var Ss=Object.defineProperty;var ws=(s,t,r)=>t in s?Ss(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var Ne=(s,t,r)=>ws(s,typeof t!="symbol"?t+"":t,r);import{r as a,j as e,a as ze}from"./react-CvHEjaVo.js";import{c as Cs}from"./react-dom-D1dbQIcV.js";import{c as ks}from"./zustand-CcenMFwO.js";import{i as ss}from"./i18next-D9VJDghF.js";import{B as Is}from"./i18next-http-backend-BfZSjpC0.js";import{i as Ns,u as B}from"./react-i18next-CkKBCMHl.js";import{s as N,T as $e,F as oe,I as be,B as Ps}from"./antd-BlTqEuCW.js";import{F as Fs}from"./react-icons-C3dNpHPf.js";import{a as _s}from"./axios-DGDcxXwr.js";import{u as ne,a as Ee,O as Es,N as Ds,B as Rs,R as Ws,b as z}from"./react-router-DAJ4nj9Z.js";import{S as Ce,M as G,I as U,B as As,N as Ms,a as Ts,b as g,T as l,L as q,c as Ls,D as De,d as Y,A as zs,e as $s,f as k,g as Bs,h as Os,i as ts,j as J,k as Z,G as P,C as rs,l as ns,m as os,n as Hs,o as $,P as A,p as as,q as qs,r as W,s as Us,t as Fe,u as le,v as ce,w as de,x as Re,y as T,z as We,E as he,F as ue,H as Ae,J as ke,K as we,O as Gs,Q as is,R as je,U as _e,V as Ys,W as Ks,X as ls,Y as cs,Z as ae,_ as H,$ as ds,a0 as Vs,a1 as Be,a2 as Me,a3 as Te,a4 as Js,a5 as Xs,a6 as hs,a7 as Qs,a8 as Zs,a9 as us,aa as ms,ab as xs,ac as gs,ad as ps,ae as re,af as et,ag as st,ah as tt,ai as rt,aj as nt,ak as ot,al as at,am as it,an as ve,ao as lt,ap as Oe,aq as ct,ar as dt,as as ht,at as ut,au as mt,av as xt,aw as gt,ax as pt,ay as He,az as jt,aA as ft}from"./@mui-Cp4kOdvE.js";import{o as bt,x as vt,y as yt,z as St,A as ye,B as wt,C as Ct,D as kt,E as It}from"./@ant-design-C-VfBzx9.js";import{S as qe,C as Ue}from"./react-transition-group-BeKoZwK3.js";import{m as js,C as fs}from"./react-big-calendar-UfWM4IL3.js";import{h as X}from"./moment-C5S46NFB.js";import{C as ie}from"./chess.js-D61LfqgS.js";import{C as bs}from"./react-chessboard-D79mwW4A.js";import"./classnames-D3cBJY9G.js";import"./scheduler-CKyTKYc2.js";import"./rc-util-D5Ku-A9K.js";import"./@babel-CMUGvuMo.js";import"./rc-motion-7F911Pcj.js";import"./rc-field-form-Ca67YJgz.js";import"./@rc-component-BkgMNXlu.js";import"./rc-resize-observer-DFMm2e6H.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-input-DGPOylTk.js";import"./dayjs-QiaqYO4y.js";import"./rc-notification-BInTsVAU.js";import"./rc-pagination-HLx0QKuY.js";import"./rc-picker-CkvEmmCl.js";import"./rc-tooltip-D4KzDfr2.js";import"./rc-textarea-CWQLdOIv.js";import"./copy-to-clipboard-CfLLryBf.js";import"./toggle-selection-DGa8lynz.js";import"./cookie--_YQFYBD.js";import"./clsx-B-dksMZM.js";import"./@emotion-DfZTMBQ9.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-YPZU7XtI.js";import"./@popperjs-B2yVk2E7.js";import"./dom-helpers-10zYd2o6.js";import"./invariant-CtPH8gXt.js";import"./uncontrollable-CbeKjXrC.js";import"./react-lifecycles-compat-AfN2QaV3.js";import"./prop-types-C2eHv_HJ.js";import"./date-arithmetic-DrY26MJF.js";import"./lodash-CuwxRx_k.js";import"./react-overlays-CmJAdYyf.js";import"./@restart-DNSoxZk-.js";import"./warning-pKr2A9xR.js";import"./memoize-one-BdPwpGay.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();const Nt=ks(s=>({theme:localStorage.getItem("theme")||"light",toggleTheme:()=>s(t=>{const r=t.theme==="light"?"dark":"light";return localStorage.setItem("theme",r),{theme:r}})})),Pt=a.createContext({toggleTheme:()=>{},mode:"light"}),Ft=({children:s})=>{const{theme:t,toggleTheme:r}=Nt();return a.useEffect(()=>{document.documentElement.setAttribute("data-theme",t)},[t]),e.jsx(Pt.Provider,{value:{toggleTheme:r,mode:t},children:s})};ss.use(Is).use(Ns).init({backend:{loadPath:"/locales/{{lng}}/{{ns}}.json"},lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1},debug:!0});const _t="http://localhost:3000/api",E=_s.create({baseURL:_t,withCredentials:!0}),Ge=s=>s==null?void 0:s.reduce((t,r)=>t+=r,""),ge=(s,t)=>(N.error({message:"Ошибка",description:t}),Promise.reject(s));E.interceptors.request.use(s=>{const t=localStorage.getItem("token");t&&(s.headers.Authorization=`Bearer ${t}`);const r=ss.language;return r&&(s.headers["Accept-Language"]=r),s},s=>Promise.reject(s));E.interceptors.response.use(s=>s,s=>{var t,r,n,i,o;if(((t=s.response)==null?void 0:t.status)===401)return N.error({message:"Сессия истекла",description:((n=(r=s.response)==null?void 0:r.data)==null?void 0:n.message)||"Пожалуйста, войдите в систему снова."}),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login",new Promise(()=>{});if(((i=s.response)==null?void 0:i.status)!==504){if(s.message==="Network Error"||!s.response)return ge(s,"Ошибка сети или сервер недоступен. Попробуйте позже.");const h=(o=s.response)==null?void 0:o.data;let u=typeof h=="string"?h:"";if(Array.isArray(h))return ge(s,Ge(h));if(Array.isArray(h==null?void 0:h.data))return ge(s,Ge(h.data));if(h!=null&&h.detail)return ge(s,h.detail);if(h instanceof Object){const f=h.msg||Object.keys(h).reduce((p,y)=>{var C;return p+=`${y}: ${((C=h[y])==null?void 0:C[0])||h[y]} `},"");return ge(s,f)}N.error({message:"Ошибка",description:u||s.message})}return Promise.reject(s)});const Et=async s=>(await E.post("/auth/login",s)).data,Dt=async s=>{try{return(await E.post("/auth/register",s)).data}catch(t){throw console.error("Registration failed",t),t}},Ye=s=>[{required:!0,message:s("validation.required")},{validator:(t,r)=>r&&r.length>=2?Promise.resolve():Promise.reject(new Error(s("validation.name_length")))}],Rt=s=>[{required:!0,message:s("validation.required")},{type:"email",message:s("validation.invalid_email")}],Wt=s=>[{required:!0,message:s("validation.required")},{min:6,message:s("validation.password_length")}],At=({mode:s})=>{const{t}=B(),r=ne(),n=s==="login",i=async h=>{try{const{token:u,user:f}=await Et(h);localStorage.setItem("token",u),localStorage.setItem("user",JSON.stringify(f)),r("/profile",{replace:!0}),N.success({message:t("auth.success.login_title"),description:t("auth.success.welcome_back",{name:f.firstName})})}catch{N.error({message:t("auth.errors.login"),description:t("auth.errors.invalid_credentials")})}},o=async h=>{var u,f;try{const y=(await Dt(h)).email;r("/verify-email",{replace:!0,state:{email:y,firstName:h.firstName,lastName:h.lastName}}),N.success({message:t("register.success.title"),description:t("register.success.description")})}catch(p){N.error({message:t("register.error.title"),description:((f=(u=p.response)==null?void 0:u.data)==null?void 0:f.msg)||t("register.error.description")})}};return e.jsxs("div",{className:"auth-form-container",children:[e.jsxs("div",{className:"auth-header",onClick:()=>r("/"),children:[e.jsx(Fs,{className:"auth-header__icon"}),e.jsx($e.Title,{level:4,className:"auth-header__brand",children:t("common.brand")})]}),e.jsx($e.Title,{level:3,className:"auth-header__title",children:t(n?"auth.sign_in":"register.title")}),e.jsxs(oe,{name:s,onFinish:n?i:o,layout:"vertical",className:"auth-form-body",size:"large",autoComplete:"off",children:[!n&&e.jsxs(e.Fragment,{children:[e.jsx(oe.Item,{label:e.jsx("span",{className:"auth-form-label",children:t("register.name")}),name:"firstName",rules:Ye(t),children:e.jsx(be,{placeholder:t("register.placeholder.name")})}),e.jsx(oe.Item,{label:e.jsx("span",{className:"auth-form-label",children:t("register.lastName")}),name:"lastName",rules:Ye(t),children:e.jsx(be,{placeholder:t("register.placeholder.lastName")})})]}),e.jsx(oe.Item,{label:e.jsx("span",{className:"auth-form-label",children:t("common.email")}),name:"email",rules:Rt(t),children:e.jsx(be,{placeholder:t("common.placeholder.email")})}),e.jsx(oe.Item,{label:e.jsx("span",{className:"auth-form-label",children:t("common.password")}),name:"password",rules:Wt(t),children:e.jsx(be.Password,{placeholder:t("common.placeholder.password")})}),e.jsx(oe.Item,{children:e.jsx(Ps,{type:"primary",htmlType:"submit",className:"auth-form-button",block:!0,children:t(n?"auth.sign_in":"register.submit")})})]}),e.jsx("div",{className:"auth-form-footer",children:n?e.jsxs(e.Fragment,{children:[t("auth.no_account")," ",e.jsx("a",{className:"auth-form-link",onClick:()=>r("/register"),children:t("auth.sign_up")})]}):e.jsxs(e.Fragment,{children:[t("register.haveAccount")," ",e.jsx("a",{className:"auth-form-link",onClick:()=>r("/login"),children:t("register.login")})]})})]})},Ke=()=>{const t=Ee().pathname.includes("register")?"register":"login";return e.jsx("div",{className:"auth-page-wrapper",children:e.jsx(At,{mode:t})})},Mt=({className:s})=>{const{i18n:t}=B(),r=n=>{const i=n.target.value;t.changeLanguage(i)};return e.jsxs(Ce,{value:t.language,onChange:r,size:"small",className:s,style:{color:"black",borderColor:"black"},children:[e.jsx(G,{value:"en",children:"EN"}),e.jsx(G,{value:"pl",children:"PL"}),e.jsx(G,{value:"uk",children:"UA"})]})},Tt=async s=>(await E.post("/notifications",s)).data,Lt=async()=>(await E.get("/notifications")).data,zt=async s=>(await E.patch("/notifications",{},{params:{notification_id:s}})).data,$t=async s=>(await E.delete("/notifications",{params:{notification_id:s}})).data,Bt=({navigateToRequests:s})=>{const[t,r]=a.useState([]),[n,i]=a.useState(null),o=!!n,h=t.filter(c=>!c.read).length,u=async()=>{try{const c=await Lt();r(Array.isArray(c)?c:[])}catch(c){console.error("Ошибка при получении уведомлений:",c)}};a.useEffect(()=>{u();const c=setInterval(u,3e4);return()=>clearInterval(c)},[]);const f=c=>{i(c.currentTarget),u()},p=()=>{i(null)},y=async(c,m)=>{c.stopPropagation();try{await $t(m),r(b=>b.filter(w=>w._id!==m))}catch(b){console.error("Ошибка при удалении уведомления:",b)}},C=c=>{c.read||(zt(c._id),r(m=>m.map(b=>b._id===c._id?{...b,read:!0}:b))),(c.type==="request"||c.type==="homework_submission")&&s(),p()},x=()=>{s(),p()};return e.jsxs("div",{children:[e.jsx(U,{color:"inherit",onClick:f,children:e.jsx(As,{badgeContent:h,color:"error",children:e.jsx(Ms,{})})}),e.jsxs(Ts,{anchorEl:n,open:o,onClose:p,PaperProps:{style:{maxHeight:300,width:"400px"}},children:[e.jsx(g,{sx:{p:2,borderBottom:"1px solid #eee"},children:e.jsx(l,{variant:"h6",children:"Уведомления"})}),t.length===0?e.jsx(G,{disabled:!0,children:"Уведомлений нет"}):t.map(c=>e.jsxs(G,{onClick:()=>C(c),sx:{bgcolor:c.read?"transparent":"action.hover",whiteSpace:"normal",alignItems:"flex-start"},children:[e.jsx(q,{primary:c.content,secondary:new Date(c.createdAt).toLocaleString()}),e.jsx(Ls,{children:e.jsx(U,{edge:"end","aria-label":"delete",onClick:m=>y(m,c._id),children:e.jsx(De,{fontSize:"small"})})})]},c._id)),e.jsx(Y,{}),e.jsx(G,{onClick:x,children:e.jsx(q,{primary:"Посмотреть все во 'Входящих'",sx:{textAlign:"center"}})})]})]})},Ot=()=>{var w,F,D;const[s,t]=a.useState(!1),r=ne(),{t:n}=B(),i=localStorage.getItem("user");let o=null;try{i&&i!=="undefined"&&i!=="null"&&(o=JSON.parse(i))}catch(v){console.error("Error parsing user from localStorage:",v),o=null}const u=!!localStorage.getItem("token")&&!!o,f=(w=o==null?void 0:o.roles)==null?void 0:w.includes("admin"),p=(F=o==null?void 0:o.roles)==null?void 0:F.includes("coach"),y=(D=o==null?void 0:o.roles)==null?void 0:D.includes("student"),C=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t(!1),r("/login")},x=()=>{t(!1),r("/register")},c=()=>{r("/inbox")},m=v=>()=>{t(v)},b=v=>{t(!1),r(v)};return e.jsxs(e.Fragment,{children:[e.jsx(zs,{position:"static",className:"navbar-appbar",children:e.jsxs($s,{className:"navbar-toolbar",children:[e.jsx(l,{variant:"h6",className:"navbar-title",onClick:()=>r("/"),children:n("navbar.chessSchool")}),e.jsxs(g,{className:"navbar-controls",children:[!u&&e.jsxs(g,{sx:{display:{xs:"none",md:"flex"},alignItems:"center"},children:[e.jsx(k,{color:"inherit",onClick:()=>r("/login"),children:n("navbar.login")}),e.jsx(k,{variant:"contained",color:"secondary",onClick:()=>r("/register"),sx:{ml:1},children:n("navbar.register")})]}),u&&e.jsx(Bt,{navigateToRequests:c}),e.jsx(U,{edge:"end",color:"inherit","aria-label":"menu",onClick:m(!0),className:"navbar-menu-button",children:e.jsx(Bs,{})})]})]})}),e.jsx(Os,{anchor:"right",open:s,onClose:m(!1),children:e.jsxs(g,{className:"navbar-drawer",children:[e.jsx(g,{className:"drawer-header",children:e.jsx(U,{onClick:m(!1),className:"close-button",children:e.jsx(bt,{className:"close-icon"})})}),e.jsxs(ts,{className:"menu-list",children:[e.jsxs(J,{onClick:()=>b("/"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(vt,{})}),e.jsx(q,{primary:n("navbar.home")})]}),e.jsxs(J,{onClick:()=>b("/about"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(yt,{})}),e.jsx(q,{primary:n("navbar.aboutUs")})]}),e.jsxs(J,{onClick:()=>b("/achievements"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(St,{})}),e.jsx(q,{primary:n("navbar.achievements")})]}),e.jsxs(J,{onClick:()=>b("/coaches"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(ye,{})}),e.jsx(q,{primary:n("navbar.coaches")})]}),u&&e.jsx(Y,{sx:{borderColor:"rgba(255, 255, 255, 0.12)"}}),u&&e.jsxs(e.Fragment,{children:[e.jsxs(J,{onClick:()=>b("/analysis"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(wt,{})}),e.jsx(q,{primary:n("navbar.chessGame")})]}),e.jsxs(J,{onClick:()=>b("/profile"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(Ct,{})}),e.jsx(q,{primary:n("navbar.profile")})]})]}),(p||f||y)&&e.jsx(Y,{sx:{borderColor:"rgba(255, 255, 255, 0.12)"}}),(p||f)&&e.jsxs(J,{onClick:()=>b("/students"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(ye,{})}),e.jsx(q,{primary:n("navbar.students")})]}),(p||f||y)&&e.jsxs(J,{onClick:()=>b("/students-shedule"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(ye,{})}),e.jsx(q,{primary:n("navbar.students-shedule")})]}),f&&e.jsxs(J,{onClick:()=>b("/users"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(ye,{})}),e.jsx(q,{primary:n("navbar.users")})]})]}),e.jsxs(g,{className:"drawer-bottom-actions",children:[u?e.jsxs(k,{onClick:C,className:"logout-button",children:[e.jsx(kt,{}),n("navbar.logout")]}):e.jsxs(k,{onClick:x,className:"get-started-button",variant:"contained",color:"secondary",children:[e.jsx(It,{style:{marginRight:"8px"}}),n("navbar.getStarted")]}),e.jsx(Mt,{className:"language-switcher"})]})]})})]})},Ht=async()=>(await E.get("/coaches")).data,qt=async s=>(await E.get(`/coach/${s}`)).data,Ut=async s=>(await E.post("/auth/coaches-by-email",{emails:s})).data,Gt=async(s,t)=>(await E.get("/trainer/student",{params:{coachEmail:s,studentId:t}})).data,Yt=async s=>(await E.get("/trainer/students",{params:{coachEmail:s}})).data,Kt=async(s,t)=>{await E.delete("/trainer/remove-student",{params:{coachEmail:s,studentId:t}})},Vt=()=>{const{t:s}=B(),t=ne(),[r,n]=a.useState([]);return a.useEffect(()=>{(async()=>{const o=await Ut(["ad3@example.com","ad7@example.com"]);n(o)})()},[]),e.jsxs(g,{py:10,px:2,sx:{backgroundColor:"#111"},children:[e.jsx(l,{variant:"h4",fontWeight:"bold",textAlign:"center",mb:6,children:s("homePage.coaches.title")}),e.jsx(P,{container:!0,spacing:4,justifyContent:"center",children:r.map(i=>e.jsx(P,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(rs,{sx:{backgroundColor:"#1a1a1a",color:"white",borderRadius:3,boxShadow:4,position:"relative","&:hover .hoverAction":{opacity:1}},children:[e.jsx(ns,{component:"img",height:"200",image:i.photoUrl||"/images/default-avatar.png",alt:`${i.firstName} ${i.lastName}`}),e.jsxs(os,{children:[e.jsxs(l,{variant:"h6",children:[i.firstName," ",i.lastName]}),e.jsx(l,{variant:"body2",color:"gray"}),e.jsx(g,{mt:1,children:[...Array(5)].map((o,h)=>e.jsx(Hs,{sx:{color:"#FFD700",fontSize:20}},h))})]}),e.jsx(g,{className:"hoverAction",sx:{position:"absolute",bottom:16,left:0,right:0,textAlign:"center",opacity:0,transition:"0.3s"},children:e.jsx(k,{variant:"contained",onClick:()=>t("/coaches",{state:{coach:i}}),sx:{backgroundColor:"#FFD700",color:"black"},children:s("homePage.coaches.selectCoach")})})]})},i._id))})]})},Jt=()=>{const{t:s}=B(),t=ne(),r=new Date().getFullYear(),n=[{icon:"🎯",key:"analytics",descKey:"descAnalytics"},{icon:"🧠",key:"memory",descKey:"descMemory"},{icon:"🏆",key:"spirit",descKey:"descSpirit"}],i=[{num:"1",titleKey:"step1Title",descKey:"step1Desc"},{num:"2",titleKey:"step2Title",descKey:"step2Desc"},{num:"3",titleKey:"step3Title",descKey:"step3Desc"}],o=[{type:"individual",icon:e.jsx(as,{sx:{fontSize:40,mb:2,color:"#FFD700"}}),descKey:"descIndividual",buttonKey:"schedule",path:"/coaches"},{type:"group",icon:e.jsx(qs,{sx:{fontSize:40,mb:2,color:"#FFD700"}}),descKey:"descGroup",buttonKey:"learnMore",path:"/classes"}];return e.jsxs(g,{sx:{backgroundColor:"#0e0e0e",color:"white",fontFamily:"'Inter', sans-serif"},children:[e.jsx(g,{sx:{backgroundImage:{xs:'url("/images/chess-cinematic-mb.jpg")',sm:'url("/images/chess-cinematic-tablet.jpg")',lg:'url("/images/chess-cinematic-lg.jpg")'},backgroundSize:"cover",backgroundPosition:"center",py:{xs:10,md:20},textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",px:2},children:e.jsxs($,{maxWidth:"md",children:[e.jsx(l,{variant:"h2",component:"h1",fontWeight:"bold",children:s("homePage.hero.title")}),e.jsx(l,{variant:"h5",mt:2,sx:{color:"rgba(255, 255, 255, 0.9)"},children:s("homePage.hero.subtitle")}),e.jsx(k,{variant:"contained",size:"large",onClick:()=>t("/coaches"),sx:{mt:4,px:5,py:1.5,borderRadius:"30px",boxShadow:"0px 8px 20px rgba(255, 215, 0, 0.3)",backgroundColor:"#FFD700",color:"black",fontWeight:"bold","&:hover":{backgroundColor:"#FFC107",transform:"translateY(-2px)",boxShadow:"0px 10px 25px rgba(255, 215, 0, 0.4)"},transition:"all 0.3s ease"},startIcon:e.jsx("span",{style:{fontSize:"1.5rem"},children:"♟️"}),children:s("homePage.hero.start")})]})}),e.jsxs($,{maxWidth:"lg",sx:{py:10},children:[e.jsx(l,{variant:"h3",component:"h2",fontWeight:"bold",textAlign:"center",mb:8,children:s("homePage.why.title")}),e.jsx(P,{container:!0,spacing:4,justifyContent:"center",children:n.map(({icon:h,key:u,descKey:f})=>e.jsx(P,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(A,{elevation:6,sx:{p:4,textAlign:"center",borderRadius:4,backgroundColor:"rgba(255,255,255,0.05)",backdropFilter:"blur(10px)",transition:"all 0.3s ease",color:"white",height:"100%","&:hover":{transform:"translateY(-10px)",backgroundColor:"rgba(255,255,255,0.1)"}},children:[e.jsx(g,{fontSize:"3.5rem",children:h}),e.jsx(l,{variant:"h5",component:"h3",mt:2,fontWeight:"bold",children:s(`homePage.why.${u}`)}),e.jsx(l,{mt:1.5,sx:{color:"rgba(255, 255, 255, 0.7)"},children:s(`homePage.why.${f}`)})]})},u))})]}),e.jsx(g,{sx:{py:5},children:e.jsx(Vt,{})}),e.jsx(g,{sx:{py:10,backgroundColor:"#121212"},children:e.jsxs($,{maxWidth:"lg",children:[e.jsx(l,{variant:"h3",component:"h2",fontWeight:"bold",textAlign:"center",mb:8,children:s("homePage.howItWorks.title")}),e.jsx(P,{container:!0,spacing:5,children:i.map(({num:h,titleKey:u,descKey:f})=>e.jsx(P,{item:!0,xs:12,md:4,children:e.jsxs(g,{sx:{textAlign:{xs:"center",md:"left"}},children:[e.jsx(l,{variant:"h1",component:"div",fontWeight:"bold",sx:{color:"#FFD700",opacity:.5},children:h}),e.jsx(l,{variant:"h5",component:"h3",fontWeight:"bold",mt:1,children:s(`homePage.howItWorks.${u}`)}),e.jsx(l,{mt:1.5,sx:{color:"rgba(255, 255, 255, 0.7)"},children:s(`homePage.howItWorks.${f}`)})]})},h))})]})}),e.jsxs($,{maxWidth:"lg",sx:{py:10},children:[e.jsx(l,{variant:"h3",component:"h2",fontWeight:"bold",textAlign:"center",mb:8,children:s("homePage.formats.title")}),e.jsx(P,{container:!0,spacing:4,justifyContent:"center",children:o.map(({type:h,icon:u,descKey:f,buttonKey:p,path:y})=>e.jsx(P,{item:!0,xs:12,md:5,children:e.jsxs(A,{elevation:6,sx:{p:4,backgroundColor:"#1c1c1c",color:"white",borderRadius:4,textAlign:"center",transition:"background-color 0.3s ease",display:"flex",flexDirection:"column",alignItems:"center",height:"100%","&:hover":{backgroundColor:"#2a2a2a"}},children:[u,e.jsx(l,{variant:"h5",component:"h3",fontWeight:"bold",children:s(`homePage.formats.${h}`)}),e.jsx(l,{mt:1.5,sx:{color:"rgba(255, 255, 255, 0.7)",flexGrow:1},children:s(`homePage.formats.${f}`)}),e.jsxs(k,{variant:"outlined",onClick:()=>t(y),sx:{mt:3,color:"#FFD700",borderColor:"#FFD700",borderRadius:"20px","&:hover":{borderColor:"#FFC107",backgroundColor:"rgba(255, 215, 0, 0.1)"}},children:[s(`homePage.formats.${p}`)," →"]})]})},h))})]}),e.jsx(g,{component:"footer",py:6,px:2,sx:{backgroundColor:"#0b0b0b",color:"gray"},children:e.jsxs($,{maxWidth:"lg",children:[e.jsxs(P,{container:!0,spacing:5,children:[e.jsxs(P,{item:!0,xs:12,sm:4,children:[e.jsx(l,{variant:"h6",fontWeight:"bold",sx:{color:"white"},children:s("homePage.footer.name")}),e.jsx(l,{variant:"body2",sx:{mt:1,color:"rgba(255,255,255,0.5)"},children:s("homePage.footer.desc")})]}),e.jsxs(P,{item:!0,xs:6,sm:2,children:[e.jsx(l,{fontWeight:"bold",sx:{color:"white"},children:s("homePage.footer.company")}),e.jsx(k,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.about")}),e.jsx(k,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.blog")}),e.jsx(k,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.coaches")})]}),e.jsxs(P,{item:!0,xs:6,sm:2,children:[e.jsx(l,{fontWeight:"bold",sx:{color:"white"},children:s("homePage.footer.resources")}),e.jsx(k,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.faq")}),e.jsx(k,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.contact")})]}),e.jsxs(P,{item:!0,xs:6,sm:2,children:[e.jsx(l,{fontWeight:"bold",sx:{color:"white"},children:s("homePage.footer.legal")}),e.jsx(k,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.privacy")}),e.jsx(k,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.terms")})]})]}),e.jsx(Y,{sx:{my:4,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsx(l,{variant:"body2",textAlign:"center",sx:{color:"rgba(255,255,255,0.4)"},children:s("homePage.footer.copyright",{year:r})})]})})]})},Xt=()=>{const{t:s}=B(),t=ne(),r=a.useMemo(()=>s("aboutPage.phrases",{returnObjects:!0})||[],[s]),n=a.useMemo(()=>s("aboutPage.testimonials.reviews",{returnObjects:!0})||[],[s]),i=a.useMemo(()=>s("aboutPage.ourCoaches.coaches",{returnObjects:!0})||[],[s]),o=a.useMemo(()=>s("aboutPage.whyUs.cards",{returnObjects:!0})||[],[s]),h=a.useMemo(()=>s("aboutPage.howItWorks.steps",{returnObjects:!0})||[],[s]),u=a.useMemo(()=>s("aboutPage.mission.points",{returnObjects:!0})||[],[s]),[f,p]=a.useState(0),[y,C]=a.useState(0);return a.useEffect(()=>{if(r.length===0||n.length===0)return;const x=setInterval(()=>{p(m=>(m+1)%r.length)},4e3),c=setInterval(()=>{C(m=>(m+1)%n.length)},5e3);return()=>{clearInterval(x),clearInterval(c)}},[r.length,n.length]),e.jsxs(g,{sx:{bgcolor:"#0e0e0e",color:"white"},children:[e.jsx(g,{sx:{position:"relative",py:{xs:10,md:15},textAlign:"center",backgroundImage:'linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.8)), url("/images/chess-cinematic-lg.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:e.jsxs($,{maxWidth:"md",children:[e.jsx(l,{variant:"h2",component:"h1",fontWeight:"bold",sx:{textTransform:"uppercase",letterSpacing:"2px"},children:s("aboutPage.mainTitle")}),e.jsx(g,{sx:{height:"2.5em",my:2},children:e.jsx(qe,{mode:"out-in",children:e.jsx(Ue,{timeout:300,classNames:"fade",children:e.jsx(l,{variant:"h5",sx:{color:"#FFD700",fontStyle:"italic"},children:r.length>0?r[f]:""})},f)})}),e.jsxs(W,{direction:{xs:"column",sm:"row"},justifyContent:"center",spacing:2,mt:4,children:[e.jsx(k,{variant:"contained",onClick:()=>t("/register"),size:"large",sx:{bgcolor:"#FFD700",color:"black",borderRadius:"30px",px:5,"&:hover":{bgcolor:"#FFC107"}},children:s("aboutPage.ctaStudent")}),e.jsx(k,{variant:"outlined",onClick:()=>t("/coaches"),size:"large",sx:{color:"white",borderColor:"rgba(255,255,255,0.5)",borderRadius:"30px",px:5,"&:hover":{borderColor:"white",bgcolor:"rgba(255,255,255,0.1)"}},children:s("aboutPage.ctaCoaches")})]})]})}),e.jsxs($,{maxWidth:"lg",sx:{py:8},children:[e.jsxs(g,{sx:{textAlign:"center",my:8},children:[e.jsxs(W,{direction:"row",spacing:2,justifyContent:"center",alignItems:"center",sx:{color:"#FFD700",mb:1},children:[e.jsx(Us,{fontSize:"large"}),e.jsx(l,{variant:"h4",component:"h2",fontWeight:"bold",children:s("aboutPage.mission.title")})]}),e.jsx(l,{variant:"h6",sx:{maxWidth:720,mx:"auto",color:"rgba(255,255,255,0.7)",mb:3},children:s("aboutPage.mission.subtitle")}),e.jsx(W,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"center",children:u.map((x,c)=>e.jsxs(W,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(Fe,{sx:{color:"success.main"}}),e.jsx(l,{children:x})]},c))})]}),e.jsx(Y,{sx:{my:8,borderColor:"rgba(255,255,255,0.2)"}}),e.jsxs(g,{sx:{my:8},children:[e.jsx(l,{variant:"h4",component:"h2",fontWeight:"bold",align:"center",sx:{mb:6},children:s("aboutPage.whyUs.title")}),e.jsx(P,{container:!0,spacing:4,children:o.map((x,c)=>e.jsx(P,{item:!0,xs:12,md:4,children:e.jsxs(A,{sx:{p:4,bgcolor:"#1c1c1c",borderRadius:4,textAlign:"center",height:"100%",transition:"all 0.3s ease","&:hover":{transform:"translateY(-10px)",boxShadow:"0 10px 20px rgba(255,215,0,0.15)"}},children:[e.jsx(l,{fontSize:"3rem",children:x.icon}),e.jsx(l,{variant:"h6",fontWeight:"bold",my:1,children:x.title}),e.jsx(l,{sx:{color:"rgba(255,255,255,0.6)"},children:x.description})]})},c))})]}),e.jsxs(g,{sx:{my:8,py:6,bgcolor:"#1c1c1c",borderRadius:4},children:[e.jsx(l,{variant:"h4",component:"h2",fontWeight:"bold",align:"center",sx:{mb:6},children:s("aboutPage.howItWorks.title")}),e.jsx(P,{container:!0,spacing:4,sx:{px:4},children:h.map((x,c)=>e.jsx(P,{item:!0,xs:12,md:4,children:e.jsxs(W,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(l,{variant:"h2",fontWeight:"bold",sx:{color:"#FFD700",opacity:.5},children:`0${c+1}`}),e.jsxs(g,{children:[e.jsx(l,{variant:"h6",fontWeight:"bold",children:x.step}),e.jsx(l,{sx:{color:"rgba(255,255,255,0.6)"},children:x.desc})]})]})},c))})]}),e.jsxs(P,{container:!0,spacing:8,sx:{my:8},children:[e.jsxs(P,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"h4",component:"h2",fontWeight:"bold",sx:{mb:3},children:s("aboutPage.testimonials.title")}),e.jsx(A,{sx:{p:4,bgcolor:"#1c1c1c",borderRadius:4,minHeight:180},children:e.jsx(qe,{children:e.jsx(Ue,{timeout:300,classNames:"fade",children:e.jsx(g,{children:n.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(l,{fontStyle:"italic",fontSize:"1.1rem",sx:{color:"rgba(255,255,255,0.8)"},children:["“",n[y].quote,"”"]}),e.jsxs(l,{fontWeight:"bold",mt:2,sx:{color:"#FFD700"},children:["— ",n[y].name]})]}):null})},y)})})]}),e.jsxs(P,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"h4",component:"h2",fontWeight:"bold",sx:{mb:3},children:s("aboutPage.ourCoaches.title")}),e.jsxs(W,{spacing:2,children:[i.map((x,c)=>e.jsxs(A,{sx:{p:2,bgcolor:"#1c1c1c",borderRadius:2},children:[e.jsx(l,{variant:"h6",fontWeight:"bold",children:x.name}),e.jsx(l,{variant:"body2",fontStyle:"italic",sx:{color:"rgba(255,255,255,0.6)"},children:x.quote})]},c)),e.jsxs(k,{variant:"text",onClick:()=>t("/coaches"),sx:{color:"#FFD700",alignSelf:"flex-start"},children:[s("aboutPage.ourCoaches.viewAll")," →"]})]})]})]}),e.jsx(Y,{sx:{my:8,borderColor:"rgba(255,255,255,0.2)"}}),e.jsx(l,{align:"center",fontWeight:"bold",variant:"h5",component:"p",sx:{fontStyle:"italic"},children:s("aboutPage.finalSlogan")})]})]})},Qt=()=>e.jsx($,{children:e.jsx(l,{variant:"h3",gutterBottom:!0,children:"Achievments"})}),Zt=()=>!!localStorage.getItem("token"),er=()=>Zt()?e.jsx(Es,{}):e.jsx(Ds,{to:"/login"}),sr=async()=>(await E.get("/auth/profile")).data,Ve=async s=>{const t=new FormData;return Object.keys(s).forEach(n=>{const i=s[n];i&&t.append(n,i)}),(await E.put("/auth/profile",t)).data},tr=s=>{const t=E.defaults.baseURL;return t?`${t}/auth/avatar/${s}`:"/default-avatar.png"},rr=({user:s,onClose:t})=>{const{t:r}=B(),[n,i]=a.useState(s.firstName),[o,h]=a.useState(s.lastName),[u,f]=a.useState(s.email),[p,y]=a.useState(""),[C,x]=a.useState(""),[c,m]=a.useState(""),[b,w]=a.useState(!1),[F,D]=a.useState(null),[v,I]=a.useState(s.photoUrl),d=S=>{var O;const R=(O=S.target.files)==null?void 0:O[0];R&&(D(R),I(URL.createObjectURL(R)))},j=async()=>{try{if(!b)await Ve({firstName:n,lastName:o,email:u,avatar:F||void 0}),N.success({message:r("profile_edit.updated"),description:void 0});else{if(!p||C!==c){N.error({message:r("profile_edit.passwordMismatch"),description:void 0});return}await Ve({currentPassword:p,newPassword:C,avatar:F||void 0}),N.success({message:r("profile_edit.passwordChanged"),description:void 0})}t(),window.location.reload()}catch(S){console.error(S),N.error({message:r("profile_edit.updateFailed"),description:void 0})}};return e.jsxs(le,{open:!0,onClose:t,fullWidth:!0,maxWidth:"sm",children:[e.jsx(ce,{children:r("profile_edit.editTitle")}),e.jsxs(de,{children:[e.jsxs(g,{display:"flex",alignItems:"center",flexDirection:"column",mb:2,children:[e.jsx(Re,{src:v,sx:{width:96,height:96,mb:1}}),e.jsxs(k,{variant:"text",size:"small",component:"label",children:[r("profile_edit.uploadAvatar"),e.jsx("input",{hidden:!0,accept:"image/*",type:"file",onChange:d})]})]}),e.jsx(T,{margin:"dense",label:r("profile_edit.firstName"),fullWidth:!0,value:n,onChange:S=>i(S.target.value)}),e.jsx(T,{margin:"dense",label:r("profile_edit.lastName"),fullWidth:!0,value:o,onChange:S=>h(S.target.value)}),e.jsx(T,{margin:"dense",label:r("profile_edit.email"),fullWidth:!0,value:u,onChange:S=>f(S.target.value)}),!b&&e.jsx(g,{mt:1,children:e.jsx(We,{component:"button",variant:"body2",onClick:()=>w(!0),children:r("profile_edit.changePassword")})}),b&&e.jsxs(g,{mt:2,children:[e.jsx(T,{margin:"dense",label:r("profile_edit.currentPassword"),fullWidth:!0,type:"password",value:p,onChange:S=>y(S.target.value)}),e.jsx(T,{margin:"dense",label:r("profile_edit.newPassword"),fullWidth:!0,type:"password",value:C,onChange:S=>x(S.target.value)}),e.jsx(T,{margin:"dense",label:r("profile_edit.confirmPassword"),fullWidth:!0,type:"password",value:c,onChange:S=>m(S.target.value)})]})]}),e.jsxs(he,{children:[e.jsx(k,{onClick:t,children:r("profile_edit.cancel")}),e.jsx(k,{variant:"contained",onClick:j,children:r("profile_edit.save")})]})]})},Le=async s=>(await E.get(`/schedule/student/${s}`)).data,nr=async s=>(await E.post("/schedule/create",s)).data,or=async(s,t)=>(await E.put(`/schedule/${s}`,t)).data,ar=async s=>{await E.delete(`/schedule/${s}`)},Je={admin:4,coach:3,student:2,user:1},ir=(s=[])=>s.length===0?"user":[...s].sort((r,n)=>(Je[n]||0)-(Je[r]||0))[0];function Pe(s){const{children:t,value:r,index:n,...i}=s;return e.jsx("div",{role:"tabpanel",hidden:r!==n,...i,children:r===n&&e.jsx(g,{sx:{pt:3},children:t})})}const lr=({coach:s,isLoading:t})=>t?e.jsxs(A,{sx:{p:2,bgcolor:"#2a2a2a",borderRadius:3,height:"100%"},children:[e.jsx(_e,{variant:"text",width:"60%",sx:{bgcolor:"grey.700"}}),e.jsx(_e,{variant:"text",width:"40%",sx:{bgcolor:"grey.700"}})]}):s?e.jsx(A,{sx:{p:2,bgcolor:"#2a2a2a",color:"white",borderRadius:3,height:"100%"},children:e.jsxs(W,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(as,{sx:{color:"#FFD700"}}),e.jsxs(g,{children:[e.jsx(l,{variant:"h6",children:"Your Coach"}),e.jsxs(l,{children:[s.firstName," ",s.lastName]})]})]})}):null,cr=({schedule:s,isLoading:t})=>{if(t)return e.jsx(A,{sx:{p:2,bgcolor:"#2a2a2a",borderRadius:3,height:"100%"},children:e.jsx(_e,{variant:"rectangular",height:80,sx:{bgcolor:"grey.700"}})});const r=s.filter(n=>new Date(n.date)>=new Date).slice(0,3);return e.jsxs(A,{sx:{p:2,bgcolor:"#2a2a2a",color:"white",borderRadius:3,height:"100%"},children:[e.jsxs(W,{direction:"row",spacing:2,alignItems:"center",mb:2,children:[e.jsx(Ys,{sx:{color:"#FFD700"}}),e.jsx(l,{variant:"h6",children:"Upcoming Lessons"})]}),e.jsx(W,{spacing:1,children:r.length>0?r.map(n=>e.jsxs(l,{children:["- ",n.title," (",new Date(n.date).toLocaleDateString(),")"]},n._id)):e.jsx(l,{sx:{color:"grey.500"},children:"No upcoming lessons."})})]})},dr=()=>{const{t:s}=B(),t=ne(),[r,n]=a.useState(null),[i,o]=a.useState(null),[h,u]=a.useState([]),[f,p]=a.useState({profile:!0,coach:!1,schedule:!1}),[y,C]=a.useState(null),[x,c]=a.useState(!1),[m,b]=a.useState(0);a.useEffect(()=>{(async()=>{p(S=>({...S,profile:!0}));try{const S=await sr();n(S)}catch{C(s("profile.errorLoadingProfile")),p(R=>({...R,profile:!1}))}})()},[s]),a.useEffect(()=>{r&&(p(j=>({...j,profile:!1,coach:!0,schedule:!0})),r.trainer?qt(r.trainer).then(o).catch(j=>console.error("Failed to fetch coach data:",j)).finally(()=>p(j=>({...j,coach:!1}))):p(j=>({...j,coach:!1})),Le(r._id).then(u).catch(j=>console.error("Failed to fetch schedule:",j)).finally(()=>p(j=>({...j,schedule:!1}))))},[r]);const w=()=>{localStorage.clear(),t("/auth/login")},F=(j,S)=>b(S),D=a.useMemo(()=>r!=null&&r._id?tr(r._id):"",[r]);if(f.profile)return e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",bgcolor:"#0e0e0e"},children:e.jsx(ue,{sx:{color:"#FFD700"}})});if(y||!r)return e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",bgcolor:"#0e0e0e"},children:e.jsx(l,{color:"error",children:y||"User not found"})});const v=ir(r.roles),I=r.roles.filter(j=>j!==v),d={admin:"secondary",coach:"primary",student:"success",user:"default"}[v];return e.jsx(g,{sx:{bgcolor:"#0e0e0e",color:"white",minHeight:"100vh",py:5},children:e.jsxs($,{maxWidth:"lg",children:[e.jsxs(g,{sx:{textAlign:"center",mb:5},children:[e.jsx(l,{variant:"h2",component:"h1",fontWeight:"bold",children:s("profile.title")}),e.jsx(l,{variant:"h6",sx:{mt:1,color:"rgba(255, 255, 255, 0.7)"},children:s("profile.subtitle")})]}),e.jsx(A,{sx:{p:{xs:2,md:4},mb:4,bgcolor:"#1c1c1c",borderRadius:4,color:"white"},children:e.jsxs(W,{direction:{xs:"column",md:"row"},spacing:4,alignItems:"center",children:[e.jsx(Re,{src:D,alt:`${r.firstName} ${r.lastName}`,sx:{width:120,height:120,border:"4px solid #FFD700"}}),e.jsxs(g,{sx:{flexGrow:1,textAlign:{xs:"center",md:"left"}},children:[e.jsxs(W,{direction:"row",spacing:2,alignItems:"center",justifyContent:{xs:"center",md:"flex-start"},children:[e.jsxs(l,{variant:"h4",fontWeight:"bold",children:[r.firstName," ",r.lastName]}),e.jsx(Ae,{title:I.length>0?`Also: ${I.join(", ")}`:"",arrow:!0,children:e.jsx(ke,{label:v,color:d,size:"small",sx:{textTransform:"capitalize"}})})]}),r.trainerEmail&&e.jsxs(l,{sx:{color:"rgba(255,255,255,0.7)"},children:["Coach: ",r.trainerEmail.split("@")[0]]}),e.jsxs(l,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:[s("profile.registrationDate"),": ",new Date(r.registrationDate).toLocaleDateString()]})]}),e.jsxs(W,{direction:"row",spacing:2,sx:{mt:{xs:3,md:0}},children:[e.jsx(k,{variant:"outlined",onClick:()=>c(!0),startIcon:e.jsx(we,{}),sx:{color:"#FFD700",borderColor:"rgba(255, 215, 0, 0.5)","&:hover":{borderColor:"#FFD700"}},children:s("profile.editProfile")}),e.jsx(k,{variant:"contained",color:"error",onClick:w,startIcon:e.jsx(Gs,{}),children:s("profile.logout")})]})]})}),e.jsx(g,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(is,{value:m,onChange:F,textColor:"inherit",TabIndicatorProps:{sx:{backgroundColor:"#FFD700"}},children:[e.jsx(je,{label:s("profile.tabs.overview","Overview")}),e.jsx(je,{label:s("profile.tabs.statistics","Statistics")}),e.jsx(je,{label:s("profile.tabs.activity","Activity"),disabled:!0})]})}),e.jsxs(Pe,{value:m,index:0,children:[e.jsx(l,{variant:"h5",fontWeight:"bold",sx:{mb:3},children:"Dashboard"}),e.jsxs(P,{container:!0,spacing:3,children:[e.jsx(P,{item:!0,xs:12,md:6,children:e.jsx(lr,{coach:i,isLoading:f.coach})}),e.jsx(P,{item:!0,xs:12,md:6,children:e.jsx(cr,{schedule:h,isLoading:f.schedule})})]})]}),e.jsx(Pe,{value:m,index:1,children:e.jsxs(g,{sx:{opacity:.6,p:2,borderRadius:3,bgcolor:"#1c1c1c"},children:[e.jsx(l,{variant:"h5",fontWeight:"bold",sx:{mb:1},children:s("profile.playerStats")}),e.jsx(l,{sx:{mb:3,fontStyle:"italic",color:"rgba(255,255,255,0.7)"},children:"Game statistics will be available soon!"})]})}),e.jsx(Pe,{value:m,index:2}),x&&e.jsx(rr,{user:r,onClose:()=>c(!1)})]})})},hr=({columns:s,data:t})=>{const[r,n]=a.useState(""),[i,o]=a.useState(10),[h,u]=a.useState(0),f=x=>{n(x.target.value),u(0)},p=(x,c)=>{u(c)},y=x=>{o(parseInt(x.target.value,10)),u(0)},C=t.filter(x=>s.some(c=>{if(c.field==="actions")return!1;const m=x[c.field];return m==null?void 0:m.toString().toLowerCase().includes(r.toLowerCase())}));return e.jsxs(A,{children:[e.jsx(T,{fullWidth:!0,label:"Поиск",variant:"outlined",value:r,onChange:f,style:{padding:"16px"}}),e.jsx(Ks,{children:e.jsxs(ls,{children:[e.jsx(cs,{children:e.jsx(ae,{children:s.map(x=>e.jsx(H,{children:x.label},String(x.field)))})}),e.jsx(ds,{children:C.slice(h*i,h*i+i).map(x=>e.jsx(ae,{children:s.map(c=>e.jsx(H,{children:c.render?c.render(x):x[c.field]},String(c.field)))},x.id))})]})}),e.jsx(Vs,{rowsPerPageOptions:[10,20,50,100],component:"div",count:C.length,rowsPerPage:i,page:h,onPageChange:p,onRowsPerPageChange:y})]})},ur=()=>{const[s,t]=a.useState([]),[r,n]=a.useState(null),[i,o]=a.useState(""),[h,u]=a.useState("add"),[f,p]=a.useState(!1),[y,C]=a.useState(!1),[x,c]=a.useState({open:!1,message:"",severity:"success"});a.useEffect(()=>{(async()=>{try{const S=(await E.get("/users")).data.map(R=>({id:R._id,firstName:R.firstName,lastName:R.lastName,email:R.email,roles:R.roles,_id:R._id,registrationDate:new Date(R.registrationDate),firebaseUID:R.firebaseUID,students:R.students,trainer:R.trainer,trainerEmail:R.trainerEmail}));t(S)}catch(j){console.error("Ошибка при получении списка пользователей:",j)}})()},[]);const m=d=>{n(d),o(""),u("add"),p(!0)},b=()=>{n(null),p(!1)},w=d=>{n(d),C(!0)},F=()=>{C(!1),n(null)},D=async()=>{if(r)try{await E.put("/admin/update-role",{userEmail:r.email,role:i,action:h}),t(s.map(d=>d.id===r.id?{...d,roles:h==="add"?[...d.roles,i]:d.roles.filter(j=>j!==i)}:d)),c({open:!0,message:"Роль успешно изменена",severity:"success"}),b()}catch(d){console.error("Ошибка при изменении роли:",d),c({open:!0,message:"Ошибка при изменении роли",severity:"error"})}},v=async()=>{if(r)try{await E.delete(`/admin/delete-user/${r.id}`),t(s.filter(d=>d.id!==r.id)),c({open:!0,message:"Пользователь удалён",severity:"success"}),F()}catch(d){console.error("Ошибка при удалении пользователя:",d),c({open:!0,message:"Ошибка при удалении пользователя",severity:"error"})}},I=[{field:"firstName",label:"Имя"},{field:"lastName",label:"Фамилия"},{field:"email",label:"Email"},{field:"roles",label:"Роли",render:d=>d.roles.join(", ")},{field:"actions",label:"Действия",render:d=>e.jsxs(e.Fragment,{children:[e.jsx(U,{size:"small",onClick:()=>m(d),children:e.jsx(we,{})}),e.jsx(U,{size:"small",color:"error",onClick:()=>w(d),children:e.jsx(De,{})})]})}];return e.jsxs($,{children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:"Список пользователей"}),e.jsx(hr,{columns:I,data:s}),e.jsxs(le,{open:f,onClose:b,fullWidth:!0,maxWidth:"xs",children:[e.jsx(ce,{children:"Управление ролями"}),e.jsxs(de,{children:[e.jsxs(Be,{children:["Пользователь: ",e.jsxs("strong",{children:[r==null?void 0:r.firstName," ",r==null?void 0:r.lastName]})]}),e.jsxs(Me,{fullWidth:!0,sx:{marginTop:2},children:[e.jsx(Te,{children:"Роль"}),e.jsxs(Ce,{value:i,onChange:d=>o(d.target.value),label:"Роль",children:[e.jsx(G,{value:"student",children:"Студент"}),e.jsx(G,{value:"coach",children:"Тренер"})]})]})]}),e.jsxs(he,{children:[e.jsx(k,{onClick:b,children:"Отмена"}),e.jsx(k,{onClick:D,color:"primary",disabled:!i,children:"Сохранить"})]})]}),e.jsxs(le,{open:y,onClose:F,children:[e.jsx(ce,{children:"Подтвердите удаление"}),e.jsx(de,{children:e.jsxs(Be,{children:["Вы уверены, что хотите удалить пользователя ",r==null?void 0:r.email,"? Это действие необратимо."]})}),e.jsxs(he,{children:[e.jsx(k,{onClick:F,children:"Нет"}),e.jsx(k,{onClick:v,color:"error",children:"Да, удалить"})]})]}),e.jsx(Js,{open:x.open,autoHideDuration:4e3,onClose:()=>c({...x,open:!1}),children:e.jsx(Xs,{severity:x.severity,onClose:()=>c({...x,open:!1}),variant:"filled",children:x.message})})]})},mr=js(X),xr={individual_lesson:e.jsx(us,{fontSize:"small"}),group_lesson:e.jsx(ms,{fontSize:"small"}),homework:e.jsx(xs,{fontSize:"small"}),opening_study:e.jsx(gs,{fontSize:"small"}),tournament_participation:e.jsx(ps,{fontSize:"small"})},gr=["individual_lesson","group_lesson","homework","opening_study","tournament_participation"],pr=({event:s})=>{const t=s.type;if(!t)return null;const r=xr[t],n=`custom-event rbc-event--${t}`;return e.jsx(Ae,{title:s.description||s.title,placement:"top",children:e.jsxs("div",{className:n,children:[r,e.jsx(l,{variant:"caption",noWrap:!0,component:"span",children:s.title})]})})},jr=({open:s,onClose:t,student:r})=>{const{t:n}=B(),[i,o]=a.useState([]),[h,u]=a.useState({}),[f,p]=a.useState(null);if(!r)return null;const y=`${r.firstName} ${r.lastName}`,C=a.useCallback(()=>{u({student:r._id,status:"scheduled",title:"",type:"individual_lesson",date:"",description:"",link:""}),p(null)},[r]),x=a.useCallback(async()=>{if(r._id)try{const d=await Le(r._id);o(d)}catch(d){console.error("Failed to fetch schedule:",d),N.error({message:n("schedule.fetchError"),description:void 0})}},[r,n]),c=async()=>{const{date:d,type:j,title:S}=h;if(!d||!j||!S){N.error({message:n("schedule.fieldRequired"),description:void 0});return}const R={studentId:r._id,date:new Date(d).toISOString(),title:S,description:h.description||"",link:h.link||"",type:j,status:h.status||"scheduled"};try{const O=!!h._id;O?await or(h._id,R):await nr(R),N.success({message:n(O?"schedule.updateSuccess":"schedule.createSuccess"),description:void 0}),await x(),C()}catch(O){console.error("Failed to save event:",O)}},m=async()=>{if(h._id)try{await ar(h._id),N.success({message:n("schedule.deleteSuccess"),description:void 0}),await x(),C()}catch(d){console.error("Failed to delete event:",d)}};a.useEffect(()=>{s&&r&&(x(),C())},[s,r,x,C]);const b=a.useCallback(({start:d})=>{C(),p(d),u(j=>({...j,date:X(d).format("YYYY-MM-DDTHH:mm")}))},[C]),w=a.useCallback(d=>{p(d.date?new Date(d.date):null),u({...d,date:d.date?X(d.date).format("YYYY-MM-DDTHH:mm"):""})},[]),F=i.map(d=>({...d,id:d._id,start:new Date(d.date),end:X(d.date).add(1,"hour").toDate(),title:d.title})),D=a.useCallback(d=>({className:f&&X(d).isSame(f,"day")?"rbc-selected-slot-custom":""}),[f]),v=d=>{const{name:j,value:S}=d.target;u(R=>({...R,[j]:S}))},I=d=>{u(j=>({...j,type:d.target.value}))};return e.jsxs(le,{open:s,onClose:t,fullWidth:!0,maxWidth:"lg",className:"schedule-dialog",children:[e.jsx(ce,{className:"schedule-dialog__header",children:e.jsxs(W,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(l,{variant:"h6",component:"div",children:n("schedule.editScheduleTitle",{studentName:y})}),e.jsx(U,{"aria-label":"close",onClick:t,className:"schedule-dialog__close-btn",children:e.jsx(hs,{})})]})}),e.jsx(de,{dividers:!0,className:"schedule-dialog__content",children:e.jsxs(P,{container:!0,spacing:3,children:[e.jsx(P,{item:!0,xs:12,md:7,children:e.jsx(fs,{localizer:mr,events:F,startAccessor:"start",endAccessor:"end",selectable:!0,onSelectSlot:b,onSelectEvent:w,components:{event:pr},dayPropGetter:D,className:"schedule-calendar"})}),e.jsx(P,{item:!0,xs:12,md:5,children:e.jsxs(A,{component:"form",className:"event-form",onSubmit:d=>{d.preventDefault(),c()},children:[e.jsx(l,{variant:"h6",className:"event-form__header",children:h._id?n("schedule.eventDetails"):f?n("schedule.addEventForDate",{date:X(f).format("MMMM Do, YYYY")}):n("schedule.addEvent")}),e.jsxs(W,{spacing:2.5,className:"event-form__fields",children:[e.jsx(T,{name:"title",label:n("schedule.form_title"),variant:"filled",fullWidth:!0,value:h.title||"",onChange:v,className:"event-form__field"}),e.jsxs(Me,{variant:"filled",fullWidth:!0,className:"event-form__field",children:[e.jsx(Te,{children:n("schedule.form_type")}),e.jsx(Ce,{name:"type",value:h.type||"",onChange:I,children:gr.map(d=>e.jsx(G,{value:d,children:n(`schedule.eventTypes.${d}`)},d))})]}),e.jsx(T,{name:"description",label:n("schedule.form_description"),variant:"filled",fullWidth:!0,multiline:!0,rows:3,value:h.description||"",onChange:v,className:"event-form__field"}),e.jsx(T,{name:"link",label:n("schedule.form_link"),variant:"filled",fullWidth:!0,value:h.link||"",onChange:v,className:"event-form__field"}),e.jsx(T,{name:"date",label:n("schedule.form_date"),type:"datetime-local",variant:"filled",fullWidth:!0,value:h.date||"",onChange:v,InputLabelProps:{shrink:!0},className:"event-form__field"})]})]})})]})}),e.jsxs(he,{className:"schedule-dialog__actions",children:[e.jsx(k,{onClick:t,className:"action-button action-button--close",children:n("common.close")}),e.jsx(g,{sx:{flex:"1 1 auto"}}),h._id&&e.jsx(k,{onClick:m,variant:"outlined",startIcon:e.jsx(De,{}),className:"action-button action-button--delete",children:n("common.delete")}),e.jsx(k,{onClick:c,variant:"contained",startIcon:h._id?e.jsx(Qs,{}):e.jsx(Zs,{}),className:"action-button action-button--save",children:h._id?n("common.save"):n("common.add")})]})]})},fr=()=>{const{t:s}=B(),[t,r]=a.useState([]),[n,i]=a.useState(null),[o,h]=a.useState(!1),[u,f]=a.useState(!0),p=a.useMemo(()=>{const c=localStorage.getItem("user");return c?JSON.parse(c).email:null},[]),y=a.useCallback(async()=>{if(!p){f(!1);return}f(!0);try{const c=await Yt(p);if(!Array.isArray(c)||c.length===0){r([]);return}const m=c.map(w=>Gt(p,w)),b=await Promise.all(m);r(b.filter(w=>w!==null))}catch(c){console.error("Ошибка при получении списка учеников:",c),N.error({message:s("studentsPage.fetchError"),description:void 0}),r([])}finally{f(!1)}},[p,s]),C=async c=>{if(p)try{await Kt(p,c),N.success({message:s("studentsPage.studentDeletedSuccess"),description:void 0}),r(m=>m.filter(b=>b._id!==c))}catch(m){console.error("Ошибка при удалении ученика:",m)}},x=c=>{i(c),h(!0)};return a.useEffect(()=>{y()},[y]),e.jsxs($,{children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:s("studentsPage.studentsListTitle")}),e.jsx(A,{children:e.jsxs(ls,{children:[e.jsx(cs,{children:e.jsxs(ae,{children:[e.jsx(H,{children:s("studentsPage.firstName")}),e.jsx(H,{children:s("studentsPage.lastName")}),e.jsx(H,{children:s("studentsPage.email")}),e.jsx(H,{align:"right",children:s("studentsPage.actions")})]})}),e.jsx(ds,{children:u?e.jsx(ae,{children:e.jsxs(H,{colSpan:4,align:"center",children:[e.jsx(ue,{}),e.jsx(l,{sx:{mt:1},children:s("common.loading")})]})}):t.length>0?t.map(c=>e.jsxs(ae,{children:[e.jsx(H,{children:c.firstName}),e.jsx(H,{children:c.lastName}),e.jsx(H,{children:c.email}),e.jsxs(H,{align:"right",children:[e.jsx(k,{variant:"contained",color:"primary",onClick:()=>x(c),style:{marginRight:10},children:s("studentsPage.editSchedule")}),e.jsx(k,{variant:"contained",color:"secondary",onClick:()=>C(c._id),children:s("studentsPage.delete")})]})]},c._id)):e.jsx(ae,{children:e.jsx(H,{colSpan:4,align:"center",children:s("studentsPage.noStudents")})})})]})}),n&&e.jsx(jr,{open:o,onClose:()=>h(!1),student:n})]})};class br{constructor(t){Ne(this,"game");Ne(this,"fullHistory",[]);this.game=t?new ie(t):new ie,this.fullHistory=this.game.history()}getFen(){return this.game.fen()}getTurn(){return this.game.turn()}getHistory(){return this.fullHistory}getMovesForSquare(t){return this.game.moves({square:t,verbose:!0})}getStatus(){return{isCheckmate:this.game.isCheckmate(),isStalemate:this.game.isStalemate(),isThreefoldRepetition:this.game.isThreefoldRepetition(),isInsufficientMaterial:this.game.isInsufficientMaterial(),isDraw:this.game.isDraw(),turn:this.game.turn()}}handleMove(t,r){try{const n=this.game.move({from:t,to:r,promotion:"q"});return n&&(this.fullHistory=this.game.history()),n}catch{return null}}resetGame(){this.game.reset(),this.fullHistory=[]}loadPgn(t){try{return this.game.loadPgn(t),this.fullHistory=this.game.history(),!0}catch(r){return console.error("Invalid PGN:",r),!1}}goToMove(t){const r=new ie;for(let n=0;n<t;n++)this.fullHistory[n]&&r.move(this.fullHistory[n]);this.game=r}uciToSan(t){const r=this.game.move({from:t.substring(0,2),to:t.substring(2,4),promotion:t.length===5?t.substring(4):void 0});return r?(this.game.undo(),r.san):null}}const vr=s=>{const t=a.useMemo(()=>new br(s),[s]),[r,n]=a.useState(t.getFen()),[i,o]=a.useState(t.getHistory()),[h,u]=a.useState(i.length),[f,p]=a.useState(null),[y,C]=a.useState({}),x=a.useRef(r);x.current=r;const c=a.useCallback(()=>{n(t.getFen());const I=t.getHistory();o(I),u(I.length)},[t]),m=a.useCallback(()=>{p(null),C({})},[]),b=a.useCallback((I,d)=>t.handleMove(I,d)?(c(),m(),!0):!1,[t,c,m]),w=a.useCallback(I=>{if(I===f){m();return}const d=t.getMovesForSquare(I);if(d.length===0){m();return}const j={};d.forEach(S=>{j[S.to]={background:S.flags.includes("c")?"radial-gradient(circle, rgba(0,0,0,0) 85%, rgba(0,0,0,0.2) 85%)":"radial-gradient(circle, rgba(0,0,0,0.2) 25%, transparent 30%)",borderRadius:"50%"}}),C(j),p(I)},[t,f,m]),F=a.useCallback(()=>{t.resetGame(),c(),m()},[t,c,m]),D=a.useCallback(I=>{const d=t.loadPgn(I.trim());return d&&(c(),m()),d},[t,c,m]),v=a.useCallback(I=>{t.goToMove(I),n(t.getFen()),u(I),m()},[t,m]);return{fen:r,history:i,currentMoveIndex:h,moveOptions:y,actions:{handleMove:b,onSquareClick:w,resetGame:F,loadPgn:D,goToMove:v}}},yr=({fen:s,onPieceDrop:t,onSquareClick:r,squareStyles:n})=>e.jsx(bs,{position:s,onPieceDrop:t,onSquareClick:r,customSquareStyles:n,customBoardStyle:{borderRadius:"4px",boxShadow:"0 5px 15px rgba(0, 0, 0, 0.5)"},customDarkSquareStyle:{backgroundColor:"#779952"},customLightSquareStyle:{backgroundColor:"#edeed1"}}),Xe=s=>{if(s===void 0)return"";const t=Math.abs(s);return t<.4?" =":t<1?s>0?" += ":" -= ":t<2?s>0?" ±":" ∓":s>0?" +-":" -+"},Qe=s=>s===void 0||Math.abs(s)<.4?"text.secondary":s>0?"success.light":"error.light",Sr=({history:s,currentMoveIndex:t,onMoveClick:r})=>{const n=ze.useMemo(()=>{const i=[];for(let o=0;o<s.length;o+=2)i.push({white:s[o],black:s[o+1]||null});return i},[s]);return e.jsx(A,{variant:"outlined",sx:{p:1.5,height:"100%",overflowY:"auto",bgcolor:"#1c1c1c",borderColor:"rgba(255,255,255,0.2)"},children:e.jsx(P,{container:!0,rowSpacing:.5,columnSpacing:1,sx:{fontSize:"1rem",color:"white"},children:n.map((i,o)=>{const h=o*2+1,u=o*2+2;return e.jsxs(ze.Fragment,{children:[e.jsxs(P,{item:!0,xs:2,sx:{color:"rgba(255, 255, 255, 0.6)",textAlign:"right",pt:"4px"},children:[o+1,"."]}),e.jsx(P,{item:!0,xs:5,children:e.jsxs(g,{onClick:()=>r(h),sx:{display:"flex",alignItems:"center",cursor:"pointer",p:"2px 5px",borderRadius:"4px",bgcolor:t===h?"rgba(255, 215, 0, 0.3)":"transparent","&:hover":{bgcolor:"rgba(255,255,255,0.1)"}},children:[e.jsx(l,{component:"span",children:i.white.san}),e.jsx(l,{component:"span",sx:{color:Qe(i.white.evaluation),fontWeight:"bold",ml:.5},children:Xe(i.white.evaluation)})]})}),e.jsx(P,{item:!0,xs:5,children:i.black&&e.jsxs(g,{onClick:()=>r(u),sx:{display:"flex",alignItems:"center",cursor:"pointer",p:"2px 5px",borderRadius:"4px",bgcolor:t===u?"rgba(255, 215, 0, 0.3)":"transparent","&:hover":{bgcolor:"rgba(255,255,255,0.1)"}},children:[e.jsx(l,{component:"span",children:i.black.san}),e.jsx(l,{component:"span",sx:{color:Qe(i.black.evaluation),fontWeight:"bold",ml:.5},children:Xe(i.black.evaluation)})]})})]},o)})})})},wr=({evaluation:s,depth:t,principalVariation:r,isAnalyzing:n,isEngineOn:i,onToggleEngine:o})=>e.jsxs(A,{variant:"outlined",sx:{p:2,borderColor:"rgba(255,255,255,0.2)",borderRadius:2},children:[e.jsxs(W,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(l,{variant:"h4",fontWeight:"bold",sx:{color:"#FFD700"},children:s??e.jsx(l,{component:"span",color:"text.secondary",children:"..."})}),e.jsxs(W,{direction:"row",alignItems:"center",spacing:1,children:[e.jsxs(W,{alignItems:"flex-end",children:[e.jsxs(l,{variant:"body2",color:"text.secondary",children:["Depth: ",t]}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"SF 16"})]}),e.jsx(re,{control:e.jsx(et,{checked:i,onChange:o,sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#FFD700"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#FFD700"}}}),label:"",sx:{mr:0}})]})]}),e.jsx(Y,{sx:{my:1,borderColor:"rgba(255,255,255,0.2)"}}),e.jsx(g,{sx:{minHeight:"4em",overflowX:"auto",whiteSpace:"nowrap"},children:e.jsx(l,{variant:"body1",children:r||(n?"Analyzing...":e.jsx(l,{component:"span",color:"text.secondary",children:"-"}))})})]}),Cr=()=>{const{t:s}=B(),{fen:t,history:r,currentMoveIndex:n,moveOptions:i,actions:o}=vr(),[h,u]=a.useState([]),[f,p]=a.useState(""),[y,C]=a.useState(null),[x,c]=a.useState(!1),[m,b]=a.useState(null),[w,F]=a.useState(0),[D,v]=a.useState(""),[I,d]=a.useState(!1),j=a.useRef(t);a.useEffect(()=>{j.current=t},[t]),a.useEffect(()=>{u(r.map(M=>({san:M})))},[r]);const S=()=>{b(null),F(0),v("")},R=()=>{o.loadPgn(f)?(S(),N.success({message:s("chessGame.pgnLoadSuccess"),description:void 0})):N.error({message:s("chessGame.pgnLoadError"),description:void 0})},O=()=>{o.resetGame(),S(),N.success({message:s("chessGame.resetSuccess"),description:void 0})},ee=M=>{o.goToMove(M),S()},xe=a.useCallback(()=>{y&&!x&&(c(!0),S(),y.postMessage(`position fen ${t}`),y.postMessage("go depth 18"))},[y,t,x]);a.useEffect(()=>{I?xe():y&&(y.postMessage("stop"),c(!1))},[t,I,xe,y]);const fe=M=>{d(M.target.checked)},_=a.useCallback((M,Q)=>{try{const L=new ie(Q),se=M.split(" ");let K="";for(const V of se){const te=L.move({from:V.substring(0,2),to:V.substring(2,4),promotion:V.length===5?V.substring(4):void 0});if(te)L.turn()==="b"?K+=`${L.moveNumber()}. ${te.san} `:K+=`${te.san} `;else break}return K.trim()}catch{return M}},[]);return a.useEffect(()=>{const M=new Worker("/workers/stockfish.js");return C(M),M.postMessage("uci"),M.onmessage=Q=>{const L=Q.data;if(L!=="uciok"){if(L.startsWith("info depth")){const se=L.match(/depth (\d+)/),K=L.match(/score (cp|mate) (-?\d+)/),V=L.match(/ pv (.+)/);if(se&&F(parseInt(se[1],10)),K){const te=new ie(j.current).turn(),vs=K[1];let Ie=parseInt(K[2],10);te==="b"&&(Ie*=-1);const ys=vs==="cp"?(Ie/100).toFixed(2):`M${Math.abs(Ie)}`;b(ys)}if(V){const te=_(V[1],j.current);v(te)}}L.startsWith("bestmove")&&c(!1)}},()=>M.terminate()},[_]),e.jsx(g,{sx:{bgcolor:"#0e0e0e",color:"white",minHeight:"100vh",py:{xs:2,md:5}},children:e.jsxs($,{maxWidth:"xl",children:[e.jsxs(g,{sx:{textAlign:"center",mb:4},children:[e.jsx(l,{variant:"h2",component:"h1",fontWeight:"bold",children:s("chessGame.title")}),e.jsx(l,{variant:"h6",sx:{mt:1,color:"rgba(255, 255, 255, 0.7)"},children:s("chessGame.subtitle")})]}),e.jsxs(P,{container:!0,spacing:4,children:[e.jsx(P,{item:!0,xs:12,md:7,children:e.jsx(A,{sx:{p:2,bgcolor:"#1c1c1c",borderRadius:4,aspectRatio:"1 / 1",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(yr,{fen:t,onPieceDrop:o.handleMove,onSquareClick:o.onSquareClick,squareStyles:i})})}),e.jsx(P,{item:!0,xs:12,md:5,children:e.jsx(A,{sx:{p:2,bgcolor:"#1c1c1c",borderRadius:4,height:"100%"},children:e.jsxs(W,{spacing:2,height:"100%",children:[e.jsx(wr,{evaluation:m,depth:w,principalVariation:D,isAnalyzing:x,isEngineOn:I,onToggleEngine:fe}),e.jsx(g,{sx:{flexGrow:1,height:"250px"},children:e.jsx(Sr,{history:h,currentMoveIndex:n,onMoveClick:ee})}),e.jsxs(W,{direction:"row",spacing:1,justifyContent:"center",alignItems:"center",children:[e.jsx(U,{onClick:()=>ee(0),disabled:n===0,children:e.jsx(st,{})}),e.jsx(U,{onClick:()=>ee(n-1),disabled:n===0,children:e.jsx(tt,{})}),e.jsx(U,{onClick:()=>ee(n+1),disabled:n===r.length,children:e.jsx(rt,{})}),e.jsx(U,{onClick:()=>ee(r.length),disabled:n===r.length,children:e.jsx(nt,{})})]}),e.jsxs(W,{spacing:1,children:[e.jsx(T,{label:s("chessGame.pgnInputLabel"),fullWidth:!0,multiline:!0,rows:2,variant:"filled",value:f,onChange:M=>p(M.target.value),sx:{"& .MuiFilledInput-root":{backgroundColor:"rgba(255,255,255,0.1)"}}}),e.jsxs(W,{direction:"row",spacing:1,children:[e.jsx(k,{variant:"outlined",onClick:O,startIcon:e.jsx(ot,{}),fullWidth:!0,children:s("chessGame.reset")}),e.jsx(k,{variant:"outlined",onClick:R,startIcon:e.jsx(at,{}),fullWidth:!0,children:s("chessGame.loadPgn")})]})]})]})})})]})]})})},kr=({position:s,onMove:t,onSquareClick:r,boardWidth:n=500})=>e.jsx(bs,{position:s,boardWidth:n,onPieceDrop:t?(i,o)=>t(i,o):void 0,onSquareClick:r}),Ze=({initialFen:s})=>{const t=s||"8/8/8/8/8/8/8/8 w - - 0 1",[r,n]=a.useState(!1),[i]=a.useState(()=>{const v=new ie;return v.clear(),v}),[o,h]=a.useState(t),[u,f]=a.useState(null),[p,y]=a.useState(null),C=[{type:"k",color:"b",icon:"♚"},{type:"q",color:"b",icon:"♛"},{type:"r",color:"b",icon:"♜"},{type:"b",color:"b",icon:"♝"},{type:"n",color:"b",icon:"♞"},{type:"p",color:"b",icon:"♟"},{type:"k",color:"w",icon:"♔"},{type:"q",color:"w",icon:"♕"},{type:"r",color:"w",icon:"♖"},{type:"b",color:"w",icon:"♗"},{type:"n",color:"w",icon:"♘"},{type:"p",color:"w",icon:"♙"}],x=a.useRef(null);a.useEffect(()=>{const v=I=>{if(!u||!r||!x.current)return;const d=x.current.getBoundingClientRect(),j=I.clientX-d.left,S=I.clientY-d.top;j>=0&&S>=0&&j<=d.width&&S<=d.height&&y({left:j,top:S})};return window.addEventListener("mousemove",v),()=>window.removeEventListener("mousemove",v)},[u,r]);const c=(v,I,d)=>{let j=o.split(" "),S=j[2]==="-"?"":j[2];I?S=(S+d).split("").sort().join(""):S=S.replace(d,""),j[2]=S||"-";const R=j.join(" ");try{i.load(R),h(R)}catch{N.error({message:"Ошибка рокировки",description:void 0})}},m=v=>{const[I,d]=[v.charCodeAt(0)-97,8-parseInt(v[1])],S=i.board()[d][I];if(u){S&&S.type===u.type&&S.color===u.color?i.remove(v):i.put(u,v),h(i.fen());return}S&&(i.remove(v),h(i.fen()))},b=()=>{i.clear(),h(i.fen()),N.success({message:"Доска очищена!",description:void 0})},w=()=>{i.reset(),h(i.fen()),N.success({message:"Установлена начальная позиция!",description:void 0})},F=()=>{f(null),y(null)},D=()=>{if(o.split("").filter(I=>I.toLowerCase()==="k").length<2){N.error({message:"Некорректная позиция",description:"На доске должно быть как минимум два короля."});return}try{i.load(o),N.success({message:"Позиция сохранена",description:`FEN: ${o}`})}catch{N.error({message:"Ошибка сохранения",description:"Некорректная FEN-позиция"})}};return e.jsxs($,{children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:"Редактор шахматной позиции"}),e.jsxs(g,{display:"flex",children:[e.jsxs(g,{onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),style:{cursor:u?"none":"default",position:"relative",width:500,height:500},children:[e.jsx(kr,{position:o,onSquareClick:m,boardWidth:500}),p&&u&&e.jsx("div",{style:{...p,position:"absolute",pointerEvents:"none",left:p.left,top:p.top,fontSize:"32px",zIndex:1e3},children:u.icon})]}),e.jsxs(g,{ml:3,display:"flex",flexDirection:"column",children:[e.jsxs(A,{elevation:3,style:{padding:"10px",marginBottom:"20px"},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Фигуры"}),e.jsx(g,{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:1,children:C.map((v,I)=>e.jsx(g,{onClick:()=>f(v),style:{textAlign:"center",cursor:"pointer",padding:6,border:"1px solid #aaa",borderRadius:4,fontSize:24,backgroundColor:u===v?"#1976d2":"#f5f5f5",color:u===v?"#fff":"inherit"},children:v.icon},I))})]}),e.jsxs(A,{elevation:3,style:{padding:"10px",marginBottom:"20px"},children:[e.jsx(l,{variant:"h6",children:"Рокировка"}),e.jsxs(it,{row:!0,children:[e.jsx(re,{control:e.jsx(ve,{checked:o.includes("K"),onChange:v=>c(o,v.target.checked,"K")}),label:"Белые 0-0"}),e.jsx(re,{control:e.jsx(ve,{checked:o.includes("Q"),onChange:v=>c(o,v.target.checked,"Q")}),label:"Белые 0-0-0"}),e.jsx(re,{control:e.jsx(ve,{checked:o.includes("k"),onChange:v=>c(o,v.target.checked,"k")}),label:"Чёрные 0-0"}),e.jsx(re,{control:e.jsx(ve,{checked:o.includes("q"),onChange:v=>c(o,v.target.checked,"q")}),label:"Чёрные 0-0-0"})]})]}),e.jsxs(A,{elevation:3,style:{padding:"10px"},children:[e.jsx(l,{variant:"h6",children:"Ход"}),e.jsxs(lt,{row:!0,value:i.turn(),onChange:v=>{const I=o.split(" ");I[1]=v.target.value;const d=I.join(" ");try{i.load(d),h(d)}catch{N.error({message:"Ошибка изменения хода",description:void 0})}},children:[e.jsx(re,{value:"w",control:e.jsx(Oe,{}),label:"Белые"}),e.jsx(re,{value:"b",control:e.jsx(Oe,{}),label:"Чёрные"})]})]})]})]}),e.jsxs(W,{direction:"row",spacing:2,mt:3,children:[e.jsx(k,{variant:"contained",onClick:b,children:"Очистить доску"}),e.jsx(k,{variant:"contained",onClick:w,children:"Начальная позиция"}),e.jsx(k,{variant:"contained",onClick:F,children:"Убрать фигуру"}),e.jsx(k,{variant:"contained",color:"primary",onClick:D,children:"Сохранить"})]}),e.jsx(T,{label:"FEN",value:o,fullWidth:!0,multiline:!0,rows:2,onChange:v=>{const I=v.target.value;try{i.load(I),h(I)}catch{N.error({message:"Некорректный FEN",description:void 0})}},style:{marginTop:20}}),p&&u&&e.jsx("div",{style:p,children:u.icon})]})},Ir=async s=>(await E.get("/auth/check-verification",{params:{email:s}})).data,Nr=async s=>(await E.post("/auth/resend-verification",{email:s})).data,Pr=()=>{const s=ne(),t=Ee(),{t:r}=B(),{firstName:n,lastName:i,email:o}=t.state||{},[h,u]=a.useState(!1),[f,p]=a.useState(!0),[y,C]=a.useState(null),[x,c]=a.useState(null),[m,b]=a.useState(!1),w=a.useRef(null);a.useEffect(()=>{if(!o){console.error("Email not found in location state. Redirecting to register."),s("/register");return}return w.current=setInterval(async()=>{try{const{emailVerified:D}=await Ir(o);D&&(p(!1),s("/login",{state:{message:r("verifyEmail.verifiedAndReadyToLogin")}}))}catch(D){console.error("Polling error:",D)}},5e3),()=>{w.current&&clearInterval(w.current)}},[o,s,r]);const F=async()=>{var D;if(o){u(!0),C(null),c(null);try{await Nr(o),C(r("verifyEmail.resendSuccess")),b(!0),setTimeout(()=>b(!1),12e4)}catch(v){((D=v.response)==null?void 0:D.status)===429?c(r("verifyEmail.resendErrorTooMany")):c(r("verifyEmail.resendError"))}finally{u(!1)}}};return e.jsxs(g,{textAlign:"center",mt:5,p:2,children:[f&&e.jsx(ue,{sx:{mb:2}}),e.jsx(l,{variant:"h4",gutterBottom:!0,children:r("verifyEmail.pageTitle")}),e.jsx(l,{variant:"body1",gutterBottom:!0,children:e.jsx("b",{children:r("verifyEmail.greeting",{firstName:n||"",lastName:i||""})})}),e.jsx(l,{variant:"body1",gutterBottom:!0,children:r("verifyEmail.sentTo",{email:o||r("verifyEmail.yourEmail")})}),e.jsx(l,{variant:"body1",color:"text.secondary",sx:{mt:2,maxWidth:"600px",mx:"auto"},children:r("verifyEmail.instruction")}),y&&!x&&e.jsx(l,{variant:"body2",color:"primary.main",sx:{mt:2,fontWeight:"bold"},children:y}),x&&e.jsx(l,{variant:"body2",color:"error",sx:{mt:2,fontWeight:"bold"},children:x}),e.jsx(k,{variant:"contained",color:"primary",onClick:F,disabled:m||h,sx:{mt:3,mb:2},children:r(h?"verifyEmail.sending":"verifyEmail.resendButton")}),e.jsx(l,{variant:"caption",display:"block",children:r("verifyEmail.didNotReceive")})]})},Fr=async()=>(await E.get("/trainer/requests",{})).data,_r=async(s,t)=>{await E.patch(`/trainer/request?request_id=${s}`,{status:t})},Er=async(s,t,r)=>(await E.post("/trainer/request",{coachId:s,experience:t,goals:r})).data,Se={"& .MuiInputBase-root":{backgroundColor:"rgba(255, 255, 255, 0.08)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.12)"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.6)"},"& .MuiInputBase-input":{color:"white"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.6)"}},Dr=()=>{var ee,xe,fe;const{t:s}=B(),[t,r]=a.useState([]),[n,i]=a.useState(null),[o,h]=a.useState(""),[u,f]=a.useState(!1),[p,y]=a.useState(!1),[C,x]=a.useState(!1),[c,m]=a.useState(!1),b=localStorage.getItem("email"),[w,F]=a.useState({userName:"",userEmail:"",experienceLevel:"Intermediate",goals:""}),[D,v]=a.useState({title:"",experience:"",bio:"",price:"",services:""});a.useEffect(()=>{(async()=>{try{const M=await Ht();r(M)}catch{N.error({message:s("coaches.fetchError"),description:void 0})}})()},[s]);const I=_=>{var M,Q,L,se,K,V;i(_),f(!0),x(!1),m(!1),v({title:((M=_.coachProfile)==null?void 0:M.title)||"",experience:((Q=_.coachProfile)==null?void 0:Q.experience)||"",bio:((L=_.coachProfile)==null?void 0:L.bio)||"",price:((K=(se=_.coachProfile)==null?void 0:se.price)==null?void 0:K.toString())||"",services:(((V=_.coachProfile)==null?void 0:V.services)||[]).join(", ")})},d=()=>{f(!1),setTimeout(()=>{i(null),x(!1),m(!1),F({userName:"",userEmail:"",experienceLevel:"Intermediate",goals:""})},300)},j=async()=>{if(n)try{y(!0),await Er(n._id,w.experienceLevel,w.goals),N.success({message:s("coaches.successMessage"),description:void 0}),d()}catch{N.error({message:s("coaches.submitError"),description:void 0})}finally{y(!1)}},S=async()=>{console.log("Saving profile:",D),N.success({message:s("coaches.updated"),description:void 0}),d()},R=t.filter(_=>`${_.firstName} ${_.lastName}`.toLowerCase().includes(o.toLowerCase())),O=n?`${n.firstName} ${n.lastName}`:"";return e.jsx(g,{sx:{bgcolor:"#0e0e0e",color:"white",minHeight:"100vh",py:8},children:e.jsxs($,{maxWidth:"lg",children:[e.jsxs(g,{sx:{textAlign:"center",mb:8},children:[e.jsx(l,{variant:"h2",component:"h1",fontWeight:"bold",children:s("coaches.title")}),e.jsx(l,{variant:"h6",sx:{mt:1,color:"rgba(255, 255, 255, 0.7)"},children:s("coaches.subtitle")})]}),e.jsx(g,{sx:{mb:5,maxWidth:"600px",mx:"auto"},children:e.jsx(T,{fullWidth:!0,variant:"outlined",placeholder:s("coaches.searchByName"),value:o,onChange:_=>h(_.target.value),sx:{"& .MuiOutlinedInput-root":{borderRadius:"30px",backgroundColor:"#1c1c1c","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"#FFD700"},"&.Mui-focused fieldset":{borderColor:"#FFD700"}},"& .MuiInputBase-input":{color:"white"}},InputProps:{startAdornment:e.jsx(ct,{position:"start",children:e.jsx(dt,{sx:{color:"rgba(255, 255, 255, 0.5)"}})})}})}),e.jsx(P,{container:!0,spacing:4,children:R.map(_=>{var M,Q,L;return e.jsx(P,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(rs,{sx:{bgcolor:"#1c1c1c",color:"white",borderRadius:4,height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-8px)",boxShadow:"0 12px 24px rgba(255, 215, 0, 0.2)"}},children:[e.jsx(ns,{component:"img",height:"250",image:_.photoUrl||"/images/default-avatar.png",alt:`${_.firstName} ${_.lastName}`}),e.jsxs(os,{sx:{flexGrow:1},children:[e.jsxs(l,{variant:"h5",component:"div",fontWeight:"bold",children:[_.firstName," ",_.lastName]}),e.jsx(l,{variant:"body1",sx:{color:"#FFD700",mb:2},children:((M=_.coachProfile)==null?void 0:M.title)||"Chess Master"}),e.jsxs(W,{spacing:1,children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",color:"rgba(255,255,255,0.7)"},children:[e.jsx(ht,{fontSize:"small",sx:{mr:1}}),e.jsx(l,{variant:"body2",children:((Q=_.coachProfile)==null?void 0:Q.experience)||"N/A"})]}),e.jsxs(g,{sx:{display:"flex",alignItems:"center",color:"rgba(255,255,255,0.7)"},children:[e.jsx(ut,{fontSize:"small",sx:{mr:1}}),e.jsx(l,{variant:"body2",children:(L=_.coachProfile)!=null&&L.price?`${_.coachProfile.price}$ / hour`:"Contact for price"})]})]})]}),e.jsx(g,{sx:{p:2,pt:0},children:e.jsx(k,{variant:"contained",fullWidth:!0,onClick:()=>I(_),sx:{backgroundColor:"#FFD700",color:"black",fontWeight:"bold",borderRadius:"20px","&:hover":{backgroundColor:"#FFC107"}},children:s("coaches.viewProfile")})})]})},_._id)})}),e.jsx(le,{open:u,onClose:d,fullWidth:!0,maxWidth:"md",PaperProps:{sx:{bgcolor:"#1c1c1c",color:"white",borderRadius:4,backgroundImage:"none"}},children:n&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{sx:{p:3,pb:1},children:e.jsxs(W,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(l,{variant:"h5",fontWeight:"bold",children:c?s("coaches.editProfile"):s("coaches.profileOf",{coachName:O})}),e.jsx(U,{onClick:d,sx:{color:"rgba(255,255,255,0.7)"},children:e.jsx(hs,{})})]})}),e.jsx(de,{children:c?e.jsx(W,{spacing:2,sx:{pt:1}}):e.jsxs(e.Fragment,{children:[e.jsxs(P,{container:!0,spacing:4,sx:{pt:1},children:[e.jsx(P,{item:!0,xs:12,md:4,children:e.jsx(Re,{src:n.photoUrl||"/images/default-avatar.png",sx:{width:"100%",height:"auto",aspectRatio:"1 / 1",borderRadius:3},variant:"rounded"})}),e.jsx(P,{item:!0,xs:12,md:8,children:e.jsxs(W,{spacing:2.5,children:[e.jsxs(g,{children:[e.jsx(l,{fontWeight:"bold",color:"#FFD700",children:s("coaches.bio")}),e.jsx(l,{sx:{color:"rgba(255,255,255,0.8)",whiteSpace:"pre-wrap"},children:((ee=n.coachProfile)==null?void 0:ee.bio)||e.jsx("span",{style:{color:"rgba(255,255,255,0.5)",fontStyle:"italic"},children:"No bio provided."})})]}),e.jsxs(g,{children:[e.jsx(l,{fontWeight:"bold",color:"#FFD700",children:s("coaches.services")}),e.jsx(g,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:(fe=(xe=n.coachProfile)==null?void 0:xe.services)!=null&&fe.length?n.coachProfile.services.map(_=>e.jsx(ke,{label:_,sx:{bgcolor:"rgba(255,255,255,0.2)",color:"white"}},_)):e.jsx(l,{sx:{color:"rgba(255,255,255,0.5)",fontStyle:"italic"},children:"No services listed."})})]})]})})]}),e.jsx(Y,{sx:{my:3,borderColor:"rgba(255,255,255,0.2)"}}),e.jsx(g,{children:C?e.jsxs(A,{elevation:0,sx:{p:{xs:2,sm:3},bgcolor:"rgba(0,0,0,0.25)",borderRadius:2},children:[e.jsx(l,{variant:"h6",fontWeight:"bold",sx:{mb:2},children:s("coaches.requestTitle",{coachName:O})}),e.jsxs(W,{spacing:2,children:[e.jsx(T,{fullWidth:!0,label:s("coaches.yourName"),value:w.userName,onChange:_=>F({...w,userName:_.target.value}),variant:"filled",sx:Se}),e.jsx(T,{fullWidth:!0,label:s("coaches.yourEmail"),value:w.userEmail,onChange:_=>F({...w,userEmail:_.target.value}),variant:"filled",sx:Se}),e.jsxs(Me,{fullWidth:!0,variant:"filled",sx:Se,children:[e.jsx(Te,{id:"level-select-label",children:s("coaches.level")}),e.jsxs(Ce,{labelId:"level-select-label",value:w.experienceLevel,onChange:_=>F({...w,experienceLevel:_.target.value}),children:[e.jsx(G,{value:"Beginner",children:s("coaches.levelBeginner")}),e.jsx(G,{value:"Intermediate",children:s("coaches.levelIntermediate")}),e.jsx(G,{value:"Advanced",children:s("coaches.levelAdvanced")})]})]}),e.jsx(T,{fullWidth:!0,multiline:!0,rows:3,label:s("coaches.goals"),value:w.goals,onChange:_=>F({...w,goals:_.target.value}),variant:"filled",sx:Se})]})]}):e.jsx(k,{fullWidth:!0,variant:"outlined",onClick:()=>x(!0),sx:{color:"#FFD700",borderColor:"#FFD700","&:hover":{borderColor:"#FFC107",bgcolor:"rgba(255, 215, 0, 0.1)"}},children:s("coaches.requestTitle",{coachName:n.firstName})})})]})}),e.jsx(he,{sx:{p:3,pt:2},children:c?e.jsxs(e.Fragment,{children:[e.jsx(k,{onClick:()=>m(!1),sx:{color:"rgba(255,255,255,0.7)"},children:s("coaches.cancel")}),e.jsx(k,{variant:"contained",onClick:S,startIcon:e.jsx(we,{}),sx:{bgcolor:"#FFD700",color:"black","&:hover":{bgcolor:"#FFC107"}},children:s("coaches.save")})]}):C?e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"outlined",onClick:()=>x(!1),sx:{color:"rgba(255,255,255,0.7)",borderColor:"rgba(255,255,255,0.3)"},children:s("coaches.cancel")}),e.jsx(k,{variant:"contained",onClick:j,disabled:p,startIcon:e.jsx(mt,{}),sx:{bgcolor:"#FFD700",color:"black","&:hover":{bgcolor:"#FFC107"}},children:s("coaches.sendRequest")})]}):n.email===b&&e.jsx(k,{variant:"text",onClick:()=>m(!0),startIcon:e.jsx(we,{}),sx:{color:"#FFD700"},children:s("coaches.editProfile")})})]})})]})})},Rr=async s=>{const t=new FormData;t.append("studentId",s.studentId),t.append("scheduleId",s.scheduleId),s.homeworkText&&t.append("homeworkText",s.homeworkText),s.screenshot&&t.append("screenshot",s.screenshot),await E.post("/homework/send",t)},Wr=async(s,t)=>(await E.put(`/homework/${s}/review`,t)).data,Ar=async()=>(await E.get("/homework/coach")).data,Mr=async s=>(await E.get(`/homework/${s}/screenshot`,{responseType:"blob"})).data,pe=s=>"createdAt"in s,Tr=()=>{const{t:s}=B(),[t,r]=a.useState("requests"),[n,i]=a.useState([]),[o,h]=a.useState(null),[u,f]=a.useState(!0),[p,y]=a.useState(""),[C,x]=a.useState(!1),[c,m]=a.useState(null),[b,w]=a.useState(!1),F=a.useCallback(async d=>{f(!0),h(null);try{const j=d==="requests"?await Fr():await Ar();i(Array.isArray(j)?j:[])}catch(j){console.error(`Error loading ${d}:`,j),N.error({message:s("inbox.errors.loadFailed"),description:void 0})}finally{f(!1)}},[s]);a.useEffect(()=>{F(t)},[t,F]),a.useEffect(()=>{let d=null;return(async()=>{if(!o||pe(o)||!o.hasScreenshot){m(null);return}w(!0);try{const S=await Mr(o._id);d=URL.createObjectURL(S),m(d)}catch(S){console.error("Screenshot load error:",S),N.error({message:s("inbox.errors.loadScreenshotFailed"),description:void 0})}finally{w(!1)}})(),y(""),()=>{d&&URL.revokeObjectURL(d)}},[o,s]);const D=async d=>{if(!(!o||!pe(o))){x(!0);try{await _r(o._id,d),N.success({message:s("inbox.success.requestHandled",{action:s(d==="approved"?"inbox.success.actions.approved":"inbox.success.actions.rejected")}),description:void 0}),await F("requests")}catch(j){console.error("Error handling request:",j),N.error({message:s("inbox.errors.handleRequestFailed"),description:void 0})}finally{x(!1)}}},v=async d=>{if(!(!o||pe(o))){x(!0);try{await Wr(o._id,{status:d,comment:p}),N.success({message:s("inbox.success.homeworkReviewed"),description:void 0}),await F("homework")}catch(j){console.error("Error reviewing homework:",j),N.error({message:s("inbox.errors.reviewHomeworkFailed"),description:void 0})}finally{x(!1)}}},I=()=>{var d;return u&&!o?null:o?pe(o)?e.jsxs(e.Fragment,{children:[e.jsxs(l,{variant:"h6",children:[o.student.firstName," ",o.student.lastName]}),e.jsxs(l,{children:[s("inbox.details.email"),": ",o.student.email]}),e.jsxs(l,{children:[s("inbox.details.sent"),": ",new Date(o.createdAt).toLocaleString()]}),e.jsx(Y,{sx:{my:2}}),e.jsxs(l,{children:[e.jsxs("strong",{children:[s("inbox.details.experience"),":"]})," ",o.experience||s("inbox.details.notSpecified")]}),e.jsxs(l,{children:[e.jsxs("strong",{children:[s("inbox.details.goals"),":"]})," ",o.goals||s("inbox.details.notSpecified")]}),e.jsxs(g,{mt:3,display:"flex",gap:2,children:[e.jsx(k,{variant:"contained",color:"primary",onClick:()=>D("approved"),disabled:C||o.status!=="pending",children:s("inbox.actions.approve")}),e.jsx(k,{variant:"contained",color:"secondary",onClick:()=>D("rejected"),disabled:C||o.status!=="pending",children:s("inbox.actions.reject")})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"h5",gutterBottom:!0,children:((d=o.schedule)==null?void 0:d.title)||s("inbox.list.untitled")}),e.jsxs(l,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,children:[s("inbox.details.student"),": ",o.student.firstName," ",o.student.lastName]}),e.jsx(Y,{sx:{my:2}}),o.text&&e.jsxs(g,{mb:2,children:[e.jsxs(l,{variant:"h6",children:[s("inbox.details.responseText"),":"]}),e.jsx(l,{sx:{whiteSpace:"pre-wrap",p:1,bgcolor:"action.hover",borderRadius:1},children:o.text})]}),o.hasScreenshot&&e.jsxs(g,{mb:2,children:[e.jsxs(l,{variant:"h6",children:[s("inbox.details.screenshot"),":"]}),b&&e.jsxs(g,{sx:{display:"flex",alignItems:"center",my:2},children:[e.jsx(ue,{size:24,sx:{mr:2}})," ",s("inbox.loading")]}),c&&!b&&e.jsx(We,{href:c,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:c,alt:s("inbox.details.screenshotAlt"),style:{maxWidth:"100%",height:"auto",borderRadius:"8px",border:"1px solid #ddd",display:"block",cursor:"pointer"}})})]}),e.jsx(Y,{sx:{my:2}}),e.jsxs(l,{variant:"h6",children:[s("inbox.details.feedback"),":"]}),e.jsx(T,{fullWidth:!0,multiline:!0,rows:4,label:s("inbox.details.commentLabel"),value:p,onChange:j=>y(j.target.value),margin:"normal",disabled:C}),e.jsxs(g,{mt:2,display:"flex",gap:2,children:[e.jsx(k,{variant:"contained",color:"success",onClick:()=>v("approved"),disabled:C,children:s("inbox.actions.approve")}),e.jsx(k,{variant:"contained",color:"error",onClick:()=>v("rejected"),disabled:C,children:s("inbox.actions.sendForRevision")})]})]}):e.jsx(l,{color:"text.secondary",children:s("inbox.selectItemPrompt")})};return e.jsxs($,{sx:{py:4},children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:s("inbox.title")}),e.jsx(g,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(is,{value:t,onChange:(d,j)=>r(j),"aria-label":"inbox tabs",children:[e.jsx(je,{label:s("inbox.tabs.requests"),value:"requests"}),e.jsx(je,{label:s("inbox.tabs.homework"),value:"homework"})]})}),e.jsxs(P,{container:!0,spacing:3,children:[e.jsx(P,{item:!0,xs:12,md:4,children:e.jsx(A,{style:{maxHeight:"80vh",overflow:"auto"},children:u?e.jsx(g,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(ue,{})}):e.jsx(ts,{component:"nav",children:n.length>0?n.map(d=>{var j;return e.jsx(J,{selected:(o==null?void 0:o._id)===d._id,onClick:()=>h(d),children:e.jsx(q,{primaryTypographyProps:{style:{fontWeight:(o==null?void 0:o._id)===d._id?"bold":"normal"}},primary:d.student?`${d.student.firstName} ${d.student.lastName}`:s("inbox.unknownStudent","Unknown Student"),secondary:pe(d)?s("inbox.list.requestSecondary",{date:new Date(d.createdAt).toLocaleDateString()}):s("inbox.list.homeworkSecondary",{title:((j=d.schedule)==null?void 0:j.title)||s("inbox.list.untitled","Без темы")})})},d._id)}):e.jsx(l,{sx:{p:2,textAlign:"center"},children:s("inbox.empty")})})})}),e.jsx(P,{item:!0,xs:12,md:8,children:e.jsx(A,{style:{padding:24,minHeight:"50vh",display:"flex",flexDirection:"column"},children:I()})})]})]})},Lr=js(X),zr={individual_lesson:e.jsx(us,{fontSize:"small"}),group_lesson:e.jsx(ms,{fontSize:"small"}),homework:e.jsx(xs,{fontSize:"small"}),opening_study:e.jsx(gs,{fontSize:"small"}),tournament_participation:e.jsx(ps,{fontSize:"small"})},$r=({event:s})=>{const t=zr[s.type],r=`custom-event rbc-event--${s.type}`;return e.jsx(Ae,{title:s.description||s.title,placement:"top",children:e.jsxs("div",{className:r,children:[t,e.jsx(l,{variant:"caption",noWrap:!0,component:"span",children:s.title})]})})},Br=({events:s,onSelectEvent:t})=>{const r=a.useMemo(()=>s.map(n=>({...n,start:new Date(n.date),end:X(n.date).add(1,"hour").toDate()})),[s]);return e.jsx(A,{className:"schedule-paper",style:{height:"70vh",padding:"16px"},children:e.jsx(fs,{localizer:Lr,events:r,startAccessor:"start",endAccessor:"end",views:["month","week","day","agenda"],components:{event:$r},onSelectEvent:t,className:"schedule-calendar-standalone"})})},es=5,me={scheduled:{icon:e.jsx(He,{fontSize:"small"}),color:"info",labelKey:"status.scheduled"},pending:{icon:e.jsx(He,{fontSize:"small"}),color:"warning",labelKey:"status.pending"},completed:{icon:e.jsx(Fe,{fontSize:"small"}),color:"success",labelKey:"status.completed"},approved:{icon:e.jsx(Fe,{fontSize:"small"}),color:"success",labelKey:"status.approved"},rejected:{icon:e.jsx(jt,{fontSize:"small"}),color:"error",labelKey:"status.rejected"}},Or=Object.keys(me),Hr=({event:s,onSelect:t,t:r})=>{const n=s.status,i=me[n]||me.scheduled;return e.jsxs(A,{className:`event-card event-card--${i.color}`,onClick:()=>t(s),children:[e.jsxs(g,{className:"event-card__header",children:[e.jsx(l,{variant:"h6",className:"event-card__title",children:s.title}),e.jsx(ke,{icon:i.icon,label:r(i.labelKey),color:i.color,size:"small"})]}),e.jsx(l,{variant:"body2",className:"event-card__date",children:X(s.date).format("MMMM Do, YYYY [at] HH:mm")}),s.description&&e.jsx(l,{variant:"body2",className:"event-card__description",children:s.description})]})},qr=({events:s,onSelectEvent:t,t:r})=>e.jsx(g,{className:"event-list",children:s.length===0?e.jsx(A,{className:"event-list__empty",children:e.jsx(l,{children:r("studentSchedule.noEventsForDay")})}):s.map(n=>e.jsx(Hr,{event:n,onSelect:t,t:r},n._id))}),Ur=({statusFilters:s,onFilterChange:t,t:r})=>{const n=(i,o)=>t(o);return e.jsxs(A,{className:"event-controls",children:[e.jsxs(l,{variant:"button",className:"event-controls__label",children:[r("common.filterByStatus"),":"]}),e.jsx(xt,{value:s,onChange:n,size:"small",children:Or.map(i=>e.jsx(gt,{value:i,className:"filter-toggle-button",children:r(me[i].labelKey)},i))})]})},Gr=({event:s,open:t,onClose:r,onSendHomework:n,t:i})=>{const[o,h]=a.useState(""),[u,f]=a.useState(null),[p,y]=a.useState(!1);if(a.useEffect(()=>{t||(h(""),f(null),y(!1))},[t]),!s)return null;const C=b=>{var F;const w=(F=b.target.files)==null?void 0:F[0];if(w){if(w.size>es*1024*1024){N.error({message:i("errors.fileTooLarge",{size:es}),description:void 0});return}f(w)}},x=async()=>{if(!o.trim()&&!u){N.error({message:i("errors.emptyHomework"),description:void 0});return}y(!0);try{await n(o,u)}finally{y(!1)}},c=s.status,m=me[c]||me.scheduled;return e.jsxs(le,{open:t,onClose:r,fullWidth:!0,maxWidth:"sm",className:"details-dialog",children:[e.jsx(ce,{className:`details-dialog__header details-dialog__header--${m.color}`,children:i("studentSchedule.eventDetails")}),e.jsxs(de,{className:"details-dialog__content",children:[e.jsxs(g,{className:"details-dialog__info",children:[e.jsx(l,{variant:"h6",className:"details-dialog__title",children:s.title}),e.jsx(ke,{icon:m.icon,label:i(m.labelKey),color:m.color,size:"small"})]}),e.jsx(l,{variant:"body2",children:X(s.date).format("dddd, MMMM Do, YYYY [at] HH:mm")}),s.description&&e.jsx(l,{variant:"body1",sx:{mt:2},children:s.description}),s.link&&e.jsxs(l,{variant:"body2",sx:{mt:1},children:[i("studentSchedule.form_link"),": ",e.jsx(We,{href:s.link,target:"_blank",rel:"noopener noreferrer",children:s.link})]}),s.type==="homework"&&e.jsxs(g,{className:"homework-form",children:[e.jsx(l,{variant:"h6",className:"homework-form__title",children:i("studentSchedule.sendHomeworkTitle")}),e.jsx(T,{label:i("studentSchedule.form_description"),fullWidth:!0,multiline:!0,rows:4,value:o,onChange:b=>h(b.target.value),variant:"filled",disabled:p}),e.jsxs(k,{variant:"outlined",component:"label",startIcon:e.jsx(pt,{}),disabled:p,children:[u?u.name:i("studentSchedule.uploadScreenshot"),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:C})]})]})]}),e.jsxs(he,{className:"details-dialog__actions",children:[e.jsx(k,{onClick:r,disabled:p,children:i("common.close")}),s.type==="homework"&&e.jsx(k,{onClick:x,variant:"contained",color:"primary",disabled:p,children:i("studentSchedule.send")})]})]})},Yr=()=>{const{t:s}=B(),[t,r]=a.useState([]),[n,i]=a.useState(!0),[o,h]=a.useState(null),[u,f]=a.useState([]);a.useEffect(()=>{(async()=>{const m=localStorage.getItem("user");let b=null;try{m&&m!=="undefined"&&m!=="null"&&(b=JSON.parse(m)._id)}catch(w){console.error("Ошибка парсинга пользователя из localStorage:",w)}if(!b){i(!1),N.error({message:s("errors.userNotFound"),description:void 0});return}i(!0);try{const w=await Le(b);r(w)}catch(w){console.error("Ошибка при загрузке расписания:",w),N.error({message:s("errors.fetchSchedule"),description:void 0})}finally{i(!1)}})()},[s]);const p=c=>h(c),y=()=>h(null),C=async(c,m)=>{const b=localStorage.getItem("user"),w=b?JSON.parse(b)._id:null;if(!(!w||!o))try{await Rr({studentId:w,scheduleId:o._id,homeworkText:c.trim()?c:void 0,screenshot:m||void 0}),o.coach&&await Tt({recipient:o.coach,type:"homework_submission",content:`Ученик отправил домашнее задание по теме: "${o.title}"`,metadata:{scheduleId:o._id}}),N.success({message:s("studentSchedule.homeworkSentSuccess"),description:void 0}),y(),r(F=>F.map(D=>D._id===o._id?{...D,status:"pending"}:D))}catch(F){console.error("Ошибка при отправке ДЗ:",F),N.error({message:s("errors.sendHomework"),description:void 0})}},x=a.useMemo(()=>{let c=[...t];return u.length>0&&(c=c.filter(m=>u.includes(m.status))),c.sort((m,b)=>new Date(m.date).getTime()-new Date(b.date).getTime())},[t,u]);return e.jsxs(g,{className:"student-schedule-v2-page",children:[e.jsxs($,{maxWidth:"lg",children:[e.jsx(l,{variant:"h4",component:"h1",className:"page-title",children:s("studentSchedule.myScheduleTitle")}),e.jsx(Br,{events:x,onSelectEvent:p}),e.jsxs(g,{className:"list-controls-container",children:[e.jsx(l,{variant:"h5",component:"h2",children:s("studentSchedule.eventListTitle")}),e.jsx(Ur,{statusFilters:u,onFilterChange:f,t:s})]}),n?e.jsx(g,{className:"loader-container",children:e.jsx(ue,{className:"loader"})}):e.jsx(qr,{events:x,onSelectEvent:p,t:s})]}),e.jsx(Gr,{event:o,open:!!o,onClose:y,onSendHomework:C,t:s})]})};function Kr(){const s=Ee(),t=s.pathname==="/login"||s.pathname==="/register";return e.jsxs(e.Fragment,{children:[e.jsx(ft,{}),!t&&e.jsx(Ot,{}),e.jsxs(Ws,{children:[e.jsx(z,{path:"/",element:e.jsx(Jt,{})}),e.jsx(z,{path:"/about",element:e.jsx(Xt,{})}),e.jsx(z,{path:"/achievements",element:e.jsx(Qt,{})}),e.jsx(z,{path:"/login",element:e.jsx(Ke,{})}),e.jsx(z,{path:"/register",element:e.jsx(Ke,{})}),e.jsx(z,{path:"/analysis",element:e.jsx(Cr,{})}),e.jsx(z,{path:"/verify-email",element:e.jsx(Pr,{})}),e.jsx(z,{path:"/coaches",element:e.jsx(Dr,{})}),e.jsxs(z,{element:e.jsx(er,{}),children:[e.jsx(z,{path:"/editor",element:e.jsx(Ze,{})}),e.jsx(z,{path:"/profile",element:e.jsx(dr,{})}),e.jsx(z,{path:"/users",element:e.jsx(ur,{})}),e.jsx(z,{path:"/students-shedule",element:e.jsx(Yr,{})}),e.jsx(z,{path:"/students",element:e.jsx(fr,{})}),e.jsx(z,{path:"/puzzle-editor",element:e.jsx(Ze,{})}),e.jsx(z,{path:"/inbox",element:e.jsx(Tr,{})})]})]})]})}function Vr(){return e.jsx(Rs,{children:e.jsx(a.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(Kr,{})})})}Cs.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(Ft,{children:e.jsx(Vr,{})})}));
//# sourceMappingURL=index-Bulw3hAJ.js.map
