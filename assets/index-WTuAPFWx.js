var Rt=Object.defineProperty;var Mt=(t,s,r)=>s in t?Rt(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var Ee=(t,s,r)=>Mt(t,typeof s!="symbol"?s+"":s,r);import{r as i,j as e,a as Oe}from"./react-CvHEjaVo.js";import{c as Wt}from"./react-dom-D1dbQIcV.js";import{a as Tt}from"./axios-DGDcxXwr.js";import{i as it}from"./i18next-D9VJDghF.js";import{B as Lt}from"./i18next-http-backend-BfZSjpC0.js";import{i as zt,u as H}from"./react-i18next-CkKBCMHl.js";import{s as P,T as qe,F as ue,I as we,B as $t}from"./antd-vw_2xf0X.js";import{F as Ht}from"./react-icons-C3dNpHPf.js";import{u as de,a as Re,O as Bt,N as Ot,L as lt,b as qt,R as Kt,c as B,B as Yt}from"./react-router-Dl3PYC8W.js";import{S as _e,M as V,I as G,B as Ut,N as Gt,a as Vt,b as f,T as c,L as Y,c as Jt,D as Me,d as J,A as Xt,e as Qt,f as C,g as Zt,h as es,i as ct,j as Z,k as ee,G as E,C as dt,l as ht,m as ut,n as ts,o as O,P as W,p as ss,q as rs,r as M,s as ns,t as oe,u as je,H as ge,v as We,w as ae,x as ie,y as le,z as Te,E as L,F as Se,J as ce,K as Le,O as Pe,Q as os,R as mt,U as Ne,V as as,W as xt,X as pe,Y as gt,Z as ye,_ as is,$ as pt,a0 as ft,a1 as me,a2 as K,a3 as jt,a4 as ls,a5 as Ke,a6 as ze,a7 as $e,a8 as cs,a9 as ds,aa as bt,ab as hs,ac as us,ad as vt,ae as yt,af as St,ag as wt,ah as Ct,ai as ne,aj as ms,ak as xs,al as gs,am as ps,an as fs,ao as js,ap as bs,aq as vs,ar as Ce,as as ys,at as Ye,au as Ss,av as ws,aw as Cs,ax as ks,ay as Is,az as Ns,aA as Ps}from"./@mui-BW2U2wih.js";import{f as _s,x as Fs,y as Es,z as Ds,A as ke,B as As,C as Rs,D as Ms,E as Ws}from"./@ant-design-Bks4O0NN.js";import{S as Ue,C as Ge}from"./react-transition-group-CwyNQDxX.js";import{h as U}from"./moment-C5S46NFB.js";import{m as kt,C as It}from"./react-big-calendar-D6ss7NAI.js";import{C as xe}from"./chess.js-D61LfqgS.js";import{C as Nt}from"./react-chessboard-D79mwW4A.js";import"./classnames-D3cBJY9G.js";import"./scheduler-CKyTKYc2.js";import"./rc-util-SZQLh1vV.js";import"./@babel-DlrNZQSW.js";import"./rc-resize-observer-MNGAtJ6Y.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-csAWsXJs.js";import"./@rc-component-COpoWvuY.js";import"./dayjs-QiaqYO4y.js";import"./rc-input-Byq_4lnI.js";import"./rc-field-form-Zk3m5T-Z.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-notification-DFa78zIu.js";import"./rc-pagination-DP2MtHOE.js";import"./rc-picker-CirFycse.js";import"./rc-tooltip-CR8cfE2b.js";import"./rc-textarea-CTz5dyJK.js";import"./copy-to-clipboard-CfLLryBf.js";import"./toggle-selection-DGa8lynz.js";import"./cookie--_YQFYBD.js";import"./clsx-B-dksMZM.js";import"./@emotion-M6yQISDD.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-YPZU7XtI.js";import"./@popperjs-B2yVk2E7.js";import"./dom-helpers-CYz2yaWn.js";import"./invariant-CtPH8gXt.js";import"./uncontrollable-BvgrQciZ.js";import"./react-lifecycles-compat-AfN2QaV3.js";import"./prop-types-C2eHv_HJ.js";import"./date-arithmetic-DrY26MJF.js";import"./lodash-CuwxRx_k.js";import"./react-overlays-pU_wA3Zj.js";import"./@restart-DNSoxZk-.js";import"./warning-pKr2A9xR.js";import"./memoize-one-BdPwpGay.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();it.use(Lt).use(zt).init({backend:{loadPath:"/locales/{{lng}}/{{ns}}.json"},lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1},debug:!0});const Ts="http://localhost:3000/api",D=Tt.create({baseURL:Ts,withCredentials:!0}),Ve=t=>t==null?void 0:t.reduce((s,r)=>s+=r,""),be=(t,s)=>(P.error({message:"Ошибка",description:s}),Promise.reject(t));D.interceptors.request.use(t=>{const s=localStorage.getItem("token");s&&(t.headers.Authorization=`Bearer ${s}`);const r=it.language;return r&&(t.headers["Accept-Language"]=r),t},t=>Promise.reject(t));D.interceptors.response.use(t=>t,t=>{var s,r,a,n,o;if(((s=t.response)==null?void 0:s.status)===401)return P.error({message:"Сессия истекла",description:((a=(r=t.response)==null?void 0:r.data)==null?void 0:a.message)||"Пожалуйста, войдите в систему снова."}),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login",new Promise(()=>{});if(((n=t.response)==null?void 0:n.status)!==504){if(t.message==="Network Error"||!t.response)return be(t,"Ошибка сети или сервер недоступен. Попробуйте позже.");const h=(o=t.response)==null?void 0:o.data;let m=typeof h=="string"?h:"";if(Array.isArray(h))return be(t,Ve(h));if(Array.isArray(h==null?void 0:h.data))return be(t,Ve(h.data));if(h!=null&&h.detail)return be(t,h.detail);if(h instanceof Object){const u=h.msg||Object.keys(h).reduce((p,b)=>{var v;return p+=`${b}: ${((v=h[b])==null?void 0:v[0])||h[b]} `},"");return be(t,u)}P.error({message:"Ошибка",description:m||t.message})}return Promise.reject(t)});const Ae=async()=>(await D.get("/auth/profile")).data,Je=async t=>{const s=new FormData;return Object.keys(t).forEach(a=>{const n=t[a];n&&s.append(a,n)}),(await D.put("/auth/profile",s)).data},Ls=t=>{const s=D.defaults.baseURL;return s?`${s}/auth/avatar/${t}`:"/default-avatar.png"},zs=async t=>(await D.get(`/auth/profile/${t}`)).data,He=i.createContext(void 0),$s=({children:t})=>{const[s,r]=i.useState(!1),[a,n]=i.useState(null),[o,h]=i.useState(!0);i.useEffect(()=>{(async()=>{if(localStorage.getItem("token"))try{const l=await Ae();n(l),r(!0)}catch(l){console.error("Session token is invalid, logging out.",l),u()}h(!1)})()},[]);const m=(v,x)=>{localStorage.setItem("token",v),localStorage.setItem("user",JSON.stringify(x)),r(!0)},u=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),n(null),r(!1)},b={isAuthenticated:s,user:a,loading:o,login:m,logout:u,refetchUser:async()=>{h(!0);try{const v=await Ae();n(v)}catch(v){console.error("Failed to refetch user data",v),u()}finally{h(!1)}}};return e.jsx(He.Provider,{value:b,children:t})},Hs=async t=>(await D.post("/auth/login",t)).data,Bs=async t=>{try{return(await D.post("/auth/register",t)).data}catch(s){throw console.error("Registration failed",s),s}},Xe=t=>[{required:!0,message:t("validation.required")},{validator:(s,r)=>r&&r.length>=2?Promise.resolve():Promise.reject(new Error(t("validation.name_length")))}],Os=t=>[{required:!0,message:t("validation.required")},{type:"email",message:t("validation.invalid_email")}],qs=t=>[{required:!0,message:t("validation.required")},{min:6,message:t("validation.password_length")}],Ks=({mode:t})=>{const{t:s}=H(),r=de(),a=i.useContext(He);if(!a)throw new Error("AuthForm must be used within an AuthProvider");const{login:n}=a,o=t==="login",h=async u=>{var p,b;try{const{token:v,user:x}=await Hs(u);n(v,x),r(`/profile/${x._id}`,{replace:!0}),P.success({message:s("auth.success.login_title"),description:s("auth.success.welcome_back",{name:x.firstName})})}catch(v){P.error({message:s("auth.errors.login"),description:((b=(p=v.response)==null?void 0:p.data)==null?void 0:b.msg)||s("auth.errors.invalid_credentials")})}},m=async u=>{var p,b;try{const x=(await Bs(u)).email;r("/verify-email",{replace:!0,state:{email:x,firstName:u.firstName,lastName:u.lastName}}),P.success({message:s("register.success.title"),description:s("register.success.description")})}catch(v){P.error({message:s("register.error.title"),description:((b=(p=v.response)==null?void 0:p.data)==null?void 0:b.msg)||s("register.error.description")})}};return e.jsxs("div",{className:"auth-form-container",children:[e.jsxs("div",{className:"auth-header",onClick:()=>r("/"),children:[e.jsx(Ht,{className:"auth-header__icon"}),e.jsx(qe.Title,{level:4,className:"auth-header__brand",children:s("common.brand")})]}),e.jsx(qe.Title,{level:3,className:"auth-header__title",children:s(o?"auth.sign_in":"register.title")}),e.jsxs(ue,{name:t,onFinish:o?h:m,layout:"vertical",className:"auth-form-body",size:"large",autoComplete:"off",children:[!o&&e.jsxs(e.Fragment,{children:[e.jsx(ue.Item,{label:e.jsx("span",{className:"auth-form-label",children:s("register.name")}),name:"firstName",rules:Xe(s),children:e.jsx(we,{placeholder:s("register.placeholder.name")})}),e.jsx(ue.Item,{label:e.jsx("span",{className:"auth-form-label",children:s("register.lastName")}),name:"lastName",rules:Xe(s),children:e.jsx(we,{placeholder:s("register.placeholder.lastName")})})]}),e.jsx(ue.Item,{label:e.jsx("span",{className:"auth-form-label",children:s("common.email")}),name:"email",rules:Os(s),children:e.jsx(we,{placeholder:s("common.placeholder.email")})}),e.jsx(ue.Item,{label:e.jsx("span",{className:"auth-form-label",children:s("common.password")}),name:"password",rules:qs(s),children:e.jsx(we.Password,{placeholder:s("common.placeholder.password")})}),e.jsx(ue.Item,{children:e.jsx($t,{type:"primary",htmlType:"submit",className:"auth-form-button",block:!0,children:s(o?"auth.sign_in":"register.submit")})})]}),e.jsx("div",{className:"auth-form-footer",children:o?e.jsxs(e.Fragment,{children:[s("auth.no_account")," ",e.jsx("a",{className:"auth-form-link",onClick:()=>r("/register"),children:s("auth.sign_up")})]}):e.jsxs(e.Fragment,{children:[s("register.haveAccount")," ",e.jsx("a",{className:"auth-form-link",onClick:()=>r("/login"),children:s("register.login")})]})})]})},Qe=()=>{const s=Re().pathname.includes("register")?"register":"login";return e.jsx("div",{className:"auth-page-wrapper",children:e.jsx(Ks,{mode:s})})},Ys=({className:t})=>{const{i18n:s}=H(),r=a=>{const n=a.target.value;s.changeLanguage(n)};return e.jsxs(_e,{value:s.language,onChange:r,size:"small",className:t,style:{color:"black",borderColor:"black"},children:[e.jsx(V,{value:"en",children:"EN"}),e.jsx(V,{value:"pl",children:"PL"}),e.jsx(V,{value:"uk",children:"UA"})]})},Pt=async t=>(await D.post("/notifications",t)).data,Us=async()=>(await D.get("/notifications")).data,Gs=async t=>(await D.patch("/notifications",{},{params:{notification_id:t}})).data,Vs=async t=>(await D.delete("/notifications",{params:{notification_id:t}})).data,Js=({navigateToRequests:t})=>{const[s,r]=i.useState([]),[a,n]=i.useState(null),o=!!a,h=s.filter(l=>!l.read).length,m=async()=>{try{const l=await Us();r(Array.isArray(l)?l:[])}catch(l){console.error("Ошибка при получении уведомлений:",l)}};i.useEffect(()=>{m();const l=setInterval(m,3e4);return()=>clearInterval(l)},[]);const u=l=>{n(l.currentTarget),m()},p=()=>{n(null)},b=async(l,g)=>{l.stopPropagation();try{await Vs(g),r(j=>j.filter(w=>w._id!==g))}catch(j){console.error("Ошибка при удалении уведомления:",j)}},v=l=>{l.read||(Gs(l._id),r(g=>g.map(j=>j._id===l._id?{...j,read:!0}:j))),(l.type==="request"||l.type==="homework_submission")&&t(),p()},x=()=>{t(),p()};return e.jsxs("div",{children:[e.jsx(G,{color:"inherit",onClick:u,children:e.jsx(Ut,{badgeContent:h,color:"error",children:e.jsx(Gt,{})})}),e.jsxs(Vt,{anchorEl:a,open:o,onClose:p,PaperProps:{style:{maxHeight:300,width:"400px"}},children:[e.jsx(f,{sx:{p:2,borderBottom:"1px solid #eee"},children:e.jsx(c,{variant:"h6",children:"Уведомления"})}),s.length===0?e.jsx(V,{disabled:!0,children:"Уведомлений нет"}):s.map(l=>e.jsxs(V,{onClick:()=>v(l),sx:{bgcolor:l.read?"transparent":"action.hover",whiteSpace:"normal",alignItems:"flex-start"},children:[e.jsx(Y,{primary:l.content,secondary:new Date(l.createdAt).toLocaleString()}),e.jsx(Jt,{children:e.jsx(G,{edge:"end","aria-label":"delete",onClick:g=>b(g,l._id),children:e.jsx(Me,{fontSize:"small"})})})]},l._id)),e.jsx(J,{}),e.jsx(V,{onClick:x,children:e.jsx(Y,{primary:"Посмотреть все во 'Входящих'",sx:{textAlign:"center"}})})]})]})},Xs=()=>{var w,_,A;const[t,s]=i.useState(!1),r=de(),{t:a}=H(),n=localStorage.getItem("user");let o=null;try{n&&n!=="undefined"&&n!=="null"&&(o=JSON.parse(n))}catch(S){console.error("Error parsing user from localStorage:",S),o=null}const m=!!localStorage.getItem("token")&&!!o,u=(w=o==null?void 0:o.roles)==null?void 0:w.includes("admin"),p=(_=o==null?void 0:o.roles)==null?void 0:_.includes("coach"),b=(A=o==null?void 0:o.roles)==null?void 0:A.includes("student"),v=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),s(!1),r("/login")},x=()=>{s(!1),r("/register")},l=()=>{r("/inbox")},g=S=>()=>{s(S)},j=S=>{s(!1),r(S)};return e.jsxs(e.Fragment,{children:[e.jsx(Xt,{position:"static",className:"navbar-appbar",children:e.jsxs(Qt,{className:"navbar-toolbar",children:[e.jsx(c,{variant:"h6",className:"navbar-title",onClick:()=>r("/"),children:a("navbar.chessSchool")}),e.jsxs(f,{className:"navbar-controls",children:[!m&&e.jsxs(f,{sx:{display:{xs:"none",md:"flex"},alignItems:"center"},children:[e.jsx(C,{color:"inherit",onClick:()=>r("/login"),children:a("navbar.login")}),e.jsx(C,{variant:"contained",color:"secondary",onClick:()=>r("/register"),sx:{ml:1},children:a("navbar.register")})]}),m&&e.jsx(Js,{navigateToRequests:l}),e.jsx(G,{edge:"end",color:"inherit","aria-label":"menu",onClick:g(!0),className:"navbar-menu-button",children:e.jsx(Zt,{})})]})]})}),e.jsx(es,{anchor:"right",open:t,onClose:g(!1),children:e.jsxs(f,{className:"navbar-drawer",children:[e.jsx(f,{className:"drawer-header",children:e.jsx(G,{onClick:g(!1),className:"close-button",children:e.jsx(_s,{className:"close-icon"})})}),e.jsxs(ct,{className:"menu-list",children:[e.jsxs(Z,{onClick:()=>j("/"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(Fs,{})}),e.jsx(Y,{primary:a("navbar.home")})]}),e.jsxs(Z,{onClick:()=>j("/about"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(Es,{})}),e.jsx(Y,{primary:a("navbar.aboutUs")})]}),e.jsxs(Z,{onClick:()=>j("/achievements"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(Ds,{})}),e.jsx(Y,{primary:a("navbar.achievements")})]}),e.jsxs(Z,{onClick:()=>j("/coaches"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(ke,{})}),e.jsx(Y,{primary:a("navbar.coaches")})]}),m&&e.jsx(J,{sx:{borderColor:"rgba(255, 255, 255, 0.12)"}}),m&&e.jsxs(e.Fragment,{children:[e.jsxs(Z,{onClick:()=>j("/analysis"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(As,{})}),e.jsx(Y,{primary:a("navbar.chessGame")})]}),e.jsxs(Z,{onClick:()=>j("/profile"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(Rs,{})}),e.jsx(Y,{primary:a("navbar.profile")})]})]}),(p||u||b)&&e.jsx(J,{sx:{borderColor:"rgba(255, 255, 255, 0.12)"}}),(p||u)&&e.jsxs(Z,{onClick:()=>j("/students"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(ke,{})}),e.jsx(Y,{primary:a("navbar.students")})]}),(p||u||b)&&e.jsxs(Z,{onClick:()=>j("/students-shedule"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(ke,{})}),e.jsx(Y,{primary:a("navbar.students-shedule")})]}),u&&e.jsxs(Z,{onClick:()=>j("/users"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(ke,{})}),e.jsx(Y,{primary:a("navbar.users")})]})]}),e.jsxs(f,{className:"drawer-bottom-actions",children:[m?e.jsxs(C,{onClick:v,className:"logout-button",children:[e.jsx(Ms,{}),a("navbar.logout")]}):e.jsxs(C,{onClick:x,className:"get-started-button",variant:"contained",color:"secondary",children:[e.jsx(Ws,{style:{marginRight:"8px"}}),a("navbar.getStarted")]}),e.jsx(Ys,{className:"language-switcher"})]})]})})]})},Qs=async()=>(await D.get("/coaches")).data,Zs=async t=>(await D.get(`/coach/${t}`)).data,er=async t=>(await D.post("/auth/coaches-by-email",{emails:t})).data,tr=async(t,s)=>(await D.get("/trainer/student",{params:{coachEmail:t,studentId:s}})).data,sr=async t=>(await D.get("/trainer/students",{params:{coachEmail:t}})).data,rr=async(t,s)=>{await D.delete("/trainer/remove-student",{params:{coachEmail:t,studentId:s}})},nr=()=>{const{t}=H(),s=de(),[r,a]=i.useState([]);return i.useEffect(()=>{(async()=>{const o=await er(["ad3@example.com","ad7@example.com"]);a(o)})()},[]),e.jsxs(f,{py:10,px:2,sx:{backgroundColor:"#111"},children:[e.jsx(c,{variant:"h4",fontWeight:"bold",textAlign:"center",mb:6,children:t("homePage.coaches.title")}),e.jsx(E,{container:!0,spacing:4,justifyContent:"center",children:r.map(n=>e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(dt,{sx:{backgroundColor:"#1a1a1a",color:"white",borderRadius:3,boxShadow:4,position:"relative","&:hover .hoverAction":{opacity:1}},children:[e.jsx(ht,{component:"img",height:"200",image:n.photoUrl||"/images/default-avatar.png",alt:`${n.firstName} ${n.lastName}`}),e.jsxs(ut,{children:[e.jsxs(c,{variant:"h6",children:[n.firstName," ",n.lastName]}),e.jsx(c,{variant:"body2",color:"gray"}),e.jsx(f,{mt:1,children:[...Array(5)].map((o,h)=>e.jsx(ts,{sx:{color:"#FFD700",fontSize:20}},h))})]}),e.jsx(f,{className:"hoverAction",sx:{position:"absolute",bottom:16,left:0,right:0,textAlign:"center",opacity:0,transition:"0.3s"},children:e.jsx(C,{variant:"contained",onClick:()=>s("/coaches",{state:{coach:n}}),sx:{backgroundColor:"#FFD700",color:"black"},children:t("homePage.coaches.selectCoach")})})]})},n._id))})]})},or=()=>{const{t}=H(),s=de(),r=new Date().getFullYear(),a=[{icon:"🎯",key:"analytics",descKey:"descAnalytics"},{icon:"🧠",key:"memory",descKey:"descMemory"},{icon:"🏆",key:"spirit",descKey:"descSpirit"}],n=[{num:"1",titleKey:"step1Title",descKey:"step1Desc"},{num:"2",titleKey:"step2Title",descKey:"step2Desc"},{num:"3",titleKey:"step3Title",descKey:"step3Desc"}],o=[{type:"individual",icon:e.jsx(ss,{sx:{fontSize:40,mb:2,color:"#FFD700"}}),descKey:"descIndividual",buttonKey:"schedule",path:"/coaches"},{type:"group",icon:e.jsx(rs,{sx:{fontSize:40,mb:2,color:"#FFD700"}}),descKey:"descGroup",buttonKey:"learnMore",path:"/classes"}];return e.jsxs(f,{sx:{backgroundColor:"#0e0e0e",color:"white",fontFamily:"'Inter', sans-serif"},children:[e.jsx(f,{sx:{backgroundImage:{xs:'url("/images/chess-cinematic-mb.jpg")',sm:'url("/images/chess-cinematic-tablet.jpg")',lg:'url("/images/chess-cinematic-lg.jpg")'},backgroundSize:"cover",backgroundPosition:"center",py:{xs:10,md:20},textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",px:2},children:e.jsxs(O,{maxWidth:"md",children:[e.jsx(c,{variant:"h2",component:"h1",fontWeight:"bold",children:t("homePage.hero.title")}),e.jsx(c,{variant:"h5",mt:2,sx:{color:"rgba(255, 255, 255, 0.9)"},children:t("homePage.hero.subtitle")}),e.jsx(C,{variant:"contained",size:"large",onClick:()=>s("/coaches"),sx:{mt:4,px:5,py:1.5,borderRadius:"30px",boxShadow:"0px 8px 20px rgba(255, 215, 0, 0.3)",backgroundColor:"#FFD700",color:"black",fontWeight:"bold","&:hover":{backgroundColor:"#FFC107",transform:"translateY(-2px)",boxShadow:"0px 10px 25px rgba(255, 215, 0, 0.4)"},transition:"all 0.3s ease"},startIcon:e.jsx("span",{style:{fontSize:"1.5rem"},children:"♟️"}),children:t("homePage.hero.start")})]})}),e.jsxs(O,{maxWidth:"lg",sx:{py:10},children:[e.jsx(c,{variant:"h3",component:"h2",fontWeight:"bold",textAlign:"center",mb:8,children:t("homePage.why.title")}),e.jsx(E,{container:!0,spacing:4,justifyContent:"center",children:a.map(({icon:h,key:m,descKey:u})=>e.jsx(E,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(W,{elevation:6,sx:{p:4,textAlign:"center",borderRadius:4,backgroundColor:"rgba(255,255,255,0.05)",backdropFilter:"blur(10px)",transition:"all 0.3s ease",color:"white",height:"100%","&:hover":{transform:"translateY(-10px)",backgroundColor:"rgba(255,255,255,0.1)"}},children:[e.jsx(f,{fontSize:"3.5rem",children:h}),e.jsx(c,{variant:"h5",component:"h3",mt:2,fontWeight:"bold",children:t(`homePage.why.${m}`)}),e.jsx(c,{mt:1.5,sx:{color:"rgba(255, 255, 255, 0.7)"},children:t(`homePage.why.${u}`)})]})},m))})]}),e.jsx(f,{sx:{py:5},children:e.jsx(nr,{})}),e.jsx(f,{sx:{py:10,backgroundColor:"#121212"},children:e.jsxs(O,{maxWidth:"lg",children:[e.jsx(c,{variant:"h3",component:"h2",fontWeight:"bold",textAlign:"center",mb:8,children:t("homePage.howItWorks.title")}),e.jsx(E,{container:!0,spacing:5,children:n.map(({num:h,titleKey:m,descKey:u})=>e.jsx(E,{item:!0,xs:12,md:4,children:e.jsxs(f,{sx:{textAlign:{xs:"center",md:"left"}},children:[e.jsx(c,{variant:"h1",component:"div",fontWeight:"bold",sx:{color:"#FFD700",opacity:.5},children:h}),e.jsx(c,{variant:"h5",component:"h3",fontWeight:"bold",mt:1,children:t(`homePage.howItWorks.${m}`)}),e.jsx(c,{mt:1.5,sx:{color:"rgba(255, 255, 255, 0.7)"},children:t(`homePage.howItWorks.${u}`)})]})},h))})]})}),e.jsxs(O,{maxWidth:"lg",sx:{py:10},children:[e.jsx(c,{variant:"h3",component:"h2",fontWeight:"bold",textAlign:"center",mb:8,children:t("homePage.formats.title")}),e.jsx(E,{container:!0,spacing:4,justifyContent:"center",children:o.map(({type:h,icon:m,descKey:u,buttonKey:p,path:b})=>e.jsx(E,{item:!0,xs:12,md:5,children:e.jsxs(W,{elevation:6,sx:{p:4,backgroundColor:"#1c1c1c",color:"white",borderRadius:4,textAlign:"center",transition:"background-color 0.3s ease",display:"flex",flexDirection:"column",alignItems:"center",height:"100%","&:hover":{backgroundColor:"#2a2a2a"}},children:[m,e.jsx(c,{variant:"h5",component:"h3",fontWeight:"bold",children:t(`homePage.formats.${h}`)}),e.jsx(c,{mt:1.5,sx:{color:"rgba(255, 255, 255, 0.7)",flexGrow:1},children:t(`homePage.formats.${u}`)}),e.jsxs(C,{variant:"outlined",onClick:()=>s(b),sx:{mt:3,color:"#FFD700",borderColor:"#FFD700",borderRadius:"20px","&:hover":{borderColor:"#FFC107",backgroundColor:"rgba(255, 215, 0, 0.1)"}},children:[t(`homePage.formats.${p}`)," →"]})]})},h))})]}),e.jsx(f,{component:"footer",py:6,px:2,sx:{backgroundColor:"#0b0b0b",color:"gray"},children:e.jsxs(O,{maxWidth:"lg",children:[e.jsxs(E,{container:!0,spacing:5,children:[e.jsxs(E,{item:!0,xs:12,sm:4,children:[e.jsx(c,{variant:"h6",fontWeight:"bold",sx:{color:"white"},children:t("homePage.footer.name")}),e.jsx(c,{variant:"body2",sx:{mt:1,color:"rgba(255,255,255,0.5)"},children:t("homePage.footer.desc")})]}),e.jsxs(E,{item:!0,xs:6,sm:2,children:[e.jsx(c,{fontWeight:"bold",sx:{color:"white"},children:t("homePage.footer.company")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.about")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.blog")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.coaches")})]}),e.jsxs(E,{item:!0,xs:6,sm:2,children:[e.jsx(c,{fontWeight:"bold",sx:{color:"white"},children:t("homePage.footer.resources")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.faq")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.contact")})]}),e.jsxs(E,{item:!0,xs:6,sm:2,children:[e.jsx(c,{fontWeight:"bold",sx:{color:"white"},children:t("homePage.footer.legal")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.privacy")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.terms")})]})]}),e.jsx(J,{sx:{my:4,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsx(c,{variant:"body2",textAlign:"center",sx:{color:"rgba(255,255,255,0.4)"},children:t("homePage.footer.copyright",{year:r})})]})})]})},ar=()=>{const{t}=H(),s=de(),r=i.useMemo(()=>t("aboutPage.phrases",{returnObjects:!0})||[],[t]),a=i.useMemo(()=>t("aboutPage.testimonials.reviews",{returnObjects:!0})||[],[t]),n=i.useMemo(()=>t("aboutPage.ourCoaches.coaches",{returnObjects:!0})||[],[t]),o=i.useMemo(()=>t("aboutPage.whyUs.cards",{returnObjects:!0})||[],[t]),h=i.useMemo(()=>t("aboutPage.howItWorks.steps",{returnObjects:!0})||[],[t]),m=i.useMemo(()=>t("aboutPage.mission.points",{returnObjects:!0})||[],[t]),[u,p]=i.useState(0),[b,v]=i.useState(0);return i.useEffect(()=>{if(r.length===0||a.length===0)return;const x=setInterval(()=>{p(g=>(g+1)%r.length)},4e3),l=setInterval(()=>{v(g=>(g+1)%a.length)},5e3);return()=>{clearInterval(x),clearInterval(l)}},[r.length,a.length]),e.jsxs(f,{sx:{bgcolor:"#0e0e0e",color:"white"},children:[e.jsx(f,{sx:{position:"relative",py:{xs:10,md:15},textAlign:"center",backgroundImage:'linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.8)), url("/images/chess-cinematic-lg.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:e.jsxs(O,{maxWidth:"md",children:[e.jsx(c,{variant:"h2",component:"h1",fontWeight:"bold",sx:{textTransform:"uppercase",letterSpacing:"2px"},children:t("aboutPage.mainTitle")}),e.jsx(f,{sx:{height:"2.5em",my:2},children:e.jsx(Ue,{mode:"out-in",children:e.jsx(Ge,{timeout:300,classNames:"fade",children:e.jsx(c,{variant:"h5",sx:{color:"#FFD700",fontStyle:"italic"},children:r.length>0?r[u]:""})},u)})}),e.jsxs(M,{direction:{xs:"column",sm:"row"},justifyContent:"center",spacing:2,mt:4,children:[e.jsx(C,{variant:"contained",onClick:()=>s("/register"),size:"large",sx:{bgcolor:"#FFD700",color:"black",borderRadius:"30px",px:5,"&:hover":{bgcolor:"#FFC107"}},children:t("aboutPage.ctaStudent")}),e.jsx(C,{variant:"outlined",onClick:()=>s("/coaches"),size:"large",sx:{color:"white",borderColor:"rgba(255,255,255,0.5)",borderRadius:"30px",px:5,"&:hover":{borderColor:"white",bgcolor:"rgba(255,255,255,0.1)"}},children:t("aboutPage.ctaCoaches")})]})]})}),e.jsxs(O,{maxWidth:"lg",sx:{py:8},children:[e.jsxs(f,{sx:{textAlign:"center",my:8},children:[e.jsxs(M,{direction:"row",spacing:2,justifyContent:"center",alignItems:"center",sx:{color:"#FFD700",mb:1},children:[e.jsx(ns,{fontSize:"large"}),e.jsx(c,{variant:"h4",component:"h2",fontWeight:"bold",children:t("aboutPage.mission.title")})]}),e.jsx(c,{variant:"h6",sx:{maxWidth:720,mx:"auto",color:"rgba(255,255,255,0.7)",mb:3},children:t("aboutPage.mission.subtitle")}),e.jsx(M,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"center",children:m.map((x,l)=>e.jsxs(M,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(oe,{sx:{color:"success.main"}}),e.jsx(c,{children:x})]},l))})]}),e.jsx(J,{sx:{my:8,borderColor:"rgba(255,255,255,0.2)"}}),e.jsxs(f,{sx:{my:8},children:[e.jsx(c,{variant:"h4",component:"h2",fontWeight:"bold",align:"center",sx:{mb:6},children:t("aboutPage.whyUs.title")}),e.jsx(E,{container:!0,spacing:4,children:o.map((x,l)=>e.jsx(E,{item:!0,xs:12,md:4,children:e.jsxs(W,{sx:{p:4,bgcolor:"#1c1c1c",borderRadius:4,textAlign:"center",height:"100%",transition:"all 0.3s ease","&:hover":{transform:"translateY(-10px)",boxShadow:"0 10px 20px rgba(255,215,0,0.15)"}},children:[e.jsx(c,{fontSize:"3rem",children:x.icon}),e.jsx(c,{variant:"h6",fontWeight:"bold",my:1,children:x.title}),e.jsx(c,{sx:{color:"rgba(255,255,255,0.6)"},children:x.description})]})},l))})]}),e.jsxs(f,{sx:{my:8,py:6,bgcolor:"#1c1c1c",borderRadius:4},children:[e.jsx(c,{variant:"h4",component:"h2",fontWeight:"bold",align:"center",sx:{mb:6},children:t("aboutPage.howItWorks.title")}),e.jsx(E,{container:!0,spacing:4,sx:{px:4},children:h.map((x,l)=>e.jsx(E,{item:!0,xs:12,md:4,children:e.jsxs(M,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(c,{variant:"h2",fontWeight:"bold",sx:{color:"#FFD700",opacity:.5},children:`0${l+1}`}),e.jsxs(f,{children:[e.jsx(c,{variant:"h6",fontWeight:"bold",children:x.step}),e.jsx(c,{sx:{color:"rgba(255,255,255,0.6)"},children:x.desc})]})]})},l))})]}),e.jsxs(E,{container:!0,spacing:8,sx:{my:8},children:[e.jsxs(E,{item:!0,xs:12,md:6,children:[e.jsx(c,{variant:"h4",component:"h2",fontWeight:"bold",sx:{mb:3},children:t("aboutPage.testimonials.title")}),e.jsx(W,{sx:{p:4,bgcolor:"#1c1c1c",borderRadius:4,minHeight:180},children:e.jsx(Ue,{children:e.jsx(Ge,{timeout:300,classNames:"fade",children:e.jsx(f,{children:a.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(c,{fontStyle:"italic",fontSize:"1.1rem",sx:{color:"rgba(255,255,255,0.8)"},children:["“",a[b].quote,"”"]}),e.jsxs(c,{fontWeight:"bold",mt:2,sx:{color:"#FFD700"},children:["— ",a[b].name]})]}):null})},b)})})]}),e.jsxs(E,{item:!0,xs:12,md:6,children:[e.jsx(c,{variant:"h4",component:"h2",fontWeight:"bold",sx:{mb:3},children:t("aboutPage.ourCoaches.title")}),e.jsxs(M,{spacing:2,children:[n.map((x,l)=>e.jsxs(W,{sx:{p:2,bgcolor:"#1c1c1c",borderRadius:2},children:[e.jsx(c,{variant:"h6",fontWeight:"bold",children:x.name}),e.jsx(c,{variant:"body2",fontStyle:"italic",sx:{color:"rgba(255,255,255,0.6)"},children:x.quote})]},l)),e.jsxs(C,{variant:"text",onClick:()=>s("/coaches"),sx:{color:"#FFD700",alignSelf:"flex-start"},children:[t("aboutPage.ourCoaches.viewAll")," →"]})]})]})]}),e.jsx(J,{sx:{my:8,borderColor:"rgba(255,255,255,0.2)"}}),e.jsx(c,{align:"center",fontWeight:"bold",variant:"h5",component:"p",sx:{fontStyle:"italic"},children:t("aboutPage.finalSlogan")})]})]})},ir=()=>e.jsx(O,{children:e.jsx(c,{variant:"h3",gutterBottom:!0,children:"Achievments"})}),lr=()=>!!localStorage.getItem("token"),cr=()=>lr()?e.jsx(Bt,{}):e.jsx(Ot,{to:"/login"}),Be=async t=>(await D.get(`/schedule/student/${t}`)).data,dr=async t=>(await D.post("/schedule/create",t)).data,hr=async(t,s)=>(await D.put(`/schedule/${t}`,s)).data,ur=async t=>{await D.delete(`/schedule/${t}`)},_t=async t=>{const s=new FormData;s.append("studentId",t.studentId),s.append("scheduleId",t.scheduleId),t.homeworkText&&s.append("homeworkText",t.homeworkText),t.screenshot&&s.append("screenshot",t.screenshot),await D.post("/homework/send",s)},mr=async(t,s)=>(await D.put(`/homework/${t}/review`,s)).data,xr=async()=>(await D.get("/homework/coach")).data,gr=async t=>(await D.get(`/homework/${t}/screenshot`,{responseType:"blob"})).data,Ze={scheduled:{icon:e.jsx(ge,{fontSize:"small"}),color:"info",labelKey:"status.scheduled"},pending:{icon:e.jsx(ge,{fontSize:"small"}),color:"warning",labelKey:"status.pending"},completed:{icon:e.jsx(oe,{fontSize:"small"}),color:"success",labelKey:"status.completed"},approved:{icon:e.jsx(oe,{fontSize:"small"}),color:"success",labelKey:"status.approved"},rejected:{icon:e.jsx(We,{fontSize:"small"}),color:"error",labelKey:"status.rejected"}},Ft=({event:t,variant:s="light",onSelect:r})=>{const{t:a}=H(),n=t.status,o=Ze[n]||Ze.scheduled,h=s==="dark"?{bgcolor:"#2a2a2a",color:"white"}:{bgcolor:"white",color:"black"};return e.jsxs(W,{onClick:r?()=>r(t):void 0,sx:{...h,p:2,borderRadius:2,cursor:r?"pointer":"default",transition:"box-shadow 0.3s, transform 0.2s","&:hover":r?{boxShadow:6,transform:"translateY(-2px)"}:{}},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(c,{variant:"h6",fontWeight:500,noWrap:!0,children:t.title}),e.jsx(je,{icon:o.icon,label:a(o.labelKey),color:o.color,size:"small"})]}),e.jsx(c,{variant:"body2",color:s==="dark"?"grey.400":"text.secondary",children:U(t.date).format("MMMM Do, YYYY [at] HH:mm")}),t.description&&e.jsx(c,{variant:"body2",sx:{mt:1,color:s==="dark"?"grey.500":"text.secondary"},children:t.description})]})},pr=({user:t,onClose:s})=>{const{t:r}=H(),[a,n]=i.useState(t.firstName),[o,h]=i.useState(t.lastName),[m,u]=i.useState(t.email),[p,b]=i.useState(""),[v,x]=i.useState(""),[l,g]=i.useState(""),[j,w]=i.useState(!1),[_,A]=i.useState(null),[S,N]=i.useState(t.photoUrl),d=k=>{var q;const R=(q=k.target.files)==null?void 0:q[0];R&&(A(R),N(URL.createObjectURL(R)))},y=async()=>{try{if(!j)await Je({firstName:a,lastName:o,email:m,avatar:_||void 0}),P.success({message:r("profile_edit.updated"),description:void 0});else{if(!p||v!==l){P.error({message:r("profile_edit.passwordMismatch"),description:void 0});return}await Je({currentPassword:p,newPassword:v,avatar:_||void 0}),P.success({message:r("profile_edit.passwordChanged"),description:void 0})}s(),window.location.reload()}catch(k){console.error(k),P.error({message:r("profile_edit.updateFailed"),description:void 0})}};return e.jsxs(ae,{open:!0,onClose:s,fullWidth:!0,maxWidth:"sm",children:[e.jsx(ie,{children:r("profile_edit.editTitle")}),e.jsxs(le,{children:[e.jsxs(f,{display:"flex",alignItems:"center",flexDirection:"column",mb:2,children:[e.jsx(Te,{src:S,sx:{width:96,height:96,mb:1}}),e.jsxs(C,{variant:"text",size:"small",component:"label",children:[r("profile_edit.uploadAvatar"),e.jsx("input",{hidden:!0,accept:"image/*",type:"file",onChange:d})]})]}),e.jsx(L,{margin:"dense",label:r("profile_edit.firstName"),fullWidth:!0,value:a,onChange:k=>n(k.target.value)}),e.jsx(L,{margin:"dense",label:r("profile_edit.lastName"),fullWidth:!0,value:o,onChange:k=>h(k.target.value)}),e.jsx(L,{margin:"dense",label:r("profile_edit.email"),fullWidth:!0,value:m,onChange:k=>u(k.target.value)}),!j&&e.jsx(f,{mt:1,children:e.jsx(Se,{component:"button",variant:"body2",onClick:()=>w(!0),children:r("profile_edit.changePassword")})}),j&&e.jsxs(f,{mt:2,children:[e.jsx(L,{margin:"dense",label:r("profile_edit.currentPassword"),fullWidth:!0,type:"password",value:p,onChange:k=>b(k.target.value)}),e.jsx(L,{margin:"dense",label:r("profile_edit.newPassword"),fullWidth:!0,type:"password",value:v,onChange:k=>x(k.target.value)}),e.jsx(L,{margin:"dense",label:r("profile_edit.confirmPassword"),fullWidth:!0,type:"password",value:l,onChange:k=>g(k.target.value)})]})]}),e.jsxs(ce,{children:[e.jsx(C,{onClick:s,children:r("profile_edit.cancel")}),e.jsx(C,{variant:"contained",onClick:y,children:r("profile_edit.save")})]})]})},et={admin:4,coach:3,student:2,user:1},fr=(t=[])=>t.length===0?"user":[...t].sort((s,r)=>(et[r]||0)-(et[s]||0))[0],jr=({user:t,coach:s,avatarUrl:r,isMyProfile:a,onEdit:n,onLogout:o,t:h})=>{const m=fr(t.roles),u=t.roles.filter(b=>b!==m),p={admin:"secondary",coach:"primary",student:"success",user:"default"}[m];return e.jsx(W,{sx:{p:{xs:2,md:4},mb:4,bgcolor:"#1c1c1c",borderRadius:4,color:"white"},children:e.jsxs(M,{direction:{xs:"column",md:"row"},spacing:4,alignItems:"center",children:[e.jsx(Te,{src:r,alt:`${t.firstName} ${t.lastName}`,sx:{width:120,height:120,border:"4px solid #FFD700"}}),e.jsxs(f,{sx:{flexGrow:1,textAlign:{xs:"center",md:"left"}},children:[e.jsxs(M,{direction:"row",spacing:2,alignItems:"center",justifyContent:{xs:"center",md:"flex-start"},children:[e.jsxs(c,{variant:"h4",fontWeight:"bold",children:[t.firstName," ",t.lastName]}),e.jsx(Le,{title:u.length>0?`Also: ${u.join(", ")}`:"",arrow:!0,children:e.jsx(je,{label:m,color:p,size:"small",sx:{textTransform:"capitalize"}})})]}),s&&e.jsxs(c,{sx:{color:"rgba(255,255,255,0.7)",mt:1},children:["Coach: ",e.jsxs(Se,{component:lt,to:`/profile/${s._id}`,color:"inherit",sx:{textDecoration:"underline"},children:[s.firstName," ",s.lastName]})]}),e.jsxs(c,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)",mt:.5},children:[h("profile.registrationDate"),": ",new Date(t.registrationDate).toLocaleDateString()]})]}),e.jsx(M,{direction:"row",spacing:2,sx:{mt:{xs:3,md:0}},children:a?e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"outlined",onClick:n,startIcon:e.jsx(Pe,{}),sx:{color:"#FFD700",borderColor:"rgba(255, 215, 0, 0.5)","&:hover":{borderColor:"#FFD700"}},children:h("profile.editProfile")}),e.jsx(C,{variant:"contained",color:"error",onClick:o,startIcon:e.jsx(os,{}),children:h("profile.logout")})]}):m==="coach"&&e.jsx(C,{variant:"contained",color:"primary",startIcon:e.jsx(mt,{}),children:"Send Request"})})]})})},br=({schedule:t,isLoading:s,onEventSelect:r})=>{if(s)return e.jsxs(M,{spacing:2,children:[e.jsx(Ne,{variant:"rectangular",height:118,sx:{borderRadius:2,bgcolor:"grey.800"}}),e.jsx(Ne,{variant:"rectangular",height:118,sx:{borderRadius:2,bgcolor:"grey.800"}}),e.jsx(Ne,{variant:"rectangular",height:118,sx:{borderRadius:2,bgcolor:"grey.800"}})]});if(t.length===0)return e.jsx(c,{sx:{color:"grey.500",textAlign:"center",p:4},children:"You have no scheduled lessons yet."});const a=[...t].sort((n,o)=>new Date(o.date).getTime()-new Date(n.date).getTime());return e.jsx(M,{spacing:2,children:a.map(n=>e.jsx(Ft,{event:n,onSelect:r},n._id))})},vr=({schedule:t,isLoading:s,onEventSelect:r})=>{if(s)return e.jsx(W,{sx:{p:2,bgcolor:"#2a2a2a",borderRadius:3},children:e.jsx(Ne,{variant:"rectangular",height:150,sx:{bgcolor:"grey.700",borderRadius:2}})});const a=t.filter(n=>new Date(n.date)>=new Date).sort((n,o)=>new Date(n.date).getTime()-new Date(o.date).getTime())[0];return e.jsxs(f,{children:[e.jsx(c,{variant:"h5",fontWeight:"bold",sx:{mb:2},children:"Next Up"}),a?e.jsx(Ft,{event:a,variant:"dark",onSelect:r}):e.jsx(W,{sx:{p:4,bgcolor:"#2a2a2a",color:"white",borderRadius:3,textAlign:"center"},children:e.jsx(c,{sx:{color:"grey.500"},children:"You have no upcoming lessons."})}),t.length>0&&e.jsx(C,{component:lt,to:"/students-shedule",fullWidth:!0,endIcon:e.jsx(as,{}),sx:{mt:2,color:"#FFD700",justifyContent:"flex-start",p:1},children:"View Full Schedule"})]})},tt={scheduled:{icon:e.jsx(ge,{fontSize:"small"}),color:"info",labelKey:"status.scheduled"},pending:{icon:e.jsx(ge,{fontSize:"small"}),color:"warning",labelKey:"status.pending"},completed:{icon:e.jsx(oe,{fontSize:"small"}),color:"success",labelKey:"status.completed"},approved:{icon:e.jsx(oe,{fontSize:"small"}),color:"success",labelKey:"status.approved"},rejected:{icon:e.jsx(We,{fontSize:"small"}),color:"error",labelKey:"status.rejected"}},st=5,yr=({event:t,open:s,onClose:r,onSendHomework:a})=>{const{t:n}=H(),[o,h]=i.useState(""),[m,u]=i.useState(null),[p,b]=i.useState(!1);if(i.useEffect(()=>{s||(h(""),u(null),b(!1))},[s]),!t)return null;const v=j=>{var _;const w=(_=j.target.files)==null?void 0:_[0];if(w){if(w.size>st*1024*1024){P.error({message:n("errors.fileTooLarge",{size:st}),description:void 0});return}u(w)}},x=async()=>{if(!o.trim()&&!m){P.error({message:n("errors.emptyHomework"),description:void 0});return}b(!0);try{await a(o,m)}finally{b(!1)}},l=t.status,g=tt[l]||tt.scheduled;return e.jsxs(ae,{open:s,onClose:r,fullWidth:!0,maxWidth:"sm",children:[e.jsx(ie,{sx:{bgcolor:`${g.color}.main`,color:"white"},children:n("studentSchedule.eventDetails")}),e.jsxs(le,{sx:{pt:3},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(c,{variant:"h6",children:t.title}),e.jsx(je,{icon:g.icon,label:n(g.labelKey),color:g.color,size:"small"})]}),e.jsx(c,{variant:"body2",color:"text.secondary",children:U(t.date).format("dddd, MMMM Do, YYYY [at] HH:mm")}),t.description&&e.jsx(c,{variant:"body1",sx:{mt:2},children:t.description}),t.link&&e.jsxs(c,{variant:"body2",sx:{mt:1},children:[n("studentSchedule.form_link"),": ",e.jsx(Se,{href:t.link,target:"_blank",rel:"noopener noreferrer",children:t.link})]}),t.type==="homework"&&e.jsxs(f,{sx:{mt:4},children:[e.jsx(c,{variant:"h6",sx:{mb:2},children:n("studentSchedule.sendHomeworkTitle")}),e.jsx(L,{label:n("studentSchedule.form_description"),fullWidth:!0,multiline:!0,rows:4,value:o,onChange:j=>h(j.target.value),variant:"outlined",disabled:p}),e.jsxs(C,{sx:{mt:2},variant:"outlined",component:"label",startIcon:e.jsx(xt,{}),disabled:p,children:[m?m.name:n("studentSchedule.uploadScreenshot"),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:v})]})]})]}),e.jsxs(ce,{sx:{p:2},children:[e.jsx(C,{onClick:r,disabled:p,children:n("common.close")}),t.type==="homework"&&e.jsx(C,{onClick:x,variant:"contained",color:"primary",disabled:p,children:n("studentSchedule.send")})]})]})};function De(t){const{children:s,value:r,index:a,...n}=t;return e.jsx("div",{role:"tabpanel",hidden:r!==a,...n,children:r===a&&e.jsx(f,{sx:{pt:3},children:s})})}const Sr=()=>{const{t}=H(),s=de(),{userId:r}=qt(),a=i.useContext(He);if(!a)throw new Error("AuthContext is not available");const{user:n,logout:o,loading:h,refetchUser:m}=a,[u,p]=i.useState(null),[b,v]=i.useState(null),[x,l]=i.useState([]),[g,j]=i.useState({profile:!0,coach:!1,schedule:!1}),[w,_]=i.useState(null),[A,S]=i.useState(!1),[N,d]=i.useState(0),[y,k]=i.useState(null);i.useEffect(()=>{if(h)return;if(!(r||(n==null?void 0:n._id))){_(t("profile.errorNoUser","Could not determine which profile to load.")),j({profile:!1,coach:!1,schedule:!1});return}p(null),v(null),l([]),(async()=>{j(z=>({...z,profile:!0}));try{const z=await(r?zs(r):Ae());p(z)}catch{_(t("profile.errorLoadingProfile"))}finally{j(z=>({...z,profile:!1}))}})()},[t,r,n==null?void 0:n._id,h]),i.useEffect(()=>{if(u){const I=!r||(n==null?void 0:n._id)===u._id;u.trainer?(j(F=>({...F,coach:!0})),Zs(u.trainer).then(v).catch(F=>console.error("Failed to fetch coach",F)).finally(()=>j(F=>({...F,coach:!1})))):v(null),I&&u.roles.some(F=>["student","user"].includes(F))?(j(F=>({...F,schedule:!0})),Be(u._id).then(l).catch(F=>console.error("Failed to fetch schedule",F)).finally(()=>j(F=>({...F,schedule:!1})))):l([])}},[u,r,n==null?void 0:n._id]);const R=()=>{o(),s("/auth/login")},q=(I,F)=>d(F),$=!r||(n==null?void 0:n._id)===(u==null?void 0:u._id),te=async(I,F)=>{if(!(!n||!y))try{await _t({studentId:n._id,scheduleId:y._id,homeworkText:I.trim()||void 0,screenshot:F||void 0}),y.coach&&await Pt({recipient:y.coach,type:"homework_submission",content:`New homework from ${n.firstName} for: "${y.title}"`,metadata:{scheduleId:y._id}}),P.success({message:t("studentSchedule.homeworkSentSuccess","Homework sent successfully!"),description:void 0}),k(null),l(z=>z.map(T=>T._id===y._id?{...T,status:"pending"}:T))}catch{P.error({message:t("errors.sendHomework","Failed to send homework."),description:void 0})}},he=i.useMemo(()=>u!=null&&u._id?Ls(u._id):"",[u]);return h||g.profile?e.jsx(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",bgcolor:"#0e0e0e"},children:e.jsx(pe,{sx:{color:"#FFD700"}})}):w||!u?e.jsx(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",bgcolor:"#0e0e0e"},children:e.jsx(c,{color:"error",children:w||"User not found"})}):e.jsx(f,{sx:{bgcolor:"#0e0e0e",color:"white",minHeight:"100vh",py:5},children:e.jsxs(O,{maxWidth:"lg",children:[e.jsxs(f,{sx:{textAlign:"center",mb:5},children:[e.jsx(c,{variant:"h2",component:"h1",fontWeight:"bold",children:$?t("profile.title"):`${u.firstName}'s Profile`}),e.jsx(c,{variant:"h6",sx:{mt:1,color:"rgba(255, 255, 255, 0.7)"},children:$&&t("profile.subtitle")})]}),e.jsx(jr,{user:u,coach:b,avatarUrl:he,isMyProfile:$,onEdit:()=>S(!0),onLogout:R,t}),e.jsx(f,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(gt,{value:N,onChange:q,textColor:"inherit",TabIndicatorProps:{sx:{backgroundColor:"#FFD700"}},children:[e.jsx(ye,{label:t("profile.tabs.overview","Overview")}),$&&u.roles.some(I=>["student","user"].includes(I))&&e.jsx(ye,{label:t("profile.tabs.lessons","All Lessons")}),e.jsx(ye,{label:t("profile.tabs.statistics","Statistics"),disabled:!0})]})}),e.jsx(De,{value:N,index:0,children:$?e.jsx(vr,{schedule:x,isLoading:g.schedule,onEventSelect:k}):e.jsx(c,{sx:{color:"grey.500",textAlign:"center",p:4},children:"This is a public profile overview."})}),$&&u.roles.some(I=>["student","user"].includes(I))&&e.jsx(De,{value:N,index:1,children:e.jsx(br,{schedule:x,isLoading:g.schedule,onEventSelect:k})}),e.jsx(De,{value:N,index:$&&u.roles.some(I=>["student","user"].includes(I))?2:1,children:e.jsx(c,{sx:{color:"grey.500",textAlign:"center",p:4},children:"Game statistics and analytics are coming soon!"})}),$&&A&&e.jsx(pr,{user:u,onClose:()=>{S(!1),m()}}),$&&e.jsx(yr,{event:y,open:!!y,onClose:()=>k(null),onSendHomework:te})]})})},wr=({columns:t,data:s})=>{const[r,a]=i.useState(""),[n,o]=i.useState(10),[h,m]=i.useState(0),u=x=>{a(x.target.value),m(0)},p=(x,l)=>{m(l)},b=x=>{o(parseInt(x.target.value,10)),m(0)},v=s.filter(x=>t.some(l=>{if(l.field==="actions")return!1;const g=x[l.field];return g==null?void 0:g.toString().toLowerCase().includes(r.toLowerCase())}));return e.jsxs(W,{children:[e.jsx(L,{fullWidth:!0,label:"Поиск",variant:"outlined",value:r,onChange:u,style:{padding:"16px"}}),e.jsx(is,{children:e.jsxs(pt,{children:[e.jsx(ft,{children:e.jsx(me,{children:t.map(x=>e.jsx(K,{children:x.label},String(x.field)))})}),e.jsx(jt,{children:v.slice(h*n,h*n+n).map(x=>e.jsx(me,{children:t.map(l=>e.jsx(K,{children:l.render?l.render(x):x[l.field]},String(l.field)))},x.id))})]})}),e.jsx(ls,{rowsPerPageOptions:[10,20,50,100],component:"div",count:v.length,rowsPerPage:n,page:h,onPageChange:p,onRowsPerPageChange:b})]})},Cr=()=>{const[t,s]=i.useState([]),[r,a]=i.useState(null),[n,o]=i.useState(""),[h,m]=i.useState("add"),[u,p]=i.useState(!1),[b,v]=i.useState(!1),[x,l]=i.useState({open:!1,message:"",severity:"success"});i.useEffect(()=>{(async()=>{try{const k=(await D.get("/users")).data.map(R=>({id:R._id,firstName:R.firstName,lastName:R.lastName,email:R.email,roles:R.roles,_id:R._id,registrationDate:new Date(R.registrationDate),firebaseUID:R.firebaseUID,students:R.students,trainer:R.trainer,trainerEmail:R.trainerEmail}));s(k)}catch(y){console.error("Ошибка при получении списка пользователей:",y)}})()},[]);const g=d=>{a(d),o(""),m("add"),p(!0)},j=()=>{a(null),p(!1)},w=d=>{a(d),v(!0)},_=()=>{v(!1),a(null)},A=async()=>{if(r)try{await D.put("/admin/update-role",{userEmail:r.email,role:n,action:h}),s(t.map(d=>d.id===r.id?{...d,roles:h==="add"?[...d.roles,n]:d.roles.filter(y=>y!==n)}:d)),l({open:!0,message:"Роль успешно изменена",severity:"success"}),j()}catch(d){console.error("Ошибка при изменении роли:",d),l({open:!0,message:"Ошибка при изменении роли",severity:"error"})}},S=async()=>{if(r)try{await D.delete(`/admin/delete-user/${r.id}`),s(t.filter(d=>d.id!==r.id)),l({open:!0,message:"Пользователь удалён",severity:"success"}),_()}catch(d){console.error("Ошибка при удалении пользователя:",d),l({open:!0,message:"Ошибка при удалении пользователя",severity:"error"})}},N=[{field:"firstName",label:"Имя"},{field:"lastName",label:"Фамилия"},{field:"email",label:"Email"},{field:"roles",label:"Роли",render:d=>d.roles.join(", ")},{field:"actions",label:"Действия",render:d=>e.jsxs(e.Fragment,{children:[e.jsx(G,{size:"small",onClick:()=>g(d),children:e.jsx(Pe,{})}),e.jsx(G,{size:"small",color:"error",onClick:()=>w(d),children:e.jsx(Me,{})})]})}];return e.jsxs(O,{children:[e.jsx(c,{variant:"h4",gutterBottom:!0,children:"Список пользователей"}),e.jsx(wr,{columns:N,data:t}),e.jsxs(ae,{open:u,onClose:j,fullWidth:!0,maxWidth:"xs",children:[e.jsx(ie,{children:"Управление ролями"}),e.jsxs(le,{children:[e.jsxs(Ke,{children:["Пользователь: ",e.jsxs("strong",{children:[r==null?void 0:r.firstName," ",r==null?void 0:r.lastName]})]}),e.jsxs(ze,{fullWidth:!0,sx:{marginTop:2},children:[e.jsx($e,{children:"Роль"}),e.jsxs(_e,{value:n,onChange:d=>o(d.target.value),label:"Роль",children:[e.jsx(V,{value:"student",children:"Студент"}),e.jsx(V,{value:"coach",children:"Тренер"})]})]})]}),e.jsxs(ce,{children:[e.jsx(C,{onClick:j,children:"Отмена"}),e.jsx(C,{onClick:A,color:"primary",disabled:!n,children:"Сохранить"})]})]}),e.jsxs(ae,{open:b,onClose:_,children:[e.jsx(ie,{children:"Подтвердите удаление"}),e.jsx(le,{children:e.jsxs(Ke,{children:["Вы уверены, что хотите удалить пользователя ",r==null?void 0:r.email,"? Это действие необратимо."]})}),e.jsxs(ce,{children:[e.jsx(C,{onClick:_,children:"Нет"}),e.jsx(C,{onClick:S,color:"error",children:"Да, удалить"})]})]}),e.jsx(cs,{open:x.open,autoHideDuration:4e3,onClose:()=>l({...x,open:!1}),children:e.jsx(ds,{severity:x.severity,onClose:()=>l({...x,open:!1}),variant:"filled",children:x.message})})]})},kr=kt(U),Ir={individual_lesson:e.jsx(vt,{fontSize:"small"}),group_lesson:e.jsx(yt,{fontSize:"small"}),homework:e.jsx(St,{fontSize:"small"}),opening_study:e.jsx(wt,{fontSize:"small"}),tournament_participation:e.jsx(Ct,{fontSize:"small"})},Nr=["individual_lesson","group_lesson","homework","opening_study","tournament_participation"],Pr=({event:t})=>{const s=t.type;if(!s)return null;const r=Ir[s],a=`custom-event rbc-event--${s}`;return e.jsx(Le,{title:t.description||t.title,placement:"top",children:e.jsxs("div",{className:a,children:[r,e.jsx(c,{variant:"caption",noWrap:!0,component:"span",children:t.title})]})})},_r=({open:t,onClose:s,student:r})=>{const{t:a}=H(),[n,o]=i.useState([]),[h,m]=i.useState({}),[u,p]=i.useState(null);if(!r)return null;const b=`${r.firstName} ${r.lastName}`,v=i.useCallback(()=>{m({student:r._id,status:"scheduled",title:"",type:"individual_lesson",date:"",description:"",link:""}),p(null)},[r]),x=i.useCallback(async()=>{if(r._id)try{const d=await Be(r._id);o(d)}catch(d){console.error("Failed to fetch schedule:",d),P.error({message:a("schedule.fetchError"),description:void 0})}},[r,a]),l=async()=>{const{date:d,type:y,title:k}=h;if(!d||!y||!k){P.error({message:a("schedule.fieldRequired"),description:void 0});return}const R={studentId:r._id,date:new Date(d).toISOString(),title:k,description:h.description||"",link:h.link||"",type:y,status:h.status||"scheduled"};try{const q=!!h._id;q?await hr(h._id,R):await dr(R),P.success({message:a(q?"schedule.updateSuccess":"schedule.createSuccess"),description:void 0}),await x(),v()}catch(q){console.error("Failed to save event:",q)}},g=async()=>{if(h._id)try{await ur(h._id),P.success({message:a("schedule.deleteSuccess"),description:void 0}),await x(),v()}catch(d){console.error("Failed to delete event:",d)}};i.useEffect(()=>{t&&r&&(x(),v())},[t,r,x,v]);const j=i.useCallback(({start:d})=>{v(),p(d),m(y=>({...y,date:U(d).format("YYYY-MM-DDTHH:mm")}))},[v]),w=i.useCallback(d=>{p(d.date?new Date(d.date):null),m({...d,date:d.date?U(d.date).format("YYYY-MM-DDTHH:mm"):""})},[]),_=n.map(d=>({...d,id:d._id,start:new Date(d.date),end:U(d.date).add(1,"hour").toDate(),title:d.title})),A=i.useCallback(d=>({className:u&&U(d).isSame(u,"day")?"rbc-selected-slot-custom":""}),[u]),S=d=>{const{name:y,value:k}=d.target;m(R=>({...R,[y]:k}))},N=d=>{m(y=>({...y,type:d.target.value}))};return e.jsxs(ae,{open:t,onClose:s,fullWidth:!0,maxWidth:"lg",className:"schedule-dialog",children:[e.jsx(ie,{className:"schedule-dialog__header",children:e.jsxs(M,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(c,{variant:"h6",component:"div",children:a("schedule.editScheduleTitle",{studentName:b})}),e.jsx(G,{"aria-label":"close",onClick:s,className:"schedule-dialog__close-btn",children:e.jsx(bt,{})})]})}),e.jsx(le,{dividers:!0,className:"schedule-dialog__content",children:e.jsxs(E,{container:!0,spacing:3,children:[e.jsx(E,{item:!0,xs:12,md:7,children:e.jsx(It,{localizer:kr,events:_,startAccessor:"start",endAccessor:"end",selectable:!0,onSelectSlot:j,onSelectEvent:w,components:{event:Pr},dayPropGetter:A,className:"schedule-calendar"})}),e.jsx(E,{item:!0,xs:12,md:5,children:e.jsxs(W,{component:"form",className:"event-form",onSubmit:d=>{d.preventDefault(),l()},children:[e.jsx(c,{variant:"h6",className:"event-form__header",children:h._id?a("schedule.eventDetails"):u?a("schedule.addEventForDate",{date:U(u).format("MMMM Do, YYYY")}):a("schedule.addEvent")}),e.jsxs(M,{spacing:2.5,className:"event-form__fields",children:[e.jsx(L,{name:"title",label:a("schedule.form_title"),variant:"filled",fullWidth:!0,value:h.title||"",onChange:S,className:"event-form__field"}),e.jsxs(ze,{variant:"filled",fullWidth:!0,className:"event-form__field",children:[e.jsx($e,{children:a("schedule.form_type")}),e.jsx(_e,{name:"type",value:h.type||"",onChange:N,children:Nr.map(d=>e.jsx(V,{value:d,children:a(`schedule.eventTypes.${d}`)},d))})]}),e.jsx(L,{name:"description",label:a("schedule.form_description"),variant:"filled",fullWidth:!0,multiline:!0,rows:3,value:h.description||"",onChange:S,className:"event-form__field"}),e.jsx(L,{name:"link",label:a("schedule.form_link"),variant:"filled",fullWidth:!0,value:h.link||"",onChange:S,className:"event-form__field"}),e.jsx(L,{name:"date",label:a("schedule.form_date"),type:"datetime-local",variant:"filled",fullWidth:!0,value:h.date||"",onChange:S,InputLabelProps:{shrink:!0},className:"event-form__field"})]})]})})]})}),e.jsxs(ce,{className:"schedule-dialog__actions",children:[e.jsx(C,{onClick:s,className:"action-button action-button--close",children:a("common.close")}),e.jsx(f,{sx:{flex:"1 1 auto"}}),h._id&&e.jsx(C,{onClick:g,variant:"outlined",startIcon:e.jsx(Me,{}),className:"action-button action-button--delete",children:a("common.delete")}),e.jsx(C,{onClick:l,variant:"contained",startIcon:h._id?e.jsx(hs,{}):e.jsx(us,{}),className:"action-button action-button--save",children:h._id?a("common.save"):a("common.add")})]})]})},Fr=()=>{const{t}=H(),[s,r]=i.useState([]),[a,n]=i.useState(null),[o,h]=i.useState(!1),[m,u]=i.useState(!0),p=i.useMemo(()=>{const l=localStorage.getItem("user");return l?JSON.parse(l).email:null},[]),b=i.useCallback(async()=>{if(!p){u(!1);return}u(!0);try{const l=await sr(p);if(!Array.isArray(l)||l.length===0){r([]);return}const g=l.map(w=>tr(p,w)),j=await Promise.all(g);r(j.filter(w=>w!==null))}catch(l){console.error("Ошибка при получении списка учеников:",l),P.error({message:t("studentsPage.fetchError"),description:void 0}),r([])}finally{u(!1)}},[p,t]),v=async l=>{if(p)try{await rr(p,l),P.success({message:t("studentsPage.studentDeletedSuccess"),description:void 0}),r(g=>g.filter(j=>j._id!==l))}catch(g){console.error("Ошибка при удалении ученика:",g)}},x=l=>{n(l),h(!0)};return i.useEffect(()=>{b()},[b]),e.jsxs(O,{children:[e.jsx(c,{variant:"h4",gutterBottom:!0,children:t("studentsPage.studentsListTitle")}),e.jsx(W,{children:e.jsxs(pt,{children:[e.jsx(ft,{children:e.jsxs(me,{children:[e.jsx(K,{children:t("studentsPage.firstName")}),e.jsx(K,{children:t("studentsPage.lastName")}),e.jsx(K,{children:t("studentsPage.email")}),e.jsx(K,{align:"right",children:t("studentsPage.actions")})]})}),e.jsx(jt,{children:m?e.jsx(me,{children:e.jsxs(K,{colSpan:4,align:"center",children:[e.jsx(pe,{}),e.jsx(c,{sx:{mt:1},children:t("common.loading")})]})}):s.length>0?s.map(l=>e.jsxs(me,{children:[e.jsx(K,{children:l.firstName}),e.jsx(K,{children:l.lastName}),e.jsx(K,{children:l.email}),e.jsxs(K,{align:"right",children:[e.jsx(C,{variant:"contained",color:"primary",onClick:()=>x(l),style:{marginRight:10},children:t("studentsPage.editSchedule")}),e.jsx(C,{variant:"contained",color:"secondary",onClick:()=>v(l._id),children:t("studentsPage.delete")})]})]},l._id)):e.jsx(me,{children:e.jsx(K,{colSpan:4,align:"center",children:t("studentsPage.noStudents")})})})]})}),a&&e.jsx(_r,{open:o,onClose:()=>h(!1),student:a})]})};class Er{constructor(s){Ee(this,"game");Ee(this,"fullHistory",[]);this.game=s?new xe(s):new xe,this.fullHistory=this.game.history()}getFen(){return this.game.fen()}getTurn(){return this.game.turn()}getHistory(){return this.fullHistory}getMovesForSquare(s){return this.game.moves({square:s,verbose:!0})}getStatus(){return{isCheckmate:this.game.isCheckmate(),isStalemate:this.game.isStalemate(),isThreefoldRepetition:this.game.isThreefoldRepetition(),isInsufficientMaterial:this.game.isInsufficientMaterial(),isDraw:this.game.isDraw(),turn:this.game.turn()}}handleMove(s,r){try{const a=this.game.move({from:s,to:r,promotion:"q"});return a&&(this.fullHistory=this.game.history()),a}catch{return null}}resetGame(){this.game.reset(),this.fullHistory=[]}loadPgn(s){try{return this.game.loadPgn(s),this.fullHistory=this.game.history(),!0}catch(r){return console.error("Invalid PGN:",r),!1}}goToMove(s){const r=new xe;for(let a=0;a<s;a++)this.fullHistory[a]&&r.move(this.fullHistory[a]);this.game=r}uciToSan(s){const r=this.game.move({from:s.substring(0,2),to:s.substring(2,4),promotion:s.length===5?s.substring(4):void 0});return r?(this.game.undo(),r.san):null}}const Dr=t=>{const s=i.useMemo(()=>new Er(t),[t]),[r,a]=i.useState(s.getFen()),[n,o]=i.useState(s.getHistory()),[h,m]=i.useState(n.length),[u,p]=i.useState(null),[b,v]=i.useState({}),x=i.useRef(r);x.current=r;const l=i.useCallback(()=>{a(s.getFen());const N=s.getHistory();o(N),m(N.length)},[s]),g=i.useCallback(()=>{p(null),v({})},[]),j=i.useCallback((N,d)=>s.handleMove(N,d)?(l(),g(),!0):!1,[s,l,g]),w=i.useCallback(N=>{if(N===u){g();return}const d=s.getMovesForSquare(N);if(d.length===0){g();return}const y={};d.forEach(k=>{y[k.to]={background:k.flags.includes("c")?"radial-gradient(circle, rgba(0,0,0,0) 85%, rgba(0,0,0,0.2) 85%)":"radial-gradient(circle, rgba(0,0,0,0.2) 25%, transparent 30%)",borderRadius:"50%"}}),v(y),p(N)},[s,u,g]),_=i.useCallback(()=>{s.resetGame(),l(),g()},[s,l,g]),A=i.useCallback(N=>{const d=s.loadPgn(N.trim());return d&&(l(),g()),d},[s,l,g]),S=i.useCallback(N=>{s.goToMove(N),a(s.getFen()),m(N),g()},[s,g]);return{fen:r,history:n,currentMoveIndex:h,moveOptions:b,actions:{handleMove:j,onSquareClick:w,resetGame:_,loadPgn:A,goToMove:S}}},Ar=({fen:t,onPieceDrop:s,onSquareClick:r,squareStyles:a})=>e.jsx(Nt,{position:t,onPieceDrop:s,onSquareClick:r,customSquareStyles:a,customBoardStyle:{borderRadius:"4px",boxShadow:"0 5px 15px rgba(0, 0, 0, 0.5)"},customDarkSquareStyle:{backgroundColor:"#779952"},customLightSquareStyle:{backgroundColor:"#edeed1"}}),rt=t=>{if(t===void 0)return"";const s=Math.abs(t);return s<.4?" =":s<1?t>0?" += ":" -= ":s<2?t>0?" ±":" ∓":t>0?" +-":" -+"},nt=t=>t===void 0||Math.abs(t)<.4?"text.secondary":t>0?"success.light":"error.light",Rr=({history:t,currentMoveIndex:s,onMoveClick:r})=>{const a=Oe.useMemo(()=>{const n=[];for(let o=0;o<t.length;o+=2)n.push({white:t[o],black:t[o+1]||null});return n},[t]);return e.jsx(W,{variant:"outlined",sx:{p:1.5,height:"100%",overflowY:"auto",bgcolor:"#1c1c1c",borderColor:"rgba(255,255,255,0.2)"},children:e.jsx(E,{container:!0,rowSpacing:.5,columnSpacing:1,sx:{fontSize:"1rem",color:"white"},children:a.map((n,o)=>{const h=o*2+1,m=o*2+2;return e.jsxs(Oe.Fragment,{children:[e.jsxs(E,{item:!0,xs:2,sx:{color:"rgba(255, 255, 255, 0.6)",textAlign:"right",pt:"4px"},children:[o+1,"."]}),e.jsx(E,{item:!0,xs:5,children:e.jsxs(f,{onClick:()=>r(h),sx:{display:"flex",alignItems:"center",cursor:"pointer",p:"2px 5px",borderRadius:"4px",bgcolor:s===h?"rgba(255, 215, 0, 0.3)":"transparent","&:hover":{bgcolor:"rgba(255,255,255,0.1)"}},children:[e.jsx(c,{component:"span",children:n.white.san}),e.jsx(c,{component:"span",sx:{color:nt(n.white.evaluation),fontWeight:"bold",ml:.5},children:rt(n.white.evaluation)})]})}),e.jsx(E,{item:!0,xs:5,children:n.black&&e.jsxs(f,{onClick:()=>r(m),sx:{display:"flex",alignItems:"center",cursor:"pointer",p:"2px 5px",borderRadius:"4px",bgcolor:s===m?"rgba(255, 215, 0, 0.3)":"transparent","&:hover":{bgcolor:"rgba(255,255,255,0.1)"}},children:[e.jsx(c,{component:"span",children:n.black.san}),e.jsx(c,{component:"span",sx:{color:nt(n.black.evaluation),fontWeight:"bold",ml:.5},children:rt(n.black.evaluation)})]})})]},o)})})})},Mr=({evaluation:t,depth:s,principalVariation:r,isAnalyzing:a,isEngineOn:n,onToggleEngine:o})=>e.jsxs(W,{variant:"outlined",sx:{p:2,borderColor:"rgba(255,255,255,0.2)",borderRadius:2},children:[e.jsxs(M,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(c,{variant:"h4",fontWeight:"bold",sx:{color:"#FFD700"},children:t??e.jsx(c,{component:"span",color:"text.secondary",children:"..."})}),e.jsxs(M,{direction:"row",alignItems:"center",spacing:1,children:[e.jsxs(M,{alignItems:"flex-end",children:[e.jsxs(c,{variant:"body2",color:"text.secondary",children:["Depth: ",s]}),e.jsx(c,{variant:"body2",color:"text.secondary",children:"SF 16"})]}),e.jsx(ne,{control:e.jsx(ms,{checked:n,onChange:o,sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#FFD700"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#FFD700"}}}),label:"",sx:{mr:0}})]})]}),e.jsx(J,{sx:{my:1,borderColor:"rgba(255,255,255,0.2)"}}),e.jsx(f,{sx:{minHeight:"4em",overflowX:"auto",whiteSpace:"nowrap"},children:e.jsx(c,{variant:"body1",children:r||(a?"Analyzing...":e.jsx(c,{component:"span",color:"text.secondary",children:"-"}))})})]}),Wr=()=>{const{t}=H(),{fen:s,history:r,currentMoveIndex:a,moveOptions:n,actions:o}=Dr(),[h,m]=i.useState([]),[u,p]=i.useState(""),[b,v]=i.useState(null),[x,l]=i.useState(!1),[g,j]=i.useState(null),[w,_]=i.useState(0),[A,S]=i.useState(""),[N,d]=i.useState(!1),y=i.useRef(s);i.useEffect(()=>{y.current=s},[s]),i.useEffect(()=>{m(r.map(F=>({san:F})))},[r]);const k=()=>{j(null),_(0),S("")},R=()=>{o.loadPgn(u)?(k(),P.success({message:t("chessGame.pgnLoadSuccess"),description:void 0})):P.error({message:t("chessGame.pgnLoadError"),description:void 0})},q=()=>{o.resetGame(),k(),P.success({message:t("chessGame.resetSuccess"),description:void 0})},$=F=>{o.goToMove(F),k()},te=i.useCallback(()=>{b&&!x&&(l(!0),k(),b.postMessage(`position fen ${s}`),b.postMessage("go depth 18"))},[b,s,x]);i.useEffect(()=>{N?te():b&&(b.postMessage("stop"),l(!1))},[s,N,te,b]);const he=F=>{d(F.target.checked)},I=i.useCallback((F,z)=>{try{const T=new xe(z),se=F.split(" ");let X="";for(const Q of se){const re=T.move({from:Q.substring(0,2),to:Q.substring(2,4),promotion:Q.length===5?Q.substring(4):void 0});if(re)T.turn()==="b"?X+=`${T.moveNumber()}. ${re.san} `:X+=`${re.san} `;else break}return X.trim()}catch{return F}},[]);return i.useEffect(()=>{const F=new Worker("/workers/stockfish.js");return v(F),F.postMessage("uci"),F.onmessage=z=>{const T=z.data;if(T!=="uciok"){if(T.startsWith("info depth")){const se=T.match(/depth (\d+)/),X=T.match(/score (cp|mate) (-?\d+)/),Q=T.match(/ pv (.+)/);if(se&&_(parseInt(se[1],10)),X){const re=new xe(y.current).turn(),Dt=X[1];let Fe=parseInt(X[2],10);re==="b"&&(Fe*=-1);const At=Dt==="cp"?(Fe/100).toFixed(2):`M${Math.abs(Fe)}`;j(At)}if(Q){const re=I(Q[1],y.current);S(re)}}T.startsWith("bestmove")&&l(!1)}},()=>F.terminate()},[I]),e.jsx(f,{sx:{bgcolor:"#0e0e0e",color:"white",minHeight:"100vh",py:{xs:2,md:5}},children:e.jsxs(O,{maxWidth:"xl",children:[e.jsxs(f,{sx:{textAlign:"center",mb:4},children:[e.jsx(c,{variant:"h2",component:"h1",fontWeight:"bold",children:t("chessGame.title")}),e.jsx(c,{variant:"h6",sx:{mt:1,color:"rgba(255, 255, 255, 0.7)"},children:t("chessGame.subtitle")})]}),e.jsxs(E,{container:!0,spacing:4,children:[e.jsx(E,{item:!0,xs:12,md:7,children:e.jsx(W,{sx:{p:2,bgcolor:"#1c1c1c",borderRadius:4,aspectRatio:"1 / 1",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ar,{fen:s,onPieceDrop:o.handleMove,onSquareClick:o.onSquareClick,squareStyles:n})})}),e.jsx(E,{item:!0,xs:12,md:5,children:e.jsx(W,{sx:{p:2,bgcolor:"#1c1c1c",borderRadius:4,height:"100%"},children:e.jsxs(M,{spacing:2,height:"100%",children:[e.jsx(Mr,{evaluation:g,depth:w,principalVariation:A,isAnalyzing:x,isEngineOn:N,onToggleEngine:he}),e.jsx(f,{sx:{flexGrow:1,height:"250px"},children:e.jsx(Rr,{history:h,currentMoveIndex:a,onMoveClick:$})}),e.jsxs(M,{direction:"row",spacing:1,justifyContent:"center",alignItems:"center",children:[e.jsx(G,{onClick:()=>$(0),disabled:a===0,children:e.jsx(xs,{})}),e.jsx(G,{onClick:()=>$(a-1),disabled:a===0,children:e.jsx(gs,{})}),e.jsx(G,{onClick:()=>$(a+1),disabled:a===r.length,children:e.jsx(ps,{})}),e.jsx(G,{onClick:()=>$(r.length),disabled:a===r.length,children:e.jsx(fs,{})})]}),e.jsxs(M,{spacing:1,children:[e.jsx(L,{label:t("chessGame.pgnInputLabel"),fullWidth:!0,multiline:!0,rows:2,variant:"filled",value:u,onChange:F=>p(F.target.value),sx:{"& .MuiFilledInput-root":{backgroundColor:"rgba(255,255,255,0.1)"}}}),e.jsxs(M,{direction:"row",spacing:1,children:[e.jsx(C,{variant:"outlined",onClick:q,startIcon:e.jsx(js,{}),fullWidth:!0,children:t("chessGame.reset")}),e.jsx(C,{variant:"outlined",onClick:R,startIcon:e.jsx(bs,{}),fullWidth:!0,children:t("chessGame.loadPgn")})]})]})]})})})]})]})})},Tr=({position:t,onMove:s,onSquareClick:r,boardWidth:a=500})=>e.jsx(Nt,{position:t,boardWidth:a,onPieceDrop:s?(n,o)=>s(n,o):void 0,onSquareClick:r}),ot=({initialFen:t})=>{const s=t||"8/8/8/8/8/8/8/8 w - - 0 1",[r,a]=i.useState(!1),[n]=i.useState(()=>{const S=new xe;return S.clear(),S}),[o,h]=i.useState(s),[m,u]=i.useState(null),[p,b]=i.useState(null),v=[{type:"k",color:"b",icon:"♚"},{type:"q",color:"b",icon:"♛"},{type:"r",color:"b",icon:"♜"},{type:"b",color:"b",icon:"♝"},{type:"n",color:"b",icon:"♞"},{type:"p",color:"b",icon:"♟"},{type:"k",color:"w",icon:"♔"},{type:"q",color:"w",icon:"♕"},{type:"r",color:"w",icon:"♖"},{type:"b",color:"w",icon:"♗"},{type:"n",color:"w",icon:"♘"},{type:"p",color:"w",icon:"♙"}],x=i.useRef(null);i.useEffect(()=>{const S=N=>{if(!m||!r||!x.current)return;const d=x.current.getBoundingClientRect(),y=N.clientX-d.left,k=N.clientY-d.top;y>=0&&k>=0&&y<=d.width&&k<=d.height&&b({left:y,top:k})};return window.addEventListener("mousemove",S),()=>window.removeEventListener("mousemove",S)},[m,r]);const l=(S,N,d)=>{let y=o.split(" "),k=y[2]==="-"?"":y[2];N?k=(k+d).split("").sort().join(""):k=k.replace(d,""),y[2]=k||"-";const R=y.join(" ");try{n.load(R),h(R)}catch{P.error({message:"Ошибка рокировки",description:void 0})}},g=S=>{const[N,d]=[S.charCodeAt(0)-97,8-parseInt(S[1])],k=n.board()[d][N];if(m){k&&k.type===m.type&&k.color===m.color?n.remove(S):n.put(m,S),h(n.fen());return}k&&(n.remove(S),h(n.fen()))},j=()=>{n.clear(),h(n.fen()),P.success({message:"Доска очищена!",description:void 0})},w=()=>{n.reset(),h(n.fen()),P.success({message:"Установлена начальная позиция!",description:void 0})},_=()=>{u(null),b(null)},A=()=>{if(o.split("").filter(N=>N.toLowerCase()==="k").length<2){P.error({message:"Некорректная позиция",description:"На доске должно быть как минимум два короля."});return}try{n.load(o),P.success({message:"Позиция сохранена",description:`FEN: ${o}`})}catch{P.error({message:"Ошибка сохранения",description:"Некорректная FEN-позиция"})}};return e.jsxs(O,{children:[e.jsx(c,{variant:"h4",gutterBottom:!0,children:"Редактор шахматной позиции"}),e.jsxs(f,{display:"flex",children:[e.jsxs(f,{onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),style:{cursor:m?"none":"default",position:"relative",width:500,height:500},children:[e.jsx(Tr,{position:o,onSquareClick:g,boardWidth:500}),p&&m&&e.jsx("div",{style:{...p,position:"absolute",pointerEvents:"none",left:p.left,top:p.top,fontSize:"32px",zIndex:1e3},children:m.icon})]}),e.jsxs(f,{ml:3,display:"flex",flexDirection:"column",children:[e.jsxs(W,{elevation:3,style:{padding:"10px",marginBottom:"20px"},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Фигуры"}),e.jsx(f,{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:1,children:v.map((S,N)=>e.jsx(f,{onClick:()=>u(S),style:{textAlign:"center",cursor:"pointer",padding:6,border:"1px solid #aaa",borderRadius:4,fontSize:24,backgroundColor:m===S?"#1976d2":"#f5f5f5",color:m===S?"#fff":"inherit"},children:S.icon},N))})]}),e.jsxs(W,{elevation:3,style:{padding:"10px",marginBottom:"20px"},children:[e.jsx(c,{variant:"h6",children:"Рокировка"}),e.jsxs(vs,{row:!0,children:[e.jsx(ne,{control:e.jsx(Ce,{checked:o.includes("K"),onChange:S=>l(o,S.target.checked,"K")}),label:"Белые 0-0"}),e.jsx(ne,{control:e.jsx(Ce,{checked:o.includes("Q"),onChange:S=>l(o,S.target.checked,"Q")}),label:"Белые 0-0-0"}),e.jsx(ne,{control:e.jsx(Ce,{checked:o.includes("k"),onChange:S=>l(o,S.target.checked,"k")}),label:"Чёрные 0-0"}),e.jsx(ne,{control:e.jsx(Ce,{checked:o.includes("q"),onChange:S=>l(o,S.target.checked,"q")}),label:"Чёрные 0-0-0"})]})]}),e.jsxs(W,{elevation:3,style:{padding:"10px"},children:[e.jsx(c,{variant:"h6",children:"Ход"}),e.jsxs(ys,{row:!0,value:n.turn(),onChange:S=>{const N=o.split(" ");N[1]=S.target.value;const d=N.join(" ");try{n.load(d),h(d)}catch{P.error({message:"Ошибка изменения хода",description:void 0})}},children:[e.jsx(ne,{value:"w",control:e.jsx(Ye,{}),label:"Белые"}),e.jsx(ne,{value:"b",control:e.jsx(Ye,{}),label:"Чёрные"})]})]})]})]}),e.jsxs(M,{direction:"row",spacing:2,mt:3,children:[e.jsx(C,{variant:"contained",onClick:j,children:"Очистить доску"}),e.jsx(C,{variant:"contained",onClick:w,children:"Начальная позиция"}),e.jsx(C,{variant:"contained",onClick:_,children:"Убрать фигуру"}),e.jsx(C,{variant:"contained",color:"primary",onClick:A,children:"Сохранить"})]}),e.jsx(L,{label:"FEN",value:o,fullWidth:!0,multiline:!0,rows:2,onChange:S=>{const N=S.target.value;try{n.load(N),h(N)}catch{P.error({message:"Некорректный FEN",description:void 0})}},style:{marginTop:20}}),p&&m&&e.jsx("div",{style:p,children:m.icon})]})},Lr=async t=>(await D.get("/auth/check-verification",{params:{email:t}})).data,zr=async t=>(await D.post("/auth/resend-verification",{email:t})).data,$r=()=>{const t=de(),s=Re(),{t:r}=H(),{firstName:a,lastName:n,email:o}=s.state||{},[h,m]=i.useState(!1),[u,p]=i.useState(!0),[b,v]=i.useState(null),[x,l]=i.useState(null),[g,j]=i.useState(!1),w=i.useRef(null);i.useEffect(()=>{if(!o){console.error("Email not found in location state. Redirecting to register."),t("/register");return}return w.current=setInterval(async()=>{try{const{emailVerified:A}=await Lr(o);A&&(p(!1),t("/login",{state:{message:r("verifyEmail.verifiedAndReadyToLogin")}}))}catch(A){console.error("Polling error:",A)}},5e3),()=>{w.current&&clearInterval(w.current)}},[o,t,r]);const _=async()=>{var A;if(o){m(!0),v(null),l(null);try{await zr(o),v(r("verifyEmail.resendSuccess")),j(!0),setTimeout(()=>j(!1),12e4)}catch(S){((A=S.response)==null?void 0:A.status)===429?l(r("verifyEmail.resendErrorTooMany")):l(r("verifyEmail.resendError"))}finally{m(!1)}}};return e.jsxs(f,{textAlign:"center",mt:5,p:2,children:[u&&e.jsx(pe,{sx:{mb:2}}),e.jsx(c,{variant:"h4",gutterBottom:!0,children:r("verifyEmail.pageTitle")}),e.jsx(c,{variant:"body1",gutterBottom:!0,children:e.jsx("b",{children:r("verifyEmail.greeting",{firstName:a||"",lastName:n||""})})}),e.jsx(c,{variant:"body1",gutterBottom:!0,children:r("verifyEmail.sentTo",{email:o||r("verifyEmail.yourEmail")})}),e.jsx(c,{variant:"body1",color:"text.secondary",sx:{mt:2,maxWidth:"600px",mx:"auto"},children:r("verifyEmail.instruction")}),b&&!x&&e.jsx(c,{variant:"body2",color:"primary.main",sx:{mt:2,fontWeight:"bold"},children:b}),x&&e.jsx(c,{variant:"body2",color:"error",sx:{mt:2,fontWeight:"bold"},children:x}),e.jsx(C,{variant:"contained",color:"primary",onClick:_,disabled:g||h,sx:{mt:3,mb:2},children:r(h?"verifyEmail.sending":"verifyEmail.resendButton")}),e.jsx(c,{variant:"caption",display:"block",children:r("verifyEmail.didNotReceive")})]})},Hr=async()=>(await D.get("/trainer/requests",{})).data,Br=async(t,s)=>{await D.patch(`/trainer/request?request_id=${t}`,{status:s})},Or=async(t,s,r)=>(await D.post("/trainer/request",{coachId:t,experience:s,goals:r})).data,Ie={"& .MuiInputBase-root":{backgroundColor:"rgba(255, 255, 255, 0.08)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.12)"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.6)"},"& .MuiInputBase-input":{color:"white"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.6)"}},qr=()=>{var $,te,he;const{t}=H(),[s,r]=i.useState([]),[a,n]=i.useState(null),[o,h]=i.useState(""),[m,u]=i.useState(!1),[p,b]=i.useState(!1),[v,x]=i.useState(!1),[l,g]=i.useState(!1),j=localStorage.getItem("email"),[w,_]=i.useState({userName:"",userEmail:"",experienceLevel:"Intermediate",goals:""}),[A,S]=i.useState({title:"",experience:"",bio:"",price:"",services:""});i.useEffect(()=>{(async()=>{try{const F=await Qs();r(F)}catch{P.error({message:t("coaches.fetchError"),description:void 0})}})()},[t]);const N=I=>{var F,z,T,se,X,Q;n(I),u(!0),x(!1),g(!1),S({title:((F=I.coachProfile)==null?void 0:F.title)||"",experience:((z=I.coachProfile)==null?void 0:z.experience)||"",bio:((T=I.coachProfile)==null?void 0:T.bio)||"",price:((X=(se=I.coachProfile)==null?void 0:se.price)==null?void 0:X.toString())||"",services:(((Q=I.coachProfile)==null?void 0:Q.services)||[]).join(", ")})},d=()=>{u(!1),setTimeout(()=>{n(null),x(!1),g(!1),_({userName:"",userEmail:"",experienceLevel:"Intermediate",goals:""})},300)},y=async()=>{if(a)try{b(!0),await Or(a._id,w.experienceLevel,w.goals),P.success({message:t("coaches.successMessage"),description:void 0}),d()}catch{P.error({message:t("coaches.submitError"),description:void 0})}finally{b(!1)}},k=async()=>{console.log("Saving profile:",A),P.success({message:t("coaches.updated"),description:void 0}),d()},R=s.filter(I=>`${I.firstName} ${I.lastName}`.toLowerCase().includes(o.toLowerCase())),q=a?`${a.firstName} ${a.lastName}`:"";return e.jsx(f,{sx:{bgcolor:"#0e0e0e",color:"white",minHeight:"100vh",py:8},children:e.jsxs(O,{maxWidth:"lg",children:[e.jsxs(f,{sx:{textAlign:"center",mb:8},children:[e.jsx(c,{variant:"h2",component:"h1",fontWeight:"bold",children:t("coaches.title")}),e.jsx(c,{variant:"h6",sx:{mt:1,color:"rgba(255, 255, 255, 0.7)"},children:t("coaches.subtitle")})]}),e.jsx(f,{sx:{mb:5,maxWidth:"600px",mx:"auto"},children:e.jsx(L,{fullWidth:!0,variant:"outlined",placeholder:t("coaches.searchByName"),value:o,onChange:I=>h(I.target.value),sx:{"& .MuiOutlinedInput-root":{borderRadius:"30px",backgroundColor:"#1c1c1c","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"#FFD700"},"&.Mui-focused fieldset":{borderColor:"#FFD700"}},"& .MuiInputBase-input":{color:"white"}},InputProps:{startAdornment:e.jsx(Ss,{position:"start",children:e.jsx(ws,{sx:{color:"rgba(255, 255, 255, 0.5)"}})})}})}),e.jsx(E,{container:!0,spacing:4,children:R.map(I=>{var F,z,T;return e.jsx(E,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(dt,{sx:{bgcolor:"#1c1c1c",color:"white",borderRadius:4,height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-8px)",boxShadow:"0 12px 24px rgba(255, 215, 0, 0.2)"}},children:[e.jsx(ht,{component:"img",height:"250",image:I.photoUrl||"/images/default-avatar.png",alt:`${I.firstName} ${I.lastName}`}),e.jsxs(ut,{sx:{flexGrow:1},children:[e.jsxs(c,{variant:"h5",component:"div",fontWeight:"bold",children:[I.firstName," ",I.lastName]}),e.jsx(c,{variant:"body1",sx:{color:"#FFD700",mb:2},children:((F=I.coachProfile)==null?void 0:F.title)||"Chess Master"}),e.jsxs(M,{spacing:1,children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",color:"rgba(255,255,255,0.7)"},children:[e.jsx(Cs,{fontSize:"small",sx:{mr:1}}),e.jsx(c,{variant:"body2",children:((z=I.coachProfile)==null?void 0:z.experience)||"N/A"})]}),e.jsxs(f,{sx:{display:"flex",alignItems:"center",color:"rgba(255,255,255,0.7)"},children:[e.jsx(ks,{fontSize:"small",sx:{mr:1}}),e.jsx(c,{variant:"body2",children:(T=I.coachProfile)!=null&&T.price?`${I.coachProfile.price}$ / hour`:"Contact for price"})]})]})]}),e.jsx(f,{sx:{p:2,pt:0},children:e.jsx(C,{variant:"contained",fullWidth:!0,onClick:()=>N(I),sx:{backgroundColor:"#FFD700",color:"black",fontWeight:"bold",borderRadius:"20px","&:hover":{backgroundColor:"#FFC107"}},children:t("coaches.viewProfile")})})]})},I._id)})}),e.jsx(ae,{open:m,onClose:d,fullWidth:!0,maxWidth:"md",PaperProps:{sx:{bgcolor:"#1c1c1c",color:"white",borderRadius:4,backgroundImage:"none"}},children:a&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{sx:{p:3,pb:1},children:e.jsxs(M,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(c,{variant:"h5",fontWeight:"bold",children:l?t("coaches.editProfile"):t("coaches.profileOf",{coachName:q})}),e.jsx(G,{onClick:d,sx:{color:"rgba(255,255,255,0.7)"},children:e.jsx(bt,{})})]})}),e.jsx(le,{children:l?e.jsx(M,{spacing:2,sx:{pt:1}}):e.jsxs(e.Fragment,{children:[e.jsxs(E,{container:!0,spacing:4,sx:{pt:1},children:[e.jsx(E,{item:!0,xs:12,md:4,children:e.jsx(Te,{src:a.photoUrl||"/images/default-avatar.png",sx:{width:"100%",height:"auto",aspectRatio:"1 / 1",borderRadius:3},variant:"rounded"})}),e.jsx(E,{item:!0,xs:12,md:8,children:e.jsxs(M,{spacing:2.5,children:[e.jsxs(f,{children:[e.jsx(c,{fontWeight:"bold",color:"#FFD700",children:t("coaches.bio")}),e.jsx(c,{sx:{color:"rgba(255,255,255,0.8)",whiteSpace:"pre-wrap"},children:(($=a.coachProfile)==null?void 0:$.bio)||e.jsx("span",{style:{color:"rgba(255,255,255,0.5)",fontStyle:"italic"},children:"No bio provided."})})]}),e.jsxs(f,{children:[e.jsx(c,{fontWeight:"bold",color:"#FFD700",children:t("coaches.services")}),e.jsx(f,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:(he=(te=a.coachProfile)==null?void 0:te.services)!=null&&he.length?a.coachProfile.services.map(I=>e.jsx(je,{label:I,sx:{bgcolor:"rgba(255,255,255,0.2)",color:"white"}},I)):e.jsx(c,{sx:{color:"rgba(255,255,255,0.5)",fontStyle:"italic"},children:"No services listed."})})]})]})})]}),e.jsx(J,{sx:{my:3,borderColor:"rgba(255,255,255,0.2)"}}),e.jsx(f,{children:v?e.jsxs(W,{elevation:0,sx:{p:{xs:2,sm:3},bgcolor:"rgba(0,0,0,0.25)",borderRadius:2},children:[e.jsx(c,{variant:"h6",fontWeight:"bold",sx:{mb:2},children:t("coaches.requestTitle",{coachName:q})}),e.jsxs(M,{spacing:2,children:[e.jsx(L,{fullWidth:!0,label:t("coaches.yourName"),value:w.userName,onChange:I=>_({...w,userName:I.target.value}),variant:"filled",sx:Ie}),e.jsx(L,{fullWidth:!0,label:t("coaches.yourEmail"),value:w.userEmail,onChange:I=>_({...w,userEmail:I.target.value}),variant:"filled",sx:Ie}),e.jsxs(ze,{fullWidth:!0,variant:"filled",sx:Ie,children:[e.jsx($e,{id:"level-select-label",children:t("coaches.level")}),e.jsxs(_e,{labelId:"level-select-label",value:w.experienceLevel,onChange:I=>_({...w,experienceLevel:I.target.value}),children:[e.jsx(V,{value:"Beginner",children:t("coaches.levelBeginner")}),e.jsx(V,{value:"Intermediate",children:t("coaches.levelIntermediate")}),e.jsx(V,{value:"Advanced",children:t("coaches.levelAdvanced")})]})]}),e.jsx(L,{fullWidth:!0,multiline:!0,rows:3,label:t("coaches.goals"),value:w.goals,onChange:I=>_({...w,goals:I.target.value}),variant:"filled",sx:Ie})]})]}):e.jsx(C,{fullWidth:!0,variant:"outlined",onClick:()=>x(!0),sx:{color:"#FFD700",borderColor:"#FFD700","&:hover":{borderColor:"#FFC107",bgcolor:"rgba(255, 215, 0, 0.1)"}},children:t("coaches.requestTitle",{coachName:a.firstName})})})]})}),e.jsx(ce,{sx:{p:3,pt:2},children:l?e.jsxs(e.Fragment,{children:[e.jsx(C,{onClick:()=>g(!1),sx:{color:"rgba(255,255,255,0.7)"},children:t("coaches.cancel")}),e.jsx(C,{variant:"contained",onClick:k,startIcon:e.jsx(Pe,{}),sx:{bgcolor:"#FFD700",color:"black","&:hover":{bgcolor:"#FFC107"}},children:t("coaches.save")})]}):v?e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"outlined",onClick:()=>x(!1),sx:{color:"rgba(255,255,255,0.7)",borderColor:"rgba(255,255,255,0.3)"},children:t("coaches.cancel")}),e.jsx(C,{variant:"contained",onClick:y,disabled:p,startIcon:e.jsx(mt,{}),sx:{bgcolor:"#FFD700",color:"black","&:hover":{bgcolor:"#FFC107"}},children:t("coaches.sendRequest")})]}):a.email===j&&e.jsx(C,{variant:"text",onClick:()=>g(!0),startIcon:e.jsx(Pe,{}),sx:{color:"#FFD700"},children:t("coaches.editProfile")})})]})})]})})},ve=t=>"createdAt"in t,Kr=()=>{const{t}=H(),[s,r]=i.useState("requests"),[a,n]=i.useState([]),[o,h]=i.useState(null),[m,u]=i.useState(!0),[p,b]=i.useState(""),[v,x]=i.useState(!1),[l,g]=i.useState(null),[j,w]=i.useState(!1),_=i.useCallback(async d=>{u(!0),h(null);try{const y=d==="requests"?await Hr():await xr();n(Array.isArray(y)?y:[])}catch(y){console.error(`Error loading ${d}:`,y),P.error({message:t("inbox.errors.loadFailed"),description:void 0})}finally{u(!1)}},[t]);i.useEffect(()=>{_(s)},[s,_]),i.useEffect(()=>{let d=null;return(async()=>{if(!o||ve(o)||!o.hasScreenshot){g(null);return}w(!0);try{const k=await gr(o._id);d=URL.createObjectURL(k),g(d)}catch(k){console.error("Screenshot load error:",k),P.error({message:t("inbox.errors.loadScreenshotFailed"),description:void 0})}finally{w(!1)}})(),b(""),()=>{d&&URL.revokeObjectURL(d)}},[o,t]);const A=async d=>{if(!(!o||!ve(o))){x(!0);try{await Br(o._id,d),P.success({message:t("inbox.success.requestHandled",{action:t(d==="approved"?"inbox.success.actions.approved":"inbox.success.actions.rejected")}),description:void 0}),await _("requests")}catch(y){console.error("Error handling request:",y),P.error({message:t("inbox.errors.handleRequestFailed"),description:void 0})}finally{x(!1)}}},S=async d=>{if(!(!o||ve(o))){x(!0);try{await mr(o._id,{status:d,comment:p}),P.success({message:t("inbox.success.homeworkReviewed"),description:void 0}),await _("homework")}catch(y){console.error("Error reviewing homework:",y),P.error({message:t("inbox.errors.reviewHomeworkFailed"),description:void 0})}finally{x(!1)}}},N=()=>{var d;return m&&!o?null:o?ve(o)?e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"h6",children:[o.student.firstName," ",o.student.lastName]}),e.jsxs(c,{children:[t("inbox.details.email"),": ",o.student.email]}),e.jsxs(c,{children:[t("inbox.details.sent"),": ",new Date(o.createdAt).toLocaleString()]}),e.jsx(J,{sx:{my:2}}),e.jsxs(c,{children:[e.jsxs("strong",{children:[t("inbox.details.experience"),":"]})," ",o.experience||t("inbox.details.notSpecified")]}),e.jsxs(c,{children:[e.jsxs("strong",{children:[t("inbox.details.goals"),":"]})," ",o.goals||t("inbox.details.notSpecified")]}),e.jsxs(f,{mt:3,display:"flex",gap:2,children:[e.jsx(C,{variant:"contained",color:"primary",onClick:()=>A("approved"),disabled:v||o.status!=="pending",children:t("inbox.actions.approve")}),e.jsx(C,{variant:"contained",color:"secondary",onClick:()=>A("rejected"),disabled:v||o.status!=="pending",children:t("inbox.actions.reject")})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"h5",gutterBottom:!0,children:((d=o.schedule)==null?void 0:d.title)||t("inbox.list.untitled")}),e.jsxs(c,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,children:[t("inbox.details.student"),": ",o.student.firstName," ",o.student.lastName]}),e.jsx(J,{sx:{my:2}}),o.text&&e.jsxs(f,{mb:2,children:[e.jsxs(c,{variant:"h6",children:[t("inbox.details.responseText"),":"]}),e.jsx(c,{sx:{whiteSpace:"pre-wrap",p:1,bgcolor:"action.hover",borderRadius:1},children:o.text})]}),o.hasScreenshot&&e.jsxs(f,{mb:2,children:[e.jsxs(c,{variant:"h6",children:[t("inbox.details.screenshot"),":"]}),j&&e.jsxs(f,{sx:{display:"flex",alignItems:"center",my:2},children:[e.jsx(pe,{size:24,sx:{mr:2}})," ",t("inbox.loading")]}),l&&!j&&e.jsx(Se,{href:l,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:l,alt:t("inbox.details.screenshotAlt"),style:{maxWidth:"100%",height:"auto",borderRadius:"8px",border:"1px solid #ddd",display:"block",cursor:"pointer"}})})]}),e.jsx(J,{sx:{my:2}}),e.jsxs(c,{variant:"h6",children:[t("inbox.details.feedback"),":"]}),e.jsx(L,{fullWidth:!0,multiline:!0,rows:4,label:t("inbox.details.commentLabel"),value:p,onChange:y=>b(y.target.value),margin:"normal",disabled:v}),e.jsxs(f,{mt:2,display:"flex",gap:2,children:[e.jsx(C,{variant:"contained",color:"success",onClick:()=>S("approved"),disabled:v,children:t("inbox.actions.approve")}),e.jsx(C,{variant:"contained",color:"error",onClick:()=>S("rejected"),disabled:v,children:t("inbox.actions.sendForRevision")})]})]}):e.jsx(c,{color:"text.secondary",children:t("inbox.selectItemPrompt")})};return e.jsxs(O,{sx:{py:4},children:[e.jsx(c,{variant:"h4",gutterBottom:!0,children:t("inbox.title")}),e.jsx(f,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(gt,{value:s,onChange:(d,y)=>r(y),"aria-label":"inbox tabs",children:[e.jsx(ye,{label:t("inbox.tabs.requests"),value:"requests"}),e.jsx(ye,{label:t("inbox.tabs.homework"),value:"homework"})]})}),e.jsxs(E,{container:!0,spacing:3,children:[e.jsx(E,{item:!0,xs:12,md:4,children:e.jsx(W,{style:{maxHeight:"80vh",overflow:"auto"},children:m?e.jsx(f,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(pe,{})}):e.jsx(ct,{component:"nav",children:a.length>0?a.map(d=>{var y;return e.jsx(Z,{selected:(o==null?void 0:o._id)===d._id,onClick:()=>h(d),children:e.jsx(Y,{primaryTypographyProps:{style:{fontWeight:(o==null?void 0:o._id)===d._id?"bold":"normal"}},primary:d.student?`${d.student.firstName} ${d.student.lastName}`:t("inbox.unknownStudent","Unknown Student"),secondary:ve(d)?t("inbox.list.requestSecondary",{date:new Date(d.createdAt).toLocaleDateString()}):t("inbox.list.homeworkSecondary",{title:((y=d.schedule)==null?void 0:y.title)||t("inbox.list.untitled","Без темы")})})},d._id)}):e.jsx(c,{sx:{p:2,textAlign:"center"},children:t("inbox.empty")})})})}),e.jsx(E,{item:!0,xs:12,md:8,children:e.jsx(W,{style:{padding:24,minHeight:"50vh",display:"flex",flexDirection:"column"},children:N()})})]})]})},Yr=kt(U),Ur={individual_lesson:e.jsx(vt,{fontSize:"small"}),group_lesson:e.jsx(yt,{fontSize:"small"}),homework:e.jsx(St,{fontSize:"small"}),opening_study:e.jsx(wt,{fontSize:"small"}),tournament_participation:e.jsx(Ct,{fontSize:"small"})},Gr=({event:t})=>{const s=Ur[t.type],r=`custom-event rbc-event--${t.type}`;return e.jsx(Le,{title:t.description||t.title,placement:"top",children:e.jsxs("div",{className:r,children:[s,e.jsx(c,{variant:"caption",noWrap:!0,component:"span",children:t.title})]})})},Vr=({events:t,onSelectEvent:s})=>{const r=i.useMemo(()=>t.map(a=>({...a,start:new Date(a.date),end:U(a.date).add(1,"hour").toDate()})),[t]);return e.jsx(W,{className:"schedule-paper",style:{height:"70vh",padding:"16px"},children:e.jsx(It,{localizer:Yr,events:r,startAccessor:"start",endAccessor:"end",views:["month","week","day","agenda"],components:{event:Gr},onSelectEvent:s,className:"schedule-calendar-standalone"})})},at=5,fe={scheduled:{icon:e.jsx(ge,{fontSize:"small"}),color:"info",labelKey:"status.scheduled"},pending:{icon:e.jsx(ge,{fontSize:"small"}),color:"warning",labelKey:"status.pending"},completed:{icon:e.jsx(oe,{fontSize:"small"}),color:"success",labelKey:"status.completed"},approved:{icon:e.jsx(oe,{fontSize:"small"}),color:"success",labelKey:"status.approved"},rejected:{icon:e.jsx(We,{fontSize:"small"}),color:"error",labelKey:"status.rejected"}},Jr=Object.keys(fe),Xr=({event:t,onSelect:s,t:r})=>{const a=t.status,n=fe[a]||fe.scheduled;return e.jsxs(W,{className:`event-card event-card--${n.color}`,onClick:()=>s(t),children:[e.jsxs(f,{className:"event-card__header",children:[e.jsx(c,{variant:"h6",className:"event-card__title",children:t.title}),e.jsx(je,{icon:n.icon,label:r(n.labelKey),color:n.color,size:"small"})]}),e.jsx(c,{variant:"body2",className:"event-card__date",children:U(t.date).format("MMMM Do, YYYY [at] HH:mm")}),t.description&&e.jsx(c,{variant:"body2",className:"event-card__description",children:t.description})]})},Qr=({events:t,onSelectEvent:s,t:r})=>e.jsx(f,{className:"event-list",children:t.length===0?e.jsx(W,{className:"event-list__empty",children:e.jsx(c,{children:r("studentSchedule.noEventsForDay")})}):t.map(a=>e.jsx(Xr,{event:a,onSelect:s,t:r},a._id))}),Zr=({statusFilters:t,onFilterChange:s,t:r})=>{const a=(n,o)=>s(o);return e.jsxs(W,{className:"event-controls",children:[e.jsxs(c,{variant:"button",className:"event-controls__label",children:[r("common.filterByStatus"),":"]}),e.jsx(Is,{value:t,onChange:a,size:"small",children:Jr.map(n=>e.jsx(Ns,{value:n,className:"filter-toggle-button",children:r(fe[n].labelKey)},n))})]})},en=({event:t,open:s,onClose:r,onSendHomework:a,t:n})=>{const[o,h]=i.useState(""),[m,u]=i.useState(null),[p,b]=i.useState(!1);if(i.useEffect(()=>{s||(h(""),u(null),b(!1))},[s]),!t)return null;const v=j=>{var _;const w=(_=j.target.files)==null?void 0:_[0];if(w){if(w.size>at*1024*1024){P.error({message:n("errors.fileTooLarge",{size:at}),description:void 0});return}u(w)}},x=async()=>{if(!o.trim()&&!m){P.error({message:n("errors.emptyHomework"),description:void 0});return}b(!0);try{await a(o,m)}finally{b(!1)}},l=t.status,g=fe[l]||fe.scheduled;return e.jsxs(ae,{open:s,onClose:r,fullWidth:!0,maxWidth:"sm",className:"details-dialog",children:[e.jsx(ie,{className:`details-dialog__header details-dialog__header--${g.color}`,children:n("studentSchedule.eventDetails")}),e.jsxs(le,{className:"details-dialog__content",children:[e.jsxs(f,{className:"details-dialog__info",children:[e.jsx(c,{variant:"h6",className:"details-dialog__title",children:t.title}),e.jsx(je,{icon:g.icon,label:n(g.labelKey),color:g.color,size:"small"})]}),e.jsx(c,{variant:"body2",children:U(t.date).format("dddd, MMMM Do, YYYY [at] HH:mm")}),t.description&&e.jsx(c,{variant:"body1",sx:{mt:2},children:t.description}),t.link&&e.jsxs(c,{variant:"body2",sx:{mt:1},children:[n("studentSchedule.form_link"),": ",e.jsx(Se,{href:t.link,target:"_blank",rel:"noopener noreferrer",children:t.link})]}),t.type==="homework"&&e.jsxs(f,{className:"homework-form",children:[e.jsx(c,{variant:"h6",className:"homework-form__title",children:n("studentSchedule.sendHomeworkTitle")}),e.jsx(L,{label:n("studentSchedule.form_description"),fullWidth:!0,multiline:!0,rows:4,value:o,onChange:j=>h(j.target.value),variant:"filled",disabled:p}),e.jsxs(C,{variant:"outlined",component:"label",startIcon:e.jsx(xt,{}),disabled:p,children:[m?m.name:n("studentSchedule.uploadScreenshot"),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:v})]})]})]}),e.jsxs(ce,{className:"details-dialog__actions",children:[e.jsx(C,{onClick:r,disabled:p,children:n("common.close")}),t.type==="homework"&&e.jsx(C,{onClick:x,variant:"contained",color:"primary",disabled:p,children:n("studentSchedule.send")})]})]})},tn=()=>{const{t}=H(),[s,r]=i.useState([]),[a,n]=i.useState(!0),[o,h]=i.useState(null),[m,u]=i.useState([]);i.useEffect(()=>{(async()=>{const g=localStorage.getItem("user");let j=null;try{g&&g!=="undefined"&&g!=="null"&&(j=JSON.parse(g)._id)}catch(w){console.error("Ошибка парсинга пользователя из localStorage:",w)}if(!j){n(!1),P.error({message:t("errors.userNotFound"),description:void 0});return}n(!0);try{const w=await Be(j);r(w)}catch(w){console.error("Ошибка при загрузке расписания:",w),P.error({message:t("errors.fetchSchedule"),description:void 0})}finally{n(!1)}})()},[t]);const p=l=>h(l),b=()=>h(null),v=async(l,g)=>{const j=localStorage.getItem("user"),w=j?JSON.parse(j)._id:null;if(!(!w||!o))try{await _t({studentId:w,scheduleId:o._id,homeworkText:l.trim()?l:void 0,screenshot:g||void 0}),o.coach&&await Pt({recipient:o.coach,type:"homework_submission",content:`Ученик отправил домашнее задание по теме: "${o.title}"`,metadata:{scheduleId:o._id}}),P.success({message:t("studentSchedule.homeworkSentSuccess"),description:void 0}),b(),r(_=>_.map(A=>A._id===o._id?{...A,status:"pending"}:A))}catch(_){console.error("Ошибка при отправке ДЗ:",_),P.error({message:t("errors.sendHomework"),description:void 0})}},x=i.useMemo(()=>{let l=[...s];return m.length>0&&(l=l.filter(g=>m.includes(g.status))),l.sort((g,j)=>new Date(g.date).getTime()-new Date(j.date).getTime())},[s,m]);return e.jsxs(f,{className:"student-schedule-v2-page",children:[e.jsxs(O,{maxWidth:"lg",children:[e.jsx(c,{variant:"h4",component:"h1",className:"page-title",children:t("studentSchedule.myScheduleTitle")}),e.jsx(Vr,{events:x,onSelectEvent:p}),e.jsxs(f,{className:"list-controls-container",children:[e.jsx(c,{variant:"h5",component:"h2",children:t("studentSchedule.eventListTitle")}),e.jsx(Zr,{statusFilters:m,onFilterChange:u,t})]}),a?e.jsx(f,{className:"loader-container",children:e.jsx(pe,{className:"loader"})}):e.jsx(Qr,{events:x,onSelectEvent:p,t})]}),e.jsx(en,{event:o,open:!!o,onClose:b,onSendHomework:v,t})]})};function sn(){const t=Re(),r=["/login","/register"].includes(t.pathname);return e.jsxs(e.Fragment,{children:[e.jsx(Ps,{}),!r&&e.jsx(Xs,{}),e.jsxs(Kt,{children:[e.jsx(B,{path:"/",element:e.jsx(or,{})}),e.jsx(B,{path:"/about",element:e.jsx(ar,{})}),e.jsx(B,{path:"/achievements",element:e.jsx(ir,{})}),e.jsx(B,{path:"/login",element:e.jsx(Qe,{})}),e.jsx(B,{path:"/register",element:e.jsx(Qe,{})}),e.jsx(B,{path:"/analysis",element:e.jsx(Wr,{})}),e.jsx(B,{path:"/verify-email",element:e.jsx($r,{})}),e.jsx(B,{path:"/coaches",element:e.jsx(qr,{})}),e.jsxs(B,{element:e.jsx(cr,{}),children:[e.jsx(B,{path:"/editor",element:e.jsx(ot,{})}),e.jsx(B,{path:"/profile/:userId",element:e.jsx(Sr,{})}),e.jsx(B,{path:"/users",element:e.jsx(Cr,{})}),e.jsx(B,{path:"/students-shedule",element:e.jsx(tn,{})}),e.jsx(B,{path:"/students",element:e.jsx(Fr,{})}),e.jsx(B,{path:"/puzzle-editor",element:e.jsx(ot,{})}),e.jsx(B,{path:"/inbox",element:e.jsx(Kr,{})})]})]})]})}function rn(){return e.jsx(i.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(sn,{})})}const Et=document.getElementById("root");if(!Et)throw new Error("Failed to find the root element");const nn=Wt.createRoot(Et);nn.render(e.jsx(i.StrictMode,{children:e.jsx(Yt,{children:e.jsx($s,{children:e.jsx(rn,{})})})}));
//# sourceMappingURL=index-WTuAPFWx.js.map
