var Rt=Object.defineProperty;var Wt=(t,s,r)=>s in t?Rt(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var Ee=(t,s,r)=>Wt(t,typeof s!="symbol"?s+"":s,r);import{r as i,j as e,a as ze}from"./react-CvHEjaVo.js";import{c as Mt}from"./react-dom-D1dbQIcV.js";import{a as Lt}from"./axios-DGDcxXwr.js";import{i as lt}from"./i18next-D9VJDghF.js";import{B as Tt}from"./i18next-http-backend-BfZSjpC0.js";import{i as $t,u as z}from"./react-i18next-CkKBCMHl.js";import{s as N,T as Be,F as le,I as ye,B as zt}from"./antd-vw_2xf0X.js";import{F as Bt}from"./react-icons-C3dNpHPf.js";import{u as ae,a as Re,O as ct,N as dt,L as ht,b as Ht,R as Ot,c as $,B as qt}from"./react-router-Dl3PYC8W.js";import{S as Pe,M as K,I as Y,B as Ut,N as Gt,a as Yt,b as p,T as d,L as G,c as Kt,D as We,d as V,A as He,e as Oe,C as se,f as C,g as Vt,h as Xt,i as ut,j as Z,k as ee,G as _,l as mt,m as xt,n as gt,o as Jt,p as B,P as M,q as Qt,r as Zt,s as W,t as es,u as ve,v as Fe,H as ke,w as pt,x as he,y as ue,z as me,E as Me,F as T,J as Ne,K as xe,O as ft,Q as Ie,R as ts,U as jt,V as je,W as ss,X as rs,Y as ns,Z as os,_ as bt,$ as be,a0 as as,a1 as vt,a2 as yt,a3 as ce,a4 as U,a5 as wt,a6 as is,a7 as qe,a8 as Le,a9 as Te,aa as ls,ab as cs,ac as St,ad as ds,ae as hs,af as us,ag as ms,ah as xs,ai as gs,aj as ps,ak as oe,al as fs,am as js,an as bs,ao as vs,ap as ys,aq as ws,ar as Ss,as as Cs,at as we,au as ks,av as Ue,aw as Is,ax as Ps,ay as Fs,az as Ns,aA as _s}from"./@mui-BZj1x7fj.js";import{f as Es,x as Ds,y as As,z as Rs,A as Se,B as Ws,C as Ms,D as Ls,E as Ts}from"./@ant-design-Bks4O0NN.js";import{S as Ge,C as Ye}from"./react-transition-group-CwyNQDxX.js";import{h as te}from"./moment-C5S46NFB.js";import{m as Ct,C as kt}from"./react-big-calendar-D6ss7NAI.js";import{C as de}from"./chess.js-D61LfqgS.js";import{C as It}from"./react-chessboard-D79mwW4A.js";import"./classnames-D3cBJY9G.js";import"./scheduler-CKyTKYc2.js";import"./rc-util-SZQLh1vV.js";import"./@babel-DlrNZQSW.js";import"./rc-resize-observer-MNGAtJ6Y.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-csAWsXJs.js";import"./@rc-component-COpoWvuY.js";import"./dayjs-QiaqYO4y.js";import"./rc-input-Byq_4lnI.js";import"./rc-field-form-Zk3m5T-Z.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-notification-DFa78zIu.js";import"./rc-pagination-DP2MtHOE.js";import"./rc-picker-CirFycse.js";import"./rc-tooltip-CR8cfE2b.js";import"./rc-textarea-CTz5dyJK.js";import"./copy-to-clipboard-CfLLryBf.js";import"./toggle-selection-DGa8lynz.js";import"./cookie--_YQFYBD.js";import"./clsx-B-dksMZM.js";import"./@emotion-M6yQISDD.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-YPZU7XtI.js";import"./@popperjs-B2yVk2E7.js";import"./dom-helpers-CYz2yaWn.js";import"./invariant-CtPH8gXt.js";import"./uncontrollable-BvgrQciZ.js";import"./react-lifecycles-compat-AfN2QaV3.js";import"./prop-types-C2eHv_HJ.js";import"./date-arithmetic-DrY26MJF.js";import"./lodash-CuwxRx_k.js";import"./react-overlays-pU_wA3Zj.js";import"./@restart-DNSoxZk-.js";import"./warning-pKr2A9xR.js";import"./memoize-one-BdPwpGay.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();lt.use(Tt).use($t).init({backend:{loadPath:"/locales/{{lng}}/{{ns}}.json"},lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1},debug:!0});const $s="http://localhost:3000/api",D=Lt.create({baseURL:$s,withCredentials:!0}),Ke=t=>t==null?void 0:t.reduce((s,r)=>s+=r,""),pe=(t,s)=>(N.error({message:"Ошибка",description:s}),Promise.reject(t));D.interceptors.request.use(t=>{const s=localStorage.getItem("token");s&&(t.headers.Authorization=`Bearer ${s}`);const r=lt.language;return r&&(t.headers["Accept-Language"]=r),t},t=>Promise.reject(t));D.interceptors.response.use(t=>t,t=>{var s,r,n,o,a;if(((s=t.response)==null?void 0:s.status)===401)return N.error({message:"Сессия истекла",description:((n=(r=t.response)==null?void 0:r.data)==null?void 0:n.message)||"Пожалуйста, войдите в систему снова."}),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login",new Promise(()=>{});if(((o=t.response)==null?void 0:o.status)!==504){if(t.message==="Network Error"||!t.response)return pe(t,"Ошибка сети или сервер недоступен. Попробуйте позже.");const c=(a=t.response)==null?void 0:a.data;let m=typeof c=="string"?c:"";if(Array.isArray(c))return pe(t,Ke(c));if(Array.isArray(c==null?void 0:c.data))return pe(t,Ke(c.data));if(c!=null&&c.detail)return pe(t,c.detail);if(c instanceof Object){const u=c.msg||Object.keys(c).reduce((g,b)=>{var f;return g+=`${b}: ${((f=c[b])==null?void 0:f[0])||c[b]} `},"");return pe(t,u)}N.error({message:"Ошибка",description:m||t.message})}return Promise.reject(t)});const Ve=async()=>(await D.get("/auth/profile")).data,Xe=async t=>{const s=new FormData;return Object.keys(t).forEach(n=>{const o=t[n];o&&s.append(n,o)}),(await D.put("/auth/profile",s)).data},zs=t=>{const s=D.defaults.baseURL;return s?`${s}/auth/avatar/${t}`:"/default-avatar.png"},Bs=async t=>(await D.get(`/auth/profile/${t}`)).data,ge=i.createContext(void 0),Hs=({children:t})=>{const[s,r]=i.useState(!1),[n,o]=i.useState(null),[a,c]=i.useState(!0),m=i.useCallback(()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),o(null),r(!1)},[]);i.useEffect(()=>{(async()=>{if(c(!0),localStorage.getItem("token"))try{const l=await Ve();o(l),r(!0)}catch(l){console.error("Session token is invalid, logging out.",l),m()}c(!1)})()},[m]);const b={isAuthenticated:s,user:n,loading:a,login:(f,x)=>{localStorage.setItem("token",f),localStorage.setItem("user",JSON.stringify(x)),o(x),r(!0)},logout:m,refetchUser:async()=>{c(!0);try{const f=await Ve();o(f)}catch(f){console.error("Failed to refetch user data",f),m()}finally{c(!1)}}};return e.jsx(ge.Provider,{value:b,children:t})},Os=async t=>(await D.post("/auth/login",t)).data,qs=async t=>{try{return(await D.post("/auth/register",t)).data}catch(s){throw console.error("Registration failed",s),s}},Je=t=>[{required:!0,message:t("validation.required")},{validator:(s,r)=>r&&r.length>=2?Promise.resolve():Promise.reject(new Error(t("validation.name_length")))}],Us=t=>[{required:!0,message:t("validation.required")},{type:"email",message:t("validation.invalid_email")}],Gs=t=>[{required:!0,message:t("validation.required")},{min:6,message:t("validation.password_length")}],Ys=({mode:t})=>{const{t:s}=z(),r=ae(),n=i.useContext(ge);if(!n)throw new Error("AuthForm must be used within an AuthProvider");const{login:o}=n,a=t==="login",c=async u=>{var g,b;try{const{token:f,user:x}=await Os(u);o(f,x),r(`/profile/${x._id}`,{replace:!0}),N.success({message:s("auth.success.login_title"),description:s("auth.success.welcome_back",{name:x.firstName})})}catch(f){N.error({message:s("auth.errors.login"),description:((b=(g=f.response)==null?void 0:g.data)==null?void 0:b.msg)||s("auth.errors.invalid_credentials")})}},m=async u=>{var g,b;try{const x=(await qs(u)).email;r("/verify-email",{replace:!0,state:{email:x,firstName:u.firstName,lastName:u.lastName}}),N.success({message:s("register.success.title"),description:s("register.success.description")})}catch(f){N.error({message:s("register.error.title"),description:((b=(g=f.response)==null?void 0:g.data)==null?void 0:b.msg)||s("register.error.description")})}};return e.jsxs("div",{className:"auth-form-container",children:[e.jsxs("div",{className:"auth-header",onClick:()=>r("/"),children:[e.jsx(Bt,{className:"auth-header__icon"}),e.jsx(Be.Title,{level:4,className:"auth-header__brand",children:s("common.brand")})]}),e.jsx(Be.Title,{level:3,className:"auth-header__title",children:s(a?"auth.sign_in":"register.title")}),e.jsxs(le,{name:t,onFinish:a?c:m,layout:"vertical",className:"auth-form-body",size:"large",autoComplete:"off",children:[!a&&e.jsxs(e.Fragment,{children:[e.jsx(le.Item,{label:e.jsx("span",{className:"auth-form-label",children:s("register.name")}),name:"firstName",rules:Je(s),children:e.jsx(ye,{placeholder:s("register.placeholder.name")})}),e.jsx(le.Item,{label:e.jsx("span",{className:"auth-form-label",children:s("register.lastName")}),name:"lastName",rules:Je(s),children:e.jsx(ye,{placeholder:s("register.placeholder.lastName")})})]}),e.jsx(le.Item,{label:e.jsx("span",{className:"auth-form-label",children:s("common.email")}),name:"email",rules:Us(s),children:e.jsx(ye,{placeholder:s("common.placeholder.email")})}),e.jsx(le.Item,{label:e.jsx("span",{className:"auth-form-label",children:s("common.password")}),name:"password",rules:Gs(s),children:e.jsx(ye.Password,{placeholder:s("common.placeholder.password")})}),e.jsx(le.Item,{children:e.jsx(zt,{type:"primary",htmlType:"submit",className:"auth-form-button",block:!0,children:s(a?"auth.sign_in":"register.submit")})})]}),e.jsx("div",{className:"auth-form-footer",children:a?e.jsxs(e.Fragment,{children:[s("auth.no_account")," ",e.jsx("a",{className:"auth-form-link",onClick:()=>r("/register"),children:s("auth.sign_up")})]}):e.jsxs(e.Fragment,{children:[s("register.haveAccount")," ",e.jsx("a",{className:"auth-form-link",onClick:()=>r("/login"),children:s("register.login")})]})})]})},Qe=()=>{const s=Re().pathname.includes("register")?"register":"login";return e.jsx("div",{className:"auth-page-wrapper",children:e.jsx(Ys,{mode:s})})},Ks=({className:t})=>{const{i18n:s}=z(),r=n=>{const o=n.target.value;s.changeLanguage(o)};return e.jsxs(Pe,{value:s.language,onChange:r,size:"small",className:t,style:{color:"black",borderColor:"black"},children:[e.jsx(K,{value:"en",children:"EN"}),e.jsx(K,{value:"pl",children:"PL"}),e.jsx(K,{value:"uk",children:"UA"})]})},Pt=async t=>(await D.post("/notifications",t)).data,Vs=async()=>(await D.get("/notifications")).data,Xs=async t=>(await D.patch("/notifications",{},{params:{notification_id:t}})).data,Js=async t=>(await D.delete("/notifications",{params:{notification_id:t}})).data,Qs=({navigateToRequests:t})=>{const[s,r]=i.useState([]),[n,o]=i.useState(null),a=!!n,c=s.filter(l=>!l.read).length,m=async()=>{try{const l=await Vs();r(Array.isArray(l)?l:[])}catch(l){console.error("Ошибка при получении уведомлений:",l)}};i.useEffect(()=>{m();const l=setInterval(m,3e4);return()=>clearInterval(l)},[]);const u=l=>{o(l.currentTarget),m()},g=()=>{o(null)},b=async(l,j)=>{l.stopPropagation();try{await Js(j),r(v=>v.filter(F=>F._id!==j))}catch(v){console.error("Ошибка при удалении уведомления:",v)}},f=l=>{l.read||(Xs(l._id),r(j=>j.map(v=>v._id===l._id?{...v,read:!0}:v))),(l.type==="request"||l.type==="homework_submission")&&t(),g()},x=()=>{t(),g()};return e.jsxs("div",{children:[e.jsx(Y,{color:"inherit",onClick:u,children:e.jsx(Ut,{badgeContent:c,color:"error",children:e.jsx(Gt,{})})}),e.jsxs(Yt,{anchorEl:n,open:a,onClose:g,PaperProps:{style:{maxHeight:300,width:"400px"}},children:[e.jsx(p,{sx:{p:2,borderBottom:"1px solid #eee"},children:e.jsx(d,{variant:"h6",children:"Уведомления"})}),s.length===0?e.jsx(K,{disabled:!0,children:"Уведомлений нет"}):s.map(l=>e.jsxs(K,{onClick:()=>f(l),sx:{bgcolor:l.read?"transparent":"action.hover",whiteSpace:"normal",alignItems:"flex-start"},children:[e.jsx(G,{primary:l.content,secondary:new Date(l.createdAt).toLocaleString()}),e.jsx(Kt,{children:e.jsx(Y,{edge:"end","aria-label":"delete",onClick:j=>b(j,l._id),children:e.jsx(We,{fontSize:"small"})})})]},l._id)),e.jsx(V,{}),e.jsx(K,{onClick:x,children:e.jsx(G,{primary:"Посмотреть все во 'Входящих'",sx:{textAlign:"center"}})})]})]})},Zs=()=>{var F,E,R;const[t,s]=i.useState(!1),r=ae(),{t:n}=z(),o=i.useContext(ge);if(!o||o.loading)return e.jsx(He,{position:"static",className:"navbar-appbar",children:e.jsxs(Oe,{className:"navbar-toolbar",sx:{justifyContent:"space-between"},children:[e.jsx(d,{variant:"h6",className:"navbar-title",children:n("navbar.chessSchool")}),e.jsx(se,{color:"inherit",size:24})]})});const{isAuthenticated:a,user:c,logout:m}=o,u=(F=c==null?void 0:c.roles)==null?void 0:F.includes("admin"),g=(E=c==null?void 0:c.roles)==null?void 0:E.includes("coach"),b=(R=c==null?void 0:c.roles)==null?void 0:R.includes("student"),f=()=>{m&&m(),s(!1),r("/login")},x=()=>{s(!1),r("/register")},l=()=>{r("/inbox")},j=w=>()=>{s(w)},v=w=>{s(!1),w==="/profile"&&(c!=null&&c._id)?r(`/profile/${c._id}`):r(w)};return e.jsxs(e.Fragment,{children:[e.jsx(He,{position:"static",className:"navbar-appbar",children:e.jsxs(Oe,{className:"navbar-toolbar",children:[e.jsx(d,{variant:"h6",className:"navbar-title",onClick:()=>r("/"),children:n("navbar.chessSchool")}),e.jsxs(p,{className:"navbar-controls",children:[!a&&e.jsxs(p,{sx:{display:{xs:"none",md:"flex"},alignItems:"center"},children:[e.jsx(C,{color:"inherit",onClick:()=>r("/login"),children:n("navbar.login")}),e.jsx(C,{variant:"contained",color:"secondary",onClick:()=>r("/register"),sx:{ml:1},children:n("navbar.register")})]}),a&&e.jsx(Qs,{navigateToRequests:l}),e.jsx(Y,{edge:"end",color:"inherit","aria-label":"menu",onClick:j(!0),className:"navbar-menu-button",children:e.jsx(Vt,{})})]})]})}),e.jsx(Xt,{anchor:"right",open:t,onClose:j(!1),children:e.jsxs(p,{className:"navbar-drawer",children:[e.jsx(p,{className:"drawer-header",children:e.jsx(Y,{onClick:j(!1),className:"close-button",children:e.jsx(Es,{className:"close-icon"})})}),e.jsxs(ut,{className:"menu-list",children:[e.jsxs(Z,{onClick:()=>v("/"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(Ds,{})}),e.jsx(G,{primary:n("navbar.home")})]}),e.jsxs(Z,{onClick:()=>v("/about"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(As,{})}),e.jsx(G,{primary:n("navbar.aboutUs")})]}),e.jsxs(Z,{onClick:()=>v("/achievements"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(Rs,{})}),e.jsx(G,{primary:n("navbar.achievements")})]}),e.jsxs(Z,{onClick:()=>v("/coaches"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(Se,{})}),e.jsx(G,{primary:n("navbar.coaches")})]}),a&&e.jsx(V,{sx:{borderColor:"rgba(255, 255, 255, 0.12)"}}),a&&e.jsxs(e.Fragment,{children:[e.jsxs(Z,{onClick:()=>v("/analysis"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(Ws,{})}),e.jsx(G,{primary:n("navbar.chessGame")})]}),e.jsxs(Z,{onClick:()=>v("/profile"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(Ms,{})}),e.jsx(G,{primary:n("navbar.profile")})]})]}),(g||u||b)&&e.jsx(V,{sx:{borderColor:"rgba(255, 255, 255, 0.12)"}}),(g||u)&&e.jsxs(Z,{onClick:()=>v("/students"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(Se,{})}),e.jsx(G,{primary:n("navbar.students")})]}),(g||u||b)&&e.jsxs(Z,{onClick:()=>v("/students-shedule"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(Se,{})}),e.jsx(G,{primary:n("navbar.students-shedule")})]}),u&&e.jsxs(Z,{onClick:()=>v("/users"),className:"menu-item",children:[e.jsx(ee,{children:e.jsx(Se,{})}),e.jsx(G,{primary:n("navbar.users")})]})]}),e.jsxs(p,{className:"drawer-bottom-actions",children:[a?e.jsxs(C,{onClick:f,className:"logout-button",children:[e.jsx(Ls,{}),n("navbar.logout")]}):e.jsxs(C,{onClick:x,className:"get-started-button",variant:"contained",color:"secondary",children:[e.jsx(Ts,{style:{marginRight:"8px"}}),n("navbar.getStarted")]}),e.jsx(Ks,{className:"language-switcher"})]})]})})]})},er=async()=>(await D.get("/coaches")).data,tr=async t=>(await D.get(`/coach/${t}`)).data,sr=async t=>(await D.post("/auth/coaches-by-email",{emails:t})).data,rr=async(t,s)=>(await D.get("/trainer/student",{params:{coachEmail:t,studentId:s}})).data,nr=async t=>(await D.get("/trainer/students",{params:{coachEmail:t}})).data,or=async(t,s)=>{await D.delete("/trainer/remove-student",{params:{coachEmail:t,studentId:s}})},ar=()=>{const{t}=z(),s=ae(),[r,n]=i.useState([]);return i.useEffect(()=>{(async()=>{const a=await sr(["ad3@example.com","ad7@example.com"]);n(a)})()},[]),e.jsxs(p,{py:10,px:2,sx:{backgroundColor:"#111"},children:[e.jsx(d,{variant:"h4",fontWeight:"bold",textAlign:"center",mb:6,children:t("homePage.coaches.title")}),e.jsx(_,{container:!0,spacing:4,justifyContent:"center",children:r.map(o=>e.jsx(_,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(mt,{sx:{backgroundColor:"#1a1a1a",color:"white",borderRadius:3,boxShadow:4,position:"relative","&:hover .hoverAction":{opacity:1}},children:[e.jsx(xt,{component:"img",height:"200",image:o.photoUrl||"/images/default-avatar.png",alt:`${o.firstName} ${o.lastName}`}),e.jsxs(gt,{children:[e.jsxs(d,{variant:"h6",children:[o.firstName," ",o.lastName]}),e.jsx(d,{variant:"body2",color:"gray"}),e.jsx(p,{mt:1,children:[...Array(5)].map((a,c)=>e.jsx(Jt,{sx:{color:"#FFD700",fontSize:20}},c))})]}),e.jsx(p,{className:"hoverAction",sx:{position:"absolute",bottom:16,left:0,right:0,textAlign:"center",opacity:0,transition:"0.3s"},children:e.jsx(C,{variant:"contained",onClick:()=>s("/coaches",{state:{coach:o}}),sx:{backgroundColor:"#FFD700",color:"black"},children:t("homePage.coaches.selectCoach")})})]})},o._id))})]})},ir=()=>{const{t}=z(),s=ae(),r=new Date().getFullYear(),n=[{icon:"🎯",key:"analytics",descKey:"descAnalytics"},{icon:"🧠",key:"memory",descKey:"descMemory"},{icon:"🏆",key:"spirit",descKey:"descSpirit"}],o=[{num:"1",titleKey:"step1Title",descKey:"step1Desc"},{num:"2",titleKey:"step2Title",descKey:"step2Desc"},{num:"3",titleKey:"step3Title",descKey:"step3Desc"}],a=[{type:"individual",icon:e.jsx(Qt,{sx:{fontSize:40,mb:2,color:"#FFD700"}}),descKey:"descIndividual",buttonKey:"schedule",path:"/coaches"},{type:"group",icon:e.jsx(Zt,{sx:{fontSize:40,mb:2,color:"#FFD700"}}),descKey:"descGroup",buttonKey:"learnMore",path:"/classes"}];return e.jsxs(p,{sx:{backgroundColor:"#0e0e0e",color:"white",fontFamily:"'Inter', sans-serif"},children:[e.jsx(p,{sx:{backgroundImage:{xs:'url("/images/chess-cinematic-mb.jpg")',sm:'url("/images/chess-cinematic-tablet.jpg")',lg:'url("/images/chess-cinematic-lg.jpg")'},backgroundSize:"cover",backgroundPosition:"center",py:{xs:10,md:20},textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",px:2},children:e.jsxs(B,{maxWidth:"md",children:[e.jsx(d,{variant:"h2",component:"h1",fontWeight:"bold",children:t("homePage.hero.title")}),e.jsx(d,{variant:"h5",mt:2,sx:{color:"rgba(255, 255, 255, 0.9)"},children:t("homePage.hero.subtitle")}),e.jsx(C,{variant:"contained",size:"large",onClick:()=>s("/coaches"),sx:{mt:4,px:5,py:1.5,borderRadius:"30px",boxShadow:"0px 8px 20px rgba(255, 215, 0, 0.3)",backgroundColor:"#FFD700",color:"black",fontWeight:"bold","&:hover":{backgroundColor:"#FFC107",transform:"translateY(-2px)",boxShadow:"0px 10px 25px rgba(255, 215, 0, 0.4)"},transition:"all 0.3s ease"},startIcon:e.jsx("span",{style:{fontSize:"1.5rem"},children:"♟️"}),children:t("homePage.hero.start")})]})}),e.jsxs(B,{maxWidth:"lg",sx:{py:10},children:[e.jsx(d,{variant:"h3",component:"h2",fontWeight:"bold",textAlign:"center",mb:8,children:t("homePage.why.title")}),e.jsx(_,{container:!0,spacing:4,justifyContent:"center",children:n.map(({icon:c,key:m,descKey:u})=>e.jsx(_,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(M,{elevation:6,sx:{p:4,textAlign:"center",borderRadius:4,backgroundColor:"rgba(255,255,255,0.05)",backdropFilter:"blur(10px)",transition:"all 0.3s ease",color:"white",height:"100%","&:hover":{transform:"translateY(-10px)",backgroundColor:"rgba(255,255,255,0.1)"}},children:[e.jsx(p,{fontSize:"3.5rem",children:c}),e.jsx(d,{variant:"h5",component:"h3",mt:2,fontWeight:"bold",children:t(`homePage.why.${m}`)}),e.jsx(d,{mt:1.5,sx:{color:"rgba(255, 255, 255, 0.7)"},children:t(`homePage.why.${u}`)})]})},m))})]}),e.jsx(p,{sx:{py:5},children:e.jsx(ar,{})}),e.jsx(p,{sx:{py:10,backgroundColor:"#121212"},children:e.jsxs(B,{maxWidth:"lg",children:[e.jsx(d,{variant:"h3",component:"h2",fontWeight:"bold",textAlign:"center",mb:8,children:t("homePage.howItWorks.title")}),e.jsx(_,{container:!0,spacing:5,children:o.map(({num:c,titleKey:m,descKey:u})=>e.jsx(_,{item:!0,xs:12,md:4,children:e.jsxs(p,{sx:{textAlign:{xs:"center",md:"left"}},children:[e.jsx(d,{variant:"h1",component:"div",fontWeight:"bold",sx:{color:"#FFD700",opacity:.5},children:c}),e.jsx(d,{variant:"h5",component:"h3",fontWeight:"bold",mt:1,children:t(`homePage.howItWorks.${m}`)}),e.jsx(d,{mt:1.5,sx:{color:"rgba(255, 255, 255, 0.7)"},children:t(`homePage.howItWorks.${u}`)})]})},c))})]})}),e.jsxs(B,{maxWidth:"lg",sx:{py:10},children:[e.jsx(d,{variant:"h3",component:"h2",fontWeight:"bold",textAlign:"center",mb:8,children:t("homePage.formats.title")}),e.jsx(_,{container:!0,spacing:4,justifyContent:"center",children:a.map(({type:c,icon:m,descKey:u,buttonKey:g,path:b})=>e.jsx(_,{item:!0,xs:12,md:5,children:e.jsxs(M,{elevation:6,sx:{p:4,backgroundColor:"#1c1c1c",color:"white",borderRadius:4,textAlign:"center",transition:"background-color 0.3s ease",display:"flex",flexDirection:"column",alignItems:"center",height:"100%","&:hover":{backgroundColor:"#2a2a2a"}},children:[m,e.jsx(d,{variant:"h5",component:"h3",fontWeight:"bold",children:t(`homePage.formats.${c}`)}),e.jsx(d,{mt:1.5,sx:{color:"rgba(255, 255, 255, 0.7)",flexGrow:1},children:t(`homePage.formats.${u}`)}),e.jsxs(C,{variant:"outlined",onClick:()=>s(b),sx:{mt:3,color:"#FFD700",borderColor:"#FFD700",borderRadius:"20px","&:hover":{borderColor:"#FFC107",backgroundColor:"rgba(255, 215, 0, 0.1)"}},children:[t(`homePage.formats.${g}`)," →"]})]})},c))})]}),e.jsx(p,{component:"footer",py:6,px:2,sx:{backgroundColor:"#0b0b0b",color:"gray"},children:e.jsxs(B,{maxWidth:"lg",children:[e.jsxs(_,{container:!0,spacing:5,children:[e.jsxs(_,{item:!0,xs:12,sm:4,children:[e.jsx(d,{variant:"h6",fontWeight:"bold",sx:{color:"white"},children:t("homePage.footer.name")}),e.jsx(d,{variant:"body2",sx:{mt:1,color:"rgba(255,255,255,0.5)"},children:t("homePage.footer.desc")})]}),e.jsxs(_,{item:!0,xs:6,sm:2,children:[e.jsx(d,{fontWeight:"bold",sx:{color:"white"},children:t("homePage.footer.company")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.about")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.blog")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.coaches")})]}),e.jsxs(_,{item:!0,xs:6,sm:2,children:[e.jsx(d,{fontWeight:"bold",sx:{color:"white"},children:t("homePage.footer.resources")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.faq")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.contact")})]}),e.jsxs(_,{item:!0,xs:6,sm:2,children:[e.jsx(d,{fontWeight:"bold",sx:{color:"white"},children:t("homePage.footer.legal")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.privacy")}),e.jsx(C,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:t("homePage.footer.terms")})]})]}),e.jsx(V,{sx:{my:4,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsx(d,{variant:"body2",textAlign:"center",sx:{color:"rgba(255,255,255,0.4)"},children:t("homePage.footer.copyright",{year:r})})]})})]})},lr=()=>{const{t}=z(),s=ae(),r=i.useMemo(()=>t("aboutPage.phrases",{returnObjects:!0})||[],[t]),n=i.useMemo(()=>t("aboutPage.testimonials.reviews",{returnObjects:!0})||[],[t]),o=i.useMemo(()=>t("aboutPage.ourCoaches.coaches",{returnObjects:!0})||[],[t]),a=i.useMemo(()=>t("aboutPage.whyUs.cards",{returnObjects:!0})||[],[t]),c=i.useMemo(()=>t("aboutPage.howItWorks.steps",{returnObjects:!0})||[],[t]),m=i.useMemo(()=>t("aboutPage.mission.points",{returnObjects:!0})||[],[t]),[u,g]=i.useState(0),[b,f]=i.useState(0);return i.useEffect(()=>{if(r.length===0||n.length===0)return;const x=setInterval(()=>{g(j=>(j+1)%r.length)},4e3),l=setInterval(()=>{f(j=>(j+1)%n.length)},5e3);return()=>{clearInterval(x),clearInterval(l)}},[r.length,n.length]),e.jsxs(p,{sx:{bgcolor:"#0e0e0e",color:"white"},children:[e.jsx(p,{sx:{position:"relative",py:{xs:10,md:15},textAlign:"center",backgroundImage:'linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.8)), url("/images/chess-cinematic-lg.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:e.jsxs(B,{maxWidth:"md",children:[e.jsx(d,{variant:"h2",component:"h1",fontWeight:"bold",sx:{textTransform:"uppercase",letterSpacing:"2px"},children:t("aboutPage.mainTitle")}),e.jsx(p,{sx:{height:"2.5em",my:2},children:e.jsx(Ge,{mode:"out-in",children:e.jsx(Ye,{timeout:300,classNames:"fade",children:e.jsx(d,{variant:"h5",sx:{color:"#FFD700",fontStyle:"italic"},children:r.length>0?r[u]:""})},u)})}),e.jsxs(W,{direction:{xs:"column",sm:"row"},justifyContent:"center",spacing:2,mt:4,children:[e.jsx(C,{variant:"contained",onClick:()=>s("/register"),size:"large",sx:{bgcolor:"#FFD700",color:"black",borderRadius:"30px",px:5,"&:hover":{bgcolor:"#FFC107"}},children:t("aboutPage.ctaStudent")}),e.jsx(C,{variant:"outlined",onClick:()=>s("/coaches"),size:"large",sx:{color:"white",borderColor:"rgba(255,255,255,0.5)",borderRadius:"30px",px:5,"&:hover":{borderColor:"white",bgcolor:"rgba(255,255,255,0.1)"}},children:t("aboutPage.ctaCoaches")})]})]})}),e.jsxs(B,{maxWidth:"lg",sx:{py:8},children:[e.jsxs(p,{sx:{textAlign:"center",my:8},children:[e.jsxs(W,{direction:"row",spacing:2,justifyContent:"center",alignItems:"center",sx:{color:"#FFD700",mb:1},children:[e.jsx(es,{fontSize:"large"}),e.jsx(d,{variant:"h4",component:"h2",fontWeight:"bold",children:t("aboutPage.mission.title")})]}),e.jsx(d,{variant:"h6",sx:{maxWidth:720,mx:"auto",color:"rgba(255,255,255,0.7)",mb:3},children:t("aboutPage.mission.subtitle")}),e.jsx(W,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"center",children:m.map((x,l)=>e.jsxs(W,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(ve,{sx:{color:"success.main"}}),e.jsx(d,{children:x})]},l))})]}),e.jsx(V,{sx:{my:8,borderColor:"rgba(255,255,255,0.2)"}}),e.jsxs(p,{sx:{my:8},children:[e.jsx(d,{variant:"h4",component:"h2",fontWeight:"bold",align:"center",sx:{mb:6},children:t("aboutPage.whyUs.title")}),e.jsx(_,{container:!0,spacing:4,children:a.map((x,l)=>e.jsx(_,{item:!0,xs:12,md:4,children:e.jsxs(M,{sx:{p:4,bgcolor:"#1c1c1c",borderRadius:4,textAlign:"center",height:"100%",transition:"all 0.3s ease","&:hover":{transform:"translateY(-10px)",boxShadow:"0 10px 20px rgba(255,215,0,0.15)"}},children:[e.jsx(d,{fontSize:"3rem",children:x.icon}),e.jsx(d,{variant:"h6",fontWeight:"bold",my:1,children:x.title}),e.jsx(d,{sx:{color:"rgba(255,255,255,0.6)"},children:x.description})]})},l))})]}),e.jsxs(p,{sx:{my:8,py:6,bgcolor:"#1c1c1c",borderRadius:4},children:[e.jsx(d,{variant:"h4",component:"h2",fontWeight:"bold",align:"center",sx:{mb:6},children:t("aboutPage.howItWorks.title")}),e.jsx(_,{container:!0,spacing:4,sx:{px:4},children:c.map((x,l)=>e.jsx(_,{item:!0,xs:12,md:4,children:e.jsxs(W,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(d,{variant:"h2",fontWeight:"bold",sx:{color:"#FFD700",opacity:.5},children:`0${l+1}`}),e.jsxs(p,{children:[e.jsx(d,{variant:"h6",fontWeight:"bold",children:x.step}),e.jsx(d,{sx:{color:"rgba(255,255,255,0.6)"},children:x.desc})]})]})},l))})]}),e.jsxs(_,{container:!0,spacing:8,sx:{my:8},children:[e.jsxs(_,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h4",component:"h2",fontWeight:"bold",sx:{mb:3},children:t("aboutPage.testimonials.title")}),e.jsx(M,{sx:{p:4,bgcolor:"#1c1c1c",borderRadius:4,minHeight:180},children:e.jsx(Ge,{children:e.jsx(Ye,{timeout:300,classNames:"fade",children:e.jsx(p,{children:n.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(d,{fontStyle:"italic",fontSize:"1.1rem",sx:{color:"rgba(255,255,255,0.8)"},children:["“",n[b].quote,"”"]}),e.jsxs(d,{fontWeight:"bold",mt:2,sx:{color:"#FFD700"},children:["— ",n[b].name]})]}):null})},b)})})]}),e.jsxs(_,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h4",component:"h2",fontWeight:"bold",sx:{mb:3},children:t("aboutPage.ourCoaches.title")}),e.jsxs(W,{spacing:2,children:[o.map((x,l)=>e.jsxs(M,{sx:{p:2,bgcolor:"#1c1c1c",borderRadius:2},children:[e.jsx(d,{variant:"h6",fontWeight:"bold",children:x.name}),e.jsx(d,{variant:"body2",fontStyle:"italic",sx:{color:"rgba(255,255,255,0.6)"},children:x.quote})]},l)),e.jsxs(C,{variant:"text",onClick:()=>s("/coaches"),sx:{color:"#FFD700",alignSelf:"flex-start"},children:[t("aboutPage.ourCoaches.viewAll")," →"]})]})]})]}),e.jsx(V,{sx:{my:8,borderColor:"rgba(255,255,255,0.2)"}}),e.jsx(d,{align:"center",fontWeight:"bold",variant:"h5",component:"p",sx:{fontStyle:"italic"},children:t("aboutPage.finalSlogan")})]})]})},cr=()=>e.jsx(B,{children:e.jsx(d,{variant:"h3",gutterBottom:!0,children:"Achievments"})}),dr=()=>!!localStorage.getItem("token"),hr=()=>dr()?e.jsx(ct,{}):e.jsx(dt,{to:"/login"}),$e=async t=>(await D.get(`/schedule/student/${t}`)).data,ur=async t=>(await D.post("/schedule/create",t)).data,mr=async(t,s)=>(await D.put(`/schedule/${t}`,s)).data,xr=async t=>{await D.delete(`/schedule/${t}`)},Ft=async t=>{const s=new FormData;s.append("studentId",t.studentId),s.append("scheduleId",t.scheduleId),t.homeworkText&&s.append("homeworkText",t.homeworkText),t.screenshot&&s.append("screenshot",t.screenshot),await D.post("/homework/send",s)},gr=async(t,s)=>(await D.put(`/homework/${t}/review`,s)).data,pr=async()=>(await D.get("/homework/coach")).data,fr=async t=>(await D.get(`/homework/${t}/screenshot`,{responseType:"blob"})).data,Ze={scheduled:{icon:e.jsx(ke,{fontSize:"small"}),color:"info",labelKey:"status.scheduled"},pending:{icon:e.jsx(ke,{fontSize:"small"}),color:"warning",labelKey:"status.pending"},completed:{icon:e.jsx(ve,{fontSize:"small"}),color:"success",labelKey:"status.completed"},approved:{icon:e.jsx(ve,{fontSize:"small"}),color:"success",labelKey:"status.approved"},rejected:{icon:e.jsx(pt,{fontSize:"small"}),color:"error",labelKey:"status.rejected"}},Ae=({event:t,variant:s="light",onSelect:r})=>{const{t:n}=z(),o=t.status,a=Ze[o]||Ze.scheduled,c=s==="dark"?{bgcolor:"#2a2a2a",color:"white"}:{bgcolor:"white",color:"black"};return e.jsxs(M,{onClick:r?()=>r(t):void 0,sx:{...c,p:2,borderRadius:2,cursor:r?"pointer":"default",transition:"box-shadow 0.3s, transform 0.2s","&:hover":r?{boxShadow:6,transform:"translateY(-2px)"}:{}},children:[e.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(d,{variant:"h6",fontWeight:500,noWrap:!0,children:t.title}),e.jsx(Fe,{icon:a.icon,label:n(a.labelKey),color:a.color,size:"small"})]}),e.jsx(d,{variant:"body2",color:s==="dark"?"grey.400":"text.secondary",children:te(t.date).format("MMMM Do, YYYY [at] HH:mm")}),t.description&&e.jsx(d,{variant:"body2",sx:{mt:1,color:s==="dark"?"grey.500":"text.secondary"},children:t.description})]})},jr=({user:t,onClose:s})=>{const{t:r}=z(),[n,o]=i.useState(t.firstName),[a,c]=i.useState(t.lastName),[m,u]=i.useState(t.email),[g,b]=i.useState(""),[f,x]=i.useState(""),[l,j]=i.useState(""),[v,F]=i.useState(!1),[E,R]=i.useState(null),[w,I]=i.useState(t.photoUrl),h=S=>{var O;const A=(O=S.target.files)==null?void 0:O[0];A&&(R(A),I(URL.createObjectURL(A)))},y=async()=>{try{if(!v)await Xe({firstName:n,lastName:a,email:m,avatar:E||void 0}),N.success({message:r("profile_edit.updated"),description:void 0});else{if(!g||f!==l){N.error({message:r("profile_edit.passwordMismatch"),description:void 0});return}await Xe({currentPassword:g,newPassword:f,avatar:E||void 0}),N.success({message:r("profile_edit.passwordChanged"),description:void 0})}s(),window.location.reload()}catch(S){console.error(S),N.error({message:r("profile_edit.updateFailed"),description:void 0})}};return e.jsxs(he,{open:!0,onClose:s,fullWidth:!0,maxWidth:"sm",children:[e.jsx(ue,{children:r("profile_edit.editTitle")}),e.jsxs(me,{children:[e.jsxs(p,{display:"flex",alignItems:"center",flexDirection:"column",mb:2,children:[e.jsx(Me,{src:w,sx:{width:96,height:96,mb:1}}),e.jsxs(C,{variant:"text",size:"small",component:"label",children:[r("profile_edit.uploadAvatar"),e.jsx("input",{hidden:!0,accept:"image/*",type:"file",onChange:h})]})]}),e.jsx(T,{margin:"dense",label:r("profile_edit.firstName"),fullWidth:!0,value:n,onChange:S=>o(S.target.value)}),e.jsx(T,{margin:"dense",label:r("profile_edit.lastName"),fullWidth:!0,value:a,onChange:S=>c(S.target.value)}),e.jsx(T,{margin:"dense",label:r("profile_edit.email"),fullWidth:!0,value:m,onChange:S=>u(S.target.value)}),!v&&e.jsx(p,{mt:1,children:e.jsx(Ne,{component:"button",variant:"body2",onClick:()=>F(!0),children:r("profile_edit.changePassword")})}),v&&e.jsxs(p,{mt:2,children:[e.jsx(T,{margin:"dense",label:r("profile_edit.currentPassword"),fullWidth:!0,type:"password",value:g,onChange:S=>b(S.target.value)}),e.jsx(T,{margin:"dense",label:r("profile_edit.newPassword"),fullWidth:!0,type:"password",value:f,onChange:S=>x(S.target.value)}),e.jsx(T,{margin:"dense",label:r("profile_edit.confirmPassword"),fullWidth:!0,type:"password",value:l,onChange:S=>j(S.target.value)})]})]}),e.jsxs(xe,{children:[e.jsx(C,{onClick:s,children:r("profile_edit.cancel")}),e.jsx(C,{variant:"contained",onClick:y,children:r("profile_edit.save")})]})]})},et={admin:4,coach:3,student:2,user:1},br=(t=[])=>t.length===0?"user":[...t].sort((s,r)=>(et[r]||0)-(et[s]||0))[0],vr=({user:t,coach:s,avatarUrl:r,isMyProfile:n,onEdit:o,onLogout:a,t:c})=>{const m=br(t.roles),u=t.roles.filter(b=>b!==m),g={admin:"secondary",coach:"primary",student:"success",user:"default"}[m];return e.jsx(M,{sx:{p:{xs:2,md:4},mb:4,bgcolor:"#1c1c1c",borderRadius:4,color:"white"},children:e.jsxs(W,{direction:{xs:"column",md:"row"},spacing:4,alignItems:"center",children:[e.jsx(Me,{src:r,alt:`${t.firstName} ${t.lastName}`,sx:{width:120,height:120,border:"4px solid #FFD700"}}),e.jsxs(p,{sx:{flexGrow:1,textAlign:{xs:"center",md:"left"}},children:[e.jsxs(W,{direction:"row",spacing:2,alignItems:"center",justifyContent:{xs:"center",md:"flex-start"},children:[e.jsxs(d,{variant:"h4",fontWeight:"bold",children:[t.firstName," ",t.lastName]}),e.jsx(ft,{title:u.length>0?`Also: ${u.join(", ")}`:"",arrow:!0,children:e.jsx(Fe,{label:m,color:g,size:"small",sx:{textTransform:"capitalize"}})})]}),s&&e.jsxs(d,{sx:{color:"rgba(255,255,255,0.7)",mt:1},children:["Coach: ",e.jsxs(Ne,{component:ht,to:`/profile/${s._id}`,color:"inherit",sx:{textDecoration:"underline"},children:[s.firstName," ",s.lastName]})]}),e.jsxs(d,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)",mt:.5},children:[c("profile.registrationDate"),": ",new Date(t.registrationDate).toLocaleDateString()]})]}),e.jsx(W,{direction:"row",spacing:2,sx:{mt:{xs:3,md:0}},children:n?e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"outlined",onClick:o,startIcon:e.jsx(Ie,{}),sx:{color:"#FFD700",borderColor:"rgba(255, 215, 0, 0.5)","&:hover":{borderColor:"#FFD700"}},children:c("profile.editProfile")}),e.jsx(C,{variant:"contained",color:"error",onClick:a,startIcon:e.jsx(ts,{}),children:c("profile.logout")})]}):m==="coach"&&e.jsx(C,{variant:"contained",color:"primary",startIcon:e.jsx(jt,{}),children:"Send Request"})})]})})},yr=["scheduled","pending","completed","approved","rejected"],Nt=({schedule:t,isLoading:s,onEventSelect:r})=>{const{t:n}=z(),[o,a]=i.useState([]),{upcomingEvents:c,pastEvents:m}=i.useMemo(()=>{const g=new Date,b=[],f=[];return(o.length>0?t.filter(l=>o.includes(l.status)):t).forEach(l=>{new Date(l.date)>=g?b.push(l):f.push(l)}),b.sort((l,j)=>new Date(l.date).getTime()-new Date(j.date).getTime()),f.sort((l,j)=>new Date(j.date).getTime()-new Date(l.date).getTime()),{upcomingEvents:b,pastEvents:f}},[t,o]),u=(g,b)=>{a(b)};return s?e.jsxs(W,{spacing:2,mt:4,children:[e.jsx(je,{variant:"rectangular",height:118,sx:{borderRadius:2}}),e.jsx(je,{variant:"rectangular",height:118,sx:{borderRadius:2}}),e.jsx(je,{variant:"rectangular",height:118,sx:{borderRadius:2}})]}):t.length>0&&c.length===0&&m.length===0?e.jsx(M,{sx:{p:4,textAlign:"center",mt:4},children:e.jsx(d,{color:"text.secondary",children:"No lessons match the selected filters."})}):t.length===0?e.jsx(d,{sx:{color:"grey.500",textAlign:"center",p:4,mt:4},children:"You have no scheduled lessons yet."}):e.jsxs(p,{mt:4,children:[e.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(d,{variant:"h5",component:"h2",children:n("studentSchedule.eventListTitle")}),e.jsx(ss,{value:o,onChange:u,size:"small","aria-label":"Filter by status",children:yr.map(g=>e.jsx(rs,{value:g,children:n(`status.${g}`)},g))})]}),c.length>0&&e.jsxs(p,{mb:5,children:[e.jsx(d,{variant:"h6",fontWeight:"medium",gutterBottom:!0,children:"Upcoming"}),e.jsx(W,{spacing:2,children:c.map(g=>e.jsx(Ae,{event:g,onSelect:r},g._id))})]}),c.length>0&&m.length>0&&e.jsx(V,{sx:{my:4}}),m.length>0&&e.jsxs(p,{children:[e.jsx(d,{variant:"h6",fontWeight:"medium",gutterBottom:!0,children:"Archive"}),e.jsx(W,{spacing:2,children:m.map(g=>e.jsx(Ae,{event:g,onSelect:r},g._id))})]})]})},wr=({schedule:t,isLoading:s,onEventSelect:r})=>{if(s)return e.jsx(M,{sx:{p:2,bgcolor:"#2a2a2a",borderRadius:3},children:e.jsx(je,{variant:"rectangular",height:150,sx:{bgcolor:"grey.700",borderRadius:2}})});const n=t.filter(o=>new Date(o.date)>=new Date).sort((o,a)=>new Date(o.date).getTime()-new Date(a.date).getTime())[0];return e.jsxs(p,{children:[e.jsx(d,{variant:"h5",fontWeight:"bold",sx:{mb:2},children:"Next Up"}),n?e.jsx(Ae,{event:n,variant:"dark",onSelect:r}):e.jsx(M,{sx:{p:4,bgcolor:"#2a2a2a",color:"white",borderRadius:3,textAlign:"center"},children:e.jsx(d,{sx:{color:"grey.500"},children:"You have no upcoming lessons."})}),t.length>0&&e.jsx(C,{component:ht,to:"/students-shedule",fullWidth:!0,endIcon:e.jsx(ns,{}),sx:{mt:2,color:"#FFD700",justifyContent:"flex-start",p:1},children:"View Full Schedule"})]})},tt={scheduled:{icon:e.jsx(ke,{fontSize:"small"}),color:"info",labelKey:"status.scheduled"},pending:{icon:e.jsx(ke,{fontSize:"small"}),color:"warning",labelKey:"status.pending"},completed:{icon:e.jsx(ve,{fontSize:"small"}),color:"success",labelKey:"status.completed"},approved:{icon:e.jsx(ve,{fontSize:"small"}),color:"success",labelKey:"status.approved"},rejected:{icon:e.jsx(pt,{fontSize:"small"}),color:"error",labelKey:"status.rejected"}},st=5,_t=({event:t,open:s,onClose:r,onSendHomework:n})=>{const{t:o}=z(),[a,c]=i.useState(""),[m,u]=i.useState(null),[g,b]=i.useState(!1);if(i.useEffect(()=>{s||(c(""),u(null),b(!1))},[s]),!t)return null;const f=v=>{var E;const F=(E=v.target.files)==null?void 0:E[0];if(F){if(F.size>st*1024*1024){N.error({message:o("errors.fileTooLarge",{size:st}),description:void 0});return}u(F)}},x=async()=>{if(!a.trim()&&!m){N.error({message:o("errors.emptyHomework"),description:void 0});return}b(!0);try{await n(a,m)}finally{b(!1)}},l=t.status,j=tt[l]||tt.scheduled;return e.jsxs(he,{open:s,onClose:r,fullWidth:!0,maxWidth:"sm",children:[e.jsx(ue,{sx:{bgcolor:`${j.color}.main`,color:"white"},children:o("studentSchedule.eventDetails")}),e.jsxs(me,{sx:{pt:3},children:[e.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(d,{variant:"h6",children:t.title}),e.jsx(Fe,{icon:j.icon,label:o(j.labelKey),color:j.color,size:"small"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",children:te(t.date).format("dddd, MMMM Do, YYYY [at] HH:mm")}),t.description&&e.jsx(d,{variant:"body1",sx:{mt:2},children:t.description}),t.link&&e.jsxs(d,{variant:"body2",sx:{mt:1},children:[o("studentSchedule.form_link"),": ",e.jsx(Ne,{href:t.link,target:"_blank",rel:"noopener noreferrer",children:t.link})]}),t.type==="homework"&&e.jsxs(p,{sx:{mt:4},children:[e.jsx(d,{variant:"h6",sx:{mb:2},children:o("studentSchedule.sendHomeworkTitle")}),e.jsx(T,{label:o("studentSchedule.form_description"),fullWidth:!0,multiline:!0,rows:4,value:a,onChange:v=>c(v.target.value),variant:"outlined",disabled:g}),e.jsxs(C,{sx:{mt:2},variant:"outlined",component:"label",startIcon:e.jsx(os,{}),disabled:g,children:[m?m.name:o("studentSchedule.uploadScreenshot"),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:f})]})]})]}),e.jsxs(xe,{sx:{p:2},children:[e.jsx(C,{onClick:r,disabled:g,children:o("common.close")}),t.type==="homework"&&e.jsx(C,{onClick:x,variant:"contained",color:"primary",disabled:g,children:o("studentSchedule.send")})]})]})};function De(t){const{children:s,value:r,index:n,...o}=t;return e.jsx("div",{role:"tabpanel",hidden:r!==n,...o,children:r===n&&e.jsx(p,{sx:{pt:3},children:s})})}const rt=()=>{const{t}=z(),s=ae(),{userId:r}=Ht(),n=i.useContext(ge);if(!n)throw new Error("AuthContext is not available");const{user:o,logout:a,loading:c,refetchUser:m}=n,[u,g]=i.useState(null),[b,f]=i.useState(null),[x,l]=i.useState([]),[j,v]=i.useState({profile:!0,coach:!1,schedule:!1}),[F,E]=i.useState(null),[R,w]=i.useState(!1),[I,h]=i.useState(0),[y,S]=i.useState(null);i.useEffect(()=>{if(c)return;if(!r){E("User ID is missing from the URL."),v(P=>({...P,profile:!1}));return}(async()=>{v({profile:!0,coach:!1,schedule:!1});try{const P=await Bs(r);g(P)}catch{E(t("profile.errorLoadingProfile"))}finally{v(P=>({...P,profile:!1}))}})()},[t,r,c]),i.useEffect(()=>{if(u){const k=(o==null?void 0:o._id)===u._id;u.trainer?(v(P=>({...P,coach:!0})),tr(u.trainer).then(f).catch(P=>console.error("Failed to fetch coach",P)).finally(()=>v(P=>({...P,coach:!1})))):f(null),k&&u.roles.some(P=>["student","user"].includes(P))?(v(P=>({...P,schedule:!0})),$e(u._id).then(l).catch(P=>console.error("Failed to fetch schedule",P)).finally(()=>v(P=>({...P,schedule:!1})))):l([])}},[u,o==null?void 0:o._id]);const A=()=>{a(),s("/login")},O=(k,P)=>h(P),X=async(k,P)=>{if(!(!o||!y))try{await Ft({studentId:o._id,scheduleId:y._id,homeworkText:k.trim()||void 0,screenshot:P||void 0}),y.coach&&await Pt({recipient:y.coach,type:"homework_submission",content:`New homework from ${o.firstName} for: "${y.title}"`,metadata:{scheduleId:y._id}}),N.success({message:t("studentSchedule.homeworkSentSuccess","Homework sent successfully!"),description:void 0}),S(null),l(q=>q.map(L=>L._id===y._id?{...L,status:"pending"}:L))}catch{N.error({message:t("errors.sendHomework","Failed to send homework."),description:void 0})}},H=(o==null?void 0:o._id)===r,ie=i.useMemo(()=>u!=null&&u._id?zs(u._id):"",[u]);return c||j.profile?e.jsx(p,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",bgcolor:"#0e0e0e"},children:e.jsx(se,{sx:{color:"#FFD700"}})}):F||!u?e.jsx(p,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",bgcolor:"#0e0e0e"},children:e.jsx(d,{color:"error",children:F||"User not found"})}):e.jsx(p,{sx:{bgcolor:"#0e0e0e",color:"white",minHeight:"100vh",py:5},children:e.jsxs(B,{maxWidth:"lg",children:[e.jsxs(p,{sx:{textAlign:"center",mb:5},children:[e.jsx(d,{variant:"h2",component:"h1",fontWeight:"bold",children:H?t("profile.title"):`${u.firstName}'s Profile`}),e.jsx(d,{variant:"h6",sx:{mt:1,color:"rgba(255, 255, 255, 0.7)"},children:H&&t("profile.subtitle")})]}),e.jsx(vr,{user:u,coach:b,avatarUrl:ie,isMyProfile:H,onEdit:()=>w(!0),onLogout:A,t}),e.jsx(p,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(bt,{value:I,onChange:O,textColor:"inherit",TabIndicatorProps:{sx:{backgroundColor:"#FFD700"}},children:[e.jsx(be,{label:t("profile.tabs.overview","Overview")}),H&&u.roles.some(k=>["student","user"].includes(k))&&e.jsx(be,{label:t("profile.tabs.lessons","All Lessons")}),e.jsx(be,{label:t("profile.tabs.statistics","Statistics"),disabled:!0})]})}),e.jsx(De,{value:I,index:0,children:H?e.jsx(wr,{schedule:x,isLoading:j.schedule,onEventSelect:S}):e.jsx(d,{sx:{color:"grey.500",textAlign:"center",p:4},children:"This is a public profile overview."})}),H&&u.roles.some(k=>["student","user"].includes(k))&&e.jsx(De,{value:I,index:1,children:e.jsx(Nt,{schedule:x,isLoading:j.schedule,onEventSelect:S})}),e.jsx(De,{value:I,index:H&&u.roles.some(k=>["student","user"].includes(k))?2:1,children:e.jsx(d,{sx:{color:"grey.500",textAlign:"center",p:4},children:"Game statistics and analytics are coming soon!"})}),H&&R&&e.jsx(jr,{user:u,onClose:()=>{w(!1),m()}}),H&&e.jsx(_t,{event:y,open:!!y,onClose:()=>S(null),onSendHomework:X})]})})},Sr=({columns:t,data:s})=>{const[r,n]=i.useState(""),[o,a]=i.useState(10),[c,m]=i.useState(0),u=x=>{n(x.target.value),m(0)},g=(x,l)=>{m(l)},b=x=>{a(parseInt(x.target.value,10)),m(0)},f=s.filter(x=>t.some(l=>{if(l.field==="actions")return!1;const j=x[l.field];return j==null?void 0:j.toString().toLowerCase().includes(r.toLowerCase())}));return e.jsxs(M,{children:[e.jsx(T,{fullWidth:!0,label:"Поиск",variant:"outlined",value:r,onChange:u,style:{padding:"16px"}}),e.jsx(as,{children:e.jsxs(vt,{children:[e.jsx(yt,{children:e.jsx(ce,{children:t.map(x=>e.jsx(U,{children:x.label},String(x.field)))})}),e.jsx(wt,{children:f.slice(c*o,c*o+o).map(x=>e.jsx(ce,{children:t.map(l=>e.jsx(U,{children:l.render?l.render(x):x[l.field]},String(l.field)))},x.id))})]})}),e.jsx(is,{rowsPerPageOptions:[10,20,50,100],component:"div",count:f.length,rowsPerPage:o,page:c,onPageChange:g,onRowsPerPageChange:b})]})},Cr=()=>{const[t,s]=i.useState([]),[r,n]=i.useState(null),[o,a]=i.useState(""),[c,m]=i.useState("add"),[u,g]=i.useState(!1),[b,f]=i.useState(!1),[x,l]=i.useState({open:!1,message:"",severity:"success"});i.useEffect(()=>{(async()=>{try{const S=(await D.get("/users")).data.map(A=>({id:A._id,firstName:A.firstName,lastName:A.lastName,email:A.email,roles:A.roles,_id:A._id,registrationDate:new Date(A.registrationDate),firebaseUID:A.firebaseUID,students:A.students,trainer:A.trainer,trainerEmail:A.trainerEmail}));s(S)}catch(y){console.error("Ошибка при получении списка пользователей:",y)}})()},[]);const j=h=>{n(h),a(""),m("add"),g(!0)},v=()=>{n(null),g(!1)},F=h=>{n(h),f(!0)},E=()=>{f(!1),n(null)},R=async()=>{if(r)try{await D.put("/admin/update-role",{userEmail:r.email,role:o,action:c}),s(t.map(h=>h.id===r.id?{...h,roles:c==="add"?[...h.roles,o]:h.roles.filter(y=>y!==o)}:h)),l({open:!0,message:"Роль успешно изменена",severity:"success"}),v()}catch(h){console.error("Ошибка при изменении роли:",h),l({open:!0,message:"Ошибка при изменении роли",severity:"error"})}},w=async()=>{if(r)try{await D.delete(`/admin/delete-user/${r.id}`),s(t.filter(h=>h.id!==r.id)),l({open:!0,message:"Пользователь удалён",severity:"success"}),E()}catch(h){console.error("Ошибка при удалении пользователя:",h),l({open:!0,message:"Ошибка при удалении пользователя",severity:"error"})}},I=[{field:"firstName",label:"Имя"},{field:"lastName",label:"Фамилия"},{field:"email",label:"Email"},{field:"roles",label:"Роли",render:h=>h.roles.join(", ")},{field:"actions",label:"Действия",render:h=>e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:"small",onClick:()=>j(h),children:e.jsx(Ie,{})}),e.jsx(Y,{size:"small",color:"error",onClick:()=>F(h),children:e.jsx(We,{})})]})}];return e.jsxs(B,{children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:"Список пользователей"}),e.jsx(Sr,{columns:I,data:t}),e.jsxs(he,{open:u,onClose:v,fullWidth:!0,maxWidth:"xs",children:[e.jsx(ue,{children:"Управление ролями"}),e.jsxs(me,{children:[e.jsxs(qe,{children:["Пользователь: ",e.jsxs("strong",{children:[r==null?void 0:r.firstName," ",r==null?void 0:r.lastName]})]}),e.jsxs(Le,{fullWidth:!0,sx:{marginTop:2},children:[e.jsx(Te,{children:"Роль"}),e.jsxs(Pe,{value:o,onChange:h=>a(h.target.value),label:"Роль",children:[e.jsx(K,{value:"student",children:"Студент"}),e.jsx(K,{value:"coach",children:"Тренер"})]})]})]}),e.jsxs(xe,{children:[e.jsx(C,{onClick:v,children:"Отмена"}),e.jsx(C,{onClick:R,color:"primary",disabled:!o,children:"Сохранить"})]})]}),e.jsxs(he,{open:b,onClose:E,children:[e.jsx(ue,{children:"Подтвердите удаление"}),e.jsx(me,{children:e.jsxs(qe,{children:["Вы уверены, что хотите удалить пользователя ",r==null?void 0:r.email,"? Это действие необратимо."]})}),e.jsxs(xe,{children:[e.jsx(C,{onClick:E,children:"Нет"}),e.jsx(C,{onClick:w,color:"error",children:"Да, удалить"})]})]}),e.jsx(ls,{open:x.open,autoHideDuration:4e3,onClose:()=>l({...x,open:!1}),children:e.jsx(cs,{severity:x.severity,onClose:()=>l({...x,open:!1}),variant:"filled",children:x.message})})]})},kr=Ct(te),Ir={individual_lesson:e.jsx(us,{fontSize:"small"}),group_lesson:e.jsx(ms,{fontSize:"small"}),homework:e.jsx(xs,{fontSize:"small"}),opening_study:e.jsx(gs,{fontSize:"small"}),tournament_participation:e.jsx(ps,{fontSize:"small"})},Pr=["individual_lesson","group_lesson","homework","opening_study","tournament_participation"],Fr=({event:t})=>{const s=t.type;if(!s)return null;const r=Ir[s],n=`custom-event rbc-event--${s}`;return e.jsx(ft,{title:t.description||t.title,placement:"top",children:e.jsxs("div",{className:n,children:[r,e.jsx(d,{variant:"caption",noWrap:!0,component:"span",children:t.title})]})})},Nr=({open:t,onClose:s,student:r})=>{const{t:n}=z(),[o,a]=i.useState([]),[c,m]=i.useState({}),[u,g]=i.useState(null);if(!r)return null;const b=`${r.firstName} ${r.lastName}`,f=i.useCallback(()=>{m({student:r._id,status:"scheduled",title:"",type:"individual_lesson",date:"",description:"",link:""}),g(null)},[r]),x=i.useCallback(async()=>{if(r._id)try{const h=await $e(r._id);a(h)}catch(h){console.error("Failed to fetch schedule:",h),N.error({message:n("schedule.fetchError"),description:void 0})}},[r,n]),l=async()=>{const{date:h,type:y,title:S}=c;if(!h||!y||!S){N.error({message:n("schedule.fieldRequired"),description:void 0});return}const A={studentId:r._id,date:new Date(h).toISOString(),title:S,description:c.description||"",link:c.link||"",type:y,status:c.status||"scheduled"};try{const O=!!c._id;O?await mr(c._id,A):await ur(A),N.success({message:n(O?"schedule.updateSuccess":"schedule.createSuccess"),description:void 0}),await x(),f()}catch(O){console.error("Failed to save event:",O)}},j=async()=>{if(c._id)try{await xr(c._id),N.success({message:n("schedule.deleteSuccess"),description:void 0}),await x(),f()}catch(h){console.error("Failed to delete event:",h)}};i.useEffect(()=>{t&&r&&(x(),f())},[t,r,x,f]);const v=i.useCallback(({start:h})=>{f(),g(h),m(y=>({...y,date:te(h).format("YYYY-MM-DDTHH:mm")}))},[f]),F=i.useCallback(h=>{g(h.date?new Date(h.date):null),m({...h,date:h.date?te(h.date).format("YYYY-MM-DDTHH:mm"):""})},[]),E=o.map(h=>({...h,id:h._id,start:new Date(h.date),end:te(h.date).add(1,"hour").toDate(),title:h.title})),R=i.useCallback(h=>({className:u&&te(h).isSame(u,"day")?"rbc-selected-slot-custom":""}),[u]),w=h=>{const{name:y,value:S}=h.target;m(A=>({...A,[y]:S}))},I=h=>{m(y=>({...y,type:h.target.value}))};return e.jsxs(he,{open:t,onClose:s,fullWidth:!0,maxWidth:"lg",className:"schedule-dialog",children:[e.jsx(ue,{className:"schedule-dialog__header",children:e.jsxs(W,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(d,{variant:"h6",component:"div",children:n("schedule.editScheduleTitle",{studentName:b})}),e.jsx(Y,{"aria-label":"close",onClick:s,className:"schedule-dialog__close-btn",children:e.jsx(St,{})})]})}),e.jsx(me,{dividers:!0,className:"schedule-dialog__content",children:e.jsxs(_,{container:!0,spacing:3,children:[e.jsx(_,{item:!0,xs:12,md:7,children:e.jsx(kt,{localizer:kr,events:E,startAccessor:"start",endAccessor:"end",selectable:!0,onSelectSlot:v,onSelectEvent:F,components:{event:Fr},dayPropGetter:R,className:"schedule-calendar"})}),e.jsx(_,{item:!0,xs:12,md:5,children:e.jsxs(M,{component:"form",className:"event-form",onSubmit:h=>{h.preventDefault(),l()},children:[e.jsx(d,{variant:"h6",className:"event-form__header",children:c._id?n("schedule.eventDetails"):u?n("schedule.addEventForDate",{date:te(u).format("MMMM Do, YYYY")}):n("schedule.addEvent")}),e.jsxs(W,{spacing:2.5,className:"event-form__fields",children:[e.jsx(T,{name:"title",label:n("schedule.form_title"),variant:"filled",fullWidth:!0,value:c.title||"",onChange:w,className:"event-form__field"}),e.jsxs(Le,{variant:"filled",fullWidth:!0,className:"event-form__field",children:[e.jsx(Te,{children:n("schedule.form_type")}),e.jsx(Pe,{name:"type",value:c.type||"",onChange:I,children:Pr.map(h=>e.jsx(K,{value:h,children:n(`schedule.eventTypes.${h}`)},h))})]}),e.jsx(T,{name:"description",label:n("schedule.form_description"),variant:"filled",fullWidth:!0,multiline:!0,rows:3,value:c.description||"",onChange:w,className:"event-form__field"}),e.jsx(T,{name:"link",label:n("schedule.form_link"),variant:"filled",fullWidth:!0,value:c.link||"",onChange:w,className:"event-form__field"}),e.jsx(T,{name:"date",label:n("schedule.form_date"),type:"datetime-local",variant:"filled",fullWidth:!0,value:c.date||"",onChange:w,InputLabelProps:{shrink:!0},className:"event-form__field"})]})]})})]})}),e.jsxs(xe,{className:"schedule-dialog__actions",children:[e.jsx(C,{onClick:s,className:"action-button action-button--close",children:n("common.close")}),e.jsx(p,{sx:{flex:"1 1 auto"}}),c._id&&e.jsx(C,{onClick:j,variant:"outlined",startIcon:e.jsx(We,{}),className:"action-button action-button--delete",children:n("common.delete")}),e.jsx(C,{onClick:l,variant:"contained",startIcon:c._id?e.jsx(ds,{}):e.jsx(hs,{}),className:"action-button action-button--save",children:c._id?n("common.save"):n("common.add")})]})]})},_r=()=>{const{t}=z(),[s,r]=i.useState([]),[n,o]=i.useState(null),[a,c]=i.useState(!1),[m,u]=i.useState(!0),g=i.useMemo(()=>{const l=localStorage.getItem("user");return l?JSON.parse(l).email:null},[]),b=i.useCallback(async()=>{if(!g){u(!1);return}u(!0);try{const l=await nr(g);if(!Array.isArray(l)||l.length===0){r([]);return}const j=l.map(F=>rr(g,F)),v=await Promise.all(j);r(v.filter(F=>F!==null))}catch(l){console.error("Ошибка при получении списка учеников:",l),N.error({message:t("studentsPage.fetchError"),description:void 0}),r([])}finally{u(!1)}},[g,t]),f=async l=>{if(g)try{await or(g,l),N.success({message:t("studentsPage.studentDeletedSuccess"),description:void 0}),r(j=>j.filter(v=>v._id!==l))}catch(j){console.error("Ошибка при удалении ученика:",j)}},x=l=>{o(l),c(!0)};return i.useEffect(()=>{b()},[b]),e.jsxs(B,{children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:t("studentsPage.studentsListTitle")}),e.jsx(M,{children:e.jsxs(vt,{children:[e.jsx(yt,{children:e.jsxs(ce,{children:[e.jsx(U,{children:t("studentsPage.firstName")}),e.jsx(U,{children:t("studentsPage.lastName")}),e.jsx(U,{children:t("studentsPage.email")}),e.jsx(U,{align:"right",children:t("studentsPage.actions")})]})}),e.jsx(wt,{children:m?e.jsx(ce,{children:e.jsxs(U,{colSpan:4,align:"center",children:[e.jsx(se,{}),e.jsx(d,{sx:{mt:1},children:t("common.loading")})]})}):s.length>0?s.map(l=>e.jsxs(ce,{children:[e.jsx(U,{children:l.firstName}),e.jsx(U,{children:l.lastName}),e.jsx(U,{children:l.email}),e.jsxs(U,{align:"right",children:[e.jsx(C,{variant:"contained",color:"primary",onClick:()=>x(l),style:{marginRight:10},children:t("studentsPage.editSchedule")}),e.jsx(C,{variant:"contained",color:"secondary",onClick:()=>f(l._id),children:t("studentsPage.delete")})]})]},l._id)):e.jsx(ce,{children:e.jsx(U,{colSpan:4,align:"center",children:t("studentsPage.noStudents")})})})]})}),n&&e.jsx(Nr,{open:a,onClose:()=>c(!1),student:n})]})};class Er{constructor(s){Ee(this,"game");Ee(this,"fullHistory",[]);this.game=s?new de(s):new de,this.fullHistory=this.game.history()}getFen(){return this.game.fen()}getTurn(){return this.game.turn()}getHistory(){return this.fullHistory}getMovesForSquare(s){return this.game.moves({square:s,verbose:!0})}getStatus(){return{isCheckmate:this.game.isCheckmate(),isStalemate:this.game.isStalemate(),isThreefoldRepetition:this.game.isThreefoldRepetition(),isInsufficientMaterial:this.game.isInsufficientMaterial(),isDraw:this.game.isDraw(),turn:this.game.turn()}}handleMove(s,r){try{const n=this.game.move({from:s,to:r,promotion:"q"});return n&&(this.fullHistory=this.game.history()),n}catch{return null}}resetGame(){this.game.reset(),this.fullHistory=[]}loadPgn(s){try{return this.game.loadPgn(s),this.fullHistory=this.game.history(),!0}catch(r){return console.error("Invalid PGN:",r),!1}}goToMove(s){const r=new de;for(let n=0;n<s;n++)this.fullHistory[n]&&r.move(this.fullHistory[n]);this.game=r}uciToSan(s){const r=this.game.move({from:s.substring(0,2),to:s.substring(2,4),promotion:s.length===5?s.substring(4):void 0});return r?(this.game.undo(),r.san):null}}const Dr=t=>{const s=i.useMemo(()=>new Er(t),[t]),[r,n]=i.useState(s.getFen()),[o,a]=i.useState(s.getHistory()),[c,m]=i.useState(o.length),[u,g]=i.useState(null),[b,f]=i.useState({}),x=i.useRef(r);x.current=r;const l=i.useCallback(()=>{n(s.getFen());const I=s.getHistory();a(I),m(I.length)},[s]),j=i.useCallback(()=>{g(null),f({})},[]),v=i.useCallback((I,h)=>s.handleMove(I,h)?(l(),j(),!0):!1,[s,l,j]),F=i.useCallback(I=>{if(I===u){j();return}const h=s.getMovesForSquare(I);if(h.length===0){j();return}const y={};h.forEach(S=>{y[S.to]={background:S.flags.includes("c")?"radial-gradient(circle, rgba(0,0,0,0) 85%, rgba(0,0,0,0.2) 85%)":"radial-gradient(circle, rgba(0,0,0,0.2) 25%, transparent 30%)",borderRadius:"50%"}}),f(y),g(I)},[s,u,j]),E=i.useCallback(()=>{s.resetGame(),l(),j()},[s,l,j]),R=i.useCallback(I=>{const h=s.loadPgn(I.trim());return h&&(l(),j()),h},[s,l,j]),w=i.useCallback(I=>{s.goToMove(I),n(s.getFen()),m(I),j()},[s,j]);return{fen:r,history:o,currentMoveIndex:c,moveOptions:b,actions:{handleMove:v,onSquareClick:F,resetGame:E,loadPgn:R,goToMove:w}}},Ar=({fen:t,onPieceDrop:s,onSquareClick:r,squareStyles:n})=>e.jsx(It,{position:t,onPieceDrop:s,onSquareClick:r,customSquareStyles:n,customBoardStyle:{borderRadius:"4px",boxShadow:"0 5px 15px rgba(0, 0, 0, 0.5)"},customDarkSquareStyle:{backgroundColor:"#779952"},customLightSquareStyle:{backgroundColor:"#edeed1"}}),nt=t=>{if(t===void 0)return"";const s=Math.abs(t);return s<.4?" =":s<1?t>0?" += ":" -= ":s<2?t>0?" ±":" ∓":t>0?" +-":" -+"},ot=t=>t===void 0||Math.abs(t)<.4?"text.secondary":t>0?"success.light":"error.light",Rr=({history:t,currentMoveIndex:s,onMoveClick:r})=>{const n=ze.useMemo(()=>{const o=[];for(let a=0;a<t.length;a+=2)o.push({white:t[a],black:t[a+1]||null});return o},[t]);return e.jsx(M,{variant:"outlined",sx:{p:1.5,height:"100%",overflowY:"auto",bgcolor:"#1c1c1c",borderColor:"rgba(255,255,255,0.2)"},children:e.jsx(_,{container:!0,rowSpacing:.5,columnSpacing:1,sx:{fontSize:"1rem",color:"white"},children:n.map((o,a)=>{const c=a*2+1,m=a*2+2;return e.jsxs(ze.Fragment,{children:[e.jsxs(_,{item:!0,xs:2,sx:{color:"rgba(255, 255, 255, 0.6)",textAlign:"right",pt:"4px"},children:[a+1,"."]}),e.jsx(_,{item:!0,xs:5,children:e.jsxs(p,{onClick:()=>r(c),sx:{display:"flex",alignItems:"center",cursor:"pointer",p:"2px 5px",borderRadius:"4px",bgcolor:s===c?"rgba(255, 215, 0, 0.3)":"transparent","&:hover":{bgcolor:"rgba(255,255,255,0.1)"}},children:[e.jsx(d,{component:"span",children:o.white.san}),e.jsx(d,{component:"span",sx:{color:ot(o.white.evaluation),fontWeight:"bold",ml:.5},children:nt(o.white.evaluation)})]})}),e.jsx(_,{item:!0,xs:5,children:o.black&&e.jsxs(p,{onClick:()=>r(m),sx:{display:"flex",alignItems:"center",cursor:"pointer",p:"2px 5px",borderRadius:"4px",bgcolor:s===m?"rgba(255, 215, 0, 0.3)":"transparent","&:hover":{bgcolor:"rgba(255,255,255,0.1)"}},children:[e.jsx(d,{component:"span",children:o.black.san}),e.jsx(d,{component:"span",sx:{color:ot(o.black.evaluation),fontWeight:"bold",ml:.5},children:nt(o.black.evaluation)})]})})]},a)})})})},Wr=({evaluation:t,depth:s,principalVariation:r,isAnalyzing:n,isEngineOn:o,onToggleEngine:a})=>e.jsxs(M,{variant:"outlined",sx:{p:2,borderColor:"rgba(255,255,255,0.2)",borderRadius:2},children:[e.jsxs(W,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(d,{variant:"h4",fontWeight:"bold",sx:{color:"#FFD700"},children:t??e.jsx(d,{component:"span",color:"text.secondary",children:"..."})}),e.jsxs(W,{direction:"row",alignItems:"center",spacing:1,children:[e.jsxs(W,{alignItems:"flex-end",children:[e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Depth: ",s]}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"SF 16"})]}),e.jsx(oe,{control:e.jsx(fs,{checked:o,onChange:a,sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#FFD700"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#FFD700"}}}),label:"",sx:{mr:0}})]})]}),e.jsx(V,{sx:{my:1,borderColor:"rgba(255,255,255,0.2)"}}),e.jsx(p,{sx:{minHeight:"4em",overflowX:"auto",whiteSpace:"nowrap"},children:e.jsx(d,{variant:"body1",children:r||(n?"Analyzing...":e.jsx(d,{component:"span",color:"text.secondary",children:"-"}))})})]}),Mr=()=>{const{t}=z(),{fen:s,history:r,currentMoveIndex:n,moveOptions:o,actions:a}=Dr(),[c,m]=i.useState([]),[u,g]=i.useState(""),[b,f]=i.useState(null),[x,l]=i.useState(!1),[j,v]=i.useState(null),[F,E]=i.useState(0),[R,w]=i.useState(""),[I,h]=i.useState(!1),y=i.useRef(s);i.useEffect(()=>{y.current=s},[s]),i.useEffect(()=>{m(r.map(P=>({san:P})))},[r]);const S=()=>{v(null),E(0),w("")},A=()=>{a.loadPgn(u)?(S(),N.success({message:t("chessGame.pgnLoadSuccess"),description:void 0})):N.error({message:t("chessGame.pgnLoadError"),description:void 0})},O=()=>{a.resetGame(),S(),N.success({message:t("chessGame.resetSuccess"),description:void 0})},X=P=>{a.goToMove(P),S()},H=i.useCallback(()=>{b&&!x&&(l(!0),S(),b.postMessage(`position fen ${s}`),b.postMessage("go depth 18"))},[b,s,x]);i.useEffect(()=>{I?H():b&&(b.postMessage("stop"),l(!1))},[s,I,H,b]);const ie=P=>{h(P.target.checked)},k=i.useCallback((P,q)=>{try{const L=new de(q),re=P.split(" ");let J="";for(const Q of re){const ne=L.move({from:Q.substring(0,2),to:Q.substring(2,4),promotion:Q.length===5?Q.substring(4):void 0});if(ne)L.turn()==="b"?J+=`${L.moveNumber()}. ${ne.san} `:J+=`${ne.san} `;else break}return J.trim()}catch{return P}},[]);return i.useEffect(()=>{const P=new Worker("/workers/stockfish.js");return f(P),P.postMessage("uci"),P.onmessage=q=>{const L=q.data;if(L!=="uciok"){if(L.startsWith("info depth")){const re=L.match(/depth (\d+)/),J=L.match(/score (cp|mate) (-?\d+)/),Q=L.match(/ pv (.+)/);if(re&&E(parseInt(re[1],10)),J){const ne=new de(y.current).turn(),Dt=J[1];let _e=parseInt(J[2],10);ne==="b"&&(_e*=-1);const At=Dt==="cp"?(_e/100).toFixed(2):`M${Math.abs(_e)}`;v(At)}if(Q){const ne=k(Q[1],y.current);w(ne)}}L.startsWith("bestmove")&&l(!1)}},()=>P.terminate()},[k]),e.jsx(p,{sx:{bgcolor:"#0e0e0e",color:"white",minHeight:"100vh",py:{xs:2,md:5}},children:e.jsxs(B,{maxWidth:"xl",children:[e.jsxs(p,{sx:{textAlign:"center",mb:4},children:[e.jsx(d,{variant:"h2",component:"h1",fontWeight:"bold",children:t("chessGame.title")}),e.jsx(d,{variant:"h6",sx:{mt:1,color:"rgba(255, 255, 255, 0.7)"},children:t("chessGame.subtitle")})]}),e.jsxs(_,{container:!0,spacing:4,children:[e.jsx(_,{item:!0,xs:12,md:7,children:e.jsx(M,{sx:{p:2,bgcolor:"#1c1c1c",borderRadius:4,aspectRatio:"1 / 1",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ar,{fen:s,onPieceDrop:a.handleMove,onSquareClick:a.onSquareClick,squareStyles:o})})}),e.jsx(_,{item:!0,xs:12,md:5,children:e.jsx(M,{sx:{p:2,bgcolor:"#1c1c1c",borderRadius:4,height:"100%"},children:e.jsxs(W,{spacing:2,height:"100%",children:[e.jsx(Wr,{evaluation:j,depth:F,principalVariation:R,isAnalyzing:x,isEngineOn:I,onToggleEngine:ie}),e.jsx(p,{sx:{flexGrow:1,height:"250px"},children:e.jsx(Rr,{history:c,currentMoveIndex:n,onMoveClick:X})}),e.jsxs(W,{direction:"row",spacing:1,justifyContent:"center",alignItems:"center",children:[e.jsx(Y,{onClick:()=>X(0),disabled:n===0,children:e.jsx(js,{})}),e.jsx(Y,{onClick:()=>X(n-1),disabled:n===0,children:e.jsx(bs,{})}),e.jsx(Y,{onClick:()=>X(n+1),disabled:n===r.length,children:e.jsx(vs,{})}),e.jsx(Y,{onClick:()=>X(r.length),disabled:n===r.length,children:e.jsx(ys,{})})]}),e.jsxs(W,{spacing:1,children:[e.jsx(T,{label:t("chessGame.pgnInputLabel"),fullWidth:!0,multiline:!0,rows:2,variant:"filled",value:u,onChange:P=>g(P.target.value),sx:{"& .MuiFilledInput-root":{backgroundColor:"rgba(255,255,255,0.1)"}}}),e.jsxs(W,{direction:"row",spacing:1,children:[e.jsx(C,{variant:"outlined",onClick:O,startIcon:e.jsx(ws,{}),fullWidth:!0,children:t("chessGame.reset")}),e.jsx(C,{variant:"outlined",onClick:A,startIcon:e.jsx(Ss,{}),fullWidth:!0,children:t("chessGame.loadPgn")})]})]})]})})})]})]})})},Lr=({position:t,onMove:s,onSquareClick:r,boardWidth:n=500})=>e.jsx(It,{position:t,boardWidth:n,onPieceDrop:s?(o,a)=>s(o,a):void 0,onSquareClick:r}),at=({initialFen:t})=>{const s=t||"8/8/8/8/8/8/8/8 w - - 0 1",[r,n]=i.useState(!1),[o]=i.useState(()=>{const w=new de;return w.clear(),w}),[a,c]=i.useState(s),[m,u]=i.useState(null),[g,b]=i.useState(null),f=[{type:"k",color:"b",icon:"♚"},{type:"q",color:"b",icon:"♛"},{type:"r",color:"b",icon:"♜"},{type:"b",color:"b",icon:"♝"},{type:"n",color:"b",icon:"♞"},{type:"p",color:"b",icon:"♟"},{type:"k",color:"w",icon:"♔"},{type:"q",color:"w",icon:"♕"},{type:"r",color:"w",icon:"♖"},{type:"b",color:"w",icon:"♗"},{type:"n",color:"w",icon:"♘"},{type:"p",color:"w",icon:"♙"}],x=i.useRef(null);i.useEffect(()=>{const w=I=>{if(!m||!r||!x.current)return;const h=x.current.getBoundingClientRect(),y=I.clientX-h.left,S=I.clientY-h.top;y>=0&&S>=0&&y<=h.width&&S<=h.height&&b({left:y,top:S})};return window.addEventListener("mousemove",w),()=>window.removeEventListener("mousemove",w)},[m,r]);const l=(w,I,h)=>{let y=a.split(" "),S=y[2]==="-"?"":y[2];I?S=(S+h).split("").sort().join(""):S=S.replace(h,""),y[2]=S||"-";const A=y.join(" ");try{o.load(A),c(A)}catch{N.error({message:"Ошибка рокировки",description:void 0})}},j=w=>{const[I,h]=[w.charCodeAt(0)-97,8-parseInt(w[1])],S=o.board()[h][I];if(m){S&&S.type===m.type&&S.color===m.color?o.remove(w):o.put(m,w),c(o.fen());return}S&&(o.remove(w),c(o.fen()))},v=()=>{o.clear(),c(o.fen()),N.success({message:"Доска очищена!",description:void 0})},F=()=>{o.reset(),c(o.fen()),N.success({message:"Установлена начальная позиция!",description:void 0})},E=()=>{u(null),b(null)},R=()=>{if(a.split("").filter(I=>I.toLowerCase()==="k").length<2){N.error({message:"Некорректная позиция",description:"На доске должно быть как минимум два короля."});return}try{o.load(a),N.success({message:"Позиция сохранена",description:`FEN: ${a}`})}catch{N.error({message:"Ошибка сохранения",description:"Некорректная FEN-позиция"})}};return e.jsxs(B,{children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:"Редактор шахматной позиции"}),e.jsxs(p,{display:"flex",children:[e.jsxs(p,{onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),style:{cursor:m?"none":"default",position:"relative",width:500,height:500},children:[e.jsx(Lr,{position:a,onSquareClick:j,boardWidth:500}),g&&m&&e.jsx("div",{style:{...g,position:"absolute",pointerEvents:"none",left:g.left,top:g.top,fontSize:"32px",zIndex:1e3},children:m.icon})]}),e.jsxs(p,{ml:3,display:"flex",flexDirection:"column",children:[e.jsxs(M,{elevation:3,style:{padding:"10px",marginBottom:"20px"},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Фигуры"}),e.jsx(p,{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:1,children:f.map((w,I)=>e.jsx(p,{onClick:()=>u(w),style:{textAlign:"center",cursor:"pointer",padding:6,border:"1px solid #aaa",borderRadius:4,fontSize:24,backgroundColor:m===w?"#1976d2":"#f5f5f5",color:m===w?"#fff":"inherit"},children:w.icon},I))})]}),e.jsxs(M,{elevation:3,style:{padding:"10px",marginBottom:"20px"},children:[e.jsx(d,{variant:"h6",children:"Рокировка"}),e.jsxs(Cs,{row:!0,children:[e.jsx(oe,{control:e.jsx(we,{checked:a.includes("K"),onChange:w=>l(a,w.target.checked,"K")}),label:"Белые 0-0"}),e.jsx(oe,{control:e.jsx(we,{checked:a.includes("Q"),onChange:w=>l(a,w.target.checked,"Q")}),label:"Белые 0-0-0"}),e.jsx(oe,{control:e.jsx(we,{checked:a.includes("k"),onChange:w=>l(a,w.target.checked,"k")}),label:"Чёрные 0-0"}),e.jsx(oe,{control:e.jsx(we,{checked:a.includes("q"),onChange:w=>l(a,w.target.checked,"q")}),label:"Чёрные 0-0-0"})]})]}),e.jsxs(M,{elevation:3,style:{padding:"10px"},children:[e.jsx(d,{variant:"h6",children:"Ход"}),e.jsxs(ks,{row:!0,value:o.turn(),onChange:w=>{const I=a.split(" ");I[1]=w.target.value;const h=I.join(" ");try{o.load(h),c(h)}catch{N.error({message:"Ошибка изменения хода",description:void 0})}},children:[e.jsx(oe,{value:"w",control:e.jsx(Ue,{}),label:"Белые"}),e.jsx(oe,{value:"b",control:e.jsx(Ue,{}),label:"Чёрные"})]})]})]})]}),e.jsxs(W,{direction:"row",spacing:2,mt:3,children:[e.jsx(C,{variant:"contained",onClick:v,children:"Очистить доску"}),e.jsx(C,{variant:"contained",onClick:F,children:"Начальная позиция"}),e.jsx(C,{variant:"contained",onClick:E,children:"Убрать фигуру"}),e.jsx(C,{variant:"contained",color:"primary",onClick:R,children:"Сохранить"})]}),e.jsx(T,{label:"FEN",value:a,fullWidth:!0,multiline:!0,rows:2,onChange:w=>{const I=w.target.value;try{o.load(I),c(I)}catch{N.error({message:"Некорректный FEN",description:void 0})}},style:{marginTop:20}}),g&&m&&e.jsx("div",{style:g,children:m.icon})]})},Tr=async t=>(await D.get("/auth/check-verification",{params:{email:t}})).data,$r=async t=>(await D.post("/auth/resend-verification",{email:t})).data,zr=()=>{const t=ae(),s=Re(),{t:r}=z(),{firstName:n,lastName:o,email:a}=s.state||{},[c,m]=i.useState(!1),[u,g]=i.useState(!0),[b,f]=i.useState(null),[x,l]=i.useState(null),[j,v]=i.useState(!1),F=i.useRef(null);i.useEffect(()=>{if(!a){console.error("Email not found in location state. Redirecting to register."),t("/register");return}return F.current=setInterval(async()=>{try{const{emailVerified:R}=await Tr(a);R&&(g(!1),t("/login",{state:{message:r("verifyEmail.verifiedAndReadyToLogin")}}))}catch(R){console.error("Polling error:",R)}},5e3),()=>{F.current&&clearInterval(F.current)}},[a,t,r]);const E=async()=>{var R;if(a){m(!0),f(null),l(null);try{await $r(a),f(r("verifyEmail.resendSuccess")),v(!0),setTimeout(()=>v(!1),12e4)}catch(w){((R=w.response)==null?void 0:R.status)===429?l(r("verifyEmail.resendErrorTooMany")):l(r("verifyEmail.resendError"))}finally{m(!1)}}};return e.jsxs(p,{textAlign:"center",mt:5,p:2,children:[u&&e.jsx(se,{sx:{mb:2}}),e.jsx(d,{variant:"h4",gutterBottom:!0,children:r("verifyEmail.pageTitle")}),e.jsx(d,{variant:"body1",gutterBottom:!0,children:e.jsx("b",{children:r("verifyEmail.greeting",{firstName:n||"",lastName:o||""})})}),e.jsx(d,{variant:"body1",gutterBottom:!0,children:r("verifyEmail.sentTo",{email:a||r("verifyEmail.yourEmail")})}),e.jsx(d,{variant:"body1",color:"text.secondary",sx:{mt:2,maxWidth:"600px",mx:"auto"},children:r("verifyEmail.instruction")}),b&&!x&&e.jsx(d,{variant:"body2",color:"primary.main",sx:{mt:2,fontWeight:"bold"},children:b}),x&&e.jsx(d,{variant:"body2",color:"error",sx:{mt:2,fontWeight:"bold"},children:x}),e.jsx(C,{variant:"contained",color:"primary",onClick:E,disabled:j||c,sx:{mt:3,mb:2},children:r(c?"verifyEmail.sending":"verifyEmail.resendButton")}),e.jsx(d,{variant:"caption",display:"block",children:r("verifyEmail.didNotReceive")})]})},Br=async()=>(await D.get("/trainer/requests",{})).data,Hr=async(t,s)=>{await D.patch(`/trainer/request?request_id=${t}`,{status:s})},Or=async(t,s,r)=>(await D.post("/trainer/request",{coachId:t,experience:s,goals:r})).data,Ce={"& .MuiInputBase-root":{backgroundColor:"rgba(255, 255, 255, 0.08)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.12)"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.6)"},"& .MuiInputBase-input":{color:"white"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.6)"}},qr=()=>{var X,H,ie;const{t}=z(),[s,r]=i.useState([]),[n,o]=i.useState(null),[a,c]=i.useState(""),[m,u]=i.useState(!1),[g,b]=i.useState(!1),[f,x]=i.useState(!1),[l,j]=i.useState(!1),v=localStorage.getItem("email"),[F,E]=i.useState({userName:"",userEmail:"",experienceLevel:"Intermediate",goals:""}),[R,w]=i.useState({title:"",experience:"",bio:"",price:"",services:""});i.useEffect(()=>{(async()=>{try{const P=await er();r(P)}catch{N.error({message:t("coaches.fetchError"),description:void 0})}})()},[t]);const I=k=>{var P,q,L,re,J,Q;o(k),u(!0),x(!1),j(!1),w({title:((P=k.coachProfile)==null?void 0:P.title)||"",experience:((q=k.coachProfile)==null?void 0:q.experience)||"",bio:((L=k.coachProfile)==null?void 0:L.bio)||"",price:((J=(re=k.coachProfile)==null?void 0:re.price)==null?void 0:J.toString())||"",services:(((Q=k.coachProfile)==null?void 0:Q.services)||[]).join(", ")})},h=()=>{u(!1),setTimeout(()=>{o(null),x(!1),j(!1),E({userName:"",userEmail:"",experienceLevel:"Intermediate",goals:""})},300)},y=async()=>{if(n)try{b(!0),await Or(n._id,F.experienceLevel,F.goals),N.success({message:t("coaches.successMessage"),description:void 0}),h()}catch{N.error({message:t("coaches.submitError"),description:void 0})}finally{b(!1)}},S=async()=>{console.log("Saving profile:",R),N.success({message:t("coaches.updated"),description:void 0}),h()},A=s.filter(k=>`${k.firstName} ${k.lastName}`.toLowerCase().includes(a.toLowerCase())),O=n?`${n.firstName} ${n.lastName}`:"";return e.jsx(p,{sx:{bgcolor:"#0e0e0e",color:"white",minHeight:"100vh",py:8},children:e.jsxs(B,{maxWidth:"lg",children:[e.jsxs(p,{sx:{textAlign:"center",mb:8},children:[e.jsx(d,{variant:"h2",component:"h1",fontWeight:"bold",children:t("coaches.title")}),e.jsx(d,{variant:"h6",sx:{mt:1,color:"rgba(255, 255, 255, 0.7)"},children:t("coaches.subtitle")})]}),e.jsx(p,{sx:{mb:5,maxWidth:"600px",mx:"auto"},children:e.jsx(T,{fullWidth:!0,variant:"outlined",placeholder:t("coaches.searchByName"),value:a,onChange:k=>c(k.target.value),sx:{"& .MuiOutlinedInput-root":{borderRadius:"30px",backgroundColor:"#1c1c1c","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"#FFD700"},"&.Mui-focused fieldset":{borderColor:"#FFD700"}},"& .MuiInputBase-input":{color:"white"}},InputProps:{startAdornment:e.jsx(Is,{position:"start",children:e.jsx(Ps,{sx:{color:"rgba(255, 255, 255, 0.5)"}})})}})}),e.jsx(_,{container:!0,spacing:4,children:A.map(k=>{var P,q,L;return e.jsx(_,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(mt,{sx:{bgcolor:"#1c1c1c",color:"white",borderRadius:4,height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-8px)",boxShadow:"0 12px 24px rgba(255, 215, 0, 0.2)"}},children:[e.jsx(xt,{component:"img",height:"250",image:k.photoUrl||"/images/default-avatar.png",alt:`${k.firstName} ${k.lastName}`}),e.jsxs(gt,{sx:{flexGrow:1},children:[e.jsxs(d,{variant:"h5",component:"div",fontWeight:"bold",children:[k.firstName," ",k.lastName]}),e.jsx(d,{variant:"body1",sx:{color:"#FFD700",mb:2},children:((P=k.coachProfile)==null?void 0:P.title)||"Chess Master"}),e.jsxs(W,{spacing:1,children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",color:"rgba(255,255,255,0.7)"},children:[e.jsx(Fs,{fontSize:"small",sx:{mr:1}}),e.jsx(d,{variant:"body2",children:((q=k.coachProfile)==null?void 0:q.experience)||"N/A"})]}),e.jsxs(p,{sx:{display:"flex",alignItems:"center",color:"rgba(255,255,255,0.7)"},children:[e.jsx(Ns,{fontSize:"small",sx:{mr:1}}),e.jsx(d,{variant:"body2",children:(L=k.coachProfile)!=null&&L.price?`${k.coachProfile.price}$ / hour`:"Contact for price"})]})]})]}),e.jsx(p,{sx:{p:2,pt:0},children:e.jsx(C,{variant:"contained",fullWidth:!0,onClick:()=>I(k),sx:{backgroundColor:"#FFD700",color:"black",fontWeight:"bold",borderRadius:"20px","&:hover":{backgroundColor:"#FFC107"}},children:t("coaches.viewProfile")})})]})},k._id)})}),e.jsx(he,{open:m,onClose:h,fullWidth:!0,maxWidth:"md",PaperProps:{sx:{bgcolor:"#1c1c1c",color:"white",borderRadius:4,backgroundImage:"none"}},children:n&&e.jsxs(e.Fragment,{children:[e.jsx(ue,{sx:{p:3,pb:1},children:e.jsxs(W,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(d,{variant:"h5",fontWeight:"bold",children:l?t("coaches.editProfile"):t("coaches.profileOf",{coachName:O})}),e.jsx(Y,{onClick:h,sx:{color:"rgba(255,255,255,0.7)"},children:e.jsx(St,{})})]})}),e.jsx(me,{children:l?e.jsx(W,{spacing:2,sx:{pt:1}}):e.jsxs(e.Fragment,{children:[e.jsxs(_,{container:!0,spacing:4,sx:{pt:1},children:[e.jsx(_,{item:!0,xs:12,md:4,children:e.jsx(Me,{src:n.photoUrl||"/images/default-avatar.png",sx:{width:"100%",height:"auto",aspectRatio:"1 / 1",borderRadius:3},variant:"rounded"})}),e.jsx(_,{item:!0,xs:12,md:8,children:e.jsxs(W,{spacing:2.5,children:[e.jsxs(p,{children:[e.jsx(d,{fontWeight:"bold",color:"#FFD700",children:t("coaches.bio")}),e.jsx(d,{sx:{color:"rgba(255,255,255,0.8)",whiteSpace:"pre-wrap"},children:((X=n.coachProfile)==null?void 0:X.bio)||e.jsx("span",{style:{color:"rgba(255,255,255,0.5)",fontStyle:"italic"},children:"No bio provided."})})]}),e.jsxs(p,{children:[e.jsx(d,{fontWeight:"bold",color:"#FFD700",children:t("coaches.services")}),e.jsx(p,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:(ie=(H=n.coachProfile)==null?void 0:H.services)!=null&&ie.length?n.coachProfile.services.map(k=>e.jsx(Fe,{label:k,sx:{bgcolor:"rgba(255,255,255,0.2)",color:"white"}},k)):e.jsx(d,{sx:{color:"rgba(255,255,255,0.5)",fontStyle:"italic"},children:"No services listed."})})]})]})})]}),e.jsx(V,{sx:{my:3,borderColor:"rgba(255,255,255,0.2)"}}),e.jsx(p,{children:f?e.jsxs(M,{elevation:0,sx:{p:{xs:2,sm:3},bgcolor:"rgba(0,0,0,0.25)",borderRadius:2},children:[e.jsx(d,{variant:"h6",fontWeight:"bold",sx:{mb:2},children:t("coaches.requestTitle",{coachName:O})}),e.jsxs(W,{spacing:2,children:[e.jsx(T,{fullWidth:!0,label:t("coaches.yourName"),value:F.userName,onChange:k=>E({...F,userName:k.target.value}),variant:"filled",sx:Ce}),e.jsx(T,{fullWidth:!0,label:t("coaches.yourEmail"),value:F.userEmail,onChange:k=>E({...F,userEmail:k.target.value}),variant:"filled",sx:Ce}),e.jsxs(Le,{fullWidth:!0,variant:"filled",sx:Ce,children:[e.jsx(Te,{id:"level-select-label",children:t("coaches.level")}),e.jsxs(Pe,{labelId:"level-select-label",value:F.experienceLevel,onChange:k=>E({...F,experienceLevel:k.target.value}),children:[e.jsx(K,{value:"Beginner",children:t("coaches.levelBeginner")}),e.jsx(K,{value:"Intermediate",children:t("coaches.levelIntermediate")}),e.jsx(K,{value:"Advanced",children:t("coaches.levelAdvanced")})]})]}),e.jsx(T,{fullWidth:!0,multiline:!0,rows:3,label:t("coaches.goals"),value:F.goals,onChange:k=>E({...F,goals:k.target.value}),variant:"filled",sx:Ce})]})]}):e.jsx(C,{fullWidth:!0,variant:"outlined",onClick:()=>x(!0),sx:{color:"#FFD700",borderColor:"#FFD700","&:hover":{borderColor:"#FFC107",bgcolor:"rgba(255, 215, 0, 0.1)"}},children:t("coaches.requestTitle",{coachName:n.firstName})})})]})}),e.jsx(xe,{sx:{p:3,pt:2},children:l?e.jsxs(e.Fragment,{children:[e.jsx(C,{onClick:()=>j(!1),sx:{color:"rgba(255,255,255,0.7)"},children:t("coaches.cancel")}),e.jsx(C,{variant:"contained",onClick:S,startIcon:e.jsx(Ie,{}),sx:{bgcolor:"#FFD700",color:"black","&:hover":{bgcolor:"#FFC107"}},children:t("coaches.save")})]}):f?e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"outlined",onClick:()=>x(!1),sx:{color:"rgba(255,255,255,0.7)",borderColor:"rgba(255,255,255,0.3)"},children:t("coaches.cancel")}),e.jsx(C,{variant:"contained",onClick:y,disabled:g,startIcon:e.jsx(jt,{}),sx:{bgcolor:"#FFD700",color:"black","&:hover":{bgcolor:"#FFC107"}},children:t("coaches.sendRequest")})]}):n.email===v&&e.jsx(C,{variant:"text",onClick:()=>j(!0),startIcon:e.jsx(Ie,{}),sx:{color:"#FFD700"},children:t("coaches.editProfile")})})]})})]})})},fe=t=>"createdAt"in t,Ur=()=>{const{t}=z(),[s,r]=i.useState("requests"),[n,o]=i.useState([]),[a,c]=i.useState(null),[m,u]=i.useState(!0),[g,b]=i.useState(""),[f,x]=i.useState(!1),[l,j]=i.useState(null),[v,F]=i.useState(!1),E=i.useCallback(async h=>{u(!0),c(null);try{const y=h==="requests"?await Br():await pr();o(Array.isArray(y)?y:[])}catch(y){console.error(`Error loading ${h}:`,y),N.error({message:t("inbox.errors.loadFailed"),description:void 0})}finally{u(!1)}},[t]);i.useEffect(()=>{E(s)},[s,E]),i.useEffect(()=>{let h=null;return(async()=>{if(!a||fe(a)||!a.hasScreenshot){j(null);return}F(!0);try{const S=await fr(a._id);h=URL.createObjectURL(S),j(h)}catch(S){console.error("Screenshot load error:",S),N.error({message:t("inbox.errors.loadScreenshotFailed"),description:void 0})}finally{F(!1)}})(),b(""),()=>{h&&URL.revokeObjectURL(h)}},[a,t]);const R=async h=>{if(!(!a||!fe(a))){x(!0);try{await Hr(a._id,h),N.success({message:t("inbox.success.requestHandled",{action:t(h==="approved"?"inbox.success.actions.approved":"inbox.success.actions.rejected")}),description:void 0}),await E("requests")}catch(y){console.error("Error handling request:",y),N.error({message:t("inbox.errors.handleRequestFailed"),description:void 0})}finally{x(!1)}}},w=async h=>{if(!(!a||fe(a))){x(!0);try{await gr(a._id,{status:h,comment:g}),N.success({message:t("inbox.success.homeworkReviewed"),description:void 0}),await E("homework")}catch(y){console.error("Error reviewing homework:",y),N.error({message:t("inbox.errors.reviewHomeworkFailed"),description:void 0})}finally{x(!1)}}},I=()=>{var h;return m&&!a?null:a?fe(a)?e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"h6",children:[a.student.firstName," ",a.student.lastName]}),e.jsxs(d,{children:[t("inbox.details.email"),": ",a.student.email]}),e.jsxs(d,{children:[t("inbox.details.sent"),": ",new Date(a.createdAt).toLocaleString()]}),e.jsx(V,{sx:{my:2}}),e.jsxs(d,{children:[e.jsxs("strong",{children:[t("inbox.details.experience"),":"]})," ",a.experience||t("inbox.details.notSpecified")]}),e.jsxs(d,{children:[e.jsxs("strong",{children:[t("inbox.details.goals"),":"]})," ",a.goals||t("inbox.details.notSpecified")]}),e.jsxs(p,{mt:3,display:"flex",gap:2,children:[e.jsx(C,{variant:"contained",color:"primary",onClick:()=>R("approved"),disabled:f||a.status!=="pending",children:t("inbox.actions.approve")}),e.jsx(C,{variant:"contained",color:"secondary",onClick:()=>R("rejected"),disabled:f||a.status!=="pending",children:t("inbox.actions.reject")})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"h5",gutterBottom:!0,children:((h=a.schedule)==null?void 0:h.title)||t("inbox.list.untitled")}),e.jsxs(d,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,children:[t("inbox.details.student"),": ",a.student.firstName," ",a.student.lastName]}),e.jsx(V,{sx:{my:2}}),a.text&&e.jsxs(p,{mb:2,children:[e.jsxs(d,{variant:"h6",children:[t("inbox.details.responseText"),":"]}),e.jsx(d,{sx:{whiteSpace:"pre-wrap",p:1,bgcolor:"action.hover",borderRadius:1},children:a.text})]}),a.hasScreenshot&&e.jsxs(p,{mb:2,children:[e.jsxs(d,{variant:"h6",children:[t("inbox.details.screenshot"),":"]}),v&&e.jsxs(p,{sx:{display:"flex",alignItems:"center",my:2},children:[e.jsx(se,{size:24,sx:{mr:2}})," ",t("inbox.loading")]}),l&&!v&&e.jsx(Ne,{href:l,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:l,alt:t("inbox.details.screenshotAlt"),style:{maxWidth:"100%",height:"auto",borderRadius:"8px",border:"1px solid #ddd",display:"block",cursor:"pointer"}})})]}),e.jsx(V,{sx:{my:2}}),e.jsxs(d,{variant:"h6",children:[t("inbox.details.feedback"),":"]}),e.jsx(T,{fullWidth:!0,multiline:!0,rows:4,label:t("inbox.details.commentLabel"),value:g,onChange:y=>b(y.target.value),margin:"normal",disabled:f}),e.jsxs(p,{mt:2,display:"flex",gap:2,children:[e.jsx(C,{variant:"contained",color:"success",onClick:()=>w("approved"),disabled:f,children:t("inbox.actions.approve")}),e.jsx(C,{variant:"contained",color:"error",onClick:()=>w("rejected"),disabled:f,children:t("inbox.actions.sendForRevision")})]})]}):e.jsx(d,{color:"text.secondary",children:t("inbox.selectItemPrompt")})};return e.jsxs(B,{sx:{py:4},children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:t("inbox.title")}),e.jsx(p,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(bt,{value:s,onChange:(h,y)=>r(y),"aria-label":"inbox tabs",children:[e.jsx(be,{label:t("inbox.tabs.requests"),value:"requests"}),e.jsx(be,{label:t("inbox.tabs.homework"),value:"homework"})]})}),e.jsxs(_,{container:!0,spacing:3,children:[e.jsx(_,{item:!0,xs:12,md:4,children:e.jsx(M,{style:{maxHeight:"80vh",overflow:"auto"},children:m?e.jsx(p,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(se,{})}):e.jsx(ut,{component:"nav",children:n.length>0?n.map(h=>{var y;return e.jsx(Z,{selected:(a==null?void 0:a._id)===h._id,onClick:()=>c(h),children:e.jsx(G,{primaryTypographyProps:{style:{fontWeight:(a==null?void 0:a._id)===h._id?"bold":"normal"}},primary:h.student?`${h.student.firstName} ${h.student.lastName}`:t("inbox.unknownStudent","Unknown Student"),secondary:fe(h)?t("inbox.list.requestSecondary",{date:new Date(h.createdAt).toLocaleDateString()}):t("inbox.list.homeworkSecondary",{title:((y=h.schedule)==null?void 0:y.title)||t("inbox.list.untitled","Без темы")})})},h._id)}):e.jsx(d,{sx:{p:2,textAlign:"center"},children:t("inbox.empty")})})})}),e.jsx(_,{item:!0,xs:12,md:8,children:e.jsx(M,{style:{padding:24,minHeight:"50vh",display:"flex",flexDirection:"column"},children:I()})})]})]})},Gr=()=>{var s;const t=i.useContext(ge);if(!t)throw new Error("useAuthUser must be used within an AuthProvider");return{userId:(s=t.user)==null?void 0:s._id,user:t.user,isAuthLoading:t.loading}},Yr=Ct(te),it={individual_lesson:"#1976D2",group_lesson:"#388E3C",homework:"#F57C00",opening_study:"#8E24AA",tournament_participation:"#D32F2F"},Kr=({events:t,onSelectEvent:s})=>e.jsx(kt,{localizer:Yr,events:t.map(r=>({...r,start:new Date(r.date),end:new Date(r.date),title:r.title,color:it[r.type]||"#000"})),startAccessor:"start",endAccessor:"end",views:["month","week","day"],popup:!0,onSelectEvent:s,style:{height:500},eventPropGetter:r=>({style:{backgroundColor:it[r.type]||"#000",color:"white"}})}),Vr=()=>{const{t}=z(),{userId:s,user:r,isAuthLoading:n}=Gr(),[o,a]=i.useState([]),[c,m]=i.useState(!0),[u,g]=i.useState(null);i.useEffect(()=>{if(!n){if(!s){m(!1);return}$e(s).then(a).catch(()=>N.error({message:t("errors.fetchSchedule"),description:void 0})).finally(()=>m(!1))}},[t,s,n]);const b=async(x,l)=>{if(!(!s||!u))try{await Ft({studentId:s,scheduleId:u._id,homeworkText:x.trim()||void 0,screenshot:l||void 0}),u.coach&&r&&await Pt({recipient:u.coach,type:"homework_submission",content:`Student ${r.firstName} submitted homework for "${u.title}"`,metadata:{scheduleId:u._id}}),N.success({message:t("studentSchedule.homeworkSentSuccess"),description:void 0}),g(null),a(j=>j.map(v=>v._id===u._id?{...v,status:"pending"}:v))}catch{N.error({message:t("errors.sendHomework"),description:void 0})}},f=i.useMemo(()=>[...o].sort((x,l)=>new Date(l.date).getTime()-new Date(x.date).getTime()),[o]);return n?e.jsx(p,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(se,{})}):e.jsxs(p,{sx:{py:4},children:[e.jsxs(B,{maxWidth:"xl",children:[e.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,children:t("studentSchedule.myScheduleTitle")}),e.jsx(M,{sx:{p:2,borderRadius:2},children:c?e.jsx(je,{variant:"rectangular",height:500}):e.jsx(Kr,{events:f,onSelectEvent:g})}),e.jsx(Nt,{schedule:f,isLoading:c,onEventSelect:g})]}),e.jsx(_t,{event:u,open:!!u,onClose:()=>g(null),onSendHomework:b})]})},Xr=()=>{const t=i.useContext(ge);if(!t)throw new Error("GuestRoute must be used within an AuthProvider");const{isAuthenticated:s,user:r,loading:n}=t;return n?e.jsx(p,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(se,{})}):s&&r?e.jsx(dt,{to:`/profile/${r._id}`,replace:!0}):e.jsx(ct,{})};function Jr(){const t=Re(),r=["/login","/register"].includes(t.pathname);return e.jsxs(e.Fragment,{children:[e.jsx(_s,{}),!r&&e.jsx(Zs,{}),e.jsxs(Ot,{children:[e.jsx($,{path:"/",element:e.jsx(ir,{})}),e.jsx($,{path:"/about",element:e.jsx(lr,{})}),e.jsx($,{path:"/achievements",element:e.jsx(cr,{})}),e.jsxs($,{element:e.jsx(Xr,{}),children:[e.jsx($,{path:"/login",element:e.jsx(Qe,{})}),e.jsx($,{path:"/register",element:e.jsx(Qe,{})})]}),e.jsx($,{path:"/analysis",element:e.jsx(Mr,{})}),e.jsx($,{path:"/verify-email",element:e.jsx(zr,{})}),e.jsx($,{path:"/coaches",element:e.jsx(qr,{})}),e.jsxs($,{element:e.jsx(hr,{}),children:[e.jsx($,{path:"/editor",element:e.jsx(at,{})}),e.jsx($,{path:"/profile",element:e.jsx(rt,{})}),e.jsx($,{path:"/profile/:userId",element:e.jsx(rt,{})},t.pathname),e.jsx($,{path:"/users",element:e.jsx(Cr,{})}),e.jsx($,{path:"/students-shedule",element:e.jsx(Vr,{})}),e.jsx($,{path:"/students",element:e.jsx(_r,{})}),e.jsx($,{path:"/puzzle-editor",element:e.jsx(at,{})}),e.jsx($,{path:"/inbox",element:e.jsx(Ur,{})})]})]})]})}function Qr(){return e.jsx(i.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(Jr,{})})}const Et=document.getElementById("root");if(!Et)throw new Error("Failed to find the root element");const Zr=Mt.createRoot(Et);Zr.render(e.jsx(i.StrictMode,{children:e.jsx(qt,{children:e.jsx(Hs,{children:e.jsx(Qr,{})})})}));
//# sourceMappingURL=index-MAAcLwRg.js.map
