var js=Object.defineProperty;var fs=(s,t,r)=>t in s?js(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var ke=(s,t,r)=>fs(s,typeof t!="symbol"?t+"":t,r);import{r as a,j as e,a as Re}from"./react-CvHEjaVo.js";import{c as bs}from"./react-dom-D1dbQIcV.js";import{c as vs}from"./zustand-CcenMFwO.js";import{i as Je}from"./i18next-D9VJDghF.js";import{B as ys}from"./i18next-http-backend-BfZSjpC0.js";import{i as Ss,u as B}from"./react-i18next-CkKBCMHl.js";import{s as N,T as Ae,F as oe,I as fe,B as ws}from"./antd-BlTqEuCW.js";import{F as Cs}from"./react-icons-C3dNpHPf.js";import{a as ks}from"./axios-DGDcxXwr.js";import{u as ne,a as Ne,O as Is,N as Ns,B as Ps,R as Fs,b as z}from"./react-router-DAJ4nj9Z.js";import{S as we,M as G,I as U,B as _s,N as Es,a as Ds,b as g,T as l,L as q,c as Ws,D as Pe,d as Y,A as Rs,e as As,f as w,g as Ms,h as Ts,i as Xe,j as J,k as Z,G as P,C as Qe,l as Ze,m as es,n as Ls,o as $,P as A,p as zs,q as $s,r as R,s as Bs,t as Ie,u as le,v as ce,w as de,x as Fe,y as T,z as _e,E as he,F as ue,H as Se,J as Hs,W as Os,K as qs,O as Us,Q as Gs,R as Ys,U as ss,V as ts,X as ae,Y as O,Z as rs,_ as Ks,$ as Me,a0 as Ee,a1 as De,a2 as Vs,a3 as Js,a4 as ns,a5 as Xs,a6 as Qs,a7 as os,a8 as as,a9 as is,aa as ls,ab as cs,ac as ds,ad as re,ae as Zs,af as et,ag as st,ah as tt,ai as rt,aj as nt,ak as ot,al as at,am as be,an as it,ao as Te,ap as lt,aq as ct,ar as dt,as as ht,at as We,au as ut,av as mt,aw as Le,ax as xt,ay as gt,az as pt,aA as ze,aB as jt,aC as ft}from"./@mui-3MJed_pA.js";import{o as bt,x as vt,y as yt,z as St,A as ve,B as wt,C as Ct,D as kt,E as It}from"./@ant-design-C-VfBzx9.js";import{S as $e,C as Be}from"./react-transition-group-BeKoZwK3.js";import{m as hs,C as us}from"./react-big-calendar-UfWM4IL3.js";import{h as X}from"./moment-C5S46NFB.js";import{C as ie}from"./chess.js-D61LfqgS.js";import{C as ms}from"./react-chessboard-D79mwW4A.js";import"./classnames-D3cBJY9G.js";import"./scheduler-CKyTKYc2.js";import"./rc-util-D5Ku-A9K.js";import"./@babel-CMUGvuMo.js";import"./rc-motion-7F911Pcj.js";import"./rc-field-form-Ca67YJgz.js";import"./@rc-component-BkgMNXlu.js";import"./rc-resize-observer-DFMm2e6H.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-input-DGPOylTk.js";import"./dayjs-QiaqYO4y.js";import"./rc-notification-BInTsVAU.js";import"./rc-pagination-HLx0QKuY.js";import"./rc-picker-CkvEmmCl.js";import"./rc-tooltip-D4KzDfr2.js";import"./rc-textarea-CWQLdOIv.js";import"./copy-to-clipboard-CfLLryBf.js";import"./toggle-selection-DGa8lynz.js";import"./cookie--_YQFYBD.js";import"./clsx-B-dksMZM.js";import"./@emotion-DfZTMBQ9.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-YPZU7XtI.js";import"./@popperjs-B2yVk2E7.js";import"./dom-helpers-10zYd2o6.js";import"./invariant-CtPH8gXt.js";import"./uncontrollable-CbeKjXrC.js";import"./react-lifecycles-compat-AfN2QaV3.js";import"./prop-types-C2eHv_HJ.js";import"./date-arithmetic-DrY26MJF.js";import"./lodash-CuwxRx_k.js";import"./react-overlays-CmJAdYyf.js";import"./@restart-DNSoxZk-.js";import"./warning-pKr2A9xR.js";import"./memoize-one-BdPwpGay.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();const Nt=vs(s=>({theme:localStorage.getItem("theme")||"light",toggleTheme:()=>s(t=>{const r=t.theme==="light"?"dark":"light";return localStorage.setItem("theme",r),{theme:r}})})),Pt=a.createContext({toggleTheme:()=>{},mode:"light"}),Ft=({children:s})=>{const{theme:t,toggleTheme:r}=Nt();return a.useEffect(()=>{document.documentElement.setAttribute("data-theme",t)},[t]),e.jsx(Pt.Provider,{value:{toggleTheme:r,mode:t},children:s})};Je.use(ys).use(Ss).init({backend:{loadPath:"/locales/{{lng}}/{{ns}}.json"},lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1},debug:!0});const _t="http://localhost:3000/api",E=ks.create({baseURL:_t,withCredentials:!0}),He=s=>s==null?void 0:s.reduce((t,r)=>t+=r,""),ge=(s,t)=>(N.error({message:"Ошибка",description:t}),Promise.reject(s));E.interceptors.request.use(s=>{const t=localStorage.getItem("token");t&&(s.headers.Authorization=`Bearer ${t}`);const r=Je.language;return r&&(s.headers["Accept-Language"]=r),s},s=>Promise.reject(s));E.interceptors.response.use(s=>s,s=>{var t,r,o,i,n;if(((t=s.response)==null?void 0:t.status)===401)return N.error({message:"Сессия истекла",description:((o=(r=s.response)==null?void 0:r.data)==null?void 0:o.message)||"Пожалуйста, войдите в систему снова."}),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login",new Promise(()=>{});if(((i=s.response)==null?void 0:i.status)!==504){if(s.message==="Network Error"||!s.response)return ge(s,"Ошибка сети или сервер недоступен. Попробуйте позже.");const h=(n=s.response)==null?void 0:n.data;let u=typeof h=="string"?h:"";if(Array.isArray(h))return ge(s,He(h));if(Array.isArray(h==null?void 0:h.data))return ge(s,He(h.data));if(h!=null&&h.detail)return ge(s,h.detail);if(h instanceof Object){const f=h.msg||Object.keys(h).reduce((p,b)=>{var y;return p+=`${b}: ${((y=h[b])==null?void 0:y[0])||h[b]} `},"");return ge(s,f)}N.error({message:"Ошибка",description:u||s.message})}return Promise.reject(s)});const Et=async s=>(await E.post("/auth/login",s)).data,Dt=async s=>{try{return(await E.post("/auth/register",s)).data}catch(t){throw console.error("Registration failed",t),t}},Oe=s=>[{required:!0,message:s("validation.required")},{validator:(t,r)=>r&&r.length>=2?Promise.resolve():Promise.reject(new Error(s("validation.name_length")))}],Wt=s=>[{required:!0,message:s("validation.required")},{type:"email",message:s("validation.invalid_email")}],Rt=s=>[{required:!0,message:s("validation.required")},{min:6,message:s("validation.password_length")}],At=({mode:s})=>{const{t}=B(),r=ne(),o=s==="login",i=async h=>{try{const{token:u,user:f}=await Et(h);localStorage.setItem("token",u),localStorage.setItem("user",JSON.stringify(f)),r("/profile",{replace:!0}),N.success({message:t("auth.success.login_title"),description:t("auth.success.welcome_back",{name:f.firstName})})}catch{N.error({message:t("auth.errors.login"),description:t("auth.errors.invalid_credentials")})}},n=async h=>{var u,f;try{const b=(await Dt(h)).email;r("/verify-email",{replace:!0,state:{email:b,firstName:h.firstName,lastName:h.lastName}}),N.success({message:t("register.success.title"),description:t("register.success.description")})}catch(p){N.error({message:t("register.error.title"),description:((f=(u=p.response)==null?void 0:u.data)==null?void 0:f.msg)||t("register.error.description")})}};return e.jsxs("div",{className:"auth-form-container",children:[e.jsxs("div",{className:"auth-header",onClick:()=>r("/"),children:[e.jsx(Cs,{className:"auth-header__icon"}),e.jsx(Ae.Title,{level:4,className:"auth-header__brand",children:t("common.brand")})]}),e.jsx(Ae.Title,{level:3,className:"auth-header__title",children:t(o?"auth.sign_in":"register.title")}),e.jsxs(oe,{name:s,onFinish:o?i:n,layout:"vertical",className:"auth-form-body",size:"large",autoComplete:"off",children:[!o&&e.jsxs(e.Fragment,{children:[e.jsx(oe.Item,{label:e.jsx("span",{className:"auth-form-label",children:t("register.name")}),name:"firstName",rules:Oe(t),children:e.jsx(fe,{placeholder:t("register.placeholder.name")})}),e.jsx(oe.Item,{label:e.jsx("span",{className:"auth-form-label",children:t("register.lastName")}),name:"lastName",rules:Oe(t),children:e.jsx(fe,{placeholder:t("register.placeholder.lastName")})})]}),e.jsx(oe.Item,{label:e.jsx("span",{className:"auth-form-label",children:t("common.email")}),name:"email",rules:Wt(t),children:e.jsx(fe,{placeholder:t("common.placeholder.email")})}),e.jsx(oe.Item,{label:e.jsx("span",{className:"auth-form-label",children:t("common.password")}),name:"password",rules:Rt(t),children:e.jsx(fe.Password,{placeholder:t("common.placeholder.password")})}),e.jsx(oe.Item,{children:e.jsx(ws,{type:"primary",htmlType:"submit",className:"auth-form-button",block:!0,children:t(o?"auth.sign_in":"register.submit")})})]}),e.jsx("div",{className:"auth-form-footer",children:o?e.jsxs(e.Fragment,{children:[t("auth.no_account")," ",e.jsx("a",{className:"auth-form-link",onClick:()=>r("/register"),children:t("auth.sign_up")})]}):e.jsxs(e.Fragment,{children:[t("register.haveAccount")," ",e.jsx("a",{className:"auth-form-link",onClick:()=>r("/login"),children:t("register.login")})]})})]})},qe=()=>{const t=Ne().pathname.includes("register")?"register":"login";return e.jsx("div",{className:"auth-page-wrapper",children:e.jsx(At,{mode:t})})},Mt=({className:s})=>{const{i18n:t}=B(),r=o=>{const i=o.target.value;t.changeLanguage(i)};return e.jsxs(we,{value:t.language,onChange:r,size:"small",className:s,style:{color:"black",borderColor:"black"},children:[e.jsx(G,{value:"en",children:"EN"}),e.jsx(G,{value:"pl",children:"PL"}),e.jsx(G,{value:"uk",children:"UA"})]})},Tt=async s=>(await E.post("/notifications",s)).data,Lt=async()=>(await E.get("/notifications")).data,zt=async s=>(await E.patch("/notifications",{},{params:{notification_id:s}})).data,$t=async s=>(await E.delete("/notifications",{params:{notification_id:s}})).data,Bt=({navigateToRequests:s})=>{const[t,r]=a.useState([]),[o,i]=a.useState(null),n=!!o,h=t.filter(c=>!c.read).length,u=async()=>{try{const c=await Lt();r(Array.isArray(c)?c:[])}catch(c){console.error("Ошибка при получении уведомлений:",c)}};a.useEffect(()=>{u();const c=setInterval(u,3e4);return()=>clearInterval(c)},[]);const f=c=>{i(c.currentTarget),u()},p=()=>{i(null)},b=async(c,m)=>{c.stopPropagation();try{await $t(m),r(j=>j.filter(C=>C._id!==m))}catch(j){console.error("Ошибка при удалении уведомления:",j)}},y=c=>{c.read||(zt(c._id),r(m=>m.map(j=>j._id===c._id?{...j,read:!0}:j))),(c.type==="request"||c.type==="homework_submission")&&s(),p()},x=()=>{s(),p()};return e.jsxs("div",{children:[e.jsx(U,{color:"inherit",onClick:f,children:e.jsx(_s,{badgeContent:h,color:"error",children:e.jsx(Es,{})})}),e.jsxs(Ds,{anchorEl:o,open:n,onClose:p,PaperProps:{style:{maxHeight:300,width:"400px"}},children:[e.jsx(g,{sx:{p:2,borderBottom:"1px solid #eee"},children:e.jsx(l,{variant:"h6",children:"Уведомления"})}),t.length===0?e.jsx(G,{disabled:!0,children:"Уведомлений нет"}):t.map(c=>e.jsxs(G,{onClick:()=>y(c),sx:{bgcolor:c.read?"transparent":"action.hover",whiteSpace:"normal",alignItems:"flex-start"},children:[e.jsx(q,{primary:c.content,secondary:new Date(c.createdAt).toLocaleString()}),e.jsx(Ws,{children:e.jsx(U,{edge:"end","aria-label":"delete",onClick:m=>b(m,c._id),children:e.jsx(Pe,{fontSize:"small"})})})]},c._id)),e.jsx(Y,{}),e.jsx(G,{onClick:x,children:e.jsx(q,{primary:"Посмотреть все во 'Входящих'",sx:{textAlign:"center"}})})]})]})},Ht=()=>{var C,_,D;const[s,t]=a.useState(!1),r=ne(),{t:o}=B(),i=localStorage.getItem("user");let n=null;try{i&&i!=="undefined"&&i!=="null"&&(n=JSON.parse(i))}catch(v){console.error("Error parsing user from localStorage:",v),n=null}const u=!!localStorage.getItem("token")&&!!n,f=(C=n==null?void 0:n.roles)==null?void 0:C.includes("admin"),p=(_=n==null?void 0:n.roles)==null?void 0:_.includes("coach"),b=(D=n==null?void 0:n.roles)==null?void 0:D.includes("student"),y=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t(!1),r("/login")},x=()=>{t(!1),r("/register")},c=()=>{r("/inbox")},m=v=>()=>{t(v)},j=v=>{t(!1),r(v)};return e.jsxs(e.Fragment,{children:[e.jsx(Rs,{position:"static",className:"navbar-appbar",children:e.jsxs(As,{className:"navbar-toolbar",children:[e.jsx(l,{variant:"h6",className:"navbar-title",onClick:()=>r("/"),children:o("navbar.chessSchool")}),e.jsxs(g,{className:"navbar-controls",children:[!u&&e.jsxs(g,{sx:{display:{xs:"none",md:"flex"},alignItems:"center"},children:[e.jsx(w,{color:"inherit",onClick:()=>r("/login"),children:o("navbar.login")}),e.jsx(w,{variant:"contained",color:"secondary",onClick:()=>r("/register"),sx:{ml:1},children:o("navbar.register")})]}),u&&e.jsx(Bt,{navigateToRequests:c}),e.jsx(U,{edge:"end",color:"inherit","aria-label":"menu",onClick:m(!0),className:"navbar-menu-button",children:e.jsx(Ms,{})})]})]})}),e.jsx(Ts,{anchor:"right",open:s,onClose:m(!1),children:e.jsxs(g,{className:"navbar-drawer",children:[e.jsx(g,{className:"drawer-header",children:e.jsx(U,{onClick:m(!1),className:"close-button",children:e.jsx(bt,{className:"close-icon"})})}),e.jsxs(Xe,{className:"menu-list",children:[e.jsxs(J,{onClick:()=>j("/"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(vt,{})}),e.jsx(q,{primary:o("navbar.home")})]}),e.jsxs(J,{onClick:()=>j("/about"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(yt,{})}),e.jsx(q,{primary:o("navbar.aboutUs")})]}),e.jsxs(J,{onClick:()=>j("/achievements"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(St,{})}),e.jsx(q,{primary:o("navbar.achievements")})]}),e.jsxs(J,{onClick:()=>j("/coaches"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(ve,{})}),e.jsx(q,{primary:o("navbar.coaches")})]}),u&&e.jsx(Y,{sx:{borderColor:"rgba(255, 255, 255, 0.12)"}}),u&&e.jsxs(e.Fragment,{children:[e.jsxs(J,{onClick:()=>j("/analysis"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(wt,{})}),e.jsx(q,{primary:o("navbar.chessGame")})]}),e.jsxs(J,{onClick:()=>j("/profile"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(Ct,{})}),e.jsx(q,{primary:o("navbar.profile")})]})]}),(p||f||b)&&e.jsx(Y,{sx:{borderColor:"rgba(255, 255, 255, 0.12)"}}),(p||f)&&e.jsxs(J,{onClick:()=>j("/students"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(ve,{})}),e.jsx(q,{primary:o("navbar.students")})]}),(p||f||b)&&e.jsxs(J,{onClick:()=>j("/students-shedule"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(ve,{})}),e.jsx(q,{primary:o("navbar.students-shedule")})]}),f&&e.jsxs(J,{onClick:()=>j("/users"),className:"menu-item",children:[e.jsx(Z,{children:e.jsx(ve,{})}),e.jsx(q,{primary:o("navbar.users")})]})]}),e.jsxs(g,{className:"drawer-bottom-actions",children:[u?e.jsxs(w,{onClick:y,className:"logout-button",children:[e.jsx(kt,{}),o("navbar.logout")]}):e.jsxs(w,{onClick:x,className:"get-started-button",variant:"contained",color:"secondary",children:[e.jsx(It,{style:{marginRight:"8px"}}),o("navbar.getStarted")]}),e.jsx(Mt,{className:"language-switcher"})]})]})})]})},Ot=async()=>(await E.get("/coaches")).data,qt=async s=>(await E.post("/auth/coaches-by-email",{emails:s})).data,Ut=async(s,t)=>(await E.get("/trainer/student",{params:{coachEmail:s,studentId:t}})).data,Gt=async s=>(await E.get("/trainer/students",{params:{coachEmail:s}})).data,Yt=async(s,t)=>{await E.delete("/trainer/remove-student",{params:{coachEmail:s,studentId:t}})},Kt=()=>{const{t:s}=B(),t=ne(),[r,o]=a.useState([]);return a.useEffect(()=>{(async()=>{const n=await qt(["ad3@example.com","ad7@example.com"]);o(n)})()},[]),e.jsxs(g,{py:10,px:2,sx:{backgroundColor:"#111"},children:[e.jsx(l,{variant:"h4",fontWeight:"bold",textAlign:"center",mb:6,children:s("homePage.coaches.title")}),e.jsx(P,{container:!0,spacing:4,justifyContent:"center",children:r.map(i=>e.jsx(P,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(Qe,{sx:{backgroundColor:"#1a1a1a",color:"white",borderRadius:3,boxShadow:4,position:"relative","&:hover .hoverAction":{opacity:1}},children:[e.jsx(Ze,{component:"img",height:"200",image:i.photoUrl||"/images/default-avatar.png",alt:`${i.firstName} ${i.lastName}`}),e.jsxs(es,{children:[e.jsxs(l,{variant:"h6",children:[i.firstName," ",i.lastName]}),e.jsx(l,{variant:"body2",color:"gray"}),e.jsx(g,{mt:1,children:[...Array(5)].map((n,h)=>e.jsx(Ls,{sx:{color:"#FFD700",fontSize:20}},h))})]}),e.jsx(g,{className:"hoverAction",sx:{position:"absolute",bottom:16,left:0,right:0,textAlign:"center",opacity:0,transition:"0.3s"},children:e.jsx(w,{variant:"contained",onClick:()=>t("/coaches",{state:{coach:i}}),sx:{backgroundColor:"#FFD700",color:"black"},children:s("homePage.coaches.selectCoach")})})]})},i._id))})]})},Vt=()=>{const{t:s}=B(),t=ne(),r=new Date().getFullYear(),o=[{icon:"🎯",key:"analytics",descKey:"descAnalytics"},{icon:"🧠",key:"memory",descKey:"descMemory"},{icon:"🏆",key:"spirit",descKey:"descSpirit"}],i=[{num:"1",titleKey:"step1Title",descKey:"step1Desc"},{num:"2",titleKey:"step2Title",descKey:"step2Desc"},{num:"3",titleKey:"step3Title",descKey:"step3Desc"}],n=[{type:"individual",icon:e.jsx(zs,{sx:{fontSize:40,mb:2,color:"#FFD700"}}),descKey:"descIndividual",buttonKey:"schedule",path:"/coaches"},{type:"group",icon:e.jsx($s,{sx:{fontSize:40,mb:2,color:"#FFD700"}}),descKey:"descGroup",buttonKey:"learnMore",path:"/classes"}];return e.jsxs(g,{sx:{backgroundColor:"#0e0e0e",color:"white",fontFamily:"'Inter', sans-serif"},children:[e.jsx(g,{sx:{backgroundImage:{xs:'url("/images/chess-cinematic-mb.jpg")',sm:'url("/images/chess-cinematic-tablet.jpg")',lg:'url("/images/chess-cinematic-lg.jpg")'},backgroundSize:"cover",backgroundPosition:"center",py:{xs:10,md:20},textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",px:2},children:e.jsxs($,{maxWidth:"md",children:[e.jsx(l,{variant:"h2",component:"h1",fontWeight:"bold",children:s("homePage.hero.title")}),e.jsx(l,{variant:"h5",mt:2,sx:{color:"rgba(255, 255, 255, 0.9)"},children:s("homePage.hero.subtitle")}),e.jsx(w,{variant:"contained",size:"large",onClick:()=>t("/coaches"),sx:{mt:4,px:5,py:1.5,borderRadius:"30px",boxShadow:"0px 8px 20px rgba(255, 215, 0, 0.3)",backgroundColor:"#FFD700",color:"black",fontWeight:"bold","&:hover":{backgroundColor:"#FFC107",transform:"translateY(-2px)",boxShadow:"0px 10px 25px rgba(255, 215, 0, 0.4)"},transition:"all 0.3s ease"},startIcon:e.jsx("span",{style:{fontSize:"1.5rem"},children:"♟️"}),children:s("homePage.hero.start")})]})}),e.jsxs($,{maxWidth:"lg",sx:{py:10},children:[e.jsx(l,{variant:"h3",component:"h2",fontWeight:"bold",textAlign:"center",mb:8,children:s("homePage.why.title")}),e.jsx(P,{container:!0,spacing:4,justifyContent:"center",children:o.map(({icon:h,key:u,descKey:f})=>e.jsx(P,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(A,{elevation:6,sx:{p:4,textAlign:"center",borderRadius:4,backgroundColor:"rgba(255,255,255,0.05)",backdropFilter:"blur(10px)",transition:"all 0.3s ease",color:"white",height:"100%","&:hover":{transform:"translateY(-10px)",backgroundColor:"rgba(255,255,255,0.1)"}},children:[e.jsx(g,{fontSize:"3.5rem",children:h}),e.jsx(l,{variant:"h5",component:"h3",mt:2,fontWeight:"bold",children:s(`homePage.why.${u}`)}),e.jsx(l,{mt:1.5,sx:{color:"rgba(255, 255, 255, 0.7)"},children:s(`homePage.why.${f}`)})]})},u))})]}),e.jsx(g,{sx:{py:5},children:e.jsx(Kt,{})}),e.jsx(g,{sx:{py:10,backgroundColor:"#121212"},children:e.jsxs($,{maxWidth:"lg",children:[e.jsx(l,{variant:"h3",component:"h2",fontWeight:"bold",textAlign:"center",mb:8,children:s("homePage.howItWorks.title")}),e.jsx(P,{container:!0,spacing:5,children:i.map(({num:h,titleKey:u,descKey:f})=>e.jsx(P,{item:!0,xs:12,md:4,children:e.jsxs(g,{sx:{textAlign:{xs:"center",md:"left"}},children:[e.jsx(l,{variant:"h1",component:"div",fontWeight:"bold",sx:{color:"#FFD700",opacity:.5},children:h}),e.jsx(l,{variant:"h5",component:"h3",fontWeight:"bold",mt:1,children:s(`homePage.howItWorks.${u}`)}),e.jsx(l,{mt:1.5,sx:{color:"rgba(255, 255, 255, 0.7)"},children:s(`homePage.howItWorks.${f}`)})]})},h))})]})}),e.jsxs($,{maxWidth:"lg",sx:{py:10},children:[e.jsx(l,{variant:"h3",component:"h2",fontWeight:"bold",textAlign:"center",mb:8,children:s("homePage.formats.title")}),e.jsx(P,{container:!0,spacing:4,justifyContent:"center",children:n.map(({type:h,icon:u,descKey:f,buttonKey:p,path:b})=>e.jsx(P,{item:!0,xs:12,md:5,children:e.jsxs(A,{elevation:6,sx:{p:4,backgroundColor:"#1c1c1c",color:"white",borderRadius:4,textAlign:"center",transition:"background-color 0.3s ease",display:"flex",flexDirection:"column",alignItems:"center",height:"100%","&:hover":{backgroundColor:"#2a2a2a"}},children:[u,e.jsx(l,{variant:"h5",component:"h3",fontWeight:"bold",children:s(`homePage.formats.${h}`)}),e.jsx(l,{mt:1.5,sx:{color:"rgba(255, 255, 255, 0.7)",flexGrow:1},children:s(`homePage.formats.${f}`)}),e.jsxs(w,{variant:"outlined",onClick:()=>t(b),sx:{mt:3,color:"#FFD700",borderColor:"#FFD700",borderRadius:"20px","&:hover":{borderColor:"#FFC107",backgroundColor:"rgba(255, 215, 0, 0.1)"}},children:[s(`homePage.formats.${p}`)," →"]})]})},h))})]}),e.jsx(g,{component:"footer",py:6,px:2,sx:{backgroundColor:"#0b0b0b",color:"gray"},children:e.jsxs($,{maxWidth:"lg",children:[e.jsxs(P,{container:!0,spacing:5,children:[e.jsxs(P,{item:!0,xs:12,sm:4,children:[e.jsx(l,{variant:"h6",fontWeight:"bold",sx:{color:"white"},children:s("homePage.footer.name")}),e.jsx(l,{variant:"body2",sx:{mt:1,color:"rgba(255,255,255,0.5)"},children:s("homePage.footer.desc")})]}),e.jsxs(P,{item:!0,xs:6,sm:2,children:[e.jsx(l,{fontWeight:"bold",sx:{color:"white"},children:s("homePage.footer.company")}),e.jsx(w,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.about")}),e.jsx(w,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.blog")}),e.jsx(w,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.coaches")})]}),e.jsxs(P,{item:!0,xs:6,sm:2,children:[e.jsx(l,{fontWeight:"bold",sx:{color:"white"},children:s("homePage.footer.resources")}),e.jsx(w,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.faq")}),e.jsx(w,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.contact")})]}),e.jsxs(P,{item:!0,xs:6,sm:2,children:[e.jsx(l,{fontWeight:"bold",sx:{color:"white"},children:s("homePage.footer.legal")}),e.jsx(w,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.privacy")}),e.jsx(w,{size:"small",sx:{color:"gray",display:"block",p:"6px 0"},children:s("homePage.footer.terms")})]})]}),e.jsx(Y,{sx:{my:4,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsx(l,{variant:"body2",textAlign:"center",sx:{color:"rgba(255,255,255,0.4)"},children:s("homePage.footer.copyright",{year:r})})]})})]})},Jt=()=>{const{t:s}=B(),t=ne(),r=a.useMemo(()=>s("aboutPage.phrases",{returnObjects:!0})||[],[s]),o=a.useMemo(()=>s("aboutPage.testimonials.reviews",{returnObjects:!0})||[],[s]),i=a.useMemo(()=>s("aboutPage.ourCoaches.coaches",{returnObjects:!0})||[],[s]),n=a.useMemo(()=>s("aboutPage.whyUs.cards",{returnObjects:!0})||[],[s]),h=a.useMemo(()=>s("aboutPage.howItWorks.steps",{returnObjects:!0})||[],[s]),u=a.useMemo(()=>s("aboutPage.mission.points",{returnObjects:!0})||[],[s]),[f,p]=a.useState(0),[b,y]=a.useState(0);return a.useEffect(()=>{if(r.length===0||o.length===0)return;const x=setInterval(()=>{p(m=>(m+1)%r.length)},4e3),c=setInterval(()=>{y(m=>(m+1)%o.length)},5e3);return()=>{clearInterval(x),clearInterval(c)}},[r.length,o.length]),e.jsxs(g,{sx:{bgcolor:"#0e0e0e",color:"white"},children:[e.jsx(g,{sx:{position:"relative",py:{xs:10,md:15},textAlign:"center",backgroundImage:'linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.8)), url("/images/chess-cinematic-lg.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:e.jsxs($,{maxWidth:"md",children:[e.jsx(l,{variant:"h2",component:"h1",fontWeight:"bold",sx:{textTransform:"uppercase",letterSpacing:"2px"},children:s("aboutPage.mainTitle")}),e.jsx(g,{sx:{height:"2.5em",my:2},children:e.jsx($e,{mode:"out-in",children:e.jsx(Be,{timeout:300,classNames:"fade",children:e.jsx(l,{variant:"h5",sx:{color:"#FFD700",fontStyle:"italic"},children:r.length>0?r[f]:""})},f)})}),e.jsxs(R,{direction:{xs:"column",sm:"row"},justifyContent:"center",spacing:2,mt:4,children:[e.jsx(w,{variant:"contained",onClick:()=>t("/register"),size:"large",sx:{bgcolor:"#FFD700",color:"black",borderRadius:"30px",px:5,"&:hover":{bgcolor:"#FFC107"}},children:s("aboutPage.ctaStudent")}),e.jsx(w,{variant:"outlined",onClick:()=>t("/coaches"),size:"large",sx:{color:"white",borderColor:"rgba(255,255,255,0.5)",borderRadius:"30px",px:5,"&:hover":{borderColor:"white",bgcolor:"rgba(255,255,255,0.1)"}},children:s("aboutPage.ctaCoaches")})]})]})}),e.jsxs($,{maxWidth:"lg",sx:{py:8},children:[e.jsxs(g,{sx:{textAlign:"center",my:8},children:[e.jsxs(R,{direction:"row",spacing:2,justifyContent:"center",alignItems:"center",sx:{color:"#FFD700",mb:1},children:[e.jsx(Bs,{fontSize:"large"}),e.jsx(l,{variant:"h4",component:"h2",fontWeight:"bold",children:s("aboutPage.mission.title")})]}),e.jsx(l,{variant:"h6",sx:{maxWidth:720,mx:"auto",color:"rgba(255,255,255,0.7)",mb:3},children:s("aboutPage.mission.subtitle")}),e.jsx(R,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"center",children:u.map((x,c)=>e.jsxs(R,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(Ie,{sx:{color:"success.main"}}),e.jsx(l,{children:x})]},c))})]}),e.jsx(Y,{sx:{my:8,borderColor:"rgba(255,255,255,0.2)"}}),e.jsxs(g,{sx:{my:8},children:[e.jsx(l,{variant:"h4",component:"h2",fontWeight:"bold",align:"center",sx:{mb:6},children:s("aboutPage.whyUs.title")}),e.jsx(P,{container:!0,spacing:4,children:n.map((x,c)=>e.jsx(P,{item:!0,xs:12,md:4,children:e.jsxs(A,{sx:{p:4,bgcolor:"#1c1c1c",borderRadius:4,textAlign:"center",height:"100%",transition:"all 0.3s ease","&:hover":{transform:"translateY(-10px)",boxShadow:"0 10px 20px rgba(255,215,0,0.15)"}},children:[e.jsx(l,{fontSize:"3rem",children:x.icon}),e.jsx(l,{variant:"h6",fontWeight:"bold",my:1,children:x.title}),e.jsx(l,{sx:{color:"rgba(255,255,255,0.6)"},children:x.description})]})},c))})]}),e.jsxs(g,{sx:{my:8,py:6,bgcolor:"#1c1c1c",borderRadius:4},children:[e.jsx(l,{variant:"h4",component:"h2",fontWeight:"bold",align:"center",sx:{mb:6},children:s("aboutPage.howItWorks.title")}),e.jsx(P,{container:!0,spacing:4,sx:{px:4},children:h.map((x,c)=>e.jsx(P,{item:!0,xs:12,md:4,children:e.jsxs(R,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(l,{variant:"h2",fontWeight:"bold",sx:{color:"#FFD700",opacity:.5},children:`0${c+1}`}),e.jsxs(g,{children:[e.jsx(l,{variant:"h6",fontWeight:"bold",children:x.step}),e.jsx(l,{sx:{color:"rgba(255,255,255,0.6)"},children:x.desc})]})]})},c))})]}),e.jsxs(P,{container:!0,spacing:8,sx:{my:8},children:[e.jsxs(P,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"h4",component:"h2",fontWeight:"bold",sx:{mb:3},children:s("aboutPage.testimonials.title")}),e.jsx(A,{sx:{p:4,bgcolor:"#1c1c1c",borderRadius:4,minHeight:180},children:e.jsx($e,{children:e.jsx(Be,{timeout:300,classNames:"fade",children:e.jsx(g,{children:o.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(l,{fontStyle:"italic",fontSize:"1.1rem",sx:{color:"rgba(255,255,255,0.8)"},children:["“",o[b].quote,"”"]}),e.jsxs(l,{fontWeight:"bold",mt:2,sx:{color:"#FFD700"},children:["— ",o[b].name]})]}):null})},b)})})]}),e.jsxs(P,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"h4",component:"h2",fontWeight:"bold",sx:{mb:3},children:s("aboutPage.ourCoaches.title")}),e.jsxs(R,{spacing:2,children:[i.map((x,c)=>e.jsxs(A,{sx:{p:2,bgcolor:"#1c1c1c",borderRadius:2},children:[e.jsx(l,{variant:"h6",fontWeight:"bold",children:x.name}),e.jsx(l,{variant:"body2",fontStyle:"italic",sx:{color:"rgba(255,255,255,0.6)"},children:x.quote})]},c)),e.jsxs(w,{variant:"text",onClick:()=>t("/coaches"),sx:{color:"#FFD700",alignSelf:"flex-start"},children:[s("aboutPage.ourCoaches.viewAll")," →"]})]})]})]}),e.jsx(Y,{sx:{my:8,borderColor:"rgba(255,255,255,0.2)"}}),e.jsx(l,{align:"center",fontWeight:"bold",variant:"h5",component:"p",sx:{fontStyle:"italic"},children:s("aboutPage.finalSlogan")})]})]})},Xt=()=>e.jsx($,{children:e.jsx(l,{variant:"h3",gutterBottom:!0,children:"Achievments"})}),Qt=()=>!!localStorage.getItem("token"),Zt=()=>Qt()?e.jsx(Is,{}):e.jsx(Ns,{to:"/login"}),er=async()=>(await E.get("/auth/profile")).data,Ue=async s=>{const t=new FormData;return Object.keys(s).forEach(o=>{const i=s[o];i&&t.append(o,i)}),(await E.put("/auth/profile",t)).data},sr=s=>{const t=E.defaults.baseURL;return t?`${t}/auth/avatar/${s}`:"/default-avatar.png"},tr=async s=>(await E.get(`/player/${s}`)).data,rr=({user:s,onClose:t})=>{const{t:r}=B(),[o,i]=a.useState(s.firstName),[n,h]=a.useState(s.lastName),[u,f]=a.useState(s.email),[p,b]=a.useState(""),[y,x]=a.useState(""),[c,m]=a.useState(""),[j,C]=a.useState(!1),[_,D]=a.useState(null),[v,I]=a.useState(s.photoUrl),d=k=>{var H;const W=(H=k.target.files)==null?void 0:H[0];W&&(D(W),I(URL.createObjectURL(W)))},S=async()=>{try{if(!j)await Ue({firstName:o,lastName:n,email:u,avatar:_||void 0}),N.success({message:r("profile_edit.updated"),description:void 0});else{if(!p||y!==c){N.error({message:r("profile_edit.passwordMismatch"),description:void 0});return}await Ue({currentPassword:p,newPassword:y,avatar:_||void 0}),N.success({message:r("profile_edit.passwordChanged"),description:void 0})}t(),window.location.reload()}catch(k){console.error(k),N.error({message:r("profile_edit.updateFailed"),description:void 0})}};return e.jsxs(le,{open:!0,onClose:t,fullWidth:!0,maxWidth:"sm",children:[e.jsx(ce,{children:r("profile_edit.editTitle")}),e.jsxs(de,{children:[e.jsxs(g,{display:"flex",alignItems:"center",flexDirection:"column",mb:2,children:[e.jsx(Fe,{src:v,sx:{width:96,height:96,mb:1}}),e.jsxs(w,{variant:"text",size:"small",component:"label",children:[r("profile_edit.uploadAvatar"),e.jsx("input",{hidden:!0,accept:"image/*",type:"file",onChange:d})]})]}),e.jsx(T,{margin:"dense",label:r("profile_edit.firstName"),fullWidth:!0,value:o,onChange:k=>i(k.target.value)}),e.jsx(T,{margin:"dense",label:r("profile_edit.lastName"),fullWidth:!0,value:n,onChange:k=>h(k.target.value)}),e.jsx(T,{margin:"dense",label:r("profile_edit.email"),fullWidth:!0,value:u,onChange:k=>f(k.target.value)}),!j&&e.jsx(g,{mt:1,children:e.jsx(_e,{component:"button",variant:"body2",onClick:()=>C(!0),children:r("profile_edit.changePassword")})}),j&&e.jsxs(g,{mt:2,children:[e.jsx(T,{margin:"dense",label:r("profile_edit.currentPassword"),fullWidth:!0,type:"password",value:p,onChange:k=>b(k.target.value)}),e.jsx(T,{margin:"dense",label:r("profile_edit.newPassword"),fullWidth:!0,type:"password",value:y,onChange:k=>x(k.target.value)}),e.jsx(T,{margin:"dense",label:r("profile_edit.confirmPassword"),fullWidth:!0,type:"password",value:c,onChange:k=>m(k.target.value)})]})]}),e.jsxs(he,{children:[e.jsx(w,{onClick:t,children:r("profile_edit.cancel")}),e.jsx(w,{variant:"contained",onClick:S,children:r("profile_edit.save")})]})]})},nr={bullet:e.jsx(Os,{}),blitz:e.jsx(qs,{}),rapid:e.jsx(Us,{}),classic:e.jsx(Gs,{})},or=()=>{const{t:s}=B(),[t,r]=a.useState(null),[o,i]=a.useState(null),[n,h]=a.useState(!0),[u,f]=a.useState(null),[p,b]=a.useState(!1),y=ne();a.useEffect(()=>{(async()=>{try{const m=await er(),j=await tr(m._id);r(j.user),i({bullet:j.bullet,blitz:j.blitz,rapid:j.rapid,classic:j.classic})}catch{f(s("profile.errorLoadingProfile"))}finally{h(!1)}})()},[s,y]);const x=()=>{localStorage.clear(),y("/login")};return n?e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",bgcolor:"#0e0e0e"},children:e.jsx(ue,{sx:{color:"#FFD700"}})}):u?e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",bgcolor:"#0e0e0e"},children:e.jsx(l,{color:"error",children:u})}):e.jsx(g,{sx:{bgcolor:"#0e0e0e",color:"white",minHeight:"100vh",py:5},children:e.jsx($,{maxWidth:"lg",children:t&&e.jsxs(e.Fragment,{children:[e.jsxs(g,{sx:{textAlign:"center",mb:5},children:[e.jsx(l,{variant:"h2",component:"h1",fontWeight:"bold",children:s("profile.title")}),e.jsx(l,{variant:"h6",sx:{mt:1,color:"rgba(255, 255, 255, 0.7)"},children:s("profile.subtitle")})]}),e.jsx(A,{sx:{p:{xs:2,md:4},mb:4,bgcolor:"#1c1c1c",borderRadius:4,color:"white"},children:e.jsxs(R,{direction:{xs:"column",md:"row"},spacing:4,alignItems:"center",children:[e.jsx(Fe,{src:sr(t._id),sx:{width:120,height:120,border:"4px solid #FFD700"}}),e.jsxs(g,{sx:{flexGrow:1,textAlign:{xs:"center",md:"left"}},children:[e.jsxs(l,{variant:"h4",fontWeight:"bold",children:[t.firstName," ",t.lastName]}),e.jsx(l,{sx:{color:"rgba(255, 255, 255, 0.5)",textTransform:"capitalize",mb:1},children:t.roles[0]||"User"}),e.jsx(l,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.7)"},children:t.email}),e.jsxs(l,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:[s("profile.registrationDate"),": ",new Date(t.registrationDate).toLocaleDateString()]})]}),e.jsxs(R,{direction:"row",spacing:2,sx:{mt:{xs:3,md:0}},children:[e.jsx(w,{variant:"outlined",onClick:()=>b(!0),startIcon:e.jsx(Se,{}),sx:{color:"#FFD700",borderColor:"#FFD700"},children:s("profile.editProfile")}),e.jsx(w,{variant:"contained",color:"error",onClick:x,startIcon:e.jsx(Hs,{}),children:s("profile.logout")})]})]})}),o&&e.jsxs(A,{sx:{p:{xs:2,md:4},mb:4,bgcolor:"#1c1c1c",borderRadius:4,color:"white"},children:[e.jsx(l,{variant:"h5",fontWeight:"bold",sx:{mb:3},children:s("profile.playerStats")}),e.jsx(P,{container:!0,spacing:3,children:Object.entries(o).map(([c,m])=>e.jsx(P,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(A,{sx:{p:2,borderRadius:3,textAlign:"center",bgcolor:"#2a2a2a",height:"100%"},children:[e.jsxs(R,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{color:"#FFD700"},children:[nr[c],e.jsx(l,{variant:"h6",fontWeight:"bold",textTransform:"capitalize",children:s(`profile.${c}`)})]}),e.jsx(l,{variant:"h3",fontWeight:"bold",my:1,children:m.rating}),e.jsxs(l,{variant:"body2",color:"text.secondary",sx:{color:"rgba(255,255,255,0.5)",mb:2},children:[m.gamesPlayed," ",s("profile.games")]}),e.jsxs(R,{direction:"row",justifyContent:"space-around",spacing:1,children:[e.jsxs(g,{children:[e.jsx(l,{color:"success.main",fontWeight:"bold",children:m.gamesWon}),e.jsx(l,{variant:"caption",sx:{color:"rgba(255,255,255,0.5)"},children:s("profile.win")})]}),e.jsxs(g,{children:[e.jsx(l,{fontWeight:"bold",children:m.gamesDrawn}),e.jsx(l,{variant:"caption",sx:{color:"rgba(255,255,255,0.5)"},children:s("profile.draw")})]}),e.jsxs(g,{children:[e.jsx(l,{color:"error.main",fontWeight:"bold",children:m.gamesLost}),e.jsx(l,{variant:"caption",sx:{color:"rgba(255,255,255,0.5)"},children:s("profile.loss")})]})]})]})},c))})]}),p&&e.jsx(rr,{user:t,onClose:()=>b(!1)})]})})})},ar=({columns:s,data:t})=>{const[r,o]=a.useState(""),[i,n]=a.useState(10),[h,u]=a.useState(0),f=x=>{o(x.target.value),u(0)},p=(x,c)=>{u(c)},b=x=>{n(parseInt(x.target.value,10)),u(0)},y=t.filter(x=>s.some(c=>{if(c.field==="actions")return!1;const m=x[c.field];return m==null?void 0:m.toString().toLowerCase().includes(r.toLowerCase())}));return e.jsxs(A,{children:[e.jsx(T,{fullWidth:!0,label:"Поиск",variant:"outlined",value:r,onChange:f,style:{padding:"16px"}}),e.jsx(Ys,{children:e.jsxs(ss,{children:[e.jsx(ts,{children:e.jsx(ae,{children:s.map(x=>e.jsx(O,{children:x.label},String(x.field)))})}),e.jsx(rs,{children:y.slice(h*i,h*i+i).map(x=>e.jsx(ae,{children:s.map(c=>e.jsx(O,{children:c.render?c.render(x):x[c.field]},String(c.field)))},x.id))})]})}),e.jsx(Ks,{rowsPerPageOptions:[10,20,50,100],component:"div",count:y.length,rowsPerPage:i,page:h,onPageChange:p,onRowsPerPageChange:b})]})},ir=()=>{const[s,t]=a.useState([]),[r,o]=a.useState(null),[i,n]=a.useState(""),[h,u]=a.useState("add"),[f,p]=a.useState(!1),[b,y]=a.useState(!1),[x,c]=a.useState({open:!1,message:"",severity:"success"});a.useEffect(()=>{(async()=>{try{const k=(await E.get("/users")).data.map(W=>({id:W._id,firstName:W.firstName,lastName:W.lastName,email:W.email,roles:W.roles,_id:W._id,registrationDate:new Date(W.registrationDate),firebaseUID:W.firebaseUID,students:W.students,trainer:W.trainer,trainerEmail:W.trainerEmail}));t(k)}catch(S){console.error("Ошибка при получении списка пользователей:",S)}})()},[]);const m=d=>{o(d),n(""),u("add"),p(!0)},j=()=>{o(null),p(!1)},C=d=>{o(d),y(!0)},_=()=>{y(!1),o(null)},D=async()=>{if(r)try{await E.put("/admin/update-role",{userEmail:r.email,role:i,action:h}),t(s.map(d=>d.id===r.id?{...d,roles:h==="add"?[...d.roles,i]:d.roles.filter(S=>S!==i)}:d)),c({open:!0,message:"Роль успешно изменена",severity:"success"}),j()}catch(d){console.error("Ошибка при изменении роли:",d),c({open:!0,message:"Ошибка при изменении роли",severity:"error"})}},v=async()=>{if(r)try{await E.delete(`/admin/delete-user/${r.id}`),t(s.filter(d=>d.id!==r.id)),c({open:!0,message:"Пользователь удалён",severity:"success"}),_()}catch(d){console.error("Ошибка при удалении пользователя:",d),c({open:!0,message:"Ошибка при удалении пользователя",severity:"error"})}},I=[{field:"firstName",label:"Имя"},{field:"lastName",label:"Фамилия"},{field:"email",label:"Email"},{field:"roles",label:"Роли",render:d=>d.roles.join(", ")},{field:"actions",label:"Действия",render:d=>e.jsxs(e.Fragment,{children:[e.jsx(U,{size:"small",onClick:()=>m(d),children:e.jsx(Se,{})}),e.jsx(U,{size:"small",color:"error",onClick:()=>C(d),children:e.jsx(Pe,{})})]})}];return e.jsxs($,{children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:"Список пользователей"}),e.jsx(ar,{columns:I,data:s}),e.jsxs(le,{open:f,onClose:j,fullWidth:!0,maxWidth:"xs",children:[e.jsx(ce,{children:"Управление ролями"}),e.jsxs(de,{children:[e.jsxs(Me,{children:["Пользователь: ",e.jsxs("strong",{children:[r==null?void 0:r.firstName," ",r==null?void 0:r.lastName]})]}),e.jsxs(Ee,{fullWidth:!0,sx:{marginTop:2},children:[e.jsx(De,{children:"Роль"}),e.jsxs(we,{value:i,onChange:d=>n(d.target.value),label:"Роль",children:[e.jsx(G,{value:"student",children:"Студент"}),e.jsx(G,{value:"coach",children:"Тренер"})]})]})]}),e.jsxs(he,{children:[e.jsx(w,{onClick:j,children:"Отмена"}),e.jsx(w,{onClick:D,color:"primary",disabled:!i,children:"Сохранить"})]})]}),e.jsxs(le,{open:b,onClose:_,children:[e.jsx(ce,{children:"Подтвердите удаление"}),e.jsx(de,{children:e.jsxs(Me,{children:["Вы уверены, что хотите удалить пользователя ",r==null?void 0:r.email,"? Это действие необратимо."]})}),e.jsxs(he,{children:[e.jsx(w,{onClick:_,children:"Нет"}),e.jsx(w,{onClick:v,color:"error",children:"Да, удалить"})]})]}),e.jsx(Vs,{open:x.open,autoHideDuration:4e3,onClose:()=>c({...x,open:!1}),children:e.jsx(Js,{severity:x.severity,onClose:()=>c({...x,open:!1}),variant:"filled",children:x.message})})]})},xs=async s=>(await E.get(`/schedule/student/${s}`)).data,lr=async s=>(await E.post("/schedule/create",s)).data,cr=async(s,t)=>(await E.put(`/schedule/${s}`,t)).data,dr=async s=>{await E.delete(`/schedule/${s}`)},hr=hs(X),ur={individual_lesson:e.jsx(as,{fontSize:"small"}),group_lesson:e.jsx(is,{fontSize:"small"}),homework:e.jsx(ls,{fontSize:"small"}),opening_study:e.jsx(cs,{fontSize:"small"}),tournament_participation:e.jsx(ds,{fontSize:"small"})},mr=["individual_lesson","group_lesson","homework","opening_study","tournament_participation"],xr=({event:s})=>{const t=s.type;if(!t)return null;const r=ur[t],o=`custom-event rbc-event--${t}`;return e.jsx(os,{title:s.description||s.title,placement:"top",children:e.jsxs("div",{className:o,children:[r,e.jsx(l,{variant:"caption",noWrap:!0,component:"span",children:s.title})]})})},gr=({open:s,onClose:t,student:r})=>{const{t:o}=B(),[i,n]=a.useState([]),[h,u]=a.useState({}),[f,p]=a.useState(null);if(!r)return null;const b=`${r.firstName} ${r.lastName}`,y=a.useCallback(()=>{u({student:r._id,status:"scheduled",title:"",type:"individual_lesson",date:"",description:"",link:""}),p(null)},[r]),x=a.useCallback(async()=>{if(r._id)try{const d=await xs(r._id);n(d)}catch(d){console.error("Failed to fetch schedule:",d),N.error({message:o("schedule.fetchError"),description:void 0})}},[r,o]),c=async()=>{const{date:d,type:S,title:k}=h;if(!d||!S||!k){N.error({message:o("schedule.fieldRequired"),description:void 0});return}const W={studentId:r._id,date:new Date(d).toISOString(),title:k,description:h.description||"",link:h.link||"",type:S,status:h.status||"scheduled"};try{const H=!!h._id;H?await cr(h._id,W):await lr(W),N.success({message:o(H?"schedule.updateSuccess":"schedule.createSuccess"),description:void 0}),await x(),y()}catch(H){console.error("Failed to save event:",H)}},m=async()=>{if(h._id)try{await dr(h._id),N.success({message:o("schedule.deleteSuccess"),description:void 0}),await x(),y()}catch(d){console.error("Failed to delete event:",d)}};a.useEffect(()=>{s&&r&&(x(),y())},[s,r,x,y]);const j=a.useCallback(({start:d})=>{y(),p(d),u(S=>({...S,date:X(d).format("YYYY-MM-DDTHH:mm")}))},[y]),C=a.useCallback(d=>{p(d.date?new Date(d.date):null),u({...d,date:d.date?X(d.date).format("YYYY-MM-DDTHH:mm"):""})},[]),_=i.map(d=>({...d,id:d._id,start:new Date(d.date),end:X(d.date).add(1,"hour").toDate(),title:d.title})),D=a.useCallback(d=>({className:f&&X(d).isSame(f,"day")?"rbc-selected-slot-custom":""}),[f]),v=d=>{const{name:S,value:k}=d.target;u(W=>({...W,[S]:k}))},I=d=>{u(S=>({...S,type:d.target.value}))};return e.jsxs(le,{open:s,onClose:t,fullWidth:!0,maxWidth:"lg",className:"schedule-dialog",children:[e.jsx(ce,{className:"schedule-dialog__header",children:e.jsxs(R,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(l,{variant:"h6",component:"div",children:o("schedule.editScheduleTitle",{studentName:b})}),e.jsx(U,{"aria-label":"close",onClick:t,className:"schedule-dialog__close-btn",children:e.jsx(ns,{})})]})}),e.jsx(de,{dividers:!0,className:"schedule-dialog__content",children:e.jsxs(P,{container:!0,spacing:3,children:[e.jsx(P,{item:!0,xs:12,md:7,children:e.jsx(us,{localizer:hr,events:_,startAccessor:"start",endAccessor:"end",selectable:!0,onSelectSlot:j,onSelectEvent:C,components:{event:xr},dayPropGetter:D,className:"schedule-calendar"})}),e.jsx(P,{item:!0,xs:12,md:5,children:e.jsxs(A,{component:"form",className:"event-form",onSubmit:d=>{d.preventDefault(),c()},children:[e.jsx(l,{variant:"h6",className:"event-form__header",children:h._id?o("schedule.eventDetails"):f?o("schedule.addEventForDate",{date:X(f).format("MMMM Do, YYYY")}):o("schedule.addEvent")}),e.jsxs(R,{spacing:2.5,className:"event-form__fields",children:[e.jsx(T,{name:"title",label:o("schedule.form_title"),variant:"filled",fullWidth:!0,value:h.title||"",onChange:v,className:"event-form__field"}),e.jsxs(Ee,{variant:"filled",fullWidth:!0,className:"event-form__field",children:[e.jsx(De,{children:o("schedule.form_type")}),e.jsx(we,{name:"type",value:h.type||"",onChange:I,children:mr.map(d=>e.jsx(G,{value:d,children:o(`schedule.eventTypes.${d}`)},d))})]}),e.jsx(T,{name:"description",label:o("schedule.form_description"),variant:"filled",fullWidth:!0,multiline:!0,rows:3,value:h.description||"",onChange:v,className:"event-form__field"}),e.jsx(T,{name:"link",label:o("schedule.form_link"),variant:"filled",fullWidth:!0,value:h.link||"",onChange:v,className:"event-form__field"}),e.jsx(T,{name:"date",label:o("schedule.form_date"),type:"datetime-local",variant:"filled",fullWidth:!0,value:h.date||"",onChange:v,InputLabelProps:{shrink:!0},className:"event-form__field"})]})]})})]})}),e.jsxs(he,{className:"schedule-dialog__actions",children:[e.jsx(w,{onClick:t,className:"action-button action-button--close",children:o("common.close")}),e.jsx(g,{sx:{flex:"1 1 auto"}}),h._id&&e.jsx(w,{onClick:m,variant:"outlined",startIcon:e.jsx(Pe,{}),className:"action-button action-button--delete",children:o("common.delete")}),e.jsx(w,{onClick:c,variant:"contained",startIcon:h._id?e.jsx(Xs,{}):e.jsx(Qs,{}),className:"action-button action-button--save",children:h._id?o("common.save"):o("common.add")})]})]})},pr=()=>{const{t:s}=B(),[t,r]=a.useState([]),[o,i]=a.useState(null),[n,h]=a.useState(!1),[u,f]=a.useState(!0),p=a.useMemo(()=>{const c=localStorage.getItem("user");return c?JSON.parse(c).email:null},[]),b=a.useCallback(async()=>{if(!p){f(!1);return}f(!0);try{const c=await Gt(p);if(!Array.isArray(c)||c.length===0){r([]);return}const m=c.map(C=>Ut(p,C)),j=await Promise.all(m);r(j.filter(C=>C!==null))}catch(c){console.error("Ошибка при получении списка учеников:",c),N.error({message:s("studentsPage.fetchError"),description:void 0}),r([])}finally{f(!1)}},[p,s]),y=async c=>{if(p)try{await Yt(p,c),N.success({message:s("studentsPage.studentDeletedSuccess"),description:void 0}),r(m=>m.filter(j=>j._id!==c))}catch(m){console.error("Ошибка при удалении ученика:",m)}},x=c=>{i(c),h(!0)};return a.useEffect(()=>{b()},[b]),e.jsxs($,{children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:s("studentsPage.studentsListTitle")}),e.jsx(A,{children:e.jsxs(ss,{children:[e.jsx(ts,{children:e.jsxs(ae,{children:[e.jsx(O,{children:s("studentsPage.firstName")}),e.jsx(O,{children:s("studentsPage.lastName")}),e.jsx(O,{children:s("studentsPage.email")}),e.jsx(O,{align:"right",children:s("studentsPage.actions")})]})}),e.jsx(rs,{children:u?e.jsx(ae,{children:e.jsxs(O,{colSpan:4,align:"center",children:[e.jsx(ue,{}),e.jsx(l,{sx:{mt:1},children:s("common.loading")})]})}):t.length>0?t.map(c=>e.jsxs(ae,{children:[e.jsx(O,{children:c.firstName}),e.jsx(O,{children:c.lastName}),e.jsx(O,{children:c.email}),e.jsxs(O,{align:"right",children:[e.jsx(w,{variant:"contained",color:"primary",onClick:()=>x(c),style:{marginRight:10},children:s("studentsPage.editSchedule")}),e.jsx(w,{variant:"contained",color:"secondary",onClick:()=>y(c._id),children:s("studentsPage.delete")})]})]},c._id)):e.jsx(ae,{children:e.jsx(O,{colSpan:4,align:"center",children:s("studentsPage.noStudents")})})})]})}),o&&e.jsx(gr,{open:n,onClose:()=>h(!1),student:o})]})};class jr{constructor(t){ke(this,"game");ke(this,"fullHistory",[]);this.game=t?new ie(t):new ie,this.fullHistory=this.game.history()}getFen(){return this.game.fen()}getTurn(){return this.game.turn()}getHistory(){return this.fullHistory}getMovesForSquare(t){return this.game.moves({square:t,verbose:!0})}getStatus(){return{isCheckmate:this.game.isCheckmate(),isStalemate:this.game.isStalemate(),isThreefoldRepetition:this.game.isThreefoldRepetition(),isInsufficientMaterial:this.game.isInsufficientMaterial(),isDraw:this.game.isDraw(),turn:this.game.turn()}}handleMove(t,r){try{const o=this.game.move({from:t,to:r,promotion:"q"});return o&&(this.fullHistory=this.game.history()),o}catch{return null}}resetGame(){this.game.reset(),this.fullHistory=[]}loadPgn(t){try{return this.game.loadPgn(t),this.fullHistory=this.game.history(),!0}catch(r){return console.error("Invalid PGN:",r),!1}}goToMove(t){const r=new ie;for(let o=0;o<t;o++)this.fullHistory[o]&&r.move(this.fullHistory[o]);this.game=r}uciToSan(t){const r=this.game.move({from:t.substring(0,2),to:t.substring(2,4),promotion:t.length===5?t.substring(4):void 0});return r?(this.game.undo(),r.san):null}}const fr=s=>{const t=a.useMemo(()=>new jr(s),[s]),[r,o]=a.useState(t.getFen()),[i,n]=a.useState(t.getHistory()),[h,u]=a.useState(i.length),[f,p]=a.useState(null),[b,y]=a.useState({}),x=a.useRef(r);x.current=r;const c=a.useCallback(()=>{o(t.getFen());const I=t.getHistory();n(I),u(I.length)},[t]),m=a.useCallback(()=>{p(null),y({})},[]),j=a.useCallback((I,d)=>t.handleMove(I,d)?(c(),m(),!0):!1,[t,c,m]),C=a.useCallback(I=>{if(I===f){m();return}const d=t.getMovesForSquare(I);if(d.length===0){m();return}const S={};d.forEach(k=>{S[k.to]={background:k.flags.includes("c")?"radial-gradient(circle, rgba(0,0,0,0) 85%, rgba(0,0,0,0.2) 85%)":"radial-gradient(circle, rgba(0,0,0,0.2) 25%, transparent 30%)",borderRadius:"50%"}}),y(S),p(I)},[t,f,m]),_=a.useCallback(()=>{t.resetGame(),c(),m()},[t,c,m]),D=a.useCallback(I=>{const d=t.loadPgn(I.trim());return d&&(c(),m()),d},[t,c,m]),v=a.useCallback(I=>{t.goToMove(I),o(t.getFen()),u(I),m()},[t,m]);return{fen:r,history:i,currentMoveIndex:h,moveOptions:b,actions:{handleMove:j,onSquareClick:C,resetGame:_,loadPgn:D,goToMove:v}}},br=({fen:s,onPieceDrop:t,onSquareClick:r,squareStyles:o})=>e.jsx(ms,{position:s,onPieceDrop:t,onSquareClick:r,customSquareStyles:o,customBoardStyle:{borderRadius:"4px",boxShadow:"0 5px 15px rgba(0, 0, 0, 0.5)"},customDarkSquareStyle:{backgroundColor:"#779952"},customLightSquareStyle:{backgroundColor:"#edeed1"}}),Ge=s=>{if(s===void 0)return"";const t=Math.abs(s);return t<.4?" =":t<1?s>0?" += ":" -= ":t<2?s>0?" ±":" ∓":s>0?" +-":" -+"},Ye=s=>s===void 0||Math.abs(s)<.4?"text.secondary":s>0?"success.light":"error.light",vr=({history:s,currentMoveIndex:t,onMoveClick:r})=>{const o=Re.useMemo(()=>{const i=[];for(let n=0;n<s.length;n+=2)i.push({white:s[n],black:s[n+1]||null});return i},[s]);return e.jsx(A,{variant:"outlined",sx:{p:1.5,height:"100%",overflowY:"auto",bgcolor:"#1c1c1c",borderColor:"rgba(255,255,255,0.2)"},children:e.jsx(P,{container:!0,rowSpacing:.5,columnSpacing:1,sx:{fontSize:"1rem",color:"white"},children:o.map((i,n)=>{const h=n*2+1,u=n*2+2;return e.jsxs(Re.Fragment,{children:[e.jsxs(P,{item:!0,xs:2,sx:{color:"rgba(255, 255, 255, 0.6)",textAlign:"right",pt:"4px"},children:[n+1,"."]}),e.jsx(P,{item:!0,xs:5,children:e.jsxs(g,{onClick:()=>r(h),sx:{display:"flex",alignItems:"center",cursor:"pointer",p:"2px 5px",borderRadius:"4px",bgcolor:t===h?"rgba(255, 215, 0, 0.3)":"transparent","&:hover":{bgcolor:"rgba(255,255,255,0.1)"}},children:[e.jsx(l,{component:"span",children:i.white.san}),e.jsx(l,{component:"span",sx:{color:Ye(i.white.evaluation),fontWeight:"bold",ml:.5},children:Ge(i.white.evaluation)})]})}),e.jsx(P,{item:!0,xs:5,children:i.black&&e.jsxs(g,{onClick:()=>r(u),sx:{display:"flex",alignItems:"center",cursor:"pointer",p:"2px 5px",borderRadius:"4px",bgcolor:t===u?"rgba(255, 215, 0, 0.3)":"transparent","&:hover":{bgcolor:"rgba(255,255,255,0.1)"}},children:[e.jsx(l,{component:"span",children:i.black.san}),e.jsx(l,{component:"span",sx:{color:Ye(i.black.evaluation),fontWeight:"bold",ml:.5},children:Ge(i.black.evaluation)})]})})]},n)})})})},yr=({evaluation:s,depth:t,principalVariation:r,isAnalyzing:o,isEngineOn:i,onToggleEngine:n})=>e.jsxs(A,{variant:"outlined",sx:{p:2,borderColor:"rgba(255,255,255,0.2)",borderRadius:2},children:[e.jsxs(R,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(l,{variant:"h4",fontWeight:"bold",sx:{color:"#FFD700"},children:s??e.jsx(l,{component:"span",color:"text.secondary",children:"..."})}),e.jsxs(R,{direction:"row",alignItems:"center",spacing:1,children:[e.jsxs(R,{alignItems:"flex-end",children:[e.jsxs(l,{variant:"body2",color:"text.secondary",children:["Depth: ",t]}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"SF 16"})]}),e.jsx(re,{control:e.jsx(Zs,{checked:i,onChange:n,sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#FFD700"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#FFD700"}}}),label:"",sx:{mr:0}})]})]}),e.jsx(Y,{sx:{my:1,borderColor:"rgba(255,255,255,0.2)"}}),e.jsx(g,{sx:{minHeight:"4em",overflowX:"auto",whiteSpace:"nowrap"},children:e.jsx(l,{variant:"body1",children:r||(o?"Analyzing...":e.jsx(l,{component:"span",color:"text.secondary",children:"-"}))})})]}),Sr=()=>{const{t:s}=B(),{fen:t,history:r,currentMoveIndex:o,moveOptions:i,actions:n}=fr(),[h,u]=a.useState([]),[f,p]=a.useState(""),[b,y]=a.useState(null),[x,c]=a.useState(!1),[m,j]=a.useState(null),[C,_]=a.useState(0),[D,v]=a.useState(""),[I,d]=a.useState(!1),S=a.useRef(t);a.useEffect(()=>{S.current=t},[t]),a.useEffect(()=>{u(r.map(M=>({san:M})))},[r]);const k=()=>{j(null),_(0),v("")},W=()=>{n.loadPgn(f)?(k(),N.success({message:s("chessGame.pgnLoadSuccess"),description:void 0})):N.error({message:s("chessGame.pgnLoadError"),description:void 0})},H=()=>{n.resetGame(),k(),N.success({message:s("chessGame.resetSuccess"),description:void 0})},ee=M=>{n.goToMove(M),k()},xe=a.useCallback(()=>{b&&!x&&(c(!0),k(),b.postMessage(`position fen ${t}`),b.postMessage("go depth 18"))},[b,t,x]);a.useEffect(()=>{I?xe():b&&(b.postMessage("stop"),c(!1))},[t,I,xe,b]);const je=M=>{d(M.target.checked)},F=a.useCallback((M,Q)=>{try{const L=new ie(Q),se=M.split(" ");let K="";for(const V of se){const te=L.move({from:V.substring(0,2),to:V.substring(2,4),promotion:V.length===5?V.substring(4):void 0});if(te)L.turn()==="b"?K+=`${L.moveNumber()}. ${te.san} `:K+=`${te.san} `;else break}return K.trim()}catch{return M}},[]);return a.useEffect(()=>{const M=new Worker("/workers/stockfish.js");return y(M),M.postMessage("uci"),M.onmessage=Q=>{const L=Q.data;if(L!=="uciok"){if(L.startsWith("info depth")){const se=L.match(/depth (\d+)/),K=L.match(/score (cp|mate) (-?\d+)/),V=L.match(/ pv (.+)/);if(se&&_(parseInt(se[1],10)),K){const te=new ie(S.current).turn(),gs=K[1];let Ce=parseInt(K[2],10);te==="b"&&(Ce*=-1);const ps=gs==="cp"?(Ce/100).toFixed(2):`M${Math.abs(Ce)}`;j(ps)}if(V){const te=F(V[1],S.current);v(te)}}L.startsWith("bestmove")&&c(!1)}},()=>M.terminate()},[F]),e.jsx(g,{sx:{bgcolor:"#0e0e0e",color:"white",minHeight:"100vh",py:{xs:2,md:5}},children:e.jsxs($,{maxWidth:"xl",children:[e.jsxs(g,{sx:{textAlign:"center",mb:4},children:[e.jsx(l,{variant:"h2",component:"h1",fontWeight:"bold",children:s("chessGame.title")}),e.jsx(l,{variant:"h6",sx:{mt:1,color:"rgba(255, 255, 255, 0.7)"},children:s("chessGame.subtitle")})]}),e.jsxs(P,{container:!0,spacing:4,children:[e.jsx(P,{item:!0,xs:12,md:7,children:e.jsx(A,{sx:{p:2,bgcolor:"#1c1c1c",borderRadius:4,aspectRatio:"1 / 1",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(br,{fen:t,onPieceDrop:n.handleMove,onSquareClick:n.onSquareClick,squareStyles:i})})}),e.jsx(P,{item:!0,xs:12,md:5,children:e.jsx(A,{sx:{p:2,bgcolor:"#1c1c1c",borderRadius:4,height:"100%"},children:e.jsxs(R,{spacing:2,height:"100%",children:[e.jsx(yr,{evaluation:m,depth:C,principalVariation:D,isAnalyzing:x,isEngineOn:I,onToggleEngine:je}),e.jsx(g,{sx:{flexGrow:1,height:"250px"},children:e.jsx(vr,{history:h,currentMoveIndex:o,onMoveClick:ee})}),e.jsxs(R,{direction:"row",spacing:1,justifyContent:"center",alignItems:"center",children:[e.jsx(U,{onClick:()=>ee(0),disabled:o===0,children:e.jsx(et,{})}),e.jsx(U,{onClick:()=>ee(o-1),disabled:o===0,children:e.jsx(st,{})}),e.jsx(U,{onClick:()=>ee(o+1),disabled:o===r.length,children:e.jsx(tt,{})}),e.jsx(U,{onClick:()=>ee(r.length),disabled:o===r.length,children:e.jsx(rt,{})})]}),e.jsxs(R,{spacing:1,children:[e.jsx(T,{label:s("chessGame.pgnInputLabel"),fullWidth:!0,multiline:!0,rows:2,variant:"filled",value:f,onChange:M=>p(M.target.value),sx:{"& .MuiFilledInput-root":{backgroundColor:"rgba(255,255,255,0.1)"}}}),e.jsxs(R,{direction:"row",spacing:1,children:[e.jsx(w,{variant:"outlined",onClick:H,startIcon:e.jsx(nt,{}),fullWidth:!0,children:s("chessGame.reset")}),e.jsx(w,{variant:"outlined",onClick:W,startIcon:e.jsx(ot,{}),fullWidth:!0,children:s("chessGame.loadPgn")})]})]})]})})})]})]})})},wr=({position:s,onMove:t,onSquareClick:r,boardWidth:o=500})=>e.jsx(ms,{position:s,boardWidth:o,onPieceDrop:t?(i,n)=>t(i,n):void 0,onSquareClick:r}),Ke=({initialFen:s})=>{const t=s||"8/8/8/8/8/8/8/8 w - - 0 1",[r,o]=a.useState(!1),[i]=a.useState(()=>{const v=new ie;return v.clear(),v}),[n,h]=a.useState(t),[u,f]=a.useState(null),[p,b]=a.useState(null),y=[{type:"k",color:"b",icon:"♚"},{type:"q",color:"b",icon:"♛"},{type:"r",color:"b",icon:"♜"},{type:"b",color:"b",icon:"♝"},{type:"n",color:"b",icon:"♞"},{type:"p",color:"b",icon:"♟"},{type:"k",color:"w",icon:"♔"},{type:"q",color:"w",icon:"♕"},{type:"r",color:"w",icon:"♖"},{type:"b",color:"w",icon:"♗"},{type:"n",color:"w",icon:"♘"},{type:"p",color:"w",icon:"♙"}],x=a.useRef(null);a.useEffect(()=>{const v=I=>{if(!u||!r||!x.current)return;const d=x.current.getBoundingClientRect(),S=I.clientX-d.left,k=I.clientY-d.top;S>=0&&k>=0&&S<=d.width&&k<=d.height&&b({left:S,top:k})};return window.addEventListener("mousemove",v),()=>window.removeEventListener("mousemove",v)},[u,r]);const c=(v,I,d)=>{let S=n.split(" "),k=S[2]==="-"?"":S[2];I?k=(k+d).split("").sort().join(""):k=k.replace(d,""),S[2]=k||"-";const W=S.join(" ");try{i.load(W),h(W)}catch{N.error({message:"Ошибка рокировки",description:void 0})}},m=v=>{const[I,d]=[v.charCodeAt(0)-97,8-parseInt(v[1])],k=i.board()[d][I];if(u){k&&k.type===u.type&&k.color===u.color?i.remove(v):i.put(u,v),h(i.fen());return}k&&(i.remove(v),h(i.fen()))},j=()=>{i.clear(),h(i.fen()),N.success({message:"Доска очищена!",description:void 0})},C=()=>{i.reset(),h(i.fen()),N.success({message:"Установлена начальная позиция!",description:void 0})},_=()=>{f(null),b(null)},D=()=>{if(n.split("").filter(I=>I.toLowerCase()==="k").length<2){N.error({message:"Некорректная позиция",description:"На доске должно быть как минимум два короля."});return}try{i.load(n),N.success({message:"Позиция сохранена",description:`FEN: ${n}`})}catch{N.error({message:"Ошибка сохранения",description:"Некорректная FEN-позиция"})}};return e.jsxs($,{children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:"Редактор шахматной позиции"}),e.jsxs(g,{display:"flex",children:[e.jsxs(g,{onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),style:{cursor:u?"none":"default",position:"relative",width:500,height:500},children:[e.jsx(wr,{position:n,onSquareClick:m,boardWidth:500}),p&&u&&e.jsx("div",{style:{...p,position:"absolute",pointerEvents:"none",left:p.left,top:p.top,fontSize:"32px",zIndex:1e3},children:u.icon})]}),e.jsxs(g,{ml:3,display:"flex",flexDirection:"column",children:[e.jsxs(A,{elevation:3,style:{padding:"10px",marginBottom:"20px"},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Фигуры"}),e.jsx(g,{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:1,children:y.map((v,I)=>e.jsx(g,{onClick:()=>f(v),style:{textAlign:"center",cursor:"pointer",padding:6,border:"1px solid #aaa",borderRadius:4,fontSize:24,backgroundColor:u===v?"#1976d2":"#f5f5f5",color:u===v?"#fff":"inherit"},children:v.icon},I))})]}),e.jsxs(A,{elevation:3,style:{padding:"10px",marginBottom:"20px"},children:[e.jsx(l,{variant:"h6",children:"Рокировка"}),e.jsxs(at,{row:!0,children:[e.jsx(re,{control:e.jsx(be,{checked:n.includes("K"),onChange:v=>c(n,v.target.checked,"K")}),label:"Белые 0-0"}),e.jsx(re,{control:e.jsx(be,{checked:n.includes("Q"),onChange:v=>c(n,v.target.checked,"Q")}),label:"Белые 0-0-0"}),e.jsx(re,{control:e.jsx(be,{checked:n.includes("k"),onChange:v=>c(n,v.target.checked,"k")}),label:"Чёрные 0-0"}),e.jsx(re,{control:e.jsx(be,{checked:n.includes("q"),onChange:v=>c(n,v.target.checked,"q")}),label:"Чёрные 0-0-0"})]})]}),e.jsxs(A,{elevation:3,style:{padding:"10px"},children:[e.jsx(l,{variant:"h6",children:"Ход"}),e.jsxs(it,{row:!0,value:i.turn(),onChange:v=>{const I=n.split(" ");I[1]=v.target.value;const d=I.join(" ");try{i.load(d),h(d)}catch{N.error({message:"Ошибка изменения хода",description:void 0})}},children:[e.jsx(re,{value:"w",control:e.jsx(Te,{}),label:"Белые"}),e.jsx(re,{value:"b",control:e.jsx(Te,{}),label:"Чёрные"})]})]})]})]}),e.jsxs(R,{direction:"row",spacing:2,mt:3,children:[e.jsx(w,{variant:"contained",onClick:j,children:"Очистить доску"}),e.jsx(w,{variant:"contained",onClick:C,children:"Начальная позиция"}),e.jsx(w,{variant:"contained",onClick:_,children:"Убрать фигуру"}),e.jsx(w,{variant:"contained",color:"primary",onClick:D,children:"Сохранить"})]}),e.jsx(T,{label:"FEN",value:n,fullWidth:!0,multiline:!0,rows:2,onChange:v=>{const I=v.target.value;try{i.load(I),h(I)}catch{N.error({message:"Некорректный FEN",description:void 0})}},style:{marginTop:20}}),p&&u&&e.jsx("div",{style:p,children:u.icon})]})},Cr=async s=>(await E.get("/auth/check-verification",{params:{email:s}})).data,kr=async s=>(await E.post("/auth/resend-verification",{email:s})).data,Ir=()=>{const s=ne(),t=Ne(),{t:r}=B(),{firstName:o,lastName:i,email:n}=t.state||{},[h,u]=a.useState(!1),[f,p]=a.useState(!0),[b,y]=a.useState(null),[x,c]=a.useState(null),[m,j]=a.useState(!1),C=a.useRef(null);a.useEffect(()=>{if(!n){console.error("Email not found in location state. Redirecting to register."),s("/register");return}return C.current=setInterval(async()=>{try{const{emailVerified:D}=await Cr(n);D&&(p(!1),s("/login",{state:{message:r("verifyEmail.verifiedAndReadyToLogin")}}))}catch(D){console.error("Polling error:",D)}},5e3),()=>{C.current&&clearInterval(C.current)}},[n,s,r]);const _=async()=>{var D;if(n){u(!0),y(null),c(null);try{await kr(n),y(r("verifyEmail.resendSuccess")),j(!0),setTimeout(()=>j(!1),12e4)}catch(v){((D=v.response)==null?void 0:D.status)===429?c(r("verifyEmail.resendErrorTooMany")):c(r("verifyEmail.resendError"))}finally{u(!1)}}};return e.jsxs(g,{textAlign:"center",mt:5,p:2,children:[f&&e.jsx(ue,{sx:{mb:2}}),e.jsx(l,{variant:"h4",gutterBottom:!0,children:r("verifyEmail.pageTitle")}),e.jsx(l,{variant:"body1",gutterBottom:!0,children:e.jsx("b",{children:r("verifyEmail.greeting",{firstName:o||"",lastName:i||""})})}),e.jsx(l,{variant:"body1",gutterBottom:!0,children:r("verifyEmail.sentTo",{email:n||r("verifyEmail.yourEmail")})}),e.jsx(l,{variant:"body1",color:"text.secondary",sx:{mt:2,maxWidth:"600px",mx:"auto"},children:r("verifyEmail.instruction")}),b&&!x&&e.jsx(l,{variant:"body2",color:"primary.main",sx:{mt:2,fontWeight:"bold"},children:b}),x&&e.jsx(l,{variant:"body2",color:"error",sx:{mt:2,fontWeight:"bold"},children:x}),e.jsx(w,{variant:"contained",color:"primary",onClick:_,disabled:m||h,sx:{mt:3,mb:2},children:r(h?"verifyEmail.sending":"verifyEmail.resendButton")}),e.jsx(l,{variant:"caption",display:"block",children:r("verifyEmail.didNotReceive")})]})},Nr=async()=>(await E.get("/trainer/requests",{})).data,Pr=async(s,t)=>{await E.patch(`/trainer/request?request_id=${s}`,{status:t})},Fr=async(s,t,r)=>(await E.post("/trainer/request",{coachId:s,experience:t,goals:r})).data,ye={"& .MuiInputBase-root":{backgroundColor:"rgba(255, 255, 255, 0.08)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.12)"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.6)"},"& .MuiInputBase-input":{color:"white"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.6)"}},_r=()=>{var ee,xe,je;const{t:s}=B(),[t,r]=a.useState([]),[o,i]=a.useState(null),[n,h]=a.useState(""),[u,f]=a.useState(!1),[p,b]=a.useState(!1),[y,x]=a.useState(!1),[c,m]=a.useState(!1),j=localStorage.getItem("email"),[C,_]=a.useState({userName:"",userEmail:"",experienceLevel:"Intermediate",goals:""}),[D,v]=a.useState({title:"",experience:"",bio:"",price:"",services:""});a.useEffect(()=>{(async()=>{try{const M=await Ot();r(M)}catch{N.error({message:s("coaches.fetchError"),description:void 0})}})()},[s]);const I=F=>{var M,Q,L,se,K,V;i(F),f(!0),x(!1),m(!1),v({title:((M=F.coachProfile)==null?void 0:M.title)||"",experience:((Q=F.coachProfile)==null?void 0:Q.experience)||"",bio:((L=F.coachProfile)==null?void 0:L.bio)||"",price:((K=(se=F.coachProfile)==null?void 0:se.price)==null?void 0:K.toString())||"",services:(((V=F.coachProfile)==null?void 0:V.services)||[]).join(", ")})},d=()=>{f(!1),setTimeout(()=>{i(null),x(!1),m(!1),_({userName:"",userEmail:"",experienceLevel:"Intermediate",goals:""})},300)},S=async()=>{if(o)try{b(!0),await Fr(o._id,C.experienceLevel,C.goals),N.success({message:s("coaches.successMessage"),description:void 0}),d()}catch{N.error({message:s("coaches.submitError"),description:void 0})}finally{b(!1)}},k=async()=>{console.log("Saving profile:",D),N.success({message:s("coaches.updated"),description:void 0}),d()},W=t.filter(F=>`${F.firstName} ${F.lastName}`.toLowerCase().includes(n.toLowerCase())),H=o?`${o.firstName} ${o.lastName}`:"";return e.jsx(g,{sx:{bgcolor:"#0e0e0e",color:"white",minHeight:"100vh",py:8},children:e.jsxs($,{maxWidth:"lg",children:[e.jsxs(g,{sx:{textAlign:"center",mb:8},children:[e.jsx(l,{variant:"h2",component:"h1",fontWeight:"bold",children:s("coaches.title")}),e.jsx(l,{variant:"h6",sx:{mt:1,color:"rgba(255, 255, 255, 0.7)"},children:s("coaches.subtitle")})]}),e.jsx(g,{sx:{mb:5,maxWidth:"600px",mx:"auto"},children:e.jsx(T,{fullWidth:!0,variant:"outlined",placeholder:s("coaches.searchByName"),value:n,onChange:F=>h(F.target.value),sx:{"& .MuiOutlinedInput-root":{borderRadius:"30px",backgroundColor:"#1c1c1c","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"#FFD700"},"&.Mui-focused fieldset":{borderColor:"#FFD700"}},"& .MuiInputBase-input":{color:"white"}},InputProps:{startAdornment:e.jsx(lt,{position:"start",children:e.jsx(ct,{sx:{color:"rgba(255, 255, 255, 0.5)"}})})}})}),e.jsx(P,{container:!0,spacing:4,children:W.map(F=>{var M,Q,L;return e.jsx(P,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(Qe,{sx:{bgcolor:"#1c1c1c",color:"white",borderRadius:4,height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-8px)",boxShadow:"0 12px 24px rgba(255, 215, 0, 0.2)"}},children:[e.jsx(Ze,{component:"img",height:"250",image:F.photoUrl||"/images/default-avatar.png",alt:`${F.firstName} ${F.lastName}`}),e.jsxs(es,{sx:{flexGrow:1},children:[e.jsxs(l,{variant:"h5",component:"div",fontWeight:"bold",children:[F.firstName," ",F.lastName]}),e.jsx(l,{variant:"body1",sx:{color:"#FFD700",mb:2},children:((M=F.coachProfile)==null?void 0:M.title)||"Chess Master"}),e.jsxs(R,{spacing:1,children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",color:"rgba(255,255,255,0.7)"},children:[e.jsx(dt,{fontSize:"small",sx:{mr:1}}),e.jsx(l,{variant:"body2",children:((Q=F.coachProfile)==null?void 0:Q.experience)||"N/A"})]}),e.jsxs(g,{sx:{display:"flex",alignItems:"center",color:"rgba(255,255,255,0.7)"},children:[e.jsx(ht,{fontSize:"small",sx:{mr:1}}),e.jsx(l,{variant:"body2",children:(L=F.coachProfile)!=null&&L.price?`${F.coachProfile.price}$ / hour`:"Contact for price"})]})]})]}),e.jsx(g,{sx:{p:2,pt:0},children:e.jsx(w,{variant:"contained",fullWidth:!0,onClick:()=>I(F),sx:{backgroundColor:"#FFD700",color:"black",fontWeight:"bold",borderRadius:"20px","&:hover":{backgroundColor:"#FFC107"}},children:s("coaches.viewProfile")})})]})},F._id)})}),e.jsx(le,{open:u,onClose:d,fullWidth:!0,maxWidth:"md",PaperProps:{sx:{bgcolor:"#1c1c1c",color:"white",borderRadius:4,backgroundImage:"none"}},children:o&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{sx:{p:3,pb:1},children:e.jsxs(R,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(l,{variant:"h5",fontWeight:"bold",children:c?s("coaches.editProfile"):s("coaches.profileOf",{coachName:H})}),e.jsx(U,{onClick:d,sx:{color:"rgba(255,255,255,0.7)"},children:e.jsx(ns,{})})]})}),e.jsx(de,{children:c?e.jsx(R,{spacing:2,sx:{pt:1}}):e.jsxs(e.Fragment,{children:[e.jsxs(P,{container:!0,spacing:4,sx:{pt:1},children:[e.jsx(P,{item:!0,xs:12,md:4,children:e.jsx(Fe,{src:o.photoUrl||"/images/default-avatar.png",sx:{width:"100%",height:"auto",aspectRatio:"1 / 1",borderRadius:3},variant:"rounded"})}),e.jsx(P,{item:!0,xs:12,md:8,children:e.jsxs(R,{spacing:2.5,children:[e.jsxs(g,{children:[e.jsx(l,{fontWeight:"bold",color:"#FFD700",children:s("coaches.bio")}),e.jsx(l,{sx:{color:"rgba(255,255,255,0.8)",whiteSpace:"pre-wrap"},children:((ee=o.coachProfile)==null?void 0:ee.bio)||e.jsx("span",{style:{color:"rgba(255,255,255,0.5)",fontStyle:"italic"},children:"No bio provided."})})]}),e.jsxs(g,{children:[e.jsx(l,{fontWeight:"bold",color:"#FFD700",children:s("coaches.services")}),e.jsx(g,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:(je=(xe=o.coachProfile)==null?void 0:xe.services)!=null&&je.length?o.coachProfile.services.map(F=>e.jsx(We,{label:F,sx:{bgcolor:"rgba(255,255,255,0.2)",color:"white"}},F)):e.jsx(l,{sx:{color:"rgba(255,255,255,0.5)",fontStyle:"italic"},children:"No services listed."})})]})]})})]}),e.jsx(Y,{sx:{my:3,borderColor:"rgba(255,255,255,0.2)"}}),e.jsx(g,{children:y?e.jsxs(A,{elevation:0,sx:{p:{xs:2,sm:3},bgcolor:"rgba(0,0,0,0.25)",borderRadius:2},children:[e.jsx(l,{variant:"h6",fontWeight:"bold",sx:{mb:2},children:s("coaches.requestTitle",{coachName:H})}),e.jsxs(R,{spacing:2,children:[e.jsx(T,{fullWidth:!0,label:s("coaches.yourName"),value:C.userName,onChange:F=>_({...C,userName:F.target.value}),variant:"filled",sx:ye}),e.jsx(T,{fullWidth:!0,label:s("coaches.yourEmail"),value:C.userEmail,onChange:F=>_({...C,userEmail:F.target.value}),variant:"filled",sx:ye}),e.jsxs(Ee,{fullWidth:!0,variant:"filled",sx:ye,children:[e.jsx(De,{id:"level-select-label",children:s("coaches.level")}),e.jsxs(we,{labelId:"level-select-label",value:C.experienceLevel,onChange:F=>_({...C,experienceLevel:F.target.value}),children:[e.jsx(G,{value:"Beginner",children:s("coaches.levelBeginner")}),e.jsx(G,{value:"Intermediate",children:s("coaches.levelIntermediate")}),e.jsx(G,{value:"Advanced",children:s("coaches.levelAdvanced")})]})]}),e.jsx(T,{fullWidth:!0,multiline:!0,rows:3,label:s("coaches.goals"),value:C.goals,onChange:F=>_({...C,goals:F.target.value}),variant:"filled",sx:ye})]})]}):e.jsx(w,{fullWidth:!0,variant:"outlined",onClick:()=>x(!0),sx:{color:"#FFD700",borderColor:"#FFD700","&:hover":{borderColor:"#FFC107",bgcolor:"rgba(255, 215, 0, 0.1)"}},children:s("coaches.requestTitle",{coachName:o.firstName})})})]})}),e.jsx(he,{sx:{p:3,pt:2},children:c?e.jsxs(e.Fragment,{children:[e.jsx(w,{onClick:()=>m(!1),sx:{color:"rgba(255,255,255,0.7)"},children:s("coaches.cancel")}),e.jsx(w,{variant:"contained",onClick:k,startIcon:e.jsx(Se,{}),sx:{bgcolor:"#FFD700",color:"black","&:hover":{bgcolor:"#FFC107"}},children:s("coaches.save")})]}):y?e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"outlined",onClick:()=>x(!1),sx:{color:"rgba(255,255,255,0.7)",borderColor:"rgba(255,255,255,0.3)"},children:s("coaches.cancel")}),e.jsx(w,{variant:"contained",onClick:S,disabled:p,startIcon:e.jsx(ut,{}),sx:{bgcolor:"#FFD700",color:"black","&:hover":{bgcolor:"#FFC107"}},children:s("coaches.sendRequest")})]}):o.email===j&&e.jsx(w,{variant:"text",onClick:()=>m(!0),startIcon:e.jsx(Se,{}),sx:{color:"#FFD700"},children:s("coaches.editProfile")})})]})})]})})},Er=async s=>{const t=new FormData;t.append("studentId",s.studentId),t.append("scheduleId",s.scheduleId),s.homeworkText&&t.append("homeworkText",s.homeworkText),s.screenshot&&t.append("screenshot",s.screenshot),await E.post("/homework/send",t)},Dr=async(s,t)=>(await E.put(`/homework/${s}/review`,t)).data,Wr=async()=>(await E.get("/homework/coach")).data,Rr=async s=>(await E.get(`/homework/${s}/screenshot`,{responseType:"blob"})).data,pe=s=>"createdAt"in s,Ar=()=>{const{t:s}=B(),[t,r]=a.useState("requests"),[o,i]=a.useState([]),[n,h]=a.useState(null),[u,f]=a.useState(!0),[p,b]=a.useState(""),[y,x]=a.useState(!1),[c,m]=a.useState(null),[j,C]=a.useState(!1),_=a.useCallback(async d=>{f(!0),h(null);try{const S=d==="requests"?await Nr():await Wr();i(Array.isArray(S)?S:[])}catch(S){console.error(`Error loading ${d}:`,S),N.error({message:s("inbox.errors.loadFailed"),description:void 0})}finally{f(!1)}},[s]);a.useEffect(()=>{_(t)},[t,_]),a.useEffect(()=>{let d=null;return(async()=>{if(!n||pe(n)||!n.hasScreenshot){m(null);return}C(!0);try{const k=await Rr(n._id);d=URL.createObjectURL(k),m(d)}catch(k){console.error("Screenshot load error:",k),N.error({message:s("inbox.errors.loadScreenshotFailed"),description:void 0})}finally{C(!1)}})(),b(""),()=>{d&&URL.revokeObjectURL(d)}},[n,s]);const D=async d=>{if(!(!n||!pe(n))){x(!0);try{await Pr(n._id,d),N.success({message:s("inbox.success.requestHandled",{action:s(d==="approved"?"inbox.success.actions.approved":"inbox.success.actions.rejected")}),description:void 0}),await _("requests")}catch(S){console.error("Error handling request:",S),N.error({message:s("inbox.errors.handleRequestFailed"),description:void 0})}finally{x(!1)}}},v=async d=>{if(!(!n||pe(n))){x(!0);try{await Dr(n._id,{status:d,comment:p}),N.success({message:s("inbox.success.homeworkReviewed"),description:void 0}),await _("homework")}catch(S){console.error("Error reviewing homework:",S),N.error({message:s("inbox.errors.reviewHomeworkFailed"),description:void 0})}finally{x(!1)}}},I=()=>{var d;return u&&!n?null:n?pe(n)?e.jsxs(e.Fragment,{children:[e.jsxs(l,{variant:"h6",children:[n.student.firstName," ",n.student.lastName]}),e.jsxs(l,{children:[s("inbox.details.email"),": ",n.student.email]}),e.jsxs(l,{children:[s("inbox.details.sent"),": ",new Date(n.createdAt).toLocaleString()]}),e.jsx(Y,{sx:{my:2}}),e.jsxs(l,{children:[e.jsxs("strong",{children:[s("inbox.details.experience"),":"]})," ",n.experience||s("inbox.details.notSpecified")]}),e.jsxs(l,{children:[e.jsxs("strong",{children:[s("inbox.details.goals"),":"]})," ",n.goals||s("inbox.details.notSpecified")]}),e.jsxs(g,{mt:3,display:"flex",gap:2,children:[e.jsx(w,{variant:"contained",color:"primary",onClick:()=>D("approved"),disabled:y||n.status!=="pending",children:s("inbox.actions.approve")}),e.jsx(w,{variant:"contained",color:"secondary",onClick:()=>D("rejected"),disabled:y||n.status!=="pending",children:s("inbox.actions.reject")})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"h5",gutterBottom:!0,children:((d=n.schedule)==null?void 0:d.title)||s("inbox.list.untitled")}),e.jsxs(l,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,children:[s("inbox.details.student"),": ",n.student.firstName," ",n.student.lastName]}),e.jsx(Y,{sx:{my:2}}),n.text&&e.jsxs(g,{mb:2,children:[e.jsxs(l,{variant:"h6",children:[s("inbox.details.responseText"),":"]}),e.jsx(l,{sx:{whiteSpace:"pre-wrap",p:1,bgcolor:"action.hover",borderRadius:1},children:n.text})]}),n.hasScreenshot&&e.jsxs(g,{mb:2,children:[e.jsxs(l,{variant:"h6",children:[s("inbox.details.screenshot"),":"]}),j&&e.jsxs(g,{sx:{display:"flex",alignItems:"center",my:2},children:[e.jsx(ue,{size:24,sx:{mr:2}})," ",s("inbox.loading")]}),c&&!j&&e.jsx(_e,{href:c,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:c,alt:s("inbox.details.screenshotAlt"),style:{maxWidth:"100%",height:"auto",borderRadius:"8px",border:"1px solid #ddd",display:"block",cursor:"pointer"}})})]}),e.jsx(Y,{sx:{my:2}}),e.jsxs(l,{variant:"h6",children:[s("inbox.details.feedback"),":"]}),e.jsx(T,{fullWidth:!0,multiline:!0,rows:4,label:s("inbox.details.commentLabel"),value:p,onChange:S=>b(S.target.value),margin:"normal",disabled:y}),e.jsxs(g,{mt:2,display:"flex",gap:2,children:[e.jsx(w,{variant:"contained",color:"success",onClick:()=>v("approved"),disabled:y,children:s("inbox.actions.approve")}),e.jsx(w,{variant:"contained",color:"error",onClick:()=>v("rejected"),disabled:y,children:s("inbox.actions.sendForRevision")})]})]}):e.jsx(l,{color:"text.secondary",children:s("inbox.selectItemPrompt")})};return e.jsxs($,{sx:{py:4},children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:s("inbox.title")}),e.jsx(g,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(mt,{value:t,onChange:(d,S)=>r(S),"aria-label":"inbox tabs",children:[e.jsx(Le,{label:s("inbox.tabs.requests"),value:"requests"}),e.jsx(Le,{label:s("inbox.tabs.homework"),value:"homework"})]})}),e.jsxs(P,{container:!0,spacing:3,children:[e.jsx(P,{item:!0,xs:12,md:4,children:e.jsx(A,{style:{maxHeight:"80vh",overflow:"auto"},children:u?e.jsx(g,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(ue,{})}):e.jsx(Xe,{component:"nav",children:o.length>0?o.map(d=>{var S;return e.jsx(J,{selected:(n==null?void 0:n._id)===d._id,onClick:()=>h(d),children:e.jsx(q,{primaryTypographyProps:{style:{fontWeight:(n==null?void 0:n._id)===d._id?"bold":"normal"}},primary:d.student?`${d.student.firstName} ${d.student.lastName}`:s("inbox.unknownStudent","Unknown Student"),secondary:pe(d)?s("inbox.list.requestSecondary",{date:new Date(d.createdAt).toLocaleDateString()}):s("inbox.list.homeworkSecondary",{title:((S=d.schedule)==null?void 0:S.title)||s("inbox.list.untitled","Без темы")})})},d._id)}):e.jsx(l,{sx:{p:2,textAlign:"center"},children:s("inbox.empty")})})})}),e.jsx(P,{item:!0,xs:12,md:8,children:e.jsx(A,{style:{padding:24,minHeight:"50vh",display:"flex",flexDirection:"column"},children:I()})})]})]})},Mr=hs(X),Tr={individual_lesson:e.jsx(as,{fontSize:"small"}),group_lesson:e.jsx(is,{fontSize:"small"}),homework:e.jsx(ls,{fontSize:"small"}),opening_study:e.jsx(cs,{fontSize:"small"}),tournament_participation:e.jsx(ds,{fontSize:"small"})},Lr=({event:s})=>{const t=Tr[s.type],r=`custom-event rbc-event--${s.type}`;return e.jsx(os,{title:s.description||s.title,placement:"top",children:e.jsxs("div",{className:r,children:[t,e.jsx(l,{variant:"caption",noWrap:!0,component:"span",children:s.title})]})})},zr=({events:s,onSelectEvent:t})=>{const r=a.useMemo(()=>s.map(o=>({...o,start:new Date(o.date),end:X(o.date).add(1,"hour").toDate()})),[s]);return e.jsx(A,{className:"schedule-paper",style:{height:"70vh",padding:"16px"},children:e.jsx(us,{localizer:Mr,events:r,startAccessor:"start",endAccessor:"end",views:["month","week","day","agenda"],components:{event:Lr},onSelectEvent:t,className:"schedule-calendar-standalone"})})},Ve=5,me={scheduled:{icon:e.jsx(ze,{fontSize:"small"}),color:"info",labelKey:"status.scheduled"},pending:{icon:e.jsx(ze,{fontSize:"small"}),color:"warning",labelKey:"status.pending"},completed:{icon:e.jsx(Ie,{fontSize:"small"}),color:"success",labelKey:"status.completed"},approved:{icon:e.jsx(Ie,{fontSize:"small"}),color:"success",labelKey:"status.approved"},rejected:{icon:e.jsx(jt,{fontSize:"small"}),color:"error",labelKey:"status.rejected"}},$r=Object.keys(me),Br=({event:s,onSelect:t,t:r})=>{const o=s.status,i=me[o]||me.scheduled;return e.jsxs(A,{className:`event-card event-card--${i.color}`,onClick:()=>t(s),children:[e.jsxs(g,{className:"event-card__header",children:[e.jsx(l,{variant:"h6",className:"event-card__title",children:s.title}),e.jsx(We,{icon:i.icon,label:r(i.labelKey),color:i.color,size:"small"})]}),e.jsx(l,{variant:"body2",className:"event-card__date",children:X(s.date).format("MMMM Do, YYYY [at] HH:mm")}),s.description&&e.jsx(l,{variant:"body2",className:"event-card__description",children:s.description})]})},Hr=({events:s,onSelectEvent:t,t:r})=>e.jsx(g,{className:"event-list",children:s.length===0?e.jsx(A,{className:"event-list__empty",children:e.jsx(l,{children:r("studentSchedule.noEventsForDay")})}):s.map(o=>e.jsx(Br,{event:o,onSelect:t,t:r},o._id))}),Or=({statusFilters:s,onFilterChange:t,t:r})=>{const o=(i,n)=>t(n);return e.jsxs(A,{className:"event-controls",children:[e.jsxs(l,{variant:"button",className:"event-controls__label",children:[r("common.filterByStatus"),":"]}),e.jsx(xt,{value:s,onChange:o,size:"small",children:$r.map(i=>e.jsx(gt,{value:i,className:"filter-toggle-button",children:r(me[i].labelKey)},i))})]})},qr=({event:s,open:t,onClose:r,onSendHomework:o,t:i})=>{const[n,h]=a.useState(""),[u,f]=a.useState(null),[p,b]=a.useState(!1);if(a.useEffect(()=>{t||(h(""),f(null),b(!1))},[t]),!s)return null;const y=j=>{var _;const C=(_=j.target.files)==null?void 0:_[0];if(C){if(C.size>Ve*1024*1024){N.error({message:i("errors.fileTooLarge",{size:Ve}),description:void 0});return}f(C)}},x=async()=>{if(!n.trim()&&!u){N.error({message:i("errors.emptyHomework"),description:void 0});return}b(!0);try{await o(n,u)}finally{b(!1)}},c=s.status,m=me[c]||me.scheduled;return e.jsxs(le,{open:t,onClose:r,fullWidth:!0,maxWidth:"sm",className:"details-dialog",children:[e.jsx(ce,{className:`details-dialog__header details-dialog__header--${m.color}`,children:i("studentSchedule.eventDetails")}),e.jsxs(de,{className:"details-dialog__content",children:[e.jsxs(g,{className:"details-dialog__info",children:[e.jsx(l,{variant:"h6",className:"details-dialog__title",children:s.title}),e.jsx(We,{icon:m.icon,label:i(m.labelKey),color:m.color,size:"small"})]}),e.jsx(l,{variant:"body2",children:X(s.date).format("dddd, MMMM Do, YYYY [at] HH:mm")}),s.description&&e.jsx(l,{variant:"body1",sx:{mt:2},children:s.description}),s.link&&e.jsxs(l,{variant:"body2",sx:{mt:1},children:[i("studentSchedule.form_link"),": ",e.jsx(_e,{href:s.link,target:"_blank",rel:"noopener noreferrer",children:s.link})]}),s.type==="homework"&&e.jsxs(g,{className:"homework-form",children:[e.jsx(l,{variant:"h6",className:"homework-form__title",children:i("studentSchedule.sendHomeworkTitle")}),e.jsx(T,{label:i("studentSchedule.form_description"),fullWidth:!0,multiline:!0,rows:4,value:n,onChange:j=>h(j.target.value),variant:"filled",disabled:p}),e.jsxs(w,{variant:"outlined",component:"label",startIcon:e.jsx(pt,{}),disabled:p,children:[u?u.name:i("studentSchedule.uploadScreenshot"),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:y})]})]})]}),e.jsxs(he,{className:"details-dialog__actions",children:[e.jsx(w,{onClick:r,disabled:p,children:i("common.close")}),s.type==="homework"&&e.jsx(w,{onClick:x,variant:"contained",color:"primary",disabled:p,children:i("studentSchedule.send")})]})]})},Ur=()=>{const{t:s}=B(),[t,r]=a.useState([]),[o,i]=a.useState(!0),[n,h]=a.useState(null),[u,f]=a.useState([]);a.useEffect(()=>{(async()=>{const m=localStorage.getItem("user");let j=null;try{m&&m!=="undefined"&&m!=="null"&&(j=JSON.parse(m)._id)}catch(C){console.error("Ошибка парсинга пользователя из localStorage:",C)}if(!j){i(!1),N.error({message:s("errors.userNotFound"),description:void 0});return}i(!0);try{const C=await xs(j);r(C)}catch(C){console.error("Ошибка при загрузке расписания:",C),N.error({message:s("errors.fetchSchedule"),description:void 0})}finally{i(!1)}})()},[s]);const p=c=>h(c),b=()=>h(null),y=async(c,m)=>{const j=localStorage.getItem("user"),C=j?JSON.parse(j)._id:null;if(!(!C||!n))try{await Er({studentId:C,scheduleId:n._id,homeworkText:c.trim()?c:void 0,screenshot:m||void 0}),n.coach&&await Tt({recipient:n.coach,type:"homework_submission",content:`Ученик отправил домашнее задание по теме: "${n.title}"`,metadata:{scheduleId:n._id}}),N.success({message:s("studentSchedule.homeworkSentSuccess"),description:void 0}),b(),r(_=>_.map(D=>D._id===n._id?{...D,status:"pending"}:D))}catch(_){console.error("Ошибка при отправке ДЗ:",_),N.error({message:s("errors.sendHomework"),description:void 0})}},x=a.useMemo(()=>{let c=[...t];return u.length>0&&(c=c.filter(m=>u.includes(m.status))),c.sort((m,j)=>new Date(m.date).getTime()-new Date(j.date).getTime())},[t,u]);return e.jsxs(g,{className:"student-schedule-v2-page",children:[e.jsxs($,{maxWidth:"lg",children:[e.jsx(l,{variant:"h4",component:"h1",className:"page-title",children:s("studentSchedule.myScheduleTitle")}),e.jsx(zr,{events:x,onSelectEvent:p}),e.jsxs(g,{className:"list-controls-container",children:[e.jsx(l,{variant:"h5",component:"h2",children:s("studentSchedule.eventListTitle")}),e.jsx(Or,{statusFilters:u,onFilterChange:f,t:s})]}),o?e.jsx(g,{className:"loader-container",children:e.jsx(ue,{className:"loader"})}):e.jsx(Hr,{events:x,onSelectEvent:p,t:s})]}),e.jsx(qr,{event:n,open:!!n,onClose:b,onSendHomework:y,t:s})]})};function Gr(){const s=Ne(),t=s.pathname==="/login"||s.pathname==="/register";return e.jsxs(e.Fragment,{children:[e.jsx(ft,{}),!t&&e.jsx(Ht,{}),e.jsxs(Fs,{children:[e.jsx(z,{path:"/",element:e.jsx(Vt,{})}),e.jsx(z,{path:"/about",element:e.jsx(Jt,{})}),e.jsx(z,{path:"/achievements",element:e.jsx(Xt,{})}),e.jsx(z,{path:"/login",element:e.jsx(qe,{})}),e.jsx(z,{path:"/register",element:e.jsx(qe,{})}),e.jsx(z,{path:"/analysis",element:e.jsx(Sr,{})}),e.jsx(z,{path:"/verify-email",element:e.jsx(Ir,{})}),e.jsx(z,{path:"/coaches",element:e.jsx(_r,{})}),e.jsxs(z,{element:e.jsx(Zt,{}),children:[e.jsx(z,{path:"/editor",element:e.jsx(Ke,{})}),e.jsx(z,{path:"/profile",element:e.jsx(or,{})}),e.jsx(z,{path:"/users",element:e.jsx(ir,{})}),e.jsx(z,{path:"/students-shedule",element:e.jsx(Ur,{})}),e.jsx(z,{path:"/students",element:e.jsx(pr,{})}),e.jsx(z,{path:"/puzzle-editor",element:e.jsx(Ke,{})}),e.jsx(z,{path:"/inbox",element:e.jsx(Ar,{})})]})]})]})}function Yr(){return e.jsx(Ps,{children:e.jsx(a.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(Gr,{})})})}bs.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(Ft,{children:e.jsx(Yr,{})})}));
//# sourceMappingURL=index-BDqLyWoS.js.map
